import{__plugin_vue_export_helper_default as e,createElementBlock as t,createStaticVNode as n,openBlock as r}from"./chunks/plugin-vue_export-helper.Bts1mPc7.js";const i=JSON.parse(`{"title":"Documentation du module VM de Node.js","description":"Le module VM (Machine Virtuelle) de Node.js fournit des API pour compiler et exécuter du code dans des contextes de moteur JavaScript V8. Il permet de créer des environnements JavaScript isolés, de sandboxer l'exécution du code et de gérer les contextes de script.","frontmatter":{"title":"Documentation du module VM de Node.js","description":"Le module VM (Machine Virtuelle) de Node.js fournit des API pour compiler et exécuter du code dans des contextes de moteur JavaScript V8. Il permet de créer des environnements JavaScript isolés, de sandboxer l'exécution du code et de gérer les contextes de script.","head":[["meta",{"name":"og:title","content":"Documentation du module VM de Node.js | Node.js - iDoc.dev"}],["meta",{"name":"og:description","content":"Le module VM (Machine Virtuelle) de Node.js fournit des API pour compiler et exécuter du code dans des contextes de moteur JavaScript V8. Il permet de créer des environnements JavaScript isolés, de sandboxer l'exécution du code et de gérer les contextes de script."}],["meta",{"name":"twitter:title","content":"Documentation du module VM de Node.js | Node.js - iDoc.dev"}],["meta",{"name":"twitter:description","content":"Le module VM (Machine Virtuelle) de Node.js fournit des API pour compiler et exécuter du code dans des contextes de moteur JavaScript V8. Il permet de créer des environnements JavaScript isolés, de sandboxer l'exécution du code et de gérer les contextes de script."}],["link",{"rel":"canonical","href":"https://idoc.dev/fr/nodejs/api/vm"}],["meta",{"property":"og:url","content":"https://idoc.dev/fr/nodejs/api/vm"}]]},"headers":[],"relativePath":"fr/nodejs/api/vm.md","filePath":"fr/nodejs/api/vm.md","lastUpdated":null}`),a={name:`fr/nodejs/api/vm.md`};function o(e,i,a,o,s,c){return r(),t(`div`,null,i[0]||=[n(`<h1 id="vm-executing-javascript" tabindex="-1">VM (exécution de JavaScript) <a class="header-anchor" href="#vm-executing-javascript" aria-label="Permalink to “VM (exécution de JavaScript)”">​</a></h1><div class="tip custom-block"><p class="custom-block-title">[Stable: 2 - Stable]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable: 2</a> <a href="/fr/nodejs/api/documentation#stability-index">Stabilité: 2</a> - Stable</p></div><p><strong>Code source:</strong> <a href="https://github.com/nodejs/node/blob/v23.5.0/lib/vm.js" target="_blank" rel="noreferrer">lib/vm.js</a></p><p>Le module <code>node:vm</code> permet de compiler et d&#39;exécuter du code dans des contextes de machine virtuelle V8.</p><p><strong>Le module <code>node:vm</code> n&#39;est pas un mécanisme de sécurité. Ne l&#39;utilisez pas pour exécuter du code non fiable.</strong></p><p>Le code JavaScript peut être compilé et exécuté immédiatement ou compilé, enregistré et exécuté ultérieurement.</p><p>Un cas d&#39;utilisation courant est d&#39;exécuter le code dans un contexte V8 différent. Cela signifie que le code invoqué a un objet global différent du code invoquant.</p><p>On peut fournir le contexte en <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object"><em>contextualisant</em></a> un objet. Le code invoqué traite toute propriété du contexte comme une variable globale. Toute modification des variables globales causée par le code invoqué est reflétée dans l&#39;objet contexte.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { x: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Contextualiser l&#39;objet.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;x += 40; var y = 17;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`x\` et \`y\` sont des variables globales dans le contexte.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Initialement, x a la valeur 2 car c&#39;est la valeur de context.x.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code, context);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.x); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 42</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.y); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 17</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1; y n&#39;est pas défini.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="class-vmscript" tabindex="-1">Classe: <code>vm.Script</code> <a class="header-anchor" href="#class-vmscript" aria-label="Permalink to “Classe: vm.Script”">​</a></h2><p><strong>Ajoutée dans\xA0: v0.3.1</strong></p><p>Les instances de la classe <code>vm.Script</code> contiennent des scripts précompilés qui peuvent être exécutés dans des contextes spécifiques.</p><h3 id="new-vmscriptcode-options" tabindex="-1"><code>new vm.Script(code[, options])</code> <a class="header-anchor" href="#new-vmscriptcode-options" aria-label="Permalink to “new vm.Script(code[, options])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v21.7.0, v20.12.0</td><td>Ajout de la prise en charge de <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Ajout de la prise en charge des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr><tr><td>v10.6.0</td><td><code>produceCachedData</code> est obsolète et remplacée par <code>script.createCachedData()</code>.</td></tr><tr><td>v5.7.0</td><td>Les options <code>cachedData</code> et <code>produceCachedData</code> sont désormais prises en charge.</td></tr><tr><td>v0.3.1</td><td>Ajoutée dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le code JavaScript à compiler.</li><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a><ul><li><code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Spécifie le nom de fichier utilisé dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>&#39;evalmachine.\\&lt;anonymous\\&gt;&#39;</code>.</li><li><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>0</code>.</li><li><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>0</code>.</li><li><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou <code>TypedArray</code>, ou <code>DataView</code> facultatif avec les données du cache de code de V8 pour la source fournie. Lorsqu&#39;il est fourni, la valeur <code>cachedDataRejected</code> sera définie sur <code>true</code> ou <code>false</code> selon l&#39;acceptation des données par V8.</li><li><code>produceCachedData</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque la valeur est <code>true</code> et qu&#39;aucune <code>cachedData</code> n&#39;est présente, V8 tentera de produire des données de cache de code pour <code>code</code>. En cas de succès, un <code>Buffer</code> avec les données du cache de code de V8 sera produit et stocké dans la propriété <code>cachedData</code> de l&#39;instance <code>vm.Script</code> renvoyée. La valeur <code>cachedDataProduced</code> sera définie sur <code>true</code> ou <code>false</code> selon que les données du cache de code sont produites avec succès ou non. Cette option est <strong>obsolète</strong> en faveur de <code>script.createCachedData()</code>. <strong>Par défaut\xA0:</strong> <code>false</code>.</li><li><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés pendant l&#39;évaluation de ce script lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Prise en charge de <code>import()</code> dynamique dans les API de compilation</a>.</li></ul></li></ul><p>Si <code>options</code> est une chaîne de caractères, elle spécifie alors le nom de fichier.</p><p>La création d&#39;un nouvel objet <code>vm.Script</code> compile <code>code</code> mais ne l&#39;exécute pas. Le <code>vm.Script</code> compilé peut être exécuté plusieurs fois ultérieurement. Le <code>code</code> n&#39;est lié à aucun objet global\xA0; il est plutôt lié avant chaque exécution, juste pour cette exécution.</p><h3 id="scriptcacheddatarejected" tabindex="-1"><code>script.cachedDataRejected</code> <a class="header-anchor" href="#scriptcacheddatarejected" aria-label="Permalink to “script.cachedDataRejected”">​</a></h3><p><strong>Ajouté dans\xA0: v5.7.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a>\xA0| <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a></li></ul><p>Lorsque <code>cachedData</code> est fourni pour créer le <code>vm.Script</code>, cette valeur sera définie sur <code>true</code> ou <code>false</code> selon l&#39;acceptation des données par V8. Sinon, la valeur est <code>undefined</code>.</p><h3 id="scriptcreatecacheddata" tabindex="-1"><code>script.createCachedData()</code> <a class="header-anchor" href="#scriptcreatecacheddata" aria-label="Permalink to “script.createCachedData()”">​</a></h3><p><strong>Ajouté dans\xA0: v10.6.0</strong></p><ul><li>Retourne\xA0: <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul><p>Crée un cache de code qui peut être utilisé avec l&#39;option <code>cachedData</code> du constructeur <code>Script</code>. Retourne un <code>Buffer</code>. Cette méthode peut être appelée à tout moment et un nombre quelconque de fois.</p><p>Le cache de code du <code>Script</code> ne contient aucun état observable par JavaScript. Le cache de code peut être enregistré en toute sécurité avec le code source du script et utilisé pour construire de nouvelles instances de <code>Script</code> à plusieurs reprises.</p><p>Les fonctions du code source du <code>Script</code> peuvent être marquées comme étant compilées paresseusement et elles ne sont pas compilées lors de la construction du <code>Script</code>. Ces fonctions seront compilées lorsqu&#39;elles seront invoquées pour la première fois. Le cache de code sérialise les métadonnées que V8 connaît actuellement sur le <code>Script</code> qu&#39;il peut utiliser pour accélérer les compilations futures.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">function add(a, b) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  return a + b;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">const x = add(1, 2);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheWithoutAdd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createCachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dans \`cacheWithoutAdd\`, la fonction \`add()\` est marquée pour une compilation complète</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// lors de l&#39;invocation.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cacheWithAdd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createCachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`cacheWithAdd\` contient la fonction \`add()\` entièrement compilée.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="scriptrunincontextcontextifiedobject-options" tabindex="-1"><code>script.runInContext(contextifiedObject[, options])</code> <a class="header-anchor" href="#scriptrunincontextcontextifiedobject-options" aria-label="Permalink to “script.runInContext(contextifiedObject[, options])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajouté dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><p><code>contextifiedObject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Un objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextualisé</a> tel que renvoyé par la méthode <code>vm.createContext()</code>.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est attachée à la trace de la pile. <strong>Par défaut\xA0:</strong> <code>true</code>.</li><li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles <code>code</code> doit être exécuté avant d&#39;interrompre l&#39;exécution. Si l&#39;exécution est interrompue, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</li><li><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) interrompra l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut\xA0:</strong> <code>false</code>.</li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> le résultat de la toute dernière instruction exécutée dans le script.</p></li></ul><p>Exécute le code compilé contenu dans l&#39;objet <code>vm.Script</code> dans le <code>contextifiedObject</code> donné et retourne le résultat. L&#39;exécution du code n&#39;a pas accès à la portée locale.</p><p>L&#39;exemple suivant compile le code qui incrémente une variable globale, définit la valeur d&#39;une autre variable globale, puis exécute le code plusieurs fois. Les globales sont contenues dans l&#39;objet <code>context</code>.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  animal: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  count: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;count += 1; name = &quot;kitty&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Affiche\xA0: { animal: &#39;cat&#39;, count: 12, name: &#39;kitty&#39; }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>L&#39;utilisation des options <code>timeout</code> ou <code>breakOnSigint</code> entraînera le démarrage de nouvelles boucles d&#39;événements et de threads correspondants, ce qui entraînera une surcharge de performance non nulle.</p><h3 id="scriptruninnewcontextcontextobject-options" tabindex="-1"><code>script.runInNewContext([contextObject[, options]])</code> <a class="header-anchor" href="#scriptruninnewcontextcontextobject-options" aria-label="Permalink to “script.runInNewContext([contextObject[, options]])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v22.8.0, v20.18.0</td><td>L&#39;argument <code>contextObject</code> accepte désormais <code>vm.constants.DONT_CONTEXTIFY</code>.</td></tr><tr><td>v14.6.0</td><td>L&#39;option <code>microtaskMode</code> est désormais prise en charge.</td></tr><tr><td>v10.0.0</td><td>L&#39;option <code>contextCodeGeneration</code> est désormais prise en charge.</td></tr><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajoutée dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><p><code>contextObject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify">&lt;vm.constants.DONT_CONTEXTIFY&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a> Soit <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a>, soit un objet qui sera <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a>. Si <code>undefined</code>, un objet contextifié vide sera créé pour assurer la rétrocompatibilité.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><p><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est jointe à la trace de la pile. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles le <code>code</code> doit être exécuté avant d&#39;être interrompu. Si l&#39;exécution est interrompue, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</p></li><li><p><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) interrompra l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut\xA0:</strong> <code>false</code>.</p></li><li><p><code>contextName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Nom lisible du contexte nouvellement créé. <strong>Par défaut\xA0:</strong> <code>&#39;VM Context i&#39;</code>, où <code>i</code> est un index numérique ascendant du contexte créé.</p></li><li><p><code>contextOrigin</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" target="_blank" rel="noreferrer">Origine</a> correspondant au contexte nouvellement créé à des fins d&#39;affichage. L&#39;origine doit être formatée comme une URL, mais avec uniquement le schéma, l&#39;hôte et le port (si nécessaire), comme la valeur de la propriété <a href="/fr/nodejs/api/url#urlorigin"><code>url.origin</code></a> d&#39;un objet <a href="/fr/nodejs/api/url#class-url"><code>URL</code></a>. Plus précisément, cette chaîne doit omettre la barre oblique finale, car elle indique un chemin. <strong>Par défaut\xA0:</strong> <code>&#39;&#39;</code>.</p></li><li><p><code>contextCodeGeneration</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p></li><li><p><code>strings</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si la valeur est false, tout appel à <code>eval</code> ou aux constructeurs de fonctions (<code>Function</code>, <code>GeneratorFunction</code>, etc.) lèvera une <code>EvalError</code>. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>wasm</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si la valeur est false, toute tentative de compilation d&#39;un module WebAssembly lèvera une <code>WebAssembly.CompileError</code>. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>microtaskMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Si la valeur est <code>afterEvaluate</code>, les microtâches (tâches planifiées via des <code>Promise</code>s et des <code>async function</code>s) seront exécutées immédiatement après l&#39;exécution du script. Elles sont incluses dans les portées <code>timeout</code> et <code>breakOnSigint</code> dans ce cas.</p></li></ul></li><li><p>Retour\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> le résultat de la toute dernière instruction exécutée dans le script.</p></li></ul><p>Cette méthode est un raccourci vers <code>script.runInContext(vm.createContext(options), options)</code>. Elle effectue plusieurs opérations à la fois\xA0:</p><p>L&#39;exemple suivant compile du code qui définit une variable globale, puis exécute le code plusieurs fois dans différents contextes. Les variables globales sont définies et contenues dans chaque <code>contexte</code> individuel.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalVar = &quot;set&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contexts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{}, {}, {}];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contexts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contexts);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Affiche\xA0: [{ globalVar: &#39;set&#39; }, { globalVar: &#39;set&#39; }, { globalVar: &#39;set&#39; }]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ceci lèverait une erreur si le contexte est créé à partir d&#39;un objet contextifié.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vm.constants.DONT_CONTEXTIFY permet de créer des contextes avec des</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// objets globaux ordinaires qui peuvent être gelés.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> freezeScript</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Object.freeze(globalThis); globalThis;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> frozenContext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> freezeScript.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DONT_CONTEXTIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="scriptruninthiscontextoptions" tabindex="-1"><code>script.runInThisContext([options])</code> <a class="header-anchor" href="#scriptruninthiscontextoptions" aria-label="Permalink to “script.runInThisContext([options])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajoutée dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est attachée à la trace de la pile. <strong>Par défaut\xA0:</strong> <code>true</code>.</li><li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles le <code>code</code> doit être exécuté avant d&#39;interrompre l&#39;exécution. Si l&#39;exécution est interrompue, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</li><li><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) mettra fin à l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut\xA0:</strong> <code>false</code>.</li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> le résultat de la toute dernière instruction exécutée dans le script.</p></li></ul><p>Exécute le code compilé contenu dans le <code>vm.Script</code> dans le contexte de l&#39;objet <code>global</code> courant. L&#39;exécution du code n&#39;a pas accès à la portée locale, mais a <em>bien</em> accès à l&#39;objet <code>global</code> courant.</p><p>L&#39;exemple suivant compile du code qui incrémente une variable <code>global</code>, puis exécute ce code plusieurs fois\xA0:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global.globalVar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalVar += 1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { filename: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;myfile.vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(globalVar);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="scriptsourcemapurl" tabindex="-1"><code>script.sourceMapURL</code> <a class="header-anchor" href="#scriptsourcemapurl" aria-label="Permalink to “script.sourceMapURL”">​</a></h3><p><strong>Ajouté dans\xA0: v19.1.0, v18.13.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a></li></ul><p>Lorsque le script est compilé à partir d&#39;une source qui contient un commentaire magique de carte source, cette propriété est définie sur l&#39;URL de la carte source.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-480" id="tab-481" checked><label data-title="ESM" for="tab-481">ESM</label><input type="radio" name="group-480" id="tab-482"><label data-title="CJS" for="tab-482">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">function myFunc() {}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">//# sourceMappingURL=sourcemap.json</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(script.sourceMapURL);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: sourcemap.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">function myFunc() {}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">//# sourceMappingURL=sourcemap.json</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(script.sourceMapURL);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: sourcemap.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><h2 id="class-vmmodule" tabindex="-1">Classe\xA0: <code>vm.Module</code> <a class="header-anchor" href="#class-vmmodule" aria-label="Permalink to “Classe\xA0: vm.Module”">​</a></h2><p><strong>Ajouté dans\xA0: v13.0.0, v12.16.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable\xA0: 1 - Expérimental]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable\xA0: 1</a> <a href="/fr/nodejs/api/documentation#stability-index">Stabilité\xA0: 1</a> - Expérimental</p></div><p>Cette fonctionnalité n&#39;est disponible qu&#39;avec l&#39;indicateur de commande <code>--experimental-vm-modules</code> activé.</p><p>La classe <code>vm.Module</code> fournit une interface de bas niveau pour l&#39;utilisation des modules ECMAScript dans les contextes de VM. C&#39;est l&#39;homologue de la classe <code>vm.Script</code> qui reflète fidèlement les <a href="https://262.ecma-international.org/14.0/#sec-abstract-module-records" target="_blank" rel="noreferrer">Enregistrements de module</a> tels que définis dans la spécification ECMAScript.</p><p>Contrairement à <code>vm.Script</code>, cependant, chaque objet <code>vm.Module</code> est lié à un contexte dès sa création. Les opérations sur les objets <code>vm.Module</code> sont intrinsèquement asynchrones, contrairement à la nature synchrone des objets <code>vm.Script</code>. L&#39;utilisation de fonctions «\xA0async\xA0» peut faciliter la manipulation des objets <code>vm.Module</code>.</p><p>L&#39;utilisation d&#39;un objet <code>vm.Module</code> nécessite trois étapes distinctes\xA0: création/analyse, liaison et évaluation. Ces trois étapes sont illustrées dans l&#39;exemple suivant.</p><p>Cette implémentation se situe à un niveau inférieur à celui du <a href="/fr/nodejs/api/esm#modules-ecmascript-modules">chargeur de module ECMAScript</a>. Il n&#39;y a pas non plus de moyen d&#39;interagir avec le chargeur pour le moment, bien qu&#39;une prise en charge soit prévue.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-510" id="tab-511" checked><label data-title="ESM" for="tab-511">ESM</label><input type="radio" name="group-510" id="tab-512"><label data-title="CJS" for="tab-512">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextifiedObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  secret: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  print: console.log,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Step 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a Module by constructing a new \`vm.SourceTextModule\` object. This</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// parses the provided source text, throwing a \`SyntaxError\` if anything goes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// wrong. By default, a Module is created in the top context. But here, we</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// specify \`contextifiedObject\` as the context this Module belongs to.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Here, we attempt to obtain the default export from the module &quot;foo&quot;, and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// put it into local binding &quot;secret&quot;.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bar</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  import s from &#39;foo&#39;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  s;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  print(s);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { context: contextifiedObject });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Step 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;Link&quot; the imported dependencies of this Module to it.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The provided linking callback (the &quot;linker&quot;) accepts two arguments: the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// parent module (\`bar\` in this case) and the string that is the specifier of</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// the imported module. The callback is expected to return a Module that</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// corresponds to the provided specifier, with certain requirements documented</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// in \`module.link()\`.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// If linking has not started for the returned Module, the same linker</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// callback will be called on the returned Module.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Even top-level Modules without dependencies must be explicitly linked. The</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// callback provided would never be called, however.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// The link() method returns a Promise that will be resolved when all the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Promises returned by the linker resolve.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Note: This is a contrived example in that the linker function creates a new</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &quot;foo&quot; module every time it is called. In a full-fledged module system, a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// cache would probably be used to avoid duplicated modules.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> linker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">specifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">referencingModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (specifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      // The &quot;secret&quot; variable refers to the global variable we added to</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      // &quot;contextifiedObject&quot; when creating the context.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      export default secret;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { context: referencingModule.context });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Using \`contextifiedObject\` instead of \`referencingModule.context\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // here would work as well.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Unable to resolve dependency: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">specifier</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bar.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(linker);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Step 3</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Evaluate the Module. The evaluate() method returns a promise which will</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// resolve after the module has finished evaluating.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints 42.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bar.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextifiedObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  secret: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  print: console.log,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Step 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Create a Module by constructing a new \`vm.SourceTextModule\` object. This</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // parses the provided source text, throwing a \`SyntaxError\` if anything goes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // wrong. By default, a Module is created in the top context. But here, we</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // specify \`contextifiedObject\` as the context this Module belongs to.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Here, we attempt to obtain the default export from the module &quot;foo&quot;, and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // put it into local binding &quot;secret&quot;.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bar</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    import s from &#39;foo&#39;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    s;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    print(s);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  \`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { context: contextifiedObject });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Step 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // &quot;Link&quot; the imported dependencies of this Module to it.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // The provided linking callback (the &quot;linker&quot;) accepts two arguments: the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // parent module (\`bar\` in this case) and the string that is the specifier of</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // the imported module. The callback is expected to return a Module that</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // corresponds to the provided specifier, with certain requirements documented</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // in \`module.link()\`.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // If linking has not started for the returned Module, the same linker</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // callback will be called on the returned Module.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Even top-level Modules without dependencies must be explicitly linked. The</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // callback provided would never be called, however.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // The link() method returns a Promise that will be resolved when all the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Promises returned by the linker resolve.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Note: This is a contrived example in that the linker function creates a new</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // &quot;foo&quot; module every time it is called. In a full-fledged module system, a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // cache would probably be used to avoid duplicated modules.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> linker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">specifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">referencingModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (specifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        // The &quot;secret&quot; variable refers to the global variable we added to</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        // &quot;contextifiedObject&quot; when creating the context.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        export default secret;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      \`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { context: referencingModule.context });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Using \`contextifiedObject\` instead of \`referencingModule.context\`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // here would work as well.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Unable to resolve dependency: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">specifier</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bar.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(linker);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Step 3</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Evaluate the Module. The evaluate() method returns a promise which will</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // resolve after the module has finished evaluating.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Prints 42.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bar.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div></div></div><h3 id="moduledependencyspecifiers" tabindex="-1"><code>module.dependencySpecifiers</code> <a class="header-anchor" href="#moduledependencyspecifiers" aria-label="Permalink to “module.dependencySpecifiers”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a></li></ul><p>Les spécificateurs de toutes les dépendances de ce module. Le tableau renvoyé est gelé pour interdire toute modification.</p><p>Correspond au champ <code>[[RequestedModules]]</code> des <a href="https://tc39.es/ecma262/#sec-cyclic-module-records" target="_blank" rel="noreferrer">enregistrements de modules cycliques</a> dans la spécification ECMAScript.</p><h3 id="moduleerror" tabindex="-1"><code>module.error</code> <a class="header-anchor" href="#moduleerror" aria-label="Permalink to “module.error”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a></li></ul><p>Si le <code>module.status</code> est <code>&#39;errored&#39;</code>, cette propriété contient l&#39;exception levée par le module lors de l&#39;évaluation. Si le statut est autre, l&#39;accès à cette propriété entraînera une exception levée.</p><p>La valeur <code>undefined</code> ne peut pas être utilisée dans les cas où il n&#39;y a pas d&#39;exception levée en raison d&#39;une possible ambiguïté avec <code>throw undefined;</code>.</p><p>Correspond au champ <code>[[EvaluationError]]</code> des <a href="https://tc39.es/ecma262/#sec-cyclic-module-records" target="_blank" rel="noreferrer">enregistrements de modules cycliques</a> dans la spécification ECMAScript.</p><h3 id="moduleevaluateoptions" tabindex="-1"><code>module.evaluate([options])</code> <a class="header-anchor" href="#moduleevaluateoptions" aria-label="Permalink to “module.evaluate([options])”">​</a></h3><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pour évaluer avant de mettre fin à l&#39;exécution. Si l&#39;exécution est interrompue, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</li><li><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) mettra fin à l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut\xA0:</strong> <code>false</code>.</li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noreferrer">&lt;Promise&gt;</a> Se réalise avec <code>undefined</code> en cas de succès.</p></li></ul><p>Évaluer le module.</p><p>Cela doit être appelé après que le module a été lié\xA0; sinon, il sera rejeté. Il pourrait également être appelé lorsque le module a déjà été évalué, auquel cas, soit il ne fera rien si l&#39;évaluation initiale s&#39;est terminée avec succès (<code>module.status</code> est <code>&#39;evaluated&#39;</code>), soit il relancera l&#39;exception qui a résulté de l&#39;évaluation initiale (<code>module.status</code> est <code>&#39;errored&#39;</code>).</p><p>Cette méthode ne peut pas être appelée pendant que le module est en cours d&#39;évaluation (<code>module.status</code> est <code>&#39;evaluating&#39;</code>).</p><p>Correspond au champ <a href="https://tc39.es/ecma262/#sec-moduleevaluation" target="_blank" rel="noreferrer">méthode concrète Evaluate()</a> des <a href="https://tc39.es/ecma262/#sec-cyclic-module-records" target="_blank" rel="noreferrer">enregistrements de modules cycliques</a> dans la spécification ECMAScript.</p><h3 id="moduleidentifier" tabindex="-1"><code>module.identifier</code> <a class="header-anchor" href="#moduleidentifier" aria-label="Permalink to “module.identifier”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></li></ul><p>L&#39;identifiant du module courant, tel que défini dans le constructeur.</p><h3 id="modulelinklinker" tabindex="-1"><code>module.link(linker)</code> <a class="header-anchor" href="#modulelinklinker" aria-label="Permalink to “module.link(linker)”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v21.1.0, v20.10.0, v18.19.0</td><td>L&#39;option <code>extra.assert</code> est renommée en <code>extra.attributes</code>. L&#39;ancien nom est toujours fourni pour assurer la rétrocompatibilité.</td></tr></tbody></table></div><ul><li><p><code>linker</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a></p><ul><li><p><code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le spécificateur du module demandé\xA0:</p></li><li><p><code>referencingModule</code> <a href="/fr/nodejs/api/vm#class-vmmodule">&lt;vm.Module&gt;</a> L&#39;objet <code>Module</code> sur lequel <code>link()</code> est appelé.</p></li><li><p><code>extra</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p></li><li><p><code>attributes</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Les données de l&#39;attribut\xA0: Conformément à la norme ECMA-262, les hôtes doivent déclencher une erreur si un attribut non pris en charge est présent.</p></li><li><p><code>assert</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Alias pour <code>extra.attributes</code>.</p></li><li><p>Renvoie\xA0: <a href="/fr/nodejs/api/vm#class-vmmodule">&lt;vm.Module&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noreferrer">&lt;Promise&gt;</a></p></li></ul></li><li><p>Renvoie\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noreferrer">&lt;Promise&gt;</a></p></li></ul><p>Lie les dépendances du module. Cette méthode doit être appelée avant l&#39;évaluation et ne peut être appelée qu&#39;une seule fois par module.</p><p>La fonction doit renvoyer un objet <code>Module</code> ou une <code>Promise</code> qui finit par se résoudre en un objet <code>Module</code>. Le <code>Module</code> renvoyé doit satisfaire aux deux invariants suivants\xA0:</p><ul><li>Il doit appartenir au même contexte que le <code>Module</code> parent.</li><li>Son <code>status</code> ne doit pas être <code>&#39;errored&#39;</code>.</li></ul><p>Si le <code>status</code> du <code>Module</code> renvoyé est <code>&#39;unlinked&#39;</code>, cette méthode sera appelée de manière récursive sur le <code>Module</code> renvoyé avec la même fonction <code>linker</code> fournie.</p><p><code>link()</code> renvoie une <code>Promise</code> qui sera soit résolue lorsque toutes les instances de liaison se résoudront en un <code>Module</code> valide, soit rejetée si la fonction de liaison lève une exception ou renvoie un <code>Module</code> non valide.</p><p>La fonction de liaison correspond approximativement à l&#39;opération abstraite <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" target="_blank" rel="noreferrer">HostResolveImportedModule</a> définie par l&#39;implémentation dans la spécification ECMAScript, avec quelques différences essentielles\xA0:</p><ul><li>La fonction de liaison est autorisée à être asynchrone tandis que <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" target="_blank" rel="noreferrer">HostResolveImportedModule</a> est synchrone.</li></ul><p>L&#39;implémentation réelle de <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" target="_blank" rel="noreferrer">HostResolveImportedModule</a> utilisée pendant la liaison du module est celle qui renvoie les modules liés pendant la liaison. Étant donné qu&#39;à ce stade, tous les modules auraient déjà été entièrement liés, l&#39;implémentation de <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" target="_blank" rel="noreferrer">HostResolveImportedModule</a> est entièrement synchrone conformément à la spécification.</p><p>Correspond au champ <a href="https://tc39.es/ecma262/#sec-moduledeclarationlinking" target="_blank" rel="noreferrer">Link() concrete method</a> des <a href="https://tc39.es/ecma262/#sec-cyclic-module-records" target="_blank" rel="noreferrer">Cyclic Module Record</a> dans la spécification ECMAScript.</p><h3 id="modulenamespace" tabindex="-1"><code>module.namespace</code> <a class="header-anchor" href="#modulenamespace" aria-label="Permalink to “module.namespace”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>L&#39;objet d&#39;espace de noms du module. Il n&#39;est disponible qu&#39;une fois la liaison (<code>module.link()</code>) terminée.</p><p>Correspond à l&#39;opération abstraite <a href="https://tc39.es/ecma262/#sec-getmodulenamespace" target="_blank" rel="noreferrer">GetModuleNamespace</a> dans la spécification ECMAScript.</p><h3 id="modulestatus" tabindex="-1"><code>module.status</code> <a class="header-anchor" href="#modulestatus" aria-label="Permalink to “module.status”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></li></ul><p>L&#39;état actuel du module. Il prendra l&#39;une des valeurs suivantes\xA0:</p><ul><li><code>&#39;unlinked&#39;</code>\xA0: <code>module.link()</code> n&#39;a pas encore été appelé.</li><li><code>&#39;linking&#39;</code>\xA0: <code>module.link()</code> a été appelé, mais toutes les Promises renvoyées par la fonction de liaison n&#39;ont pas encore été résolues.</li><li><code>&#39;linked&#39;</code>\xA0: Le module a été lié avec succès, et toutes ses dépendances sont liées, mais <code>module.evaluate()</code> n&#39;a pas encore été appelé.</li><li><code>&#39;evaluating&#39;</code>\xA0: Le module est en cours d&#39;évaluation par le biais d&#39;un <code>module.evaluate()</code> sur lui-même ou sur un module parent.</li><li><code>&#39;evaluated&#39;</code>\xA0: Le module a été évalué avec succès.</li><li><code>&#39;errored&#39;</code>\xA0: Le module a été évalué, mais une exception a été levée.</li></ul><p>Hormis <code>&#39;errored&#39;</code>, cette chaîne d&#39;état correspond au champ <code>[[Status]]</code> du <a href="https://tc39.es/ecma262/#sec-cyclic-module-records" target="_blank" rel="noreferrer">Cyclic Module Record</a> de la spécification. <code>&#39;errored&#39;</code> correspond à <code>&#39;evaluated&#39;</code> dans la spécification, mais avec <code>[[EvaluationError]]</code> défini sur une valeur qui n&#39;est pas <code>undefined</code>.</p><h2 id="class-vmsourcetextmodule" tabindex="-1">Classe\xA0: <code>vm.SourceTextModule</code> <a class="header-anchor" href="#class-vmsourcetextmodule" aria-label="Permalink to “Classe\xA0: vm.SourceTextModule”">​</a></h2><p><strong>Ajouté dans\xA0: v9.6.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable\xA0: 1 - Expérimental]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable\xA0: 1</a> <a href="/fr/nodejs/api/documentation#stability-index">Stabilité\xA0: 1</a> - Expérimental</p></div><p>Cette fonctionnalité n&#39;est disponible qu&#39;avec l&#39;option de ligne de commande <code>--experimental-vm-modules</code> activée.</p><ul><li>Étend\xA0: <a href="/fr/nodejs/api/vm#class-vmmodule">&lt;vm.Module&gt;</a></li></ul><p>La classe <code>vm.SourceTextModule</code> fournit l&#39;<a href="https://tc39.es/ecma262/#sec-source-text-module-records" target="_blank" rel="noreferrer">enregistrement de module de texte source</a> tel que défini dans la spécification ECMAScript.</p><h3 id="new-vmsourcetextmodulecode-options" tabindex="-1"><code>new vm.SourceTextModule(code[, options])</code> <a class="header-anchor" href="#new-vmsourcetextmodulecode-options" aria-label="Permalink to “new vm.SourceTextModule(code[, options])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v17.0.0, v16.12.0</td><td>Ajout du support des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr></tbody></table></div><ul><li><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Code JavaScript du module à analyser</li><li><code>options</code><ul><li><p><code>identifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Chaîne utilisée dans les traces de pile. <strong>Par défaut\xA0:</strong> <code>&#39;vm:module(i)&#39;</code> où <code>i</code> est un index ascendant spécifique au contexte.</p></li><li><p><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou un <code>TypedArray</code> ou <code>DataView</code> facultatif avec les données du cache de code V8 pour la source fournie. Le <code>code</code> doit être le même que le module à partir duquel ce <code>cachedData</code> a été créé.</p></li><li><p><code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> L&#39;objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> tel que renvoyé par la méthode <code>vm.createContext()</code>, pour compiler et évaluer ce <code>Module</code> dans. Si aucun contexte n&#39;est spécifié, le module est évalué dans le contexte d&#39;exécution actuel.</p></li><li><p><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce <code>Module</code>. <strong>Par défaut\xA0:</strong> <code>0</code>.</p></li><li><p><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce <code>Module</code>. <strong>Par défaut\xA0:</strong> <code>0</code>.</p></li><li><p><code>initializeImportMeta</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> Appelée lors de l&#39;évaluation de ce <code>Module</code> pour initialiser le <code>import.meta</code>.</p></li><li><p><code>meta</code> <a href="/fr/nodejs/api/esm#importmeta">&lt;import.meta&gt;</a></p></li><li><p><code>module</code> <a href="/fr/nodejs/api/vm#class-vmsourcetextmodule">&lt;vm.SourceTextModule&gt;</a></p></li><li><p><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés lors de l&#39;évaluation de ce module lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Support of dynamic <code>import()</code> in compilation APIs</a>.</p></li></ul></li></ul><p>Crée une nouvelle instance de <code>SourceTextModule</code>.</p><p>Les propriétés affectées à l&#39;objet <code>import.meta</code> qui sont des objets peuvent permettre au module d&#39;accéder à des informations en dehors du <code>contexte</code> spécifié. Utilisez <code>vm.runInContext()</code> pour créer des objets dans un contexte spécifique.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-892" id="tab-893" checked><label data-title="ESM" for="tab-893">ESM</label><input type="radio" name="group-892" id="tab-894"><label data-title="CJS" for="tab-894">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextifiedObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ secret: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Object.getPrototypeOf(import.meta.prop).secret = secret;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    initializeImportMeta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Note: this object is created in the top context. As such,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Object.getPrototypeOf(import.meta.prop) points to the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Object.prototype in the top context rather than that in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // the contextified object.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      meta.prop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Since module has no dependencies, the linker function will never be called.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Now, Object.prototype.secret will be equal to 42.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// To fix this problem, replace</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     meta.prop = {};</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// above with</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     meta.prop = vm.runInContext(&#39;{}&#39;, contextifiedObject);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextifiedObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ secret: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;Object.getPrototypeOf(import.meta.prop).secret = secret;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      initializeImportMeta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Note: this object is created in the top context. As such,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Object.getPrototypeOf(import.meta.prop) points to the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Object.prototype in the top context rather than that in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // the contextified object.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        meta.prop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Since module has no dependencies, the linker function will never be called.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Now, Object.prototype.secret will be equal to 42.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // To fix this problem, replace</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //     meta.prop = {};</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // above with</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //     meta.prop = vm.runInContext(&#39;{}&#39;, contextifiedObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div></div><h3 id="sourcetextmodulecreatecacheddata" tabindex="-1"><code>sourceTextModule.createCachedData()</code> <a class="header-anchor" href="#sourcetextmodulecreatecacheddata" aria-label="Permalink to “sourceTextModule.createCachedData()”">​</a></h3><p><strong>Ajouté dans\xA0: v13.7.0, v12.17.0</strong></p><ul><li>Renvoie\xA0: <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul><p>Crée un cache de code qui peut être utilisé avec l&#39;option <code>cachedData</code> du constructeur <code>SourceTextModule</code>. Renvoie un <code>Buffer</code>. Cette méthode peut être appelée un nombre quelconque de fois avant que le module n&#39;ait été évalué.</p><p>Le cache de code de <code>SourceTextModule</code> ne contient aucun état observable par JavaScript. Le cache de code peut être enregistré en toute sécurité avec le code source et utilisé pour construire de nouvelles instances de <code>SourceTextModule</code> plusieurs fois.</p><p>Les fonctions dans la source <code>SourceTextModule</code> peuvent être marquées comme étant compilées paresseusement et elles ne sont pas compilées lors de la construction de <code>SourceTextModule</code>. Ces fonctions seront compilées lorsqu&#39;elles seront invoquées pour la première fois. Le cache de code sérialise les métadonnées que V8 connaît actuellement sur le <code>SourceTextModule</code> qu&#39;il peut utiliser pour accélérer les compilations futures.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create an initial module</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;const a = 1;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create cached data from this module</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cachedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createCachedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a new module using the cached data. The code must be the same.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;const a = 1;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { cachedData });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="class-vmsyntheticmodule" tabindex="-1">Classe\xA0: <code>vm.SyntheticModule</code> <a class="header-anchor" href="#class-vmsyntheticmodule" aria-label="Permalink to “Classe\xA0: vm.SyntheticModule”">​</a></h2><p><strong>Ajouté dans\xA0: v13.0.0, v12.16.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/fr/nodejs/api/documentation#stability-index">Stability: 1</a> - Expérimental</p></div><p>Cette fonctionnalité n&#39;est disponible qu&#39;avec l&#39;indicateur de commande <code>--experimental-vm-modules</code> activé.</p><ul><li>Etend\xA0: <a href="/fr/nodejs/api/vm#class-vmmodule">&lt;vm.Module&gt;</a></li></ul><p>La classe <code>vm.SyntheticModule</code> fournit le <a href="https://heycam.github.io/webidl/#synthetic-module-records" target="_blank" rel="noreferrer">Synthetic Module Record</a> tel que défini dans la spécification WebIDL. Le but des modules synthétiques est de fournir une interface générique pour exposer des sources non-JavaScript aux graphes de modules ECMAScript.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{ &quot;a&quot;: 1 }&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;default&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(source);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;default&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, obj);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Use \`module\` in linking...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="new-vmsyntheticmoduleexportnames-evaluatecallback-options" tabindex="-1"><code>new vm.SyntheticModule(exportNames, evaluateCallback[, options])</code> <a class="header-anchor" href="#new-vmsyntheticmoduleexportnames-evaluatecallback-options" aria-label="Permalink to “new vm.SyntheticModule(exportNames, evaluateCallback[, options])”">​</a></h3><p><strong>Ajouté dans\xA0: v13.0.0, v12.16.0</strong></p><ul><li><code>exportNames</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> Tableau de noms qui seront exportés depuis le module.</li><li><code>evaluateCallback</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> Appelée lorsque le module est évalué.</li><li><code>options</code><ul><li><code>identifier</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noreferrer">&lt;string&gt;</a> Chaîne utilisée dans les traces de pile. <strong>Par défaut\xA0:</strong> <code>&#39;vm:module(i)&#39;</code> où <code>i</code> est un index ascendant spécifique au contexte.</li><li><code>context</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> L&#39;objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> tel que renvoyé par la méthode <code>vm.createContext()</code> afin de compiler et d&#39;évaluer ce <code>Module</code> dans ce contexte.</li></ul></li></ul><p>Crée une nouvelle instance de <code>SyntheticModule</code>.</p><p>Les objets assignés aux exports de cette instance peuvent permettre aux importateurs du module d&#39;accéder à des informations en dehors du <code>contexte</code> spécifié. Utilisez <code>vm.runInContext()</code> pour créer des objets dans un contexte spécifique.</p><h3 id="syntheticmodulesetexportname-value" tabindex="-1"><code>syntheticModule.setExport(name, value)</code> <a class="header-anchor" href="#syntheticmodulesetexportname-value" aria-label="Permalink to “syntheticModule.setExport(name, value)”">​</a></h3><p><strong>Ajouté dans\xA0: v13.0.0, v12.16.0</strong></p><ul><li><code>name</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" rel="noreferrer">&lt;string&gt;</a> Nom de l&#39;export à définir.</li><li><code>value</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> La valeur à laquelle définir l&#39;export.</li></ul><p>Cette méthode est utilisée après que le module est lié pour définir les valeurs des exports. Si elle est appelée avant que le module ne soit lié, une erreur <a href="/fr/nodejs/api/errors#err-vm-module-status"><code>ERR_VM_MODULE_STATUS</code></a> sera levée.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1006" id="tab-1007" checked><label data-title="ESM" for="tab-1007">ESM</label><input type="radio" name="group-1006" id="tab-1008"><label data-title="CJS" for="tab-1008">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">assert.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strictEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m.namespace.x, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  assert.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strictEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m.namespace.x, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><h2 id="vmcompilefunctioncode-params-options" tabindex="-1"><code>vm.compileFunction(code[, params[, options]])</code> <a class="header-anchor" href="#vmcompilefunctioncode-params-options" aria-label="Permalink to “vm.compileFunction(code[, params[, options]])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v21.7.0, v20.12.0</td><td>Ajout du support de <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v19.6.0, v18.15.0</td><td>La valeur de retour inclut maintenant <code>cachedDataRejected</code> avec la même sémantique que la version <code>vm.Script</code> si l&#39;option <code>cachedData</code> a été passée.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Ajout du support des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr><tr><td>v15.9.0</td><td>Ajout de nouveau de l&#39;option <code>importModuleDynamically</code>.</td></tr><tr><td>v14.3.0</td><td>Suppression de <code>importModuleDynamically</code> en raison de problèmes de compatibilité.</td></tr><tr><td>v14.1.0, v13.14.0</td><td>L&#39;option <code>importModuleDynamically</code> est maintenant supportée.</td></tr><tr><td>v10.10.0</td><td>Ajoutée dans : v10.10.0</td></tr></tbody></table></div><ul><li><p><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le corps de la fonction à compiler.</p></li><li><p><code>params</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> Un tableau de chaînes contenant tous les paramètres de la fonction.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Spécifie le nom de fichier utilisé dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>&#39;&#39;</code>.</li><li><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou <code>TypedArray</code> ou <code>DataView</code> optionnel avec les données de cache de code V8 pour la source fournie. Cela doit être produit par un appel antérieur à <a href="/fr/nodejs/api/vm#vmcompilefunctioncode-params-options"><code>vm.compileFunction()</code></a> avec le même <code>code</code> et <code>params</code>.</li><li><code>produceCachedData</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Spécifie s&#39;il faut produire de nouvelles données de cache. <strong>Par défaut :</strong> <code>false</code>.</li><li><code>parsingContext</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> L&#39;objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> dans lequel ladite fonction doit être compilée.</li><li><code>contextExtensions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object[]&gt;</a> Un tableau contenant une collection d&#39;extensions de contexte (objets enveloppant la portée actuelle) à appliquer lors de la compilation. <strong>Par défaut :</strong> <code>[]</code>.</li></ul></li><li><p><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés pendant l&#39;évaluation de cette fonction lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API de modules expérimentale. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Support of dynamic <code>import()</code> in compilation APIs</a>.</p></li><li><p>Retourne : <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a></p></li></ul><p>Compile le code donné dans le contexte fourni (si aucun contexte n&#39;est fourni, le contexte actuel est utilisé), et le renvoie enveloppé dans une fonction avec les <code>params</code> donnés.</p><h2 id="vmconstants" tabindex="-1"><code>vm.constants</code> <a class="header-anchor" href="#vmconstants" aria-label="Permalink to “vm.constants”">​</a></h2><p><strong>Ajouté dans\xA0: v21.7.0, v20.12.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>Renvoie un objet contenant des constantes couramment utilisées pour les opérations VM.</p><h3 id="vmconstantsuse_main_context_default_loader" tabindex="-1"><code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code> <a class="header-anchor" href="#vmconstantsuse_main_context_default_loader" aria-label="Permalink to “vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER”">​</a></h3><p><strong>Ajouté dans\xA0: v21.7.0, v20.12.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/fr/nodejs/api/documentation#stability-index">Stability: 1</a>.1 - Développement actif</p></div><p>Une constante qui peut être utilisée comme option <code>importModuleDynamically</code> pour <code>vm.Script</code> et <code>vm.compileFunction()</code> afin que Node.js utilise le chargeur ESM par défaut du contexte principal pour charger le module demandé.</p><p>Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Prise en charge de <code>import()</code> dynamique dans les API de compilation</a>.</p><h2 id="vmcreatecontextcontextobject-options" tabindex="-1"><code>vm.createContext([contextObject[, options]])</code> <a class="header-anchor" href="#vmcreatecontextcontextobject-options" aria-label="Permalink to “vm.createContext([contextObject[, options]])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v22.8.0, v20.18.0</td><td>L&#39;argument <code>contextObject</code> accepte désormais <code>vm.constants.DONT_CONTEXTIFY</code>.</td></tr><tr><td>v21.7.0, v20.12.0</td><td>Ajout de la prise en charge de <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v21.2.0, v20.11.0</td><td>L&#39;option <code>importModuleDynamically</code> est désormais prise en charge.</td></tr><tr><td>v14.6.0</td><td>L&#39;option <code>microtaskMode</code> est désormais prise en charge.</td></tr><tr><td>v10.0.0</td><td>Le premier argument ne peut plus être une fonction.</td></tr><tr><td>v10.0.0</td><td>L&#39;option <code>codeGeneration</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajouté dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><p><code>contextObject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify">&lt;vm.constants.DONT_CONTEXTIFY&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a> Soit <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a>, soit un objet qui sera <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a>. Si <code>undefined</code>, un objet contextifié vide sera créé pour assurer la rétrocompatibilité.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><p><code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Nom lisible du contexte nouvellement créé. <strong>Default:</strong> <code>&#39;VM Context i&#39;</code>, où <code>i</code> est un index numérique ascendant du contexte créé.</p></li><li><p><code>origin</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" target="_blank" rel="noreferrer">Origine</a> correspondant au contexte nouvellement créé à des fins d&#39;affichage. L&#39;origine doit être formatée comme une URL, mais avec uniquement le schéma, l&#39;hôte et le port (si nécessaire), comme la valeur de la propriété <a href="/fr/nodejs/api/url#urlorigin"><code>url.origin</code></a> d&#39;un objet <a href="/fr/nodejs/api/url#class-url"><code>URL</code></a>. Plus particulièrement, cette chaîne doit omettre la barre oblique de fin, car elle indique un chemin d&#39;accès. <strong>Default:</strong> <code>&#39;&#39;</code>.</p></li><li><p><code>codeGeneration</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p></li><li><p><code>strings</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si elle est définie sur false, tout appel à <code>eval</code> ou à des constructeurs de fonctions (<code>Function</code>, <code>GeneratorFunction</code>, etc.) lèvera une <code>EvalError</code>. <strong>Default:</strong> <code>true</code>.</p></li><li><p><code>wasm</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si elle est définie sur false, toute tentative de compilation d&#39;un module WebAssembly lèvera une <code>WebAssembly.CompileError</code>. <strong>Default:</strong> <code>true</code>.</p></li><li><p><code>microtaskMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> S&#39;il est défini sur <code>afterEvaluate</code>, les microtâches (tâches planifiées via des <code>Promise</code> et des <code>async function</code>) seront exécutées immédiatement après qu&#39;un script a été exécuté via <a href="/fr/nodejs/api/vm#scriptrunincontextcontextifiedobject-options"><code>script.runInContext()</code></a>. Elles sont incluses dans les portées <code>timeout</code> et <code>breakOnSigint</code> dans ce cas.</p></li><li><p><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisée pour spécifier comment les modules doivent être chargés lorsque <code>import()</code> est appelé dans ce contexte sans script de référence ni module. Cette option fait partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Prise en charge de <code>import()</code> dynamique dans les API de compilation</a>.</p></li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Objet contextifié.</p></li></ul><p>Si le <code>contextObject</code> donné est un objet, la méthode <code>vm.createContext()</code> va <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">préparer cet objet</a> et renvoyer une référence à celui-ci afin qu&#39;il puisse être utilisé dans les appels à <a href="/fr/nodejs/api/vm#vmrunincontextcode-contextifiedobject-options"><code>vm.runInContext()</code></a> ou <a href="/fr/nodejs/api/vm#scriptrunincontextcontextifiedobject-options"><code>script.runInContext()</code></a>. Dans de tels scripts, l&#39;objet global sera encapsulé par le <code>contextObject</code>, conservant toutes ses propriétés existantes, mais ayant également les objets et fonctions intégrés que tout <a href="https://es5.github.io/#x15.1" target="_blank" rel="noreferrer">objet global</a> standard possède. En dehors des scripts exécutés par le module vm, les variables globales resteront inchangées.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global.globalVar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { globalVar: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalVar *= 2;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: { globalVar: 2 }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global.globalVar);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Si <code>contextObject</code> est omis (ou passé explicitement comme <code>undefined</code>), un nouvel objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> vide sera renvoyé.</p><p>Lorsque l&#39;objet global dans le contexte nouvellement créé est <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a>, il présente certaines particularités par rapport aux objets globaux ordinaires. Par exemple, il ne peut pas être gelé. Pour créer un contexte sans les particularités de la contextification, passez <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a> comme argument <code>contextObject</code>. Consultez la documentation de <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a> pour plus de détails.</p><p>La méthode <code>vm.createContext()</code> est principalement utile pour créer un contexte unique qui peut être utilisé pour exécuter plusieurs scripts. Par exemple, si vous émulez un navigateur Web, la méthode peut être utilisée pour créer un contexte unique représentant l&#39;objet global d&#39;une fenêtre, puis exécuter toutes les balises <code>\\&lt;script\\&gt;</code> ensemble dans ce contexte.</p><p>Le <code>name</code> et l&#39;<code>origin</code> fournis du contexte sont rendus visibles via l&#39;API Inspector.</p><h2 id="vmiscontextobject" tabindex="-1"><code>vm.isContext(object)</code> <a class="header-anchor" href="#vmiscontextobject" aria-label="Permalink to “vm.isContext(object)”">​</a></h2><p><strong>Ajouté dans\xA0: v0.11.7</strong></p><ul><li><code>object</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li><li>Retourne\xA0: <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a></li></ul><p>Retourne <code>true</code> si l&#39;objet <code>object</code> donné a été <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> en utilisant <a href="/fr/nodejs/api/vm#vmcreatecontextcontextobject-options"><code>vm.createContext()</code></a>, ou si c&#39;est l&#39;objet global d&#39;un contexte créé en utilisant <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a>.</p><h2 id="vmmeasurememoryoptions" tabindex="-1"><code>vm.measureMemory([options])</code> <a class="header-anchor" href="#vmmeasurememoryoptions" aria-label="Permalink to “vm.measureMemory([options])”">​</a></h2><p><strong>Ajouté dans\xA0: v13.10.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Expérimental]</p><p><a href="/fr/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/fr/nodejs/api/documentation#stability-index">Stabilité\xA0: 1</a> - Expérimental</p></div><p>Mesure la mémoire connue de V8 et utilisée par tous les contextes connus de l&#39;isolate V8 actuel, ou le contexte principal.</p><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Optionnel.</p><ul><li><code>mode</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Soit <code>&#39;summary&#39;</code> ou <code>&#39;detailed&#39;</code>. En mode résumé, seule la mémoire mesurée pour le contexte principal sera renvoyée. En mode détaillé, la mémoire mesurée pour tous les contextes connus de l&#39;isolate V8 actuel sera renvoyée. <strong>Par défaut\xA0:</strong> <code>&#39;summary&#39;</code></li><li><code>execution</code> <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Soit <code>&#39;default&#39;</code> ou <code>&#39;eager&#39;</code>. Avec l&#39;exécution par défaut, la promesse ne sera résolue qu&#39;après le démarrage de la prochaine collecte des ordures planifiée, ce qui peut prendre un certain temps (voire jamais si le programme se termine avant le prochain GC). Avec l&#39;exécution anticipée, le GC démarrera immédiatement pour mesurer la mémoire. <strong>Par défaut\xA0:</strong> <code>&#39;default&#39;</code></li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noreferrer">&lt;Promise&gt;</a> Si la mémoire est mesurée avec succès, la promesse se résoudra avec un objet contenant des informations sur l&#39;utilisation de la mémoire. Sinon, elle sera rejetée avec une erreur <code>ERR_CONTEXT_NOT_INITIALIZED</code>.</p></li></ul><p>Le format de l&#39;objet avec lequel la Promise retournée peut se résoudre est spécifique au moteur V8 et peut changer d&#39;une version de V8 à l&#39;autre.</p><p>Le résultat renvoyé est différent des statistiques renvoyées par <code>v8.getHeapSpaceStatistics()</code> en ce sens que <code>vm.measureMemory()</code> mesure la mémoire accessible par chaque contexte spécifique de V8 dans l&#39;instance actuelle du moteur V8, tandis que le résultat de <code>v8.getHeapSpaceStatistics()</code> mesure la mémoire occupée par chaque espace de tas dans l&#39;instance V8 actuelle.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Mesure la mémoire utilisée par le contexte principal.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">measureMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;summary&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Ceci est identique à vm.measureMemory()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Le format actuel est\xA0:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   total: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //      jsMemoryEstimate: 2418479, jsMemoryRange: [ 2418479, 2745799 ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">measureMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;detailed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, execution: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;eager&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Référence le contexte ici afin qu&#39;il ne soit pas collecté par le GC</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // jusqu&#39;à ce que la mesure soit terminée.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.a);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   total: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     jsMemoryEstimate: 2574732,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     jsMemoryRange: [ 2574732, 2904372 ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   current: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     jsMemoryEstimate: 2438996,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     jsMemoryRange: [ 2438996, 2768636 ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   other: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //       jsMemoryEstimate: 135736,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //       jsMemoryRange: [ 135736, 465376 ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //     }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   ]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="vmrunincontextcode-contextifiedobject-options" tabindex="-1"><code>vm.runInContext(code, contextifiedObject[, options])</code> <a class="header-anchor" href="#vmrunincontextcode-contextifiedobject-options" aria-label="Permalink to “vm.runInContext(code, contextifiedObject[, options])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v21.7.0, v20.12.0</td><td>Ajout du support de <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Ajout du support des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajoutée dans : v0.3.1</td></tr></tbody></table></div><ul><li><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le code JavaScript à compiler et à exécuter.</li><li><code>contextifiedObject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> L&#39;objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> qui sera utilisé comme <code>global</code> lorsque le <code>code</code> sera compilé et exécuté.</li><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a><ul><li><code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Spécifie le nom de fichier utilisé dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>&#39;evalmachine.\\&lt;anonymous\\&gt;&#39;</code>.</li><li><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est ajoutée à la trace de pile. <strong>Par défaut :</strong> <code>true</code>.</li><li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles <code>code</code> doit être exécuté avant d&#39;être arrêté. Si l&#39;exécution est arrêtée, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</li><li><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) mettra fin à l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut :</strong> <code>false</code>.</li><li><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou <code>TypedArray</code>, ou <code>DataView</code> facultatif avec les données du cache de code V8 pour la source fournie.</li><li><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés lors de l&#39;évaluation de ce script lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Prise en charge de <code>import()</code> dynamique dans les API de compilation</a>.</li></ul></li></ul><p>La méthode <code>vm.runInContext()</code> compile <code>code</code>, l&#39;exécute dans le contexte de <code>contextifiedObject</code>, puis renvoie le résultat. Le code en cours d&#39;exécution n&#39;a pas accès à la portée locale. L&#39;objet <code>contextifiedObject</code> <em>doit</em> avoir été précédemment <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> en utilisant la méthode <a href="/fr/nodejs/api/vm#vmcreatecontextcontextobject-options"><code>vm.createContext()</code></a>.</p><p>Si <code>options</code> est une chaîne de caractères, elle spécifie alors le nom du fichier.</p><p>L&#39;exemple suivant compile et exécute différents scripts en utilisant un seul objet <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a> :</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { globalVar: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contextObject);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalVar *= 2;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, contextObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contextObject);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: { globalVar: 1024 }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="vmruninnewcontextcode-contextobject-options" tabindex="-1"><code>vm.runInNewContext(code[, contextObject[, options]])</code> <a class="header-anchor" href="#vmruninnewcontextcode-contextobject-options" aria-label="Permalink to “vm.runInNewContext(code[, contextObject[, options]])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v22.8.0, v20.18.0</td><td>L&#39;argument <code>contextObject</code> accepte désormais <code>vm.constants.DONT_CONTEXTIFY</code>.</td></tr><tr><td>v21.7.0, v20.12.0</td><td>Ajout du support de <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Ajout du support des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr><tr><td>v14.6.0</td><td>L&#39;option <code>microtaskMode</code> est désormais prise en charge.</td></tr><tr><td>v10.0.0</td><td>L&#39;option <code>contextCodeGeneration</code> est désormais prise en charge.</td></tr><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajouté dans\xA0: v0.3.1</td></tr></tbody></table></div><ul><li><p><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le code JavaScript à compiler et à exécuter.</p></li><li><p><code>contextObject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify">&lt;vm.constants.DONT_CONTEXTIFY&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a> Soit <a href="/fr/nodejs/api/vm#vmconstantsdont-contextify"><code>vm.constants.DONT_CONTEXTIFY</code></a>, soit un objet qui sera <a href="/fr/nodejs/api/vm#what-does-it-mean-to-contextify-an-object">contextifié</a>. Si <code>undefined</code>, un objet contextifié vide sera créé pour assurer la rétrocompatibilité.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></p><ul><li><p><code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Spécifie le nom de fichier utilisé dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>&#39;evalmachine.\\&lt;anonymous\\&gt;&#39;</code>.</p></li><li><p><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>0</code>.</p></li><li><p><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut\xA0:</strong> <code>0</code>.</p></li><li><p><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque la valeur est <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est jointe à la trace de pile. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles le <code>code</code> doit être exécuté avant d&#39;être arrêté. Si l&#39;exécution est arrêtée, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</p></li><li><p><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si la valeur est <code>true</code>, la réception de <code>SIGINT</code> (+) mettra fin à l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut\xA0:</strong> <code>false</code>.</p></li><li><p><code>contextName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Nom lisible par l&#39;homme du contexte nouvellement créé. <strong>Par défaut\xA0:</strong> <code>&#39;VM Context i&#39;</code>, où <code>i</code> est un index numérique ascendant du contexte créé.</p></li><li><p><code>contextOrigin</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" target="_blank" rel="noreferrer">Origine</a> correspondant au contexte nouvellement créé à des fins d&#39;affichage. L&#39;origine doit être formatée comme une URL, mais avec uniquement le schéma, l&#39;hôte et le port (si nécessaire), comme la valeur de la propriété <a href="/fr/nodejs/api/url#urlorigin"><code>url.origin</code></a> d&#39;un objet <a href="/fr/nodejs/api/url#class-url"><code>URL</code></a>. Plus particulièrement, cette chaîne doit omettre la barre oblique finale, car elle désigne un chemin d&#39;accès. <strong>Par défaut\xA0:</strong> <code>&#39;&#39;</code>.</p></li><li><p><code>contextCodeGeneration</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p></li><li><p><code>strings</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si la valeur est définie sur false, tout appel à <code>eval</code> ou aux constructeurs de fonctions (<code>Function</code>, <code>GeneratorFunction</code>, etc.) lèvera une <code>EvalError</code>. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>wasm</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si la valeur est définie sur false, toute tentative de compilation d&#39;un module WebAssembly lèvera une <code>WebAssembly.CompileError</code>. <strong>Par défaut\xA0:</strong> <code>true</code>.</p></li><li><p><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou <code>TypedArray</code> facultatif, ou <code>DataView</code> avec les données du cache de code V8 pour la source fournie.</p></li><li><p><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés lors de l&#39;évaluation de ce script lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API de modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Support de l&#39;importation dynamique <code>import()</code> dans les API de compilation</a>.</p></li><li><p><code>microtaskMode</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Si la valeur est définie sur <code>afterEvaluate</code>, les microtâches (tâches planifiées via <code>Promise</code>s et <code>async function</code>s) seront exécutées immédiatement après l&#39;exécution du script. Elles sont incluses dans les étendues <code>timeout</code> et <code>breakOnSigint</code> dans ce cas.</p></li></ul></li><li><p>Retourne\xA0: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> le résultat de la toute dernière instruction exécutée dans le script.</p></li></ul><p>Cette méthode est un raccourci pour <code>(new vm.Script(code, options)).runInContext(vm.createContext(options), options)</code>. Si <code>options</code> est une chaîne, alors elle spécifie le nom de fichier.</p><p>Elle fait plusieurs choses à la fois\xA0:</p><p>L&#39;exemple suivant compile et exécute du code qui incrémente une variable globale et en définit une nouvelle. Ces variables globales sont contenues dans le <code>contextObject</code>.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> contextObject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  animal: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cat&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  count: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;count += 1; name = &quot;kitty&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, contextObject);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contextObject);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: { animal: &#39;cat&#39;, count: 3, name: &#39;kitty&#39; }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This would throw if the context is created from a contextified object.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vm.constants.DONT_CONTEXTIFY allows creating contexts with ordinary global objects that</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// can be frozen.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> frozenContext</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Object.freeze(globalThis); globalThis;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, vm.constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DONT_CONTEXTIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="vmruninthiscontextcode-options" tabindex="-1"><code>vm.runInThisContext(code[, options])</code> <a class="header-anchor" href="#vmruninthiscontextcode-options" aria-label="Permalink to “vm.runInThisContext(code[, options])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[Historique]</p><table tabindex="0"><thead><tr><th>Version</th><th>Modifications</th></tr></thead><tbody><tr><td>v21.7.0, v20.12.0</td><td>Ajout du support pour <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code>.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Ajout du support des attributs d&#39;importation au paramètre <code>importModuleDynamically</code>.</td></tr><tr><td>v6.3.0</td><td>L&#39;option <code>breakOnSigint</code> est désormais prise en charge.</td></tr><tr><td>v0.3.1</td><td>Ajouté dans : v0.3.1</td></tr></tbody></table></div><ul><li><p><code>code</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Le code JavaScript à compiler et à exécuter.</p></li><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></p><ul><li><code>filename</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Spécifie le nom de fichier utilisé dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>&#39;evalmachine.\\&lt;anonymous\\&gt;&#39;</code>.</li><li><code>lineOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>columnOffset</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> Spécifie le décalage du numéro de colonne de la première ligne qui est affiché dans les traces de pile produites par ce script. <strong>Par défaut :</strong> <code>0</code>.</li><li><code>displayErrors</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Lorsque <code>true</code>, si une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> se produit lors de la compilation du <code>code</code>, la ligne de code à l&#39;origine de l&#39;erreur est attachée à la trace de pile. <strong>Par défaut :</strong> <code>true</code>.</li><li><code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a> Spécifie le nombre de millisecondes pendant lesquelles <code>code</code> doit être exécuté avant d&#39;interrompre l&#39;exécution. Si l&#39;exécution est interrompue, une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a> sera levée. Cette valeur doit être un entier strictement positif.</li><li><code>breakOnSigint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> Si <code>true</code>, la réception de <code>SIGINT</code> (+) mettra fin à l&#39;exécution et lèvera une <a href="/fr/nodejs/api/errors#class-error"><code>Error</code></a>. Les gestionnaires existants pour l&#39;événement qui ont été attachés via <code>process.on(&#39;SIGINT&#39;)</code> sont désactivés pendant l&#39;exécution du script, mais continuent de fonctionner après cela. <strong>Par défaut :</strong> <code>false</code>.</li><li><code>cachedData</code> <a href="/fr/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> Fournit un <code>Buffer</code> ou <code>TypedArray</code> ou <code>DataView</code> facultatif avec les données du cache de code V8 pour la source fournie.</li><li><code>importModuleDynamically</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#vmconstantsuse-main-context-default-loader">&lt;vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER&gt;</a> Utilisé pour spécifier comment les modules doivent être chargés lors de l&#39;évaluation de ce script lorsque <code>import()</code> est appelé. Cette option fait partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production. Pour des informations détaillées, voir <a href="/fr/nodejs/api/vm#support-of-dynamic-import-in-compilation-apis">Prise en charge de l&#39;importation dynamique <code>import()</code> dans les API de compilation</a>.</li></ul></li><li><p>Retourne : <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" target="_blank" rel="noreferrer">&lt;any&gt;</a> le résultat de la toute dernière instruction exécutée dans le script.</p></li></ul><p><code>vm.runInThisContext()</code> compile le <code>code</code>, l&#39;exécute dans le contexte du <code>global</code> actuel et renvoie le résultat. Le code en cours d&#39;exécution n&#39;a pas accès à la portée locale, mais a accès à l&#39;objet <code>global</code> actuel.</p><p>Si <code>options</code> est une chaîne, elle spécifie le nom de fichier.</p><p>L&#39;exemple suivant illustre l&#39;utilisation de <code>vm.runInThisContext()</code> et de la fonction JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval" target="_blank" rel="noreferrer"><code>eval()</code></a> pour exécuter le même code\xA0:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localVar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;initial value&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vmResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localVar = &quot;vm&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`vmResult: &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vmResult</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;, localVar: &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localVar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: vmResult: &#39;vm&#39;, localVar: &#39;initial value&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> evalResult</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> eval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localVar = &quot;eval&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`evalResult: &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">evalResult</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;, localVar: &#39;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localVar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&#39;\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Prints: evalResult: &#39;eval&#39;, localVar: &#39;eval&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Étant donné que <code>vm.runInThisContext()</code> n&#39;a pas accès à la portée locale, <code>localVar</code> reste inchangé. En revanche, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval" target="_blank" rel="noreferrer"><code>eval()</code></a> <em>a</em> accès à la portée locale, la valeur de <code>localVar</code> est donc modifiée. De cette façon, <code>vm.runInThisContext()</code> ressemble beaucoup à un <a href="https://es5.github.io/#x10.4.2" target="_blank" rel="noreferrer">appel <code>eval()</code> indirect</a>, par exemple <code>(0,eval)(&#39;code&#39;)</code>.</p><h2 id="example-running-an-http-server-within-a-vm" tabindex="-1">Exemple : Exécuter un serveur HTTP dans une VM <a class="header-anchor" href="#example-running-an-http-server-within-a-vm" aria-label="Permalink to “Exemple : Exécuter un serveur HTTP dans une VM”">​</a></h2><p>Lors de l&#39;utilisation de <a href="/fr/nodejs/api/vm#scriptruninthiscontextoptions"><code>script.runInThisContext()</code></a> ou de <a href="/fr/nodejs/api/vm#vmruninthiscontextcode-options"><code>vm.runInThisContext()</code></a>, le code est exécuté dans le contexte global V8 actuel. Le code transmis à ce contexte VM aura sa propre portée isolée.</p><p>Afin d&#39;exécuter un simple serveur web en utilisant le module <code>node:http</code>, le code transmis au contexte doit soit appeler <code>require(&#39;node:http&#39;)</code> lui-même, soit avoir une référence au module <code>node:http</code> qui lui est transmise. Par exemple :</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;use strict&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">((require) =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  const http = require(&#39;node:http&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  http.createServer((request, response) =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    response.writeHead(200, { &#39;Content-Type&#39;: &#39;text/plain&#39; });</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    response.end(&#39;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">n&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }).listen(8124);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  console.log(&#39;Server running at http://127.0.0.1:8124/&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">})\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code)(require);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Le <code>require()</code> dans le cas ci-dessus partage l&#39;état avec le contexte duquel il est transmis. Cela peut introduire des risques lorsque du code non fiable est exécuté, par exemple en modifiant des objets dans le contexte de manière indésirable.</p><h2 id="what-does-it-mean-to-&quot;contextify&quot;-an-object?" tabindex="-1">Que signifie &quot;contextifier&quot; un objet ? <a class="header-anchor" href="#what-does-it-mean-to-&quot;contextify&quot;-an-object?" aria-label="Permalink to “Que signifie &quot;contextifier&quot; un objet ?”">​</a></h2><p>Tout le JavaScript exécuté dans Node.js s&#39;exécute dans la portée d&#39;un &quot;contexte&quot;. Selon le <a href="https://v8.dev/docs/embed#contexts" target="_blank" rel="noreferrer">Guide de l&#39;intégrateur V8</a> :</p><p>Lorsque la méthode <code>vm.createContext()</code> est appelée avec un objet, l&#39;argument <code>contextObject</code> sera utilisé pour encapsuler l&#39;objet global d&#39;une nouvelle instance d&#39;un contexte V8 (si <code>contextObject</code> est <code>undefined</code>, un nouvel objet sera créé à partir du contexte actuel avant sa contextification). Ce contexte V8 fournit au <code>code</code> exécuté à l&#39;aide des méthodes du module <code>node:vm</code> un environnement global isolé dans lequel il peut fonctionner. Le processus de création du contexte V8 et de son association avec le <code>contextObject</code> dans le contexte externe est ce que ce document appelle la &quot;contextification&quot; de l&#39;objet.</p><p>La contextification introduirait quelques bizarreries à la valeur <code>globalThis</code> dans le contexte. Par exemple, il ne peut pas être gelé, et il n&#39;est pas une référence égale au <code>contextObject</code> dans le contexte externe.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Une option \`contextObject\` indéfinie rend l&#39;objet global contextifié.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalThis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Un objet global contextifié ne peut pas être gelé.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Object.freeze(globalThis);&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeError: Cannot freeze</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalThis.foo = 1; foo;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context));  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Pour créer un contexte avec un objet global ordinaire et accéder à un proxy global dans le contexte externe avec moins de bizarreries, spécifiez <code>vm.constants.DONT_CONTEXTIFY</code> comme argument <code>contextObject</code>.</p><h3 id="vmconstantsdont_contextify" tabindex="-1"><code>vm.constants.DONT_CONTEXTIFY</code> <a class="header-anchor" href="#vmconstantsdont_contextify" aria-label="Permalink to “vm.constants.DONT_CONTEXTIFY”">​</a></h3><p>Lorsque cette constante est utilisée comme argument <code>contextObject</code> dans les API vm, elle indique à Node.js de créer un contexte sans envelopper son objet global avec un autre objet d&#39;une manière spécifique à Node.js. Par conséquent, la valeur <code>globalThis</code> à l&#39;intérieur du nouveau contexte se comporterait plus comme une valeur ordinaire.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Utilisez vm.constants.DONT_CONTEXTIFY pour geler l&#39;objet global.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DONT_CONTEXTIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Object.freeze(globalThis);&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar = 1; bar;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Uncaught ReferenceError: bar is not defined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Lorsque <code>vm.constants.DONT_CONTEXTIFY</code> est utilisé comme argument <code>contextObject</code> pour <a href="/fr/nodejs/api/vm#vmcreatecontextcontextobject-options"><code>vm.createContext()</code></a>, l&#39;objet renvoyé est un objet de type proxy vers l&#39;objet global dans le contexte nouvellement créé, avec moins d&#39;excentricités spécifiques à Node.js. Il est de référence égale à la valeur <code>globalThis</code> dans le nouveau contexte, peut être modifié de l&#39;extérieur du contexte et peut être utilisé pour accéder directement aux éléments intégrés dans le nouveau contexte.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DONT_CONTEXTIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// L&#39;objet renvoyé est de référence égale à globalThis dans le nouveau contexte.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;globalThis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Peut être utilisé pour accéder directement aux globales dans le nouveau contexte.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.Array);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [Function: Array]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;foo = 1;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context.foo);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context.bar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context));  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Peut être gelé et cela affecte le contexte interne.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">freeze</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;baz = 1; baz;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Uncaught ReferenceError: baz is not defined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="timeout-interactions-with-asynchronous-tasks-and-promises" tabindex="-1">Interactions de timeout avec les tâches asynchrones et les Promesses <a class="header-anchor" href="#timeout-interactions-with-asynchronous-tasks-and-promises" aria-label="Permalink to “Interactions de timeout avec les tâches asynchrones et les Promesses”">​</a></h2><p>Les <code>Promise</code>s et les <code>async function</code>s peuvent planifier des tâches exécutées de manière asynchrone par le moteur JavaScript. Par défaut, ces tâches sont exécutées une fois que toutes les fonctions JavaScript de la pile actuelle ont terminé leur exécution. Cela permet d&#39;échapper aux fonctionnalités des options <code>timeout</code> et <code>breakOnSigint</code>.</p><p>Par exemple, le code suivant exécuté par <code>vm.runInNewContext()</code> avec un timeout de 5 millisecondes planifie une boucle infinie à exécuter après la résolution d&#39;une promise. La boucle planifiée n&#39;est jamais interrompue par le timeout\xA0:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;entering loop&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Promise.resolve().then(() =&gt; loop());&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { loop, console },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { timeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ceci est affiché *avant* &#39;entering loop&#39; (!)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;done executing&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Ceci peut être résolu en passant <code>microtaskMode: &#39;afterEvaluate&#39;</code> au code qui crée le <code>Context</code>\xA0:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Date.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;Promise.resolve().then(() =&gt; loop());&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { loop, console },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { timeout: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, microtaskMode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;afterEvaluate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Dans ce cas, la microtâche planifiée via <code>promise.then()</code> sera exécutée avant de revenir de <code>vm.runInNewContext()</code>, et sera interrompue par la fonctionnalité <code>timeout</code>. Ceci ne s&#39;applique qu&#39;au code s&#39;exécutant dans un <code>vm.Context</code>, donc par exemple, <a href="/fr/nodejs/api/vm#vmruninthiscontextcode-options"><code>vm.runInThisContext()</code></a> ne prend pas cette option.</p><p>Les rappels Promise sont entrés dans la file d&#39;attente de microtâches du contexte dans lequel ils ont été créés. Par exemple, si <code>() =\\&gt; loop()</code> est remplacé par simplement <code>loop</code> dans l&#39;exemple ci-dessus, alors <code>loop</code> sera poussé dans la file d&#39;attente de microtâches globale, car c&#39;est une fonction du contexte externe (principal), et sera donc également capable d&#39;échapper au timeout.</p><p>Si des fonctions de planification asynchrone telles que <code>process.nextTick()</code>, <code>queueMicrotask()</code>, <code>setTimeout()</code>, <code>setImmediate()</code>, etc. sont mises à disposition à l&#39;intérieur d&#39;un <code>vm.Context</code>, les fonctions qui leur sont passées seront ajoutées aux files d&#39;attente globales, qui sont partagées par tous les contextes. Par conséquent, les rappels passés à ces fonctions ne sont pas non plus contrôlables via le timeout.</p><h2 id="support-of-dynamic-import-in-compilation-apis" tabindex="-1">Prise en charge de <code>import()</code> dynamique dans les API de compilation <a class="header-anchor" href="#support-of-dynamic-import-in-compilation-apis" aria-label="Permalink to “Prise en charge de import() dynamique dans les API de compilation”">​</a></h2><p>Les API suivantes prennent en charge une option <code>importModuleDynamically</code> pour activer <code>import()</code> dynamique dans le code compilé par le module vm.</p><ul><li><code>new vm.Script</code></li><li><code>vm.compileFunction()</code></li><li><code>new vm.SourceTextModule</code></li><li><code>vm.runInThisContext()</code></li><li><code>vm.runInContext()</code></li><li><code>vm.runInNewContext()</code></li><li><code>vm.createContext()</code></li></ul><p>Cette option fait toujours partie de l&#39;API des modules expérimentaux. Nous ne recommandons pas de l&#39;utiliser dans un environnement de production.</p><h3 id="when-the-importmoduledynamically-option-is-not-specified-or-undefined" tabindex="-1">Lorsque l&#39;option <code>importModuleDynamically</code> n&#39;est pas spécifiée ou indéfinie <a class="header-anchor" href="#when-the-importmoduledynamically-option-is-not-specified-or-undefined" aria-label="Permalink to “Lorsque l&#39;option importModuleDynamically n&#39;est pas spécifiée ou indéfinie”">​</a></h3><p>Si cette option n&#39;est pas spécifiée, ou si elle est <code>undefined</code>, le code contenant <code>import()</code> peut toujours être compilé par les API vm, mais lorsque le code compilé est exécuté et qu&#39;il appelle effectivement <code>import()</code>, le résultat sera rejeté avec <a href="/fr/nodejs/api/errors#err-vm-dynamic-import-callback-missing"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>.</p><h3 id="when-importmoduledynamically-is-vmconstantsuse_main_context_default_loader" tabindex="-1">Lorsque <code>importModuleDynamically</code> est <code>vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER</code> <a class="header-anchor" href="#when-importmoduledynamically-is-vmconstantsuse_main_context_default_loader" aria-label="Permalink to “Lorsque importModuleDynamically est vm.constants.USE_MAIN_CONTEXT_DEFAULT_LOADER”">​</a></h3><p>Cette option n&#39;est actuellement pas prise en charge pour <code>vm.SourceTextModule</code>.</p><p>Avec cette option, lorsqu&#39;un <code>import()</code> est lancé dans le code compilé, Node.js utiliserait le chargeur ESM par défaut du contexte principal pour charger le module demandé et le renvoyer au code en cours d&#39;exécution.</p><p>Cela donne accès aux modules intégrés de Node.js tels que <code>fs</code> ou <code>http</code> au code en cours de compilation. Si le code est exécuté dans un contexte différent, sachez que les objets créés par les modules chargés à partir du contexte principal proviennent toujours du contexte principal et ne sont pas <code>instanceof</code> des classes intégrées dans le nouveau contexte.</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1945" id="tab-1946" checked><label data-title="CJS" for="tab-1946">CJS</label><input type="radio" name="group-1945" id="tab-1947"><label data-title="ESM" for="tab-1947">ESM</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;import(&quot;node:fs&quot;).then(({readFile}) =&gt; readFile instanceof Function)&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { importModuleDynamically: constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USE_MAIN_CONTEXT_DEFAULT_LOADER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false: L&#39;URL chargée depuis le contexte principal n&#39;est pas une instance de la classe Function</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// dans le nouveau contexte.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(console.log);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Script, constants } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;import(&quot;node:fs&quot;).then(({readFile}) =&gt; readFile instanceof Function)&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { importModuleDynamically: constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USE_MAIN_CONTEXT_DEFAULT_LOADER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false: L&#39;URL chargée depuis le contexte principal n&#39;est pas une instance de la classe Function</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// dans le nouveau contexte.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInNewContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(console.log);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><p>Cette option permet également au script ou à la fonction de charger des modules utilisateur\xA0:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1952" id="tab-1953" checked><label data-title="ESM" for="tab-1953">ESM</label><input type="radio" name="group-1952" id="tab-1954"><label data-title="CJS" for="tab-1954">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Script, constants } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { resolve } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:path&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { writeFileSync } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Écrit test.js et test.txt dans le répertoire où le script actuel</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// en cours d&#39;exécution est situé.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test.mjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39;export const filename = &quot;./test.json&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Compile un script qui charge test.mjs puis test.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// comme si le script était placé dans le même répertoire.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  \`(async function() {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    const { filename } = await import(&#39;./test.mjs&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    return import(filename, { with: { type: &#39;json&#39; } })</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  })();\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filename: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test-with-default.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    importModuleDynamically: constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USE_MAIN_CONTEXT_DEFAULT_LOADER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { default: { hello: &#39;world&#39; } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(console.log);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">constants</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:path&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Écrit test.js et test.txt dans le répertoire où le script actuel</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// en cours d&#39;exécution est situé.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test.mjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39;export const filename = &quot;./test.json&quot;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">              &#39;{&quot;hello&quot;: &quot;world&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Compile un script qui charge test.mjs puis test.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// comme si le script était placé dans le même répertoire.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  \`(async function() {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    const { filename } = await import(&#39;./test.mjs&#39;);</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    return import(filename, { with: { type: &#39;json&#39; } })</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  })();\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filename: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test-with-default.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    importModuleDynamically: constants.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">USE_MAIN_CONTEXT_DEFAULT_LOADER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { default: { hello: &#39;world&#39; } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(console.log);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></div></div><p>Il y a quelques mises en garde concernant le chargement de modules utilisateur à l&#39;aide du chargeur par défaut du contexte principal\xA0:</p><h3 id="when-importmoduledynamically-is-a-function" tabindex="-1">Quand <code>importModuleDynamically</code> est une fonction <a class="header-anchor" href="#when-importmoduledynamically-is-a-function" aria-label="Permalink to “Quand importModuleDynamically est une fonction”">​</a></h3><p>Quand <code>importModuleDynamically</code> est une fonction, elle sera invoquée quand <code>import()</code> est appelé dans le code compilé pour permettre aux utilisateurs de personnaliser la manière dont le module requis doit être compilé et évalué. Actuellement, l&#39;instance Node.js doit être lancée avec l&#39;indicateur <code>--experimental-vm-modules</code> pour que cette option fonctionne. Si l&#39;indicateur n&#39;est pas défini, ce rappel sera ignoré. Si le code évalué appelle réellement <code>import()</code>, le résultat sera rejeté avec <a href="/fr/nodejs/api/errors#err-vm-dynamic-import-callback-missing-flag"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING_FLAG</code></a>.</p><p>Le rappel <code>importModuleDynamically(specifier, referrer, importAttributes)</code> a la signature suivante :</p><ul><li><code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> specifier passé à <code>import()</code></li><li><code>referrer</code> <a href="/fr/nodejs/api/vm#class-vmscript">&lt;vm.Script&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> | <a href="/fr/nodejs/api/vm#class-vmsourcetextmodule">&lt;vm.SourceTextModule&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> Le référent est le <code>vm.Script</code> compilé pour <code>new vm.Script</code>, <code>vm.runInThisContext</code>, <code>vm.runInContext</code> et <code>vm.runInNewContext</code>. C&#39;est la <code>Function</code> compilée pour <code>vm.compileFunction</code>, le <code>vm.SourceTextModule</code> compilé pour <code>new vm.SourceTextModule</code>, et le <code>Object</code> de contexte pour <code>vm.createContext()</code>.</li><li><code>importAttributes</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> La valeur <code>&quot;with&quot;</code> passée au paramètre optionnel <a href="https://tc39.es/proposal-import-attributes/#sec-evaluate-import-call" target="_blank" rel="noreferrer"><code>optionsExpression</code></a>, ou un objet vide si aucune valeur n&#39;a été fournie.</li><li>Returns: <a href="https://tc39.github.io/ecma262/#sec-module-namespace-exotic-objects" target="_blank" rel="noreferrer">&lt;Module Namespace Object&gt;</a> | <a href="/fr/nodejs/api/vm#class-vmmodule">&lt;vm.Module&gt;</a> Il est recommandé de renvoyer un <code>vm.Module</code> afin de profiter du suivi des erreurs et d&#39;éviter les problèmes liés aux espaces de noms qui contiennent des exportations de fonctions <code>then</code>.</li></ul><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1990" id="tab-1991" checked><label data-title="ESM" for="tab-1991">ESM</label><input type="radio" name="group-1990" id="tab-1992"><label data-title="CJS" for="tab-1992">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ce script doit être exécuté avec --experimental-vm-modules.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Script, SyntheticModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;import(&quot;foo.json&quot;, { with: { type: &quot;json&quot; } })&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> importModuleDynamically</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">specifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">referrer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">importAttributes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(specifier);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;foo.json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(referrer);   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Le script compilé</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(importAttributes);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { type: &#39;json&#39; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { hello: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;world&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  { bar: { hello: &#39;world&#39; } }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ce script doit être exécuté avec --experimental-vm-modules.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:vm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;import(&quot;foo.json&quot;, { with: { type: &quot;json&quot; } })&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> importModuleDynamically</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">specifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">referrer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">importAttributes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(specifier);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// &#39;foo.json&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(referrer);   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Le script compilé</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(importAttributes);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { type: &#39;json&#39; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SyntheticModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      m.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { hello: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;world&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> script.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">runInThisContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  { bar: { hello: &#39;world&#39; } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div></div>`,236)])}var s=e(a,[[`render`,o]]);export{i as __pageData,s as default};