import{__plugin_vue_export_helper_default as e,createElementBlock as t,createStaticVNode as n,openBlock as r}from"./chunks/plugin-vue_export-helper.Bts1mPc7.js";const i=JSON.parse(`{"title":"Документация N-API Node.js","description":"N-API (Node.js API) предоставляет стабильный и последовательный интерфейс для нативных дополнений, позволяя разработчикам создавать модули, совместимые с различными версиями Node.js.","frontmatter":{"title":"Документация N-API Node.js","description":"N-API (Node.js API) предоставляет стабильный и последовательный интерфейс для нативных дополнений, позволяя разработчикам создавать модули, совместимые с различными версиями Node.js.","head":[["meta",{"name":"og:title","content":"Документация N-API Node.js | Node.js - iDoc.dev"}],["meta",{"name":"og:description","content":"N-API (Node.js API) предоставляет стабильный и последовательный интерфейс для нативных дополнений, позволяя разработчикам создавать модули, совместимые с различными версиями Node.js."}],["meta",{"name":"twitter:title","content":"Документация N-API Node.js | Node.js - iDoc.dev"}],["meta",{"name":"twitter:description","content":"N-API (Node.js API) предоставляет стабильный и последовательный интерфейс для нативных дополнений, позволяя разработчикам создавать модули, совместимые с различными версиями Node.js."}],["link",{"rel":"canonical","href":"https://idoc.dev/ru/nodejs/api/n-api"}],["meta",{"property":"og:url","content":"https://idoc.dev/ru/nodejs/api/n-api"}]]},"headers":[],"relativePath":"ru/nodejs/api/n-api.md","filePath":"ru/nodejs/api/n-api.md","lastUpdated":1749464498000}`),a={name:`ru/nodejs/api/n-api.md`};function o(e,i,a,o,s,c){return r(),t(`div`,null,i[0]||=[n(`<h1 id="node-api" tabindex="-1">Node-API <a class="header-anchor" href="#node-api" aria-label="Permalink to “Node-API”">​</a></h1><div class="tip custom-block"><p class="custom-block-title">[Стабильно: 2 - Стабильно]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 2</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 2</a> - Стабильно</p></div><p>Node-API (ранее N-API) - это API для создания нативных Addons. Он не зависит от базовой среды выполнения JavaScript (например, V8) и поддерживается как часть самого Node.js. Этот API будет Application Binary Interface (ABI) стабильным для разных версий Node.js. Он предназначен для защиты аддонов от изменений в базовом движке JavaScript и позволяет модулям, скомпилированным для одной основной версии, запускаться на более поздних основных версиях Node.js без перекомпиляции. Руководство по <a href="https://nodejs.org/en/docs/guides/abi-stability/" target="_blank" rel="noreferrer">ABI Stability</a> содержит более подробное объяснение.</p><p>Addons строятся/пакуются с использованием того же подхода/инструментов, которые описаны в разделе <a href="/ru/nodejs/api/addons">C++ Addons</a>. Единственное различие заключается в наборе API, используемых собственным кодом. Вместо использования V8 или <a href="https://github.com/nodejs/nan" target="_blank" rel="noreferrer">Native Abstractions for Node.js</a> API, используются функции, доступные в Node-API.</p><p>API, предоставляемые Node-API, обычно используются для создания и управления значениями JavaScript. Концепции и операции обычно соответствуют идеям, указанным в спецификации языка ECMA-262. API имеют следующие свойства:</p><ul><li>Все вызовы Node-API возвращают код состояния типа <code>napi_status</code>. Этот статус указывает, успешно ли выполнен вызов API или нет.</li><li>Возвращаемое значение API передается через выходной параметр.</li><li>Все значения JavaScript абстрагированы за непрозрачным типом с именем <code>napi_value</code>.</li><li>В случае кода ошибки, дополнительную информацию можно получить с помощью <code>napi_get_last_error_info</code>. Более подробную информацию можно найти в разделе обработки ошибок <a href="/ru/nodejs/api/n-api#error-handling">Error handling</a>.</li></ul><p>Node-API - это C API, который обеспечивает стабильность ABI для разных версий Node.js и различных уровней компилятора. C++ API может быть проще в использовании. Для поддержки использования C++ проект поддерживает модуль-обертку C++ под названием <a href="https://github.com/nodejs/node-addon-api" target="_blank" rel="noreferrer"><code>node-addon-api</code></a>. Эта обертка предоставляет встраиваемый C++ API. Двоичные файлы, построенные с помощью <code>node-addon-api</code>, будут зависеть от символов для функций на основе Node-API C, экспортируемых Node.js. <code>node-addon-api</code> - это более эффективный способ написания кода, который вызывает Node-API. Возьмем, к примеру, следующий код <code>node-addon-api</code>. В первом разделе показан код <code>node-addon-api</code>, а во втором - то, что на самом деле используется в аддоне.</p><div class="language-C++ line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C++</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-C++ line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C++</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value object, string;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">object);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">string);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, string);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, ...);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Конечным результатом является то, что аддон использует только экспортируемые C API. В результате он по-прежнему получает преимущества стабильности ABI, обеспечиваемой C API.</p><p>При использовании <code>node-addon-api</code> вместо C API, начните с API <a href="https://github.com/nodejs/node-addon-api#api-documentation" target="_blank" rel="noreferrer">docs</a> для <code>node-addon-api</code>.</p><p><a href="https://nodejs.github.io/node-addon-examples/" target="_blank" rel="noreferrer">Node-API Resource</a> предлагает отличную ориентацию и советы для разработчиков, только начинающих работать с Node-API и <code>node-addon-api</code>. Дополнительные медиа-ресурсы можно найти на странице <a href="https://github.com/nodejs/abi-stable-node/blob/HEAD/node-api-media.md" target="_blank" rel="noreferrer">Node-API Media</a>.</p><h2 id="implications-of-abi-stability" tabindex="-1">Последствия стабильности ABI <a class="header-anchor" href="#implications-of-abi-stability" aria-label="Permalink to “Последствия стабильности ABI”">​</a></h2><p>Хотя Node-API предоставляет гарантию стабильности ABI, другие части Node.js этого не делают, и любые внешние библиотеки, используемые из дополнения, могут этого не делать. В частности, ни один из следующих API не предоставляет гарантию стабильности ABI между основными версиями:</p><ul><li>C++ API Node.js, доступные через любой из</li><li>API libuv, которые также включены в Node.js и доступны через</li><li>API V8, доступный через</li></ul><p>Таким образом, чтобы дополнение оставалось ABI-совместимым между основными версиями Node.js, оно должно использовать исключительно Node-API, ограничиваясь использованием</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>и проверяя для всех используемых внешних библиотек, что внешняя библиотека дает гарантии стабильности ABI, аналогичные Node-API.</p><h2 id="building" tabindex="-1">Сборка <a class="header-anchor" href="#building" aria-label="Permalink to “Сборка”">​</a></h2><p>В отличие от модулей, написанных на JavaScript, разработка и развертывание собственных дополнений Node.js с использованием Node-API требует дополнительного набора инструментов. Помимо базовых инструментов, необходимых для разработки для Node.js, разработчику собственных дополнений требуется цепочка инструментов, которая может компилировать код C и C++ в двоичный файл. Кроме того, в зависимости от того, как развертывается собственное дополнение, <em>пользователю</em> собственного дополнения также необходимо будет установить цепочку инструментов C/C++.</p><p>Для разработчиков Linux необходимые пакеты цепочки инструментов C/C++ легко доступны. <a href="https://gcc.gnu.org/" target="_blank" rel="noreferrer">GCC</a> широко используется в сообществе Node.js для сборки и тестирования на различных платформах. Для многих разработчиков инфраструктура компилятора <a href="https://llvm.org/" target="_blank" rel="noreferrer">LLVM</a> также является хорошим выбором.</p><p>Для разработчиков Mac <a href="https://developer.apple.com/xcode/" target="_blank" rel="noreferrer">Xcode</a> предлагает все необходимые инструменты компилятора. Однако нет необходимости устанавливать всю IDE Xcode. Следующая команда устанавливает необходимую цепочку инструментов:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xcode-select</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Для разработчиков Windows <a href="https://visualstudio.microsoft.com/" target="_blank" rel="noreferrer">Visual Studio</a> предлагает все необходимые инструменты компилятора. Однако нет необходимости устанавливать всю IDE Visual Studio. Следующая команда устанавливает необходимую цепочку инструментов:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --global</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> windows-build-tools</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>В разделах ниже описаны дополнительные инструменты, доступные для разработки и развертывания собственных дополнений Node.js.</p><h3 id="build-tools" tabindex="-1">Инструменты сборки <a class="header-anchor" href="#build-tools" aria-label="Permalink to “Инструменты сборки”">​</a></h3><p>Оба перечисленных здесь инструмента требуют, чтобы у <em>пользователей</em> нативного дополнения была установлена цепочка инструментов C/C++, чтобы успешно установить нативное дополнение.</p><h4 id="node-gyp" tabindex="-1">node-gyp <a class="header-anchor" href="#node-gyp" aria-label="Permalink to “node-gyp”">​</a></h4><p><a href="https://github.com/nodejs/node-gyp" target="_blank" rel="noreferrer">node-gyp</a> — это система сборки, основанная на форке <a href="https://github.com/nodejs/gyp-next" target="_blank" rel="noreferrer">gyp-next</a> инструмента <a href="https://gyp.gsrc.io/" target="_blank" rel="noreferrer">GYP</a> от Google, и она поставляется в комплекте с npm. GYP, а следовательно и node-gyp, требует установки Python.</p><p>Исторически сложилось так, что node-gyp был инструментом выбора для сборки нативных дополнений. Он широко распространен и имеет обширную документацию. Однако некоторые разработчики столкнулись с ограничениями в node-gyp.</p><h4 id="cmakejs" tabindex="-1">CMake.js <a class="header-anchor" href="#cmakejs" aria-label="Permalink to “CMake.js”">​</a></h4><p><a href="https://github.com/cmake-js/cmake-js" target="_blank" rel="noreferrer">CMake.js</a> — это альтернативная система сборки, основанная на <a href="https://cmake.org/" target="_blank" rel="noreferrer">CMake</a>.</p><p>CMake.js — хороший выбор для проектов, которые уже используют CMake, или для разработчиков, столкнувшихся с ограничениями в node-gyp. <a href="https://github.com/nodejs/node-addon-examples/tree/main/src/8-tooling/build_with_cmake" target="_blank" rel="noreferrer"><code>build_with_cmake</code></a> — это пример проекта нативного дополнения на основе CMake.</p><h3 id="uploading-precompiled-binaries" tabindex="-1">Загрузка предварительно скомпилированных бинарных файлов <a class="header-anchor" href="#uploading-precompiled-binaries" aria-label="Permalink to “Загрузка предварительно скомпилированных бинарных файлов”">​</a></h3><p>Три перечисленных здесь инструмента позволяют разработчикам и сопровождающим нативных дополнений создавать и загружать бинарные файлы на общедоступные или частные серверы. Эти инструменты обычно интегрируются с системами сборки CI/CD, такими как <a href="https://travis-ci.org/" target="_blank" rel="noreferrer">Travis CI</a> и <a href="https://www.appveyor.com/" target="_blank" rel="noreferrer">AppVeyor</a>, для сборки и загрузки бинарных файлов для различных платформ и архитектур. Эти бинарные файлы затем доступны для загрузки пользователями, которым не требуется устанавливать цепочку инструментов C/C++.</p><h4 id="node-pre-gyp" tabindex="-1">node-pre-gyp <a class="header-anchor" href="#node-pre-gyp" aria-label="Permalink to “node-pre-gyp”">​</a></h4><p><a href="https://github.com/mapbox/node-pre-gyp" target="_blank" rel="noreferrer">node-pre-gyp</a> — это инструмент, основанный на node-gyp, который добавляет возможность загружать бинарные файлы на сервер по выбору разработчика. node-pre-gyp имеет особенно хорошую поддержку загрузки бинарных файлов в Amazon S3.</p><h4 id="prebuild" tabindex="-1">prebuild <a class="header-anchor" href="#prebuild" aria-label="Permalink to “prebuild”">​</a></h4><p><a href="https://github.com/prebuild/prebuild" target="_blank" rel="noreferrer">prebuild</a> — это инструмент, который поддерживает сборку с использованием либо node-gyp, либо CMake.js. В отличие от node-pre-gyp, который поддерживает различные серверы, prebuild загружает бинарные файлы только в <a href="https://help.github.com/en/github/administering-a-repository/about-releases" target="_blank" rel="noreferrer">GitHub releases</a>. prebuild — хороший выбор для проектов GitHub, использующих CMake.js.</p><h4 id="prebuildify" tabindex="-1">prebuildify <a class="header-anchor" href="#prebuildify" aria-label="Permalink to “prebuildify”">​</a></h4><p><a href="https://github.com/prebuild/prebuildify" target="_blank" rel="noreferrer">prebuildify</a> - это инструмент, основанный на node-gyp. Преимущество prebuildify заключается в том, что собранные бинарные файлы объединяются с нативным аддоном при его загрузке в npm. Бинарные файлы загружаются из npm и сразу же доступны пользователю модуля при установке нативного аддона.</p><h2 id="usage" tabindex="-1">Использование <a class="header-anchor" href="#usage" aria-label="Permalink to “Использование”">​</a></h2><p>Чтобы использовать функции Node-API, включите файл <a href="https://github.com/nodejs/node/blob/HEAD/src/node_api.h" target="_blank" rel="noreferrer"><code>node_api.h</code></a>, который находится в каталоге src в дереве разработки node:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Это приведет к выбору <code>NAPI_VERSION</code> по умолчанию для данного выпуска Node.js. Чтобы обеспечить совместимость с определенными версиями Node-API, версию можно указать явно при включении заголовка:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_VERSION</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Это ограничивает поверхность Node-API только функциональностью, доступной в указанных (и более ранних) версиях.</p><p>Некоторые части поверхности Node-API являются экспериментальными и требуют явного включения:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_EXPERIMENTAL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>В этом случае весь набор API, включая любые экспериментальные API, будет доступен для кода модуля.</p><p>Иногда вводятся экспериментальные функции, которые влияют на уже выпущенные и стабильные API. Эти функции можно отключить с помощью отказа:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NAPI_EXPERIMENTAL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NODE_API_EXPERIMENTAL_</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FEATURE_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_OPT_OUT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>где <code>\\&lt;FEATURE_NAME\\&gt;</code> - это имя экспериментальной функции, которая влияет как на экспериментальные, так и на стабильные API.</p><h2 id="node-api-version-matrix" tabindex="-1">Матрица версий Node-API <a class="header-anchor" href="#node-api-version-matrix" aria-label="Permalink to “Матрица версий Node-API”">​</a></h2><p>До версии 9 версии Node-API были аддитивными и версионировались независимо от Node.js. Это означало, что каждая версия была расширением предыдущей версии в том смысле, что она имела все API из предыдущей версии с некоторыми дополнениями. Каждая версия Node.js поддерживала только одну версию Node-API. Например, v18.15.0 поддерживает только версию 8 Node-API. Стабильность ABI была достигнута потому, что 8 была строгим супермножеством всех предыдущих версий.</p><p>Начиная с версии 9, хотя версии Node-API продолжают версионироваться независимо, аддону, работающему с версией 9 Node-API, может потребоваться обновление кода для работы с версией 10 Node-API. Однако стабильность ABI поддерживается, потому что версии Node.js, которые поддерживают версии Node-API выше 8, будут поддерживать все версии между 8 и самой высокой версией, которую они поддерживают, и по умолчанию будут предоставлять API версии 8, если только аддон не выберет более высокую версию Node-API. Этот подход обеспечивает гибкость для лучшей оптимизации существующих функций Node-API при сохранении стабильности ABI. Существующие аддоны могут продолжать работать без перекомпиляции, используя более раннюю версию Node-API. Если аддону требуется функциональность из более новой версии Node-API, для использования этих новых функций все равно потребуются изменения в существующем коде и перекомпиляция.</p><p>В версиях Node.js, которые поддерживают версию 9 Node-API и более поздние, определение <code>NAPI_VERSION=X</code> и использование существующих макросов инициализации аддона запечет запрошенную версию Node-API, которая будет использоваться во время выполнения, в аддон. Если <code>NAPI_VERSION</code> не установлен, по умолчанию будет установлено значение 8.</p><p>Эта таблица может быть неактуальной в старых потоках, самая актуальная информация находится в последней документации API по адресу: <a href="/ru/nodejs/api/n-api#node-api-version-matrix">Матрица версий Node-API</a></p><table tabindex="0"><thead><tr><th>Версия Node-API</th><th>Поддерживается в</th></tr></thead><tbody><tr><td>9</td><td>v18.17.0+, 20.3.0+, 21.0.0 и все более поздние версии</td></tr><tr><td>8</td><td>v12.22.0+, v14.17.0+, v15.12.0+, 16.0.0 и все более поздние версии</td></tr><tr><td>7</td><td>v10.23.0+, v12.19.0+, v14.12.0+, 15.0.0 и все более поздние версии</td></tr><tr><td>6</td><td>v10.20.0+, v12.17.0+, 14.0.0 и все более поздние версии</td></tr><tr><td>5</td><td>v10.17.0+, v12.11.0+, 13.0.0 и все более поздние версии</td></tr><tr><td>4</td><td>v10.16.0+, v11.8.0+, 12.0.0 и все более поздние версии</td></tr><tr><td>3</td><td>v6.14.2*, 8.11.2+, v9.11.0+*, 10.0.0 и все более поздние версии</td></tr><tr><td>2</td><td>v8.10.0+<em>, v9.3.0+</em>, 10.0.0 и все более поздние версии</td></tr><tr><td>1</td><td>v8.6.0+**, v9.0.0+*, 10.0.0 и все более поздние версии</td></tr></tbody></table><ul><li>Node-API была экспериментальной.</li></ul><p>** Node.js 8.0.0 включал Node-API как экспериментальную. Он был выпущен как версия 1 Node-API, но продолжал развиваться до Node.js 8.6.0. API отличается в версиях до Node.js 8.6.0. Мы рекомендуем версию 3 Node-API или более позднюю.</p><p>Каждый API, документированный для Node-API, будет иметь заголовок с именем <code>added in:</code>, а стабильные API будут иметь дополнительный заголовок <code>Node-API version:</code>. API непосредственно доступны при использовании версии Node.js, которая поддерживает версию Node-API, показанную в <code>Node-API version:</code>, или выше. При использовании версии Node.js, которая не поддерживает указанную <code>Node-API version:</code> или если нет указанной <code>Node-API version:</code>, то API будет доступен только в том случае, если <code>#define NAPI_EXPERIMENTAL</code> предшествует включению <code>node_api.h</code> или <code>js_native_api.h</code>. Если API, похоже, недоступен в версии Node.js, которая позже, чем указанная в <code>added in:</code>, то это, скорее всего, причина кажущегося отсутствия.</p><p>Node-API, строго связанные с доступом к функциям ECMAScript из машинного кода, можно найти отдельно в <code>js_native_api.h</code> и <code>js_native_api_types.h</code>. API, определенные в этих заголовках, включены в <code>node_api.h</code> и <code>node_api_types.h</code>. Заголовки структурированы таким образом, чтобы разрешить реализации Node-API вне Node.js. Для этих реализаций API, специфичные для Node.js, могут быть неприменимы.</p><p>Части аддона, специфичные для Node.js, могут быть отделены от кода, который предоставляет фактическую функциональность среде JavaScript, чтобы последний можно было использовать с несколькими реализациями Node-API. В приведенном ниже примере <code>addon.c</code> и <code>addon.h</code> ссылаются только на <code>js_native_api.h</code>. Это гарантирует, что <code>addon.c</code> можно будет повторно использовать для компиляции как с реализацией Node-API в Node.js, так и с любой реализацией Node-API за пределами Node.js.</p><p><code>addon_node.c</code> - это отдельный файл, который содержит специфичную для Node.js точку входа в аддон и который создает аддон, вызывая <code>addon.c</code>, когда аддон загружается в среду Node.js.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon.h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _ADDON_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _ADDON_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;js_native_api.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // _ADDON_H_</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;addon.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NODE_API_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">call</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)                                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {                                                            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (call);                                  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {                                      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_info </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_get_last_error_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">error_info);               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_info-&gt;error_message;        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_pending;                                            </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_is_exception_pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_pending);              </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      /* If an exception is already pending, don&#39;t rethrow it */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_pending) {                                          </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)               </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;empty error message&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                               \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err_message;                                        </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((env), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message);                   </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }                                                           </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                                                </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }                                                             </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DoSomethingUseful</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Do something useful.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NODE_API_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value exported_function;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NODE_API_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                          &quot;doSomethingUseful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          NAPI_AUTO_LENGTH,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          DoSomethingUseful,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                          NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                          &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exported_function));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  NODE_API_CALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             result,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                             &quot;doSomethingUseful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             exported_function));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addon_node.c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;node_api.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;addon.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE_INIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* napi_env env, napi_value exports */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This function body is expected to return a \`napi_value\`.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // The variables \`napi_env env\` and \`napi_value exports\` may be used within</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // the body, as they are provided by the definition of \`NAPI_MODULE_INIT()\`.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create_addon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="environment-life-cycle-apis" tabindex="-1">API жизненного цикла окружения <a class="header-anchor" href="#environment-life-cycle-apis" aria-label="Permalink to “API жизненного цикла окружения”">​</a></h2><p><a href="https://tc39.es/ecma262/#sec-agents" target="_blank" rel="noreferrer">Раздел 8.7</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a> определяет понятие &quot;Агент&quot; как самодостаточное окружение, в котором выполняется код JavaScript. Процесс может запускать и завершать несколько таких агентов либо одновременно, либо последовательно.</p><p>Окружение Node.js соответствует агенту ECMAScript. В основном процессе окружение создается при запуске, и дополнительные окружения могут быть созданы в отдельных потоках для использования в качестве <a href="https://nodejs.org/api/worker_threads" target="_blank" rel="noreferrer">рабочих потоков</a>. Когда Node.js встраивается в другое приложение, основной поток приложения также может создавать и уничтожать окружение Node.js несколько раз в течение жизненного цикла процесса приложения, так что каждое окружение Node.js, созданное приложением, может, в свою очередь, в течение своего жизненного цикла создавать и уничтожать дополнительные окружения в качестве рабочих потоков.</p><p>С точки зрения нативного аддона, это означает, что предоставленные им привязки могут вызываться несколько раз, из нескольких контекстов и даже одновременно из нескольких потоков.</p><p>Нативным аддонам может потребоваться выделять глобальное состояние, которое они используют во время своего жизненного цикла окружения Node.js, чтобы это состояние было уникальным для каждого экземпляра аддона.</p><p>С этой целью Node-API предоставляет способ связать данные так, чтобы их жизненный цикл был связан с жизненным циклом окружения Node.js.</p><h3 id="napi_set_instance_data" tabindex="-1"><code>napi_set_instance_data</code> <a class="header-anchor" href="#napi_set_instance_data" aria-label="Permalink to “napi_set_instance_data”">​</a></h3><p><strong>Добавлено в: v12.8.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_instance_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается вызов Node-API.</li><li><code>[in] data</code>: Элемент данных, который необходимо сделать доступным для привязок этого экземпляра.</li><li><code>[in] finalize_cb</code>: Функция, вызываемая при завершении работы окружения. Функция получает <code>data</code>, чтобы ее можно было освободить. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию.</li><li><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов finalize во время сборки.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API связывает <code>data</code> с текущим запущенным окружением Node.js. <code>data</code> может быть получена позже с помощью <code>napi_get_instance_data()</code>. Любые существующие данные, связанные с текущим запущенным окружением Node.js, которые были установлены посредством предыдущего вызова <code>napi_set_instance_data()</code>, будут перезаписаны. Если <code>finalize_cb</code> был предоставлен предыдущим вызовом, он не будет вызван.</p><h3 id="napi_get_instance_data" tabindex="-1"><code>napi_get_instance_data</code> <a class="header-anchor" href="#napi_get_instance_data" aria-label="Permalink to “napi_get_instance_data”">​</a></h3><p><strong>Добавлено в версии: v12.8.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_instance_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается вызов Node-API.</li><li><code>[out] data</code>: Элемент данных, который ранее был связан с текущей запущенной средой Node.js посредством вызова <code>napi_set_instance_data()</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API извлекает данные, которые ранее были связаны с текущей запущенной средой Node.js через <code>napi_set_instance_data()</code>. Если данные не установлены, вызов будет успешным, и <code>data</code> будет установлено в <code>NULL</code>.</p><h2 id="basic-node-api-data-types" tabindex="-1">Базовые типы данных Node-API <a class="header-anchor" href="#basic-node-api-data-types" aria-label="Permalink to “Базовые типы данных Node-API”">​</a></h2><p>Node-API предоставляет следующие фундаментальные типы данных в качестве абстракций, используемых различными API. Эти API следует рассматривать как непрозрачные, доступные для интроспекции только с помощью других вызовов Node-API.</p><h3 id="napi_status" tabindex="-1"><code>napi_status</code> <a class="header-anchor" href="#napi_status" aria-label="Permalink to “napi_status”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Целочисленный код состояния, указывающий на успех или неудачу вызова Node-API. В настоящее время поддерживаются следующие коды состояния.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_ok,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_invalid_arg,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_object_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_string_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_name_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_function_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_number_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_boolean_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_array_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_generic_failure,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_pending_exception,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_cancelled,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_escape_called_twice,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_handle_scope_mismatch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback_scope_mismatch,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_queue_full,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_closing,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_date_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_arraybuffer_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_detachable_arraybuffer_expected,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_would_deadlock,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /* unused */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_no_external_buffers_allowed,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_cannot_run_js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_status;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Если требуется дополнительная информация при возврате API кода состояния ошибки, ее можно получить, вызвав <code>napi_get_last_error_info</code>.</p><h3 id="napi_extended_error_info" tabindex="-1"><code>napi_extended_error_info</code> <a class="header-anchor" href="#napi_extended_error_info" aria-label="Permalink to “napi_extended_error_info”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_message;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_reserved;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_extended_error_info;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>error_message</code>: строка в кодировке UTF8, содержащая VM-нейтральное описание ошибки.</li><li><code>engine_reserved</code>: Зарезервировано для специфичных для VM деталей ошибки. В настоящее время не реализовано ни для одной VM.</li><li><code>engine_error_code</code>: Специфичный для VM код ошибки. В настоящее время не реализовано ни для одной VM.</li><li><code>error_code</code>: Код состояния Node-API, возникший при последней ошибке.</li></ul><p>См. раздел <a href="/ru/nodejs/api/n-api#error-handling">Обработка ошибок</a> для получения дополнительной информации.</p><h3 id="napi_env" tabindex="-1"><code>napi_env</code> <a class="header-anchor" href="#napi_env" aria-label="Permalink to “napi_env”">​</a></h3><p><code>napi_env</code> используется для представления контекста, который основная реализация Node-API может использовать для сохранения состояния, специфичного для виртуальной машины. Эта структура передается в нативные функции при их вызове и должна быть возвращена при выполнении вызовов Node-API. В частности, один и тот же <code>napi_env</code>, который был передан при вызове исходной нативной функции, должен быть передан во все последующие вложенные вызовы Node-API. Кэширование <code>napi_env</code> для целей общего повторного использования и передача <code>napi_env</code> между экземплярами одного и того же аддона, работающего в разных потоках <a href="/ru/nodejs/api/worker_threads#class-worker"><code>Worker</code></a>, не допускается. <code>napi_env</code> становится недействительным, когда экземпляр нативного аддона выгружается. Уведомление об этом событии доставляется через обратные вызовы, переданные в <a href="/ru/nodejs/api/n-api#napi-add-env-cleanup-hook"><code>napi_add_env_cleanup_hook</code></a> и <a href="/ru/nodejs/api/n-api#napi-set-instance-data"><code>napi_set_instance_data</code></a>.</p><h3 id="node_api_basic_env" tabindex="-1"><code>node_api_basic_env</code> <a class="header-anchor" href="#node_api_basic_env" aria-label="Permalink to “node_api_basic_env”">​</a></h3><div class="warning custom-block"><p class="custom-block-title">[Стабильно: 1 - Экспериментально]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментально</p></div><p>Этот вариант <code>napi_env</code> передается синхронным финализаторам (<a href="/ru/nodejs/api/n-api#node-api-basic-finalize"><code>node_api_basic_finalize</code></a>). Существует подмножество Node-APIs, которые принимают параметр типа <code>node_api_basic_env</code> в качестве своего первого аргумента. Эти APIs не обращаются к состоянию движка JavaScript и, следовательно, безопасны для вызова из синхронных финализаторов. Передача параметра типа <code>napi_env</code> в эти APIs допускается, однако передача параметра типа <code>node_api_basic_env</code> в APIs, которые обращаются к состоянию движка JavaScript, не допускается. Попытка сделать это без приведения типов приведет к предупреждению компилятора или ошибке, когда аддоны компилируются с флагами, которые заставляют их выдавать предупреждения и/или ошибки, когда в функцию передаются неправильные типы указателей. Вызов таких APIs из синхронного финализатора в конечном итоге приведет к завершению работы приложения.</p><h3 id="napi_value" tabindex="-1"><code>napi_value</code> <a class="header-anchor" href="#napi_value" aria-label="Permalink to “napi_value”">​</a></h3><p>Это непрозрачный указатель, который используется для представления значения JavaScript.</p><h3 id="napi_threadsafe_function" tabindex="-1"><code>napi_threadsafe_function</code> <a class="header-anchor" href="#napi_threadsafe_function" aria-label="Permalink to “napi_threadsafe_function”">​</a></h3><p><strong>Added in: v10.6.0</strong></p><p><strong>N-API version: 4</strong></p><p>Это непрозрачный указатель, представляющий функцию JavaScript, которую можно асинхронно вызывать из нескольких потоков через <code>napi_call_threadsafe_function()</code>.</p><h3 id="napi_threadsafe_function_release_mode" tabindex="-1"><code>napi_threadsafe_function_release_mode</code> <a class="header-anchor" href="#napi_threadsafe_function_release_mode" aria-label="Permalink to “napi_threadsafe_function_release_mode”">​</a></h3><p><strong>Added in: v10.6.0</strong></p><p><strong>N-API version: 4</strong></p><p>Значение, которое передается в <code>napi_release_threadsafe_function()</code>, чтобы указать, следует ли немедленно закрыть потокобезопасную функцию (<code>napi_tsfn_abort</code>) или просто освободить (<code>napi_tsfn_release</code>) и, таким образом, сделать ее доступной для последующего использования через <code>napi_acquire_threadsafe_function()</code> и <code>napi_call_threadsafe_function()</code>.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_release,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_abort</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_threadsafe_function_release_mode;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="napi_threadsafe_function_call_mode" tabindex="-1"><code>napi_threadsafe_function_call_mode</code> <a class="header-anchor" href="#napi_threadsafe_function_call_mode" aria-label="Permalink to “napi_threadsafe_function_call_mode”">​</a></h3><p><strong>Added in: v10.6.0</strong></p><p><strong>N-API version: 4</strong></p><p>Значение, которое передается в <code>napi_call_threadsafe_function()</code>, чтобы указать, следует ли блокировать вызов, когда очередь, связанная с потокобезопасной функцией, заполнена.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_nonblocking,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_tsfn_blocking</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_threadsafe_function_call_mode;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="node-api-memory-management-types" tabindex="-1">Типы управления памятью Node-API <a class="header-anchor" href="#node-api-memory-management-types" aria-label="Permalink to “Типы управления памятью Node-API”">​</a></h3><h4 id="napi_handle_scope" tabindex="-1"><code>napi_handle_scope</code> <a class="header-anchor" href="#napi_handle_scope" aria-label="Permalink to “napi_handle_scope”">​</a></h4><p>Это абстракция, используемая для контроля и изменения времени жизни объектов, созданных в определенной области. Как правило, значения Node-API создаются в контексте области видимости дескриптора. Когда собственный метод вызывается из JavaScript, существует область видимости дескриптора по умолчанию. Если пользователь явно не создает новую область видимости дескриптора, значения Node-API будут созданы в области видимости дескриптора по умолчанию. Для любых вызовов кода вне выполнения собственного метода (например, во время вызова обратного вызова libuv) модуль должен создать область перед вызовом каких-либо функций, которые могут привести к созданию значений JavaScript.</p><p>Области видимости дескрипторов создаются с помощью <a href="/ru/nodejs/api/n-api#napi-open-handle-scope"><code>napi_open_handle_scope</code></a> и уничтожаются с помощью <a href="/ru/nodejs/api/n-api#napi-close-handle-scope"><code>napi_close_handle_scope</code></a>. Закрытие области может указать GC, что на все <code>napi_value</code>, созданные в течение времени жизни области видимости дескриптора, больше нет ссылок из текущего кадра стека.</p><p>Для получения более подробной информации ознакомьтесь с разделом <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объектов</a>.</p><h4 id="napi_escapable_handle_scope" tabindex="-1"><code>napi_escapable_handle_scope</code> <a class="header-anchor" href="#napi_escapable_handle_scope" aria-label="Permalink to “napi_escapable_handle_scope”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Экранируемые области видимости обработчиков – это особый тип области видимости обработчиков для возврата значений, созданных в пределах определенной области видимости обработчиков, в родительскую область.</p><h4 id="napi_ref" tabindex="-1"><code>napi_ref</code> <a class="header-anchor" href="#napi_ref" aria-label="Permalink to “napi_ref”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Это абстракция, используемая для ссылки на <code>napi_value</code>. Это позволяет пользователям управлять временем жизни значений JavaScript, включая явное определение их минимального времени жизни.</p><p>Для получения более подробной информации ознакомьтесь с разделом <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объектов</a>.</p><h4 id="napi_type_tag" tabindex="-1"><code>napi_type_tag</code> <a class="header-anchor" href="#napi_type_tag" aria-label="Permalink to “napi_type_tag”">​</a></h4><p><strong>Добавлено в версии: v14.8.0, v12.19.0</strong></p><p><strong>Версия N-API: 8</strong></p><p>128-битное значение, хранящееся в виде двух 64-битных целых чисел без знака. Оно служит UUID, с помощью которого объекты JavaScript или <a href="/ru/nodejs/api/n-api#napi-create-external">внешние объекты</a> могут быть &quot;помечены&quot;, чтобы убедиться, что они определенного типа. Это более строгая проверка, чем <a href="/ru/nodejs/api/n-api#napi-instanceof"><code>napi_instanceof</code></a>, поскольку последняя может сообщить о ложноположительном результате, если прототип объекта был изменен. Назначение тегов типов наиболее полезно в сочетании с <a href="/ru/nodejs/api/n-api#napi-wrap"><code>napi_wrap</code></a>, поскольку оно гарантирует, что указатель, полученный из обернутого объекта, может быть безопасно приведен к собственному типу, соответствующему тегу типа, который ранее был применен к объекту JavaScript.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lower;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upper;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_type_tag;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="napi_async_cleanup_hook_handle" tabindex="-1"><code>napi_async_cleanup_hook_handle</code> <a class="header-anchor" href="#napi_async_cleanup_hook_handle" aria-label="Permalink to “napi_async_cleanup_hook_handle”">​</a></h4><p><strong>Добавлено в версии: v14.10.0, v12.19.0</strong></p><p>Непрозрачное значение, возвращаемое <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>. Оно должно быть передано в <a href="/ru/nodejs/api/n-api#napi-remove-async-cleanup-hook"><code>napi_remove_async_cleanup_hook</code></a> при завершении цепочки асинхронных событий очистки.</p><h3 id="node-api-callback-types" tabindex="-1">Типы обратных вызовов Node-API <a class="header-anchor" href="#node-api-callback-types" aria-label="Permalink to “Типы обратных вызовов Node-API”">​</a></h3><h4 id="napi_callback_info" tabindex="-1"><code>napi_callback_info</code> <a class="header-anchor" href="#napi_callback_info" aria-label="Permalink to “napi_callback_info”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Непрозрачный тип данных, который передается в функцию обратного вызова. Он может быть использован для получения дополнительной информации о контексте, в котором был вызван обратный вызов.</p><h4 id="napi_callback" tabindex="-1"><code>napi_callback</code> <a class="header-anchor" href="#napi_callback" aria-label="Permalink to “napi_callback”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Тип указателя функции для предоставляемых пользователем собственных функций, которые должны быть доступны для JavaScript через Node-API. Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">napi_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(napi_env, napi_callback_info);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Если нет причин, обсуждаемых в <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объектов</a>, создание области видимости обработчиков и/или обратных вызовов внутри <code>napi_callback</code> не является необходимым.</p><h4 id="node_api_basic_finalize" tabindex="-1"><code>node_api_basic_finalize</code> <a class="header-anchor" href="#node_api_basic_finalize" aria-label="Permalink to “node_api_basic_finalize”">​</a></h4><p><strong>Добавлено в: v21.6.0, v20.12.0, v18.20.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Стабильность: 1 - Экспериментальная]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментальная</p></div><p>Тип указателя функции для предоставляемых аддоном функций, которые позволяют пользователю получать уведомления, когда данные, принадлежащие внешнему миру, готовы к очистке, потому что объект, с которым они были связаны, был собран сборщиком мусора. Пользователь должен предоставить функцию, удовлетворяющую следующей сигнатуре, которая будет вызываться при сборе объекта. В настоящее время <code>node_api_basic_finalize</code> можно использовать для выяснения, когда собираются объекты, содержащие внешние данные.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node_api_basic_finalize)(node_api_basic_env env,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_data,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_hint);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>За исключением случаев, обсуждаемых в <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объекта</a>, создание дескриптора и/или области обратного вызова внутри тела функции не требуется.</p><p>Поскольку эти функции могут быть вызваны, когда движок JavaScript находится в состоянии, когда он не может выполнять код JavaScript, можно вызывать только Node-API, которые принимают <code>node_api_basic_env</code> в качестве своего первого параметра. <a href="/ru/nodejs/api/n-api#node-api-post-finalizer"><code>node_api_post_finalizer</code></a> можно использовать для планирования вызовов Node-API, которым требуется доступ к состоянию движка JavaScript, для запуска после завершения текущего цикла сборки мусора.</p><p>В случае <a href="/ru/nodejs/api/n-api#node-api-create-external-string-latin1"><code>node_api_create_external_string_latin1</code></a> и <a href="/ru/nodejs/api/n-api#node-api-create-external-string-utf16"><code>node_api_create_external_string_utf16</code></a> параметр <code>env</code> может быть null, поскольку внешние строки могут быть собраны на последней стадии завершения работы среды.</p><p>История изменений:</p><ul><li>экспериментальная (<code>NAPI_EXPERIMENTAL</code>): Можно вызывать только Node-API, которые принимают <code>node_api_basic_env</code> в качестве своего первого параметра, в противном случае приложение будет завершено с соответствующим сообщением об ошибке. Эту функцию можно отключить, определив <code>NODE_API_EXPERIMENTAL_BASIC_ENV_OPT_OUT</code>.</li></ul><h4 id="napi_finalize" tabindex="-1"><code>napi_finalize</code> <a class="header-anchor" href="#napi_finalize" aria-label="Permalink to “napi_finalize”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Тип указателя на функцию, предоставляемую аддоном, которая позволяет пользователю планировать группу вызовов Node-API в ответ на событие сборки мусора, после завершения цикла сборки мусора. Эти указатели на функции можно использовать с <a href="/ru/nodejs/api/n-api#node-api-post-finalizer"><code>node_api_post_finalizer</code></a>.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_finalize)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_data,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> finalize_hint);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>История изменений:</p><ul><li>experimental (<code>NAPI_EXPERIMENTAL</code> определен): Функция этого типа больше не может использоваться в качестве финализатора, за исключением <a href="/ru/nodejs/api/n-api#node-api-post-finalizer"><code>node_api_post_finalizer</code></a>. Вместо этого необходимо использовать <a href="/ru/nodejs/api/n-api#node-api-basic-finalize"><code>node_api_basic_finalize</code></a>. Эту функцию можно отключить, определив <code>NODE_API_EXPERIMENTAL_BASIC_ENV_OPT_OUT</code>.</li></ul><h4 id="napi_async_execute_callback" tabindex="-1"><code>napi_async_execute_callback</code> <a class="header-anchor" href="#napi_async_execute_callback" aria-label="Permalink to “napi_async_execute_callback”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Указатель на функцию, используемый с функциями, которые поддерживают асинхронные операции. Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_execute_callback)(napi_env env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Реализации этой функции должны избегать вызовов Node-API, которые выполняют JavaScript или взаимодействуют с объектами JavaScript. Вызовы Node-API должны быть в <code>napi_async_complete_callback</code> вместо этого. Не используйте параметр <code>napi_env</code>, так как это, вероятно, приведет к выполнению JavaScript.</p><h4 id="napi_async_complete_callback" tabindex="-1"><code>napi_async_complete_callback</code> <a class="header-anchor" href="#napi_async_complete_callback" aria-label="Permalink to “napi_async_complete_callback”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><p>Указатель на функцию, используемый с функциями, которые поддерживают асинхронные операции. Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_complete_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_status status,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Если нет причин, указанных в разделе <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объекта</a>, создание дескриптора и/или области обратного вызова внутри тела функции не является необходимым.</p><h4 id="napi_threadsafe_function_call_js" tabindex="-1"><code>napi_threadsafe_function_call_js</code> <a class="header-anchor" href="#napi_threadsafe_function_call_js" aria-label="Permalink to “napi_threadsafe_function_call_js”">​</a></h4><p><strong>Добавлено в: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><p>Указатель на функцию, используемый с асинхронными потокобезопасными вызовами функций. Обратный вызов будет вызываться в основном потоке. Его цель - использовать элемент данных, поступающий через очередь из одного из вторичных потоков, для создания параметров, необходимых для вызова в JavaScript, обычно через <code>napi_call_function</code>, а затем выполнить вызов в JavaScript.</p><p>Данные, поступающие из вторичного потока через очередь, передаются в параметре <code>data</code>, а функция JavaScript для вызова - в параметре <code>js_callback</code>.</p><p>Node-API настраивает окружение перед вызовом этого обратного вызова, поэтому достаточно вызвать функцию JavaScript через <code>napi_call_function</code>, а не через <code>napi_make_callback</code>.</p><p>Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_threadsafe_function_call_js)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value js_callback,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                 void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                 void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение для использования для вызовов API, или <code>NULL</code>, если потокобезопасная функция разрушается и <code>data</code> может потребоваться освободить.</li><li><code>[in] js_callback</code>: Функция JavaScript для вызова, или <code>NULL</code>, если потокобезопасная функция разрушается и <code>data</code> может потребоваться освободить. Она также может быть <code>NULL</code>, если потокобезопасная функция была создана без <code>js_callback</code>.</li><li><code>[in] context</code>: Необязательные данные, с которыми была создана потокобезопасная функция.</li><li><code>[in] data</code>: Данные, созданные вторичным потоком. Ответственность обратного вызова заключается в преобразовании этих нативных данных в значения JavaScript (с помощью функций Node-API), которые можно передать в качестве параметров при вызове <code>js_callback</code>. Этот указатель полностью управляется потоками и этим обратным вызовом. Таким образом, этот обратный вызов должен освободить данные.</li></ul><p>Если нет причин, рассмотренных в разделе <a href="/ru/nodejs/api/n-api#object-lifetime-management">Управление временем жизни объектов</a>, создание дескриптора и/или области действия обратного вызова внутри тела функции не требуется.</p><h4 id="napi_cleanup_hook" tabindex="-1"><code>napi_cleanup_hook</code> <a class="header-anchor" href="#napi_cleanup_hook" aria-label="Permalink to “napi_cleanup_hook”">​</a></h4><p><strong>Добавлено в версии: v19.2.0, v18.13.0</strong></p><p><strong>Версия N-API: 3</strong></p><p>Указатель на функцию, используемый с <a href="/ru/nodejs/api/n-api#napi-add-env-cleanup-hook"><code>napi_add_env_cleanup_hook</code></a>. Она будет вызываться, когда среда будет завершаться.</p><p>Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_cleanup_hook)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] data</code>: Данные, переданные в <a href="/ru/nodejs/api/n-api#napi-add-env-cleanup-hook"><code>napi_add_env_cleanup_hook</code></a>.</li></ul><h4 id="napi_async_cleanup_hook" tabindex="-1"><code>napi_async_cleanup_hook</code> <a class="header-anchor" href="#napi_async_cleanup_hook" aria-label="Permalink to “napi_async_cleanup_hook”">​</a></h4><p><strong>Добавлено в версии: v14.10.0, v12.19.0</strong></p><p>Указатель на функцию, используемый с <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>. Она будет вызываться, когда среда будет завершаться.</p><p>Функции обратного вызова должны соответствовать следующей сигнатуре:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_cleanup_hook)(napi_async_cleanup_hook_handle handle,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] handle</code>: Дескриптор, который должен быть передан в <a href="/ru/nodejs/api/n-api#napi-remove-async-cleanup-hook"><code>napi_remove_async_cleanup_hook</code></a> после завершения асинхронной очистки.</li><li><code>[in] data</code>: Данные, переданные в <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>.</li></ul><p>Тело функции должно инициировать асинхронные действия по очистке, в конце которых <code>handle</code> должен быть передан в вызов <a href="/ru/nodejs/api/n-api#napi-remove-async-cleanup-hook"><code>napi_remove_async_cleanup_hook</code></a>.</p><h2 id="error-handling" tabindex="-1">Обработка ошибок <a class="header-anchor" href="#error-handling" aria-label="Permalink to “Обработка ошибок”">​</a></h2><p>Node-API использует как возвращаемые значения, так и исключения JavaScript для обработки ошибок. В следующих разделах объясняется подход для каждого случая.</p><h3 id="return-values" tabindex="-1">Возвращаемые значения <a class="header-anchor" href="#return-values" aria-label="Permalink to “Возвращаемые значения”">​</a></h3><p>Все функции Node-API имеют одинаковую схему обработки ошибок. Тип возвращаемого значения всех функций API - <code>napi_status</code>.</p><p>Возвращаемое значение будет <code>napi_ok</code>, если запрос был успешно выполнен и не было выброшено необработанное исключение JavaScript. Если произошла ошибка И было выброшено исключение, будет возвращено значение <code>napi_status</code> для этой ошибки. Если исключение было выброшено, и ошибка не произошла, будет возвращено <code>napi_pending_exception</code>.</p><p>В случаях, когда возвращается значение, отличное от <code>napi_ok</code> или <code>napi_pending_exception</code>, необходимо вызвать <a href="/ru/nodejs/api/n-api#napi-is-exception-pending"><code>napi_is_exception_pending</code></a>, чтобы проверить, находится ли исключение в ожидании. Дополнительные сведения см. в разделе об исключениях.</p><p>Полный набор возможных значений <code>napi_status</code> определен в <code>napi_api_types.h</code>.</p><p>Возвращаемое значение <code>napi_status</code> предоставляет VM-независимое представление произошедшей ошибки. В некоторых случаях полезно иметь возможность получить более подробную информацию, включая строку, представляющую ошибку, а также VM (движок)-специфическую информацию.</p><p>Чтобы получить эту информацию, предоставляется <a href="/ru/nodejs/api/n-api#napi-get-last-error-info"><code>napi_get_last_error_info</code></a>, которая возвращает структуру <code>napi_extended_error_info</code>. Формат структуры <code>napi_extended_error_info</code> следующий:</p><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error_message;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_reserved;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> engine_error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status error_code;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>error_message</code>: Текстовое представление произошедшей ошибки.</li><li><code>engine_reserved</code>: Непрозрачный дескриптор, зарезервированный только для использования движком.</li><li><code>engine_error_code</code>: VM-специфичный код ошибки.</li><li><code>error_code</code>: Код состояния Node-API для последней ошибки.</li></ul><p><a href="/ru/nodejs/api/n-api#napi-get-last-error-info"><code>napi_get_last_error_info</code></a> возвращает информацию для последнего выполненного вызова Node-API.</p><p>Не полагайтесь на содержимое или формат какой-либо расширенной информации, поскольку она не подлежит SemVer и может измениться в любое время. Она предназначена только для целей ведения журнала.</p><h4 id="napi_get_last_error_info" tabindex="-1"><code>napi_get_last_error_info</code> <a class="header-anchor" href="#napi_get_last_error_info" aria-label="Permalink to “napi_get_last_error_info”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_last_error_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_extended_error_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: Структура <code>napi_extended_error_info</code> с более подробной информацией об ошибке.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API извлекает структуру <code>napi_extended_error_info</code> с информацией о последней произошедшей ошибке.</p><p>Содержимое возвращаемого <code>napi_extended_error_info</code> действительно только до тех пор, пока функция Node-API не будет вызвана в той же среде <code>env</code>. Это включает в себя вызов <code>napi_is_exception_pending</code>, поэтому часто может потребоваться сделать копию информации, чтобы ее можно было использовать позже. Указатель, возвращаемый в <code>error_message</code>, указывает на статически определенную строку, поэтому безопасно использовать этот указатель, если вы скопировали его из поля <code>error_message</code> (которое будет перезаписано) до вызова другой функции Node-API.</p><p>Не полагайтесь на содержимое или формат какой-либо расширенной информации, поскольку она не подлежит SemVer и может измениться в любое время. Она предназначена только для целей ведения журнала.</p><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h3 id="exceptions" tabindex="-1">Исключения <a class="header-anchor" href="#exceptions" aria-label="Permalink to “Исключения”">​</a></h3><p>Любой вызов функции Node-API может привести к ожидающему исключению JavaScript. Это относится ко всем функциям API, даже к тем, которые могут не вызывать выполнение JavaScript.</p><p>Если <code>napi_status</code>, возвращенный функцией, равен <code>napi_ok</code>, то исключение не ожидается и никаких дополнительных действий не требуется. Если возвращенный <code>napi_status</code> отличается от <code>napi_ok</code> или <code>napi_pending_exception</code>, чтобы попытаться восстановиться и продолжить, а не просто немедленно вернуться, необходимо вызвать <a href="/ru/nodejs/api/n-api#napi-is-exception-pending"><code>napi_is_exception_pending</code></a>, чтобы определить, ожидается ли исключение или нет.</p><p>Во многих случаях, когда вызывается функция Node-API и исключение уже ожидается, функция немедленно вернется со статусом <code>napi_pending_exception</code>. Однако это не относится ко всем функциям. Node-API позволяет вызывать подмножество функций, чтобы обеспечить минимальную очистку перед возвратом в JavaScript. В этом случае <code>napi_status</code> будет отражать статус функции. Он не будет отражать предыдущие ожидающие исключения. Чтобы избежать путаницы, проверяйте статус ошибки после каждого вызова функции.</p><p>Когда исключение ожидает обработки, можно использовать один из двух подходов.</p><p>Первый подход состоит в том, чтобы выполнить любую соответствующую очистку, а затем вернуться, чтобы выполнение вернулось в JavaScript. В рамках перехода обратно в JavaScript исключение будет сгенерировано в той точке кода JavaScript, где был вызван собственный метод. Поведение большинства вызовов Node-API не определено, пока исключение ожидает обработки, и многие просто вернут <code>napi_pending_exception</code>, поэтому сделайте как можно меньше и вернитесь в JavaScript, где исключение можно обработать.</p><p>Второй подход состоит в том, чтобы попытаться обработать исключение. Бывают случаи, когда собственный код может перехватить исключение, предпринять соответствующие действия, а затем продолжить. Это рекомендуется только в тех конкретных случаях, когда известно, что исключение можно безопасно обработать. В этих случаях <a href="/ru/nodejs/api/n-api#napi-get-and-clear-last-exception"><code>napi_get_and_clear_last_exception</code></a> можно использовать для получения и очистки исключения. В случае успеха результат будет содержать дескриптор последнего сгенерированного JavaScript <code>Object</code>. Если после извлечения исключения будет определено, что исключение все-таки не может быть обработано, его можно повторно сгенерировать с помощью <a href="/ru/nodejs/api/n-api#napi-throw"><code>napi_throw</code></a>, где error - это значение JavaScript, которое нужно сгенерировать.</p><p>Следующие служебные функции также доступны в случае, если собственному коду необходимо сгенерировать исключение или определить, является ли <code>napi_value</code> экземпляром объекта JavaScript <code>Error</code>: <a href="/ru/nodejs/api/n-api#napi-throw-error"><code>napi_throw_error</code></a>, <a href="/ru/nodejs/api/n-api#napi-throw-type-error"><code>napi_throw_type_error</code></a>, <a href="/ru/nodejs/api/n-api#napi-throw-range-error"><code>napi_throw_range_error</code></a>, <a href="/ru/nodejs/api/n-api#node-api-throw-syntax-error"><code>node_api_throw_syntax_error</code></a> и <a href="/ru/nodejs/api/n-api#napi-is-error"><code>napi_is_error</code></a>.</p><p>Следующие служебные функции также доступны в случае, если собственному коду необходимо создать объект <code>Error</code>: <a href="/ru/nodejs/api/n-api#napi-create-error"><code>napi_create_error</code></a>, <a href="/ru/nodejs/api/n-api#napi-create-type-error"><code>napi_create_type_error</code></a>, <a href="/ru/nodejs/api/n-api#napi-create-range-error"><code>napi_create_range_error</code></a> и <a href="/ru/nodejs/api/n-api#node-api-create-syntax-error"><code>node_api_create_syntax_error</code></a>, где result - это <code>napi_value</code>, который ссылается на вновь созданный объект JavaScript <code>Error</code>.</p><p>Проект Node.js добавляет коды ошибок ко всем ошибкам, создаваемым внутри. Цель состоит в том, чтобы приложения использовали эти коды ошибок для всей проверки ошибок. Связанные сообщения об ошибках останутся, но будут предназначены только для ведения журнала и отображения с ожиданием, что сообщение может измениться без применения SemVer. Чтобы поддержать эту модель с помощью Node-API, как во внутренней функциональности, так и для функциональности, специфичной для модуля (поскольку это хорошая практика), функции <code>throw_</code> и <code>create_</code> принимают необязательный параметр code, который является строкой для кода, который будет добавлен к объекту ошибки. Если необязательный параметр равен <code>NULL</code>, то с ошибкой не будет связан код. Если код предоставлен, имя, связанное с ошибкой, также обновляется и становится:</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>originalName [code]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>где <code>originalName</code> - это исходное имя, связанное с ошибкой, а <code>code</code> - это предоставленный код. Например, если код - <code>&#39;ERR_ERROR_1&#39;</code>, и создается <code>TypeError</code>, имя будет:</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TypeError [ERR_ERROR_1]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="napi_throw" tabindex="-1"><code>napi_throw</code> <a class="header-anchor" href="#napi_throw" aria-label="Permalink to “napi_throw”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] error</code>: Значение JavaScript, которое будет выброшено.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API выбрасывает предоставленное значение JavaScript.</p><h4 id="napi_throw_error" tabindex="-1"><code>napi_throw_error</code> <a class="header-anchor" href="#napi_throw_error" aria-label="Permalink to “napi_throw_error”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный код ошибки, который будет установлен для ошибки.</li><li><code>[in] msg</code>: C-строка, представляющая текст, связанный с ошибкой.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API выбрасывает JavaScript <code>Error</code> с предоставленным текстом.</p><h4 id="napi_throw_type_error" tabindex="-1"><code>napi_throw_type_error</code> <a class="header-anchor" href="#napi_throw_type_error" aria-label="Permalink to “napi_throw_type_error”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_type_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный код ошибки, который будет установлен для ошибки.</li><li><code>[in] msg</code>: C-строка, представляющая текст, связанный с ошибкой.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API выбрасывает JavaScript <code>TypeError</code> с предоставленным текстом.</p><h4 id="napi_throw_range_error" tabindex="-1"><code>napi_throw_range_error</code> <a class="header-anchor" href="#napi_throw_range_error" aria-label="Permalink to “napi_throw_range_error”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_throw_range_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный код ошибки, который будет установлен для ошибки.</li><li><code>[in] msg</code>: C-строка, представляющая текст, связанный с ошибкой.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API выбрасывает JavaScript <code>RangeError</code> с предоставленным текстом.</p><h4 id="node_api_throw_syntax_error" tabindex="-1"><code>node_api_throw_syntax_error</code> <a class="header-anchor" href="#node_api_throw_syntax_error" aria-label="Permalink to “node_api_throw_syntax_error”">​</a></h4><p><strong>Added in: v17.2.0, v16.14.0</strong></p><p><strong>N-API version: 9</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_throw_syntax_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный код ошибки, который будет установлен для ошибки.</li><li><code>[in] msg</code>: Строка C, представляющая текст, который будет связан с ошибкой.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API выбрасывает JavaScript <code>SyntaxError</code> с предоставленным текстом.</p><h4 id="napi_is_error" tabindex="-1"><code>napi_is_error</code> <a class="header-anchor" href="#napi_is_error" aria-label="Permalink to “napi_is_error”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, который нужно проверить.</li><li><code>[out] result</code>: Логическое значение, которое устанавливается в true, если <code>napi_value</code> представляет ошибку, в противном случае - false.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API запрашивает <code>napi_value</code>, чтобы проверить, представляет ли он объект ошибки.</p><h4 id="napi_create_error" tabindex="-1"><code>napi_create_error</code> <a class="header-anchor" href="#napi_create_error" aria-label="Permalink to “napi_create_error”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный <code>napi_value</code> со строкой кода ошибки, который будет связан с ошибкой.</li><li><code>[in] msg</code>: <code>napi_value</code>, который ссылается на JavaScript <code>string</code>, который будет использоваться в качестве сообщения для <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий созданную ошибку.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API возвращает JavaScript <code>Error</code> с предоставленным текстом.</p><h4 id="napi_create_type_error" tabindex="-1"><code>napi_create_type_error</code> <a class="header-anchor" href="#napi_create_type_error" aria-label="Permalink to “napi_create_type_error”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_type_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательный <code>napi_value</code> со строкой кода ошибки, который будет связан с ошибкой.</li><li><code>[in] msg</code>: <code>napi_value</code>, который ссылается на JavaScript <code>string</code>, который будет использоваться в качестве сообщения для <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий созданную ошибку.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API возвращает JavaScript <code>TypeError</code> с предоставленным текстом.</p><h4 id="napi_create_range_error" tabindex="-1"><code>napi_create_range_error</code> <a class="header-anchor" href="#napi_create_range_error" aria-label="Permalink to “napi_create_range_error”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_range_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательное <code>napi_value</code> со строкой кода ошибки, которая будет связана с ошибкой.</li><li><code>[in] msg</code>: <code>napi_value</code>, ссылающееся на JavaScript <code>string</code>, который будет использоваться в качестве сообщения для <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее созданную ошибку.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершил работу.</p><p>Этот API возвращает JavaScript <code>RangeError</code> с предоставленным текстом.</p><h4 id="node_api_create_syntax_error" tabindex="-1"><code>node_api_create_syntax_error</code> <a class="header-anchor" href="#node_api_create_syntax_error" aria-label="Permalink to “node_api_create_syntax_error”">​</a></h4><p><strong>Добавлено в: v17.2.0, v16.14.0</strong></p><p><strong>Версия N-API: 9</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_syntax_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] code</code>: Необязательное <code>napi_value</code> со строкой кода ошибки, которая будет связана с ошибкой.</li><li><code>[in] msg</code>: <code>napi_value</code>, ссылающееся на JavaScript <code>string</code>, который будет использоваться в качестве сообщения для <code>Error</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее созданную ошибку.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершил работу.</p><p>Этот API возвращает JavaScript <code>SyntaxError</code> с предоставленным текстом.</p><h4 id="napi_get_and_clear_last_exception" tabindex="-1"><code>napi_get_and_clear_last_exception</code> <a class="header-anchor" href="#napi_get_and_clear_last_exception" aria-label="Permalink to “napi_get_and_clear_last_exception”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_and_clear_last_exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: Исключение, если оно ожидает обработки, в противном случае <code>NULL</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершил работу.</p><p>Этот API можно вызывать, даже если есть ожидающее обработки исключение JavaScript.</p><h4 id="napi_is_exception_pending" tabindex="-1"><code>napi_is_exception_pending</code> <a class="header-anchor" href="#napi_is_exception_pending" aria-label="Permalink to “napi_is_exception_pending”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_exception_pending</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: Логическое значение, устанавливаемое в true, если ожидается исключение.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h4 id="napi_fatal_exception" tabindex="-1"><code>napi_fatal_exception</code> <a class="header-anchor" href="#napi_fatal_exception" aria-label="Permalink to “napi_fatal_exception”">​</a></h4><p><strong>Added in: v9.10.0</strong></p><p><strong>N-API version: 3</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_fatal_exception</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] err</code>: Ошибка, которая передается в <code>&#39;uncaughtException&#39;</code>.</li></ul><p>Вызывает <code>&#39;uncaughtException&#39;</code> в JavaScript. Полезно, если асинхронный обратный вызов выдает исключение, которое невозможно восстановить.</p><h3 id="fatal-errors" tabindex="-1">Критические ошибки <a class="header-anchor" href="#fatal-errors" aria-label="Permalink to “Критические ошибки”">​</a></h3><p>В случае неисправимой ошибки в нативном аддоне можно вызвать фатальную ошибку для немедленного завершения процесса.</p><h4 id="napi_fatal_error" tabindex="-1"><code>napi_fatal_error</code> <a class="header-anchor" href="#napi_fatal_error" aria-label="Permalink to “napi_fatal_error”">​</a></h4><p><strong>Added in: v8.2.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_NO_RETURN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_fatal_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> location_len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> message_len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] location</code>: Необязательное местоположение, в котором произошла ошибка.</li><li><code>[in] location_len</code>: Длина местоположения в байтах или <code>NAPI_AUTO_LENGTH</code>, если оно завершается нулевым символом.</li><li><code>[in] message</code>: Сообщение, связанное с ошибкой.</li><li><code>[in] message_len</code>: Длина сообщения в байтах или <code>NAPI_AUTO_LENGTH</code>, если оно завершается нулевым символом.</li></ul><p>Вызов функции не возвращает управление, процесс будет завершен.</p><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h2 id="object-lifetime-management" tabindex="-1">Управление временем жизни объектов <a class="header-anchor" href="#object-lifetime-management" aria-label="Permalink to “Управление временем жизни объектов”">​</a></h2><p>По мере вызова Node-API дескрипторы объектов в куче для базовой виртуальной машины могут возвращаться как <code>napi_values</code>. Эти дескрипторы должны поддерживать объекты «живыми» до тех пор, пока они больше не требуются нативному коду, в противном случае объекты могут быть собраны до того, как нативный код закончит их использование.</p><p>По мере возврата дескрипторов объектов они связываются с «областью видимости». Продолжительность жизни области видимости по умолчанию связана с продолжительностью вызова нативного метода. В результате, по умолчанию, дескрипторы остаются действительными, и объекты, связанные с этими дескрипторами, будут оставаться живыми в течение всего вызова нативного метода.</p><p>Однако во многих случаях необходимо, чтобы дескрипторы оставались действительными в течение более короткого или более длительного периода, чем у нативного метода. В следующих разделах описываются функции Node-API, которые можно использовать для изменения продолжительности жизни дескриптора по сравнению со значением по умолчанию.</p><h3 id="making-handle-lifespan-shorter-than-that-of-the-native-method" tabindex="-1">Сокращение времени жизни дескриптора по сравнению с временем жизни собственного метода <a class="header-anchor" href="#making-handle-lifespan-shorter-than-that-of-the-native-method" aria-label="Permalink to “Сокращение времени жизни дескриптора по сравнению с временем жизни собственного метода”">​</a></h3><p>Часто необходимо сделать время жизни дескрипторов короче, чем время жизни собственного метода. Например, рассмотрим собственный метод, который содержит цикл, перебирающий элементы в большом массиве:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // do something with element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Это приведет к созданию большого количества дескрипторов, потребляющих значительные ресурсы. Кроме того, даже если собственный код может использовать только самый последний дескриптор, все связанные с ним объекты также будут оставаться активными, поскольку все они разделяют одну и ту же область видимости.</p><p>Для обработки этого случая Node-API предоставляет возможность установить новую &#39;область видимости&#39;, с которой будут связаны вновь созданные дескрипторы. Как только эти дескрипторы больше не требуются, область видимости может быть &#39;закрыта&#39;, и все дескрипторы, связанные с областью видимости, становятся недействительными. Методы, доступные для открытия/закрытия областей видимости: <a href="/ru/nodejs/api/n-api#napi-open-handle-scope"><code>napi_open_handle_scope</code></a> и <a href="/ru/nodejs/api/n-api#napi-close-handle-scope"><code>napi_close_handle_scope</code></a>.</p><p>Node-API поддерживает только одну вложенную иерархию областей видимости. В любой момент времени существует только одна активная область видимости, и все новые дескрипторы будут связаны с этой областью видимости, пока она активна. Области видимости должны быть закрыты в обратном порядке их открытия. Кроме того, все области видимости, созданные внутри собственного метода, должны быть закрыты до возврата из этого метода.</p><p>Взяв предыдущий пример, добавление вызовов <a href="/ru/nodejs/api/n-api#napi-open-handle-scope"><code>napi_open_handle_scope</code></a> и <a href="/ru/nodejs/api/n-api#napi-close-handle-scope"><code>napi_close_handle_scope</code></a> гарантирует, что в течение всего выполнения цикла действителен не более одного дескриптора:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_handle_scope scope;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_open_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scope);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, object, i, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // do something with element</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_close_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, scope);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>При вложении областей видимости возникают случаи, когда дескриптор из внутренней области видимости должен существовать дольше, чем время жизни этой области видимости. Node-API поддерживает &#39;экранируемую область видимости&#39;, чтобы поддержать этот случай. Экранируемая область видимости позволяет &#39;повысить&#39; один дескриптор, чтобы он &#39;избежал&#39; текущей области видимости, и время жизни дескриптора изменяется с текущей области видимости на внешнюю область видимости.</p><p>Методы, доступные для открытия/закрытия экранируемых областей видимости: <a href="/ru/nodejs/api/n-api#napi-open-escapable-handle-scope"><code>napi_open_escapable_handle_scope</code></a> и <a href="/ru/nodejs/api/n-api#napi-close-escapable-handle-scope"><code>napi_close_escapable_handle_scope</code></a>.</p><p>Запрос на повышение дескриптора делается через <a href="/ru/nodejs/api/n-api#napi-escape-handle"><code>napi_escape_handle</code></a>, который можно вызвать только один раз.</p><h4 id="napi_open_handle_scope" tabindex="-1"><code>napi_open_handle_scope</code> <a class="header-anchor" href="#napi_open_handle_scope" aria-label="Permalink to “napi_open_handle_scope”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_open_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                               napi_handle_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий новую область видимости.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API открывает новую область видимости.</p><h4 id="napi_close_handle_scope" tabindex="-1"><code>napi_close_handle_scope</code> <a class="header-anchor" href="#napi_close_handle_scope" aria-label="Permalink to “napi_close_handle_scope”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_close_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                napi_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] scope</code>: <code>napi_value</code>, представляющий закрываемую область видимости.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API закрывает переданную область видимости. Области видимости должны закрываться в обратном порядке от их создания.</p><p>Этот API можно вызывать, даже если есть ожидающее JavaScript исключение.</p><h4 id="napi_open_escapable_handle_scope" tabindex="-1"><code>napi_open_escapable_handle_scope</code> <a class="header-anchor" href="#napi_open_escapable_handle_scope" aria-label="Permalink to “napi_open_escapable_handle_scope”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_open_escapable_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_handle_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий новую область видимости.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API открывает новую область видимости, из которой один объект может быть продвинут во внешнюю область видимости.</p><h4 id="napi_close_escapable_handle_scope" tabindex="-1"><code>napi_close_escapable_handle_scope</code> <a class="header-anchor" href="#napi_close_escapable_handle_scope" aria-label="Permalink to “napi_close_escapable_handle_scope”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    napi_close_escapable_handle_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] scope</code>: <code>napi_value</code>, представляющий закрываемую область видимости.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API закрывает переданную область видимости. Области видимости должны закрываться в обратном порядке от их создания.</p><p>Этот API можно вызывать, даже если есть ожидающее JavaScript исключение.</p><h4 id="napi_escape_handle" tabindex="-1"><code>napi_escape_handle</code> <a class="header-anchor" href="#napi_escape_handle" aria-label="Permalink to “napi_escape_handle”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_escape_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_escapable_handle_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">escapee</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] scope</code>: <code>napi_value</code>, представляющий текущую область видимости.</li><li><code>[in] escapee</code>: <code>napi_value</code>, представляющий JavaScript <code>Object</code>, который необходимо &quot;вынести&quot; из области видимости.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий дескриптор &quot;вынесенного&quot; <code>Object</code> во внешней области видимости.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API повышает уровень дескриптора для JavaScript-объекта, чтобы он был действителен в течение всего времени существования внешней области видимости. Его можно вызвать только один раз для каждой области видимости. Если он вызывается более одного раза, будет возвращена ошибка.</p><p>Этот API можно вызывать, даже если есть ожидающее JavaScript-исключение.</p><h3 id="references-to-values-with-a-lifespan-longer-than-that-of-the-native-method" tabindex="-1">Ссылки на значения, время жизни которых больше, чем у собственного метода <a class="header-anchor" href="#references-to-values-with-a-lifespan-longer-than-that-of-the-native-method" aria-label="Permalink to “Ссылки на значения, время жизни которых больше, чем у собственного метода”">​</a></h3><p>В некоторых случаях надстройке потребуется создавать значения и ссылаться на них с временем жизни, превышающим время жизни одного вызова собственного метода. Например, чтобы создать конструктор и позже использовать этот конструктор в запросе на создание экземпляров, необходимо иметь возможность ссылаться на объект-конструктор в нескольких разных запросах на создание экземпляров. Это было бы невозможно с обычным дескриптором, возвращенным в виде <code>napi_value</code>, как описано в предыдущем разделе. Время жизни обычного дескриптора управляется областями видимости, и все области видимости должны быть закрыты до завершения собственного метода.</p><p>Node-API предоставляет методы для создания постоянных ссылок на значения. В настоящее время Node-API позволяет создавать ссылки только для ограниченного набора типов значений, включая object, external, function и symbol.</p><p>Каждая ссылка имеет связанный счетчик со значением 0 или выше, который определяет, будет ли ссылка поддерживать соответствующее значение в активном состоянии. Ссылки со счетчиком 0 не препятствуют сборке значений. Значения типов object (object, function, external) и symbol становятся &quot;слабыми&quot; ссылками, и к ним все еще можно получить доступ, пока они не собраны. Любой счетчик больше 0 будет препятствовать сборке значений.</p><p>Значения Symbol бывают разных видов. Истинное поведение слабой ссылки поддерживается только локальными символами, созданными с помощью функции <code>napi_create_symbol</code> или вызовов конструктора JavaScript <code>Symbol()</code>. Символы, глобально зарегистрированные с помощью функции <code>node_api_symbol_for</code> или вызовов функции JavaScript <code>Symbol.for()</code>, всегда остаются сильными ссылками, поскольку сборщик мусора их не собирает. То же самое относится и к хорошо известным символам, таким как <code>Symbol.iterator</code>. Они также никогда не собираются сборщиком мусора.</p><p>Ссылки можно создавать с начальным счетчиком ссылок. Затем счетчик можно изменить с помощью <a href="/ru/nodejs/api/n-api#napi-reference-ref"><code>napi_reference_ref</code></a> и <a href="/ru/nodejs/api/n-api#napi-reference-unref"><code>napi_reference_unref</code></a>. Если объект собирается, пока счетчик для ссылки равен 0, все последующие вызовы для получения объекта, связанного со ссылкой <a href="/ru/nodejs/api/n-api#napi-get-reference-value"><code>napi_get_reference_value</code></a>, вернут <code>NULL</code> для возвращаемого <code>napi_value</code>. Попытка вызвать <a href="/ru/nodejs/api/n-api#napi-reference-ref"><code>napi_reference_ref</code></a> для ссылки, объект которой был собран, приводит к ошибке.</p><p>Ссылки необходимо удалять, когда они больше не требуются надстройке. Когда ссылка удаляется, она больше не препятствует сборке соответствующего объекта. Неудаление постоянной ссылки приводит к &quot;утечке памяти&quot;, при этом и собственная память для постоянной ссылки, и соответствующий объект в куче сохраняются навсегда.</p><p>Можно создать несколько постоянных ссылок, которые ссылаются на один и тот же объект, каждая из которых либо поддерживает объект в активном состоянии, либо нет, в зависимости от ее индивидуального счетчика. Несколько постоянных ссылок на один и тот же объект могут привести к неожиданному поддержанию в активном состоянии собственной памяти. Собственные структуры для постоянной ссылки должны поддерживаться в активном состоянии до тех пор, пока не будут выполнены финализаторы для объекта, на который указывает ссылка. Если для одного и того же объекта создается новая постоянная ссылка, финализаторы для этого объекта не будут запущены, а собственная память, на которую указывает более ранняя постоянная ссылка, не будет освобождена. Этого можно избежать, вызвав <code>napi_delete_reference</code> в дополнение к <code>napi_reference_unref</code>, когда это возможно.</p><p><strong>История изменений:</strong></p><ul><li>Экспериментальный (определен <code>NAPI_EXPERIMENTAL</code>): Ссылки можно создавать для всех типов значений. Новые поддерживаемые типы значений не поддерживают слабую семантику ссылок, и значения этих типов освобождаются, когда счетчик ссылок становится равным 0, и к ним больше нельзя получить доступ из ссылки.</li></ul><h4 id="napi_create_reference" tabindex="-1"><code>napi_create_reference</code> <a class="header-anchor" href="#napi_create_reference" aria-label="Permalink to “napi_create_reference”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                              uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> initial_refcount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                              napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, для которого создается ссылка.</li><li><code>[in] initial_refcount</code>: Начальное количество ссылок для новой ссылки.</li><li><code>[out] result</code>: <code>napi_ref</code>, указывающий на новую ссылку.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает новую ссылку с указанным количеством ссылок на переданное значение.</p><h4 id="napi_delete_reference" tabindex="-1"><code>napi_delete_reference</code> <a class="header-anchor" href="#napi_delete_reference" aria-label="Permalink to “napi_delete_reference”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] ref</code>: <code>napi_ref</code>, который необходимо удалить.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API удаляет переданную ссылку.</p><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h4 id="napi_reference_ref" tabindex="-1"><code>napi_reference_ref</code> <a class="header-anchor" href="#napi_reference_ref" aria-label="Permalink to “napi_reference_ref”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reference_ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] ref</code>: <code>napi_ref</code>, для которого будет увеличено количество ссылок.</li><li><code>[out] result</code>: Новое количество ссылок.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API увеличивает количество ссылок для переданной ссылки и возвращает результирующее количество ссылок.</p><h4 id="napi_reference_unref" tabindex="-1"><code>napi_reference_unref</code> <a class="header-anchor" href="#napi_reference_unref" aria-label="Permalink to “napi_reference_unref”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reference_unref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] ref</code>: <code>napi_ref</code>, для которого будет уменьшено количество ссылок.</li><li><code>[out] result</code>: Новое количество ссылок.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API уменьшает количество ссылок для переданной ссылки и возвращает результирующее количество ссылок.</p><h4 id="napi_get_reference_value" tabindex="-1"><code>napi_get_reference_value</code> <a class="header-anchor" href="#napi_get_reference_value" aria-label="Permalink to “napi_get_reference_value”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_reference_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_ref </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] ref</code>: <code>napi_ref</code>, для которого запрашивается соответствующее значение.</li><li><code>[out] result</code>: <code>napi_value</code>, на которое ссылается <code>napi_ref</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Если все еще валидно, этот API возвращает <code>napi_value</code>, представляющее значение JavaScript, связанное с <code>napi_ref</code>. В противном случае <code>result</code> будет <code>NULL</code>.</p><h3 id="cleanup-on-exit-of-the-current-nodejs-environment" tabindex="-1">Очистка при выходе из текущего окружения Node.js <a class="header-anchor" href="#cleanup-on-exit-of-the-current-nodejs-environment" aria-label="Permalink to “Очистка при выходе из текущего окружения Node.js”">​</a></h3><p>Хотя процесс Node.js обычно освобождает все свои ресурсы при выходе, встраиватели Node.js или будущая поддержка Worker&#39;ов могут потребовать от аддонов регистрации хуков очистки, которые будут выполняться после выхода из текущего окружения Node.js.</p><p>Node-API предоставляет функции для регистрации и отмены регистрации таких колбэков. При выполнении этих колбэков должны быть освобождены все ресурсы, удерживаемые аддоном.</p><h4 id="napi_add_env_cleanup_hook" tabindex="-1"><code>napi_add_env_cleanup_hook</code> <a class="header-anchor" href="#napi_add_env_cleanup_hook" aria-label="Permalink to “napi_add_env_cleanup_hook”">​</a></h4><p><strong>Добавлено в: v10.2.0</strong></p><p><strong>Версия N-API: 3</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NODE_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_env_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                  napi_cleanup_hook </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                  void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Регистрирует <code>fun</code> как функцию, которая будет выполняться с параметром <code>arg</code> после выхода из текущего окружения Node.js.</p><p>Функция может быть безопасно указана несколько раз с разными значениями <code>arg</code>. В этом случае она также будет вызвана несколько раз. Предоставление одних и тех же значений <code>fun</code> и <code>arg</code> несколько раз не допускается и приведет к аварийному завершению процесса.</p><p>Хуки будут вызываться в обратном порядке, т.е. самый последний добавленный будет вызван первым.</p><p>Удаление этого хука можно выполнить с помощью <a href="/ru/nodejs/api/n-api#napi-remove-env-cleanup-hook"><code>napi_remove_env_cleanup_hook</code></a>. Как правило, это происходит, когда ресурс, для которого был добавлен этот хук, в любом случае уничтожается.</p><p>Для асинхронной очистки доступен <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>.</p><h4 id="napi_remove_env_cleanup_hook" tabindex="-1"><code>napi_remove_env_cleanup_hook</code> <a class="header-anchor" href="#napi_remove_env_cleanup_hook" aria-label="Permalink to “napi_remove_env_cleanup_hook”">​</a></h4><p><strong>Добавлено в: v10.2.0</strong></p><p><strong>Версия N-API: 3</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_env_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                     void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fun)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arg),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                     void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Отменяет регистрацию <code>fun</code> как функции, которая должна быть запущена с параметром <code>arg</code> после выхода из текущей среды Node.js. Как аргумент, так и значение функции должны точно совпадать.</p><p>Функция должна быть первоначально зарегистрирована с помощью <code>napi_add_env_cleanup_hook</code>, в противном случае процесс будет прерван.</p><h4 id="napi_add_async_cleanup_hook" tabindex="-1"><code>napi_add_async_cleanup_hook</code> <a class="header-anchor" href="#napi_add_async_cleanup_hook" aria-label="Permalink to “napi_add_async_cleanup_hook”">​</a></h4><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v14.10.0, v12.19.0</td><td>Изменена сигнатура обратного вызова <code>hook</code>.</td></tr><tr><td>v14.8.0, v12.19.0</td><td>Добавлено в: v14.8.0, v12.19.0</td></tr></tbody></table></div><p><strong>Версия N-API: 8</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_async_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook_handle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> remove_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] hook</code>: Указатель на функцию, которая будет вызвана при завершении среды.</li><li><code>[in] arg</code>: Указатель, который передается в <code>hook</code> при его вызове.</li><li><code>[out] remove_handle</code>: Необязательный дескриптор, который относится к асинхронному хуку очистки.</li></ul><p>Регистрирует <code>hook</code>, который является функцией типа <a href="/ru/nodejs/api/n-api#napi-async-cleanup-hook"><code>napi_async_cleanup_hook</code></a>, как функцию, которая должна быть запущена с параметрами <code>remove_handle</code> и <code>arg</code> после выхода из текущей среды Node.js.</p><p>В отличие от <a href="/ru/nodejs/api/n-api#napi-add-env-cleanup-hook"><code>napi_add_env_cleanup_hook</code></a>, хук может быть асинхронным.</p><p>В остальном поведение в целом соответствует поведению <a href="/ru/nodejs/api/n-api#napi-add-env-cleanup-hook"><code>napi_add_env_cleanup_hook</code></a>.</p><p>Если <code>remove_handle</code> не является <code>NULL</code>, в нем будет сохранено непрозрачное значение, которое позже должно быть передано в <a href="/ru/nodejs/api/n-api#napi-remove-async-cleanup-hook"><code>napi_remove_async_cleanup_hook</code></a>, независимо от того, был ли уже вызван хук. Обычно это происходит, когда ресурс, для которого был добавлен этот хук, в любом случае уничтожается.</p><h4 id="napi_remove_async_cleanup_hook" tabindex="-1"><code>napi_remove_async_cleanup_hook</code> <a class="header-anchor" href="#napi_remove_async_cleanup_hook" aria-label="Permalink to “napi_remove_async_cleanup_hook”">​</a></h4><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v14.10.0, v12.19.0</td><td>Удален параметр <code>env</code>.</td></tr><tr><td>v14.8.0, v12.19.0</td><td>Добавлено в: v14.8.0, v12.19.0</td></tr></tbody></table></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_async_cleanup_hook</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_async_cleanup_hook_handle </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">remove_handle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] remove_handle</code>: Дескриптор асинхронного хука очистки, который был создан с помощью <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>.</li></ul><p>Отменяет регистрацию хука очистки, соответствующего <code>remove_handle</code>. Это предотвратит выполнение хука, если он еще не начал выполняться. Это необходимо вызывать для любого значения <code>napi_async_cleanup_hook_handle</code>, полученного от <a href="/ru/nodejs/api/n-api#napi-add-async-cleanup-hook"><code>napi_add_async_cleanup_hook</code></a>.</p><h3 id="finalization-on-the-exit-of-the-nodejs-environment" tabindex="-1">Финализация при выходе из окружения Node.js <a class="header-anchor" href="#finalization-on-the-exit-of-the-nodejs-environment" aria-label="Permalink to “Финализация при выходе из окружения Node.js”">​</a></h3><p>Окружение Node.js может быть завершено в произвольный момент, как можно скорее, с запретом выполнения JavaScript, например, по запросу <a href="/ru/nodejs/api/worker_threads#workerterminate"><code>worker.terminate()</code></a>. Когда окружение завершается, зарегистрированные обратные вызовы <code>napi_finalize</code> объектов JavaScript, потокобезопасных функций и данных экземпляра окружения вызываются немедленно и независимо.</p><p>Вызов обратных вызовов <code>napi_finalize</code> планируется после вручную зарегистрированных хуков очистки. Чтобы обеспечить правильный порядок финализации дополнений во время завершения работы окружения, чтобы избежать использования памяти после освобождения в обратном вызове <code>napi_finalize</code>, дополнения должны зарегистрировать хук очистки с помощью <code>napi_add_env_cleanup_hook</code> и <code>napi_add_async_cleanup_hook</code>, чтобы вручную освободить выделенный ресурс в правильном порядке.</p><h2 id="module-registration" tabindex="-1">Регистрация модуля <a class="header-anchor" href="#module-registration" aria-label="Permalink to “Регистрация модуля”">​</a></h2><p>Node-API модули регистрируются аналогично другим модулям, за исключением того, что вместо макроса <code>NODE_MODULE</code> используется следующее:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NODE_GYP_MODULE_NAME, Init)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Следующим отличием является сигнатура метода <code>Init</code>. Для Node-API модуля она выглядит следующим образом:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Возвращаемое значение из <code>Init</code> рассматривается как объект <code>exports</code> для модуля. Метод <code>Init</code> принимает пустой объект через параметр <code>exports</code> для удобства. Если <code>Init</code> возвращает <code>NULL</code>, параметр, переданный как <code>exports</code>, экспортируется модулем. Node-API модули не могут изменять объект <code>module</code>, но могут указывать что угодно в качестве свойства <code>exports</code> модуля.</p><p>Чтобы добавить метод <code>hello</code> в качестве функции, чтобы его можно было вызывать как метод, предоставляемый дополнением:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_descriptor desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Method,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">desc);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Чтобы установить функцию, которая будет возвращена <code>require()</code> для дополнения:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, Method, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">method);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Чтобы определить класс, чтобы можно было создавать новые экземпляры (часто используется с <a href="/ru/nodejs/api/n-api#object-wrap">Оберткой объекта</a>):</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ПРИМЕЧАНИЕ: частичный пример, не весь указанный код включен</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_descriptor properties</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, GetValue, SetValue, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    DECLARE_NAPI_METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plusOne&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, PlusOne),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    DECLARE_NAPI_METHOD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;multiply&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Multiply),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value cons;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      napi_define_class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, New, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, properties, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cons);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_reference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, cons, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">constructor);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cons);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Вы также можете использовать макрос <code>NAPI_MODULE_INIT</code>, который действует как сокращение для <code>NAPI_MODULE</code> и определения функции <code>Init</code>:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE_INIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* napi_env env, napi_value exports */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value answer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status result;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">42</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Параметры <code>env</code> и <code>exports</code> предоставляются телу макроса <code>NAPI_MODULE_INIT</code>.</p><p>Все Node-API дополнения поддерживают контекст, то есть могут загружаться несколько раз. При объявлении такого модуля необходимо учитывать несколько моментов. Более подробная информация представлена в документации по <a href="/ru/nodejs/api/addons#context-aware-addons">дополнениям, поддерживающим контекст</a>.</p><p>Переменные <code>env</code> и <code>exports</code> будут доступны внутри тела функции после вызова макроса.</p><p>Для получения более подробной информации об установке свойств объектов смотрите раздел <a href="/ru/nodejs/api/n-api#working-with-javascript-properties">Работа со свойствами JavaScript</a>.</p><p>Для получения более подробной информации о создании модулей дополнений в целом обратитесь к существующему API.</p><h2 id="working-with-javascript-values" tabindex="-1">Работа со значениями JavaScript <a class="header-anchor" href="#working-with-javascript-values" aria-label="Permalink to “Работа со значениями JavaScript”">​</a></h2><p>Node-API предоставляет набор API для создания всех типов значений JavaScript. Некоторые из этих типов описаны в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values" target="_blank" rel="noreferrer">Разделе 6</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a>.</p><p>По сути, эти API используются для выполнения одного из следующих действий:</p><p>Значения Node-API представлены типом <code>napi_value</code>. Любой вызов Node-API, требующий значение JavaScript, принимает <code>napi_value</code>. В некоторых случаях API проверяет тип <code>napi_value</code> заранее. Однако для повышения производительности вызывающей стороне лучше убедиться, что рассматриваемый <code>napi_value</code> имеет тип JavaScript, ожидаемый API.</p><h3 id="enum-types" tabindex="-1">Типы перечислений <a class="header-anchor" href="#enum-types" aria-label="Permalink to “Типы перечислений”">​</a></h3><h4 id="napi_key_collection_mode" tabindex="-1"><code>napi_key_collection_mode</code> <a class="header-anchor" href="#napi_key_collection_mode" aria-label="Permalink to “napi_key_collection_mode”">​</a></h4><p><strong>Добавлено в: v13.7.0, v12.17.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_include_prototypes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_own_only</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_collection_mode;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Описывает перечисления фильтров <code>Ключей/Свойств</code>:</p><p><code>napi_key_collection_mode</code> ограничивает диапазон собираемых свойств.</p><p><code>napi_key_own_only</code> ограничивает собранные свойства только данным объектом. <code>napi_key_include_prototypes</code> будет включать все ключи цепочки прототипов объекта.</p><h4 id="napi_key_filter" tabindex="-1"><code>napi_key_filter</code> <a class="header-anchor" href="#napi_key_filter" aria-label="Permalink to “napi_key_filter”">​</a></h4><p><strong>Добавлено в: v13.7.0, v12.17.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_all_properties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_configurable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_skip_strings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_skip_symbols </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_filter;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Биты фильтра свойств. Их можно объединить операцией ИЛИ для создания составного фильтра.</p><h4 id="napi_key_conversion" tabindex="-1"><code>napi_key_conversion</code> <a class="header-anchor" href="#napi_key_conversion" aria-label="Permalink to “napi_key_conversion”">​</a></h4><p><strong>Добавлено в: v13.7.0, v12.17.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_keep_numbers,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_key_numbers_to_strings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_key_conversion;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>napi_key_numbers_to_strings</code> преобразует целочисленные индексы в строки. <code>napi_key_keep_numbers</code> будет возвращать числа для целочисленных индексов.</p><h4 id="napi_valuetype" tabindex="-1"><code>napi_valuetype</code> <a class="header-anchor" href="#napi_valuetype" aria-label="Permalink to “napi_valuetype”">​</a></h4><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ES6 типы (соответствует typeof)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_undefined,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_null,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_boolean,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_string,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_symbol,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_object,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_function,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_external,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_valuetype;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Описывает тип <code>napi_value</code>. Это обычно соответствует типам, описанным в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types" target="_blank" rel="noreferrer">Разделе 6.1</a> Спецификации языка ECMAScript. В дополнение к типам в этом разделе, <code>napi_valuetype</code> может также представлять <code>Function</code> и <code>Object</code> с внешними данными.</p><p>Значение JavaScript типа <code>napi_external</code> появляется в JavaScript как простой объект, такой что никакие свойства не могут быть установлены на нем, и нет прототипа.</p><h4 id="napi_typedarray_type" tabindex="-1"><code>napi_typedarray_type</code> <a class="header-anchor" href="#napi_typedarray_type" aria-label="Permalink to “napi_typedarray_type”">​</a></h4><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int8_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint8_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint8_clamped_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int16_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint16_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_int32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_uint32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_float32_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_float64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_bigint64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_biguint64_array,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_typedarray_type;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Это представляет собой базовый скалярный тип двоичных данных <code>TypedArray</code>. Элементы этого перечисления соответствуют <a href="https://tc39.github.io/ecma262/#sec-typedarray-objects" target="_blank" rel="noreferrer">разделу 22.2</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">спецификации языка ECMAScript</a>.</p><h3 id="object-creation-functions" tabindex="-1">Функции создания объектов <a class="header-anchor" href="#object-creation-functions" aria-label="Permalink to “Функции создания объектов”">​</a></h3><h4 id="napi_create_array" tabindex="-1"><code>napi_create_array</code> <a class="header-anchor" href="#napi_create_array" aria-label="Permalink to “napi_create_array”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается вызов Node-API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>Array</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API возвращает значение Node-API, соответствующее типу JavaScript <code>Array</code>. Массивы JavaScript описаны в <a href="https://tc39.github.io/ecma262/#sec-array-objects" target="_blank" rel="noreferrer">разделе 22.1</a> спецификации языка ECMAScript.</p><h4 id="napi_create_array_with_length" tabindex="-1"><code>napi_create_array_with_length</code> <a class="header-anchor" href="#napi_create_array_with_length" aria-label="Permalink to “napi_create_array_with_length”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_array_with_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                          size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                          napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] length</code>: Начальная длина <code>Array</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>Array</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API возвращает значение Node-API, соответствующее типу JavaScript <code>Array</code>. Свойство <code>length</code> объекта <code>Array</code> устанавливается равным переданному параметру length. Однако нет гарантии, что базовый буфер будет предварительно выделен виртуальной машиной при создании массива. Это поведение остается на усмотрение базовой реализации виртуальной машины. Если буфер должен быть непрерывным блоком памяти, который можно напрямую читать и/или записывать через C, рассмотрите возможность использования <a href="/ru/nodejs/api/n-api#napi-create-external-arraybuffer"><code>napi_create_external_arraybuffer</code></a>.</p><p>Массивы JavaScript описаны в <a href="https://tc39.github.io/ecma262/#sec-array-objects" target="_blank" rel="noreferrer">разделе 22.1</a> спецификации языка ECMAScript.</p><h4 id="napi_create_arraybuffer" tabindex="-1"><code>napi_create_arraybuffer</code> <a class="header-anchor" href="#napi_create_arraybuffer" aria-label="Permalink to “napi_create_arraybuffer”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] length</code>: Длина в байтах создаваемого array buffer.</li><li><code>[out] data</code>: Указатель на базовый байтовый буфер <code>ArrayBuffer</code>. <code>data</code> можно при желании игнорировать, передав <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>ArrayBuffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнено успешно.</p><p>Этот API возвращает значение Node-API, соответствующее JavaScript <code>ArrayBuffer</code>. <code>ArrayBuffer</code> используются для представления буферов двоичных данных фиксированной длины. Обычно они используются в качестве резервного буфера для объектов <code>TypedArray</code>. Выделенный <code>ArrayBuffer</code> будет иметь базовый байтовый буфер, размер которого определяется переданным параметром <code>length</code>. Базовый буфер при необходимости возвращается вызывающей стороне, если вызывающая сторона хочет напрямую манипулировать буфером. В этот буфер можно записывать только непосредственно из машинного кода. Для записи в этот буфер из JavaScript необходимо создать типизированный массив или объект <code>DataView</code>.</p><p>Объекты JavaScript <code>ArrayBuffer</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-arraybuffer-objects" target="_blank" rel="noreferrer">Разделе 24.1</a> Языковой спецификации ECMAScript.</p><h4 id="napi_create_buffer" tabindex="-1"><code>napi_create_buffer</code> <a class="header-anchor" href="#napi_create_buffer" aria-label="Permalink to “napi_create_buffer”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] size</code>: Размер базового буфера в байтах.</li><li><code>[out] data</code>: Необработанный указатель на базовый буфер. <code>data</code> можно при желании игнорировать, передав <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий <code>node::Buffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнено успешно.</p><p>Этот API выделяет объект <code>node::Buffer</code>. Хотя это по-прежнему полностью поддерживаемая структура данных, в большинстве случаев будет достаточно использовать <code>TypedArray</code>.</p><h4 id="napi_create_buffer_copy" tabindex="-1"><code>napi_create_buffer_copy</code> <a class="header-anchor" href="#napi_create_buffer_copy" aria-label="Permalink to “napi_create_buffer_copy”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_buffer_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] size</code>: Размер входного буфера в байтах (должен совпадать с размером нового буфера).</li><li><code>[in] data</code>: Необработанный указатель на базовый буфер, из которого будет скопировано.</li><li><code>[out] result_data</code>: Указатель на базовый буфер данных нового <code>Buffer</code>. <code>result_data</code> можно проигнорировать, передав <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий <code>node::Buffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API выделяет объект <code>node::Buffer</code> и инициализирует его данными, скопированными из переданного буфера. Хотя это по-прежнему полностью поддерживаемая структура данных, в большинстве случаев достаточно использовать <code>TypedArray</code>.</p><h4 id="napi_create_date" tabindex="-1"><code>napi_create_date</code> <a class="header-anchor" href="#napi_create_date" aria-label="Permalink to “napi_create_date”">​</a></h4><p><strong>Добавлено в версии: v11.11.0, v10.17.0</strong></p><p><strong>Версия N-API: 5</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] time</code>: Значение времени ECMAScript в миллисекундах с 01 января 1970 г. UTC.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>Date</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API не учитывает високосные секунды; они игнорируются, поскольку ECMAScript соответствует спецификации времени POSIX.</p><p>Этот API выделяет объект JavaScript <code>Date</code>.</p><p>Объекты JavaScript <code>Date</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-date-objects" target="_blank" rel="noreferrer">разделе 20.3</a> спецификации языка ECMAScript.</p><h4 id="napi_create_external" tabindex="-1"><code>napi_create_external</code> <a class="header-anchor" href="#napi_create_external" aria-label="Permalink to “napi_create_external”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] data</code>: Необработанный указатель на внешние данные.</li><li><code>[in] finalize_cb</code>: Необязательный обратный вызов, вызываемый при сборе внешнего значения. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет больше информации.</li><li><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов finalize во время сборки.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий внешнее значение.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API выделяет значение JavaScript с прикрепленными к нему внешними данными. Это используется для передачи внешних данных через код JavaScript, чтобы их можно было позже получить с помощью собственного кода, используя <a href="/ru/nodejs/api/n-api#napi-get-value-external"><code>napi_get_value_external</code></a>.</p><p>API добавляет обратный вызов <code>napi_finalize</code>, который будет вызываться, когда созданный объект JavaScript будет собран сборщиком мусора.</p><p>Созданное значение не является объектом и, следовательно, не поддерживает дополнительные свойства. Он считается отдельным типом значения: вызов <code>napi_typeof()</code> с внешним значением дает <code>napi_external</code>.</p><h4 id="napi_create_external_arraybuffer" tabindex="-1"><code>napi_create_external_arraybuffer</code> <a class="header-anchor" href="#napi_create_external_arraybuffer" aria-label="Permalink to “napi_create_external_arraybuffer”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> external_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] external_data</code>: Указатель на базовый байтовый буфер <code>ArrayBuffer</code>.</li><li><code>[in] byte_length</code>: Длина базового буфера в байтах.</li><li><code>[in] finalize_cb</code>: Необязательный обратный вызов, вызываемый при сборе <code>ArrayBuffer</code>. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию.</li><li><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов finalize во время сборки.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>ArrayBuffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p><strong>Некоторые среды выполнения, отличные от Node.js, отказались от поддержки внешних буферов</strong>. В средах выполнения, отличных от Node.js, этот метод может возвращать <code>napi_no_external_buffers_allowed</code>, чтобы указать, что внешние буферы не поддерживаются. Одной из таких сред выполнения является Electron, как описано в этой проблеме <a href="https://github.com/electron/electron/issues/35801" target="_blank" rel="noreferrer">electron/issues/35801</a>.</p><p>Чтобы обеспечить широчайшую совместимость со всеми средами выполнения, вы можете определить <code>NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED</code> в вашем аддоне перед включением заголовков node-api. Это скроет 2 функции, которые создают внешние буферы. Это гарантирует, что при случайном использовании одного из этих методов возникнет ошибка компиляции.</p><p>Этот API возвращает значение Node-API, соответствующее JavaScript <code>ArrayBuffer</code>. Базовый байтовый буфер <code>ArrayBuffer</code> выделяется и управляется внешне. Вызывающий должен обеспечить, чтобы байтовый буфер оставался действительным до вызова обратного вызова finalize.</p><p>API добавляет обратный вызов <code>napi_finalize</code>, который будет вызван, когда созданный JavaScript-объект будет собран сборщиком мусора.</p><p>JavaScript <code>ArrayBuffer</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-arraybuffer-objects" target="_blank" rel="noreferrer">Разделе 24.1</a> спецификации языка ECMAScript.</p><h4 id="napi_create_external_buffer" tabindex="-1"><code>napi_create_external_buffer</code> <a class="header-anchor" href="#napi_create_external_buffer" aria-label="Permalink to “napi_create_external_buffer”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_external_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] length</code>: Размер входного буфера в байтах (должен совпадать с размером нового буфера).</li><li><code>[in] data</code>: Необработанный указатель на базовый буфер для предоставления JavaScript.</li><li><code>[in] finalize_cb</code>: Необязательный обратный вызов для вызова при сборке <code>ArrayBuffer</code>. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию.</li><li><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов finalize во время сборки.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий <code>node::Buffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p><strong>Некоторые среды выполнения, отличные от Node.js, отказались от поддержки внешних буферов</strong>. В средах выполнения, отличных от Node.js, этот метод может возвращать <code>napi_no_external_buffers_allowed</code>, чтобы указать, что внешние буферы не поддерживаются. Одной из таких сред выполнения является Electron, как описано в этой проблеме <a href="https://github.com/electron/electron/issues/35801" target="_blank" rel="noreferrer">electron/issues/35801</a>.</p><p>Чтобы поддерживать широчайшую совместимость со всеми средами выполнения, вы можете определить <code>NODE_API_NO_EXTERNAL_BUFFERS_ALLOWED</code> в своем аддоне перед включением заголовков node-api. Это скроет 2 функции, которые создают внешние буферы. Это гарантирует возникновение ошибки компиляции, если вы случайно используете один из этих методов.</p><p>Этот API выделяет объект <code>node::Buffer</code> и инициализирует его данными, поддерживаемыми переданным буфером. Хотя это по-прежнему полностью поддерживаемая структура данных, в большинстве случаев достаточно использовать <code>TypedArray</code>.</p><p>API добавляет обратный вызов <code>napi_finalize</code>, который будет вызываться, когда только что созданный объект JavaScript будет собран сборщиком мусора.</p><p>Для Node.js &gt;=4 <code>Buffers</code> являются <code>Uint8Array</code>.</p><h4 id="napi_create_object" tabindex="-1"><code>napi_create_object</code> <a class="header-anchor" href="#napi_create_object" aria-label="Permalink to “napi_create_object”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>Object</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API выделяет JavaScript <code>Object</code> по умолчанию. Это эквивалентно выполнению <code>new Object()</code> в JavaScript.</p><p>Тип JavaScript <code>Object</code> описан в <a href="https://tc39.github.io/ecma262/#sec-object-type" target="_blank" rel="noreferrer">Разделе 6.1.7</a> Спецификации языка ECMAScript.</p><h4 id="napi_create_symbol" tabindex="-1"><code>napi_create_symbol</code> <a class="header-anchor" href="#napi_create_symbol" aria-label="Permalink to “napi_create_symbol”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] description</code>: Необязательный <code>napi_value</code>, который ссылается на JavaScript <code>string</code>, который будет установлен в качестве описания для символа.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>symbol</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>symbol</code> из C-строки в кодировке UTF8.</p><p>Тип JavaScript <code>symbol</code> описан в <a href="https://tc39.github.io/ecma262/#sec-symbol-objects" target="_blank" rel="noreferrer">Разделе 19.4</a> Спецификации языка ECMAScript.</p><h4 id="node_api_symbol_for" tabindex="-1"><code>node_api_symbol_for</code> <a class="header-anchor" href="#node_api_symbol_for" aria-label="Permalink to “node_api_symbol_for”">​</a></h4><p><strong>Добавлено в: v17.5.0, v16.15.0</strong></p><p><strong>Версия N-API: 9</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_symbol_for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] utf8description</code>: C-строка в кодировке UTF-8, представляющая текст, который будет использоваться в качестве описания для символа.</li><li><code>[in] length</code>: Длина строки описания в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>symbol</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API ищет в глобальном реестре существующий символ с заданным описанием. Если символ уже существует, он будет возвращен, в противном случае в реестре будет создан новый символ.</p><p>Тип JavaScript <code>symbol</code> описан в <a href="https://tc39.github.io/ecma262/#sec-symbol-objects" target="_blank" rel="noreferrer">Разделе 19.4</a> Спецификации языка ECMAScript.</p><h4 id="napi_create_typedarray" tabindex="-1"><code>napi_create_typedarray</code> <a class="header-anchor" href="#napi_create_typedarray" aria-label="Permalink to “napi_create_typedarray”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_typedarray_type </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] type</code>: Скалярный тип данных элементов в <code>TypedArray</code>.</li><li><code>[in] length</code>: Количество элементов в <code>TypedArray</code>.</li><li><code>[in] arraybuffer</code>: <code>ArrayBuffer</code>, лежащий в основе типизированного массива.</li><li><code>[in] byte_offset</code>: Смещение в байтах внутри <code>ArrayBuffer</code>, с которого начинается проекция <code>TypedArray</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>TypedArray</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает объект JavaScript <code>TypedArray</code> поверх существующего <code>ArrayBuffer</code>. Объекты <code>TypedArray</code> предоставляют массивоподобное представление основного буфера данных, где каждый элемент имеет одинаковый основной двоичный скалярный тип данных.</p><p>Требуется, чтобы <code>(length * size_of_element) + byte_offset</code> было &lt;= размеру в байтах переданного массива. В противном случае будет вызвано исключение <code>RangeError</code>.</p><p>Объекты JavaScript <code>TypedArray</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-typedarray-objects" target="_blank" rel="noreferrer">Разделе 22.2</a> Спецификации языка ECMAScript.</p><h4 id="node_api_create_buffer_from_arraybuffer" tabindex="-1"><code>node_api_create_buffer_from_arraybuffer</code> <a class="header-anchor" href="#node_api_create_buffer_from_arraybuffer" aria-label="Permalink to “node_api_create_buffer_from_arraybuffer”">​</a></h4><p><strong>Добавлено в: v23.0.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментальная</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status NAPI_CDECL </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_buffer_from_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong><code>[in] env</code></strong>: Среда, в которой вызывается API.</li><li><strong><code>[in] arraybuffer</code></strong>: <code>ArrayBuffer</code>, из которого будет создан буфер.</li><li><strong><code>[in] byte_offset</code></strong>: Смещение в байтах внутри <code>ArrayBuffer</code>, с которого начинается создание буфера.</li><li><strong><code>[in] byte_length</code></strong>: Длина в байтах буфера, который нужно создать из <code>ArrayBuffer</code>.</li><li><strong><code>[out] result</code></strong>: <code>napi_value</code>, представляющий созданный объект JavaScript <code>Buffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает объект JavaScript <code>Buffer</code> из существующего <code>ArrayBuffer</code>. Объект <code>Buffer</code> - это специфичный для Node.js класс, который предоставляет способ работы с двоичными данными непосредственно в JavaScript.</p><p>Диапазон байтов <code>[byte_offset, byte_offset + byte_length)</code> должен находиться в пределах <code>ArrayBuffer</code>. Если <code>byte_offset + byte_length</code> превышает размер <code>ArrayBuffer</code>, будет вызвано исключение <code>RangeError</code>.</p><h4 id="napi_create_dataview" tabindex="-1"><code>napi_create_dataview</code> <a class="header-anchor" href="#napi_create_dataview" aria-label="Permalink to “napi_create_dataview”">​</a></h4><p><strong>Добавлено в: v8.3.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] length</code>: Количество элементов в <code>DataView</code>.</li><li><code>[in] arraybuffer</code>: <code>ArrayBuffer</code>, лежащий в основе <code>DataView</code>.</li><li><code>[in] byte_offset</code>: Смещение в байтах внутри <code>ArrayBuffer</code>, с которого начинается проецирование <code>DataView</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>DataView</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает объект JavaScript <code>DataView</code> поверх существующего <code>ArrayBuffer</code>. Объекты <code>DataView</code> предоставляют array-like представление поверх базового буфера данных, но которое позволяет элементы разного размера и типа в <code>ArrayBuffer</code>.</p><p>Требуется, чтобы <code>byte_length + byte_offset</code> было меньше или равно размеру в байтах переданного массива. В противном случае возникает исключение <code>RangeError</code>.</p><p>Объекты JavaScript <code>DataView</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-dataview-objects" target="_blank" rel="noreferrer">Разделе 24.3</a> Спецификации языка ECMAScript.</p><h3 id="functions-to-convert-from-c-types-to-node-api" tabindex="-1">Функции для преобразования из типов C в Node-API <a class="header-anchor" href="#functions-to-convert-from-c-types-to-node-api" aria-label="Permalink to “Функции для преобразования из типов C в Node-API”">​</a></h3><h4 id="napi_create_int32" tabindex="-1"><code>napi_create_int32</code> <a class="header-anchor" href="#napi_create_int32" aria-label="Permalink to “napi_create_int32”">​</a></h4><p><strong>Добавлено в: v8.4.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Целочисленное значение для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API используется для преобразования из типа C <code>int32_t</code> в тип JavaScript <code>number</code>.</p><p>Тип JavaScript <code>number</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type" target="_blank" rel="noreferrer">Разделе 6.1.6</a> Спецификации языка ECMAScript.</p><h4 id="napi_create_uint32" tabindex="-1"><code>napi_create_uint32</code> <a class="header-anchor" href="#napi_create_uint32" aria-label="Permalink to “napi_create_uint32”">​</a></h4><p><strong>Добавлено в: v8.4.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_uint32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: Беззнаковое целое значение для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API используется для преобразования типа C <code>uint32_t</code> в тип JavaScript <code>number</code>.</p><p>Тип JavaScript <code>number</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type" target="_blank" rel="noreferrer">Разделе 6.1.6</a> Спецификации языка ECMAScript.</p><h4 id="napi_create_int64" tabindex="-1"><code>napi_create_int64</code> <a class="header-anchor" href="#napi_create_int64" aria-label="Permalink to “napi_create_int64”">​</a></h4><p><strong>Добавлено в: v8.4.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: Целое значение для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API используется для преобразования типа C <code>int64_t</code> в тип JavaScript <code>number</code>.</p><p>Тип JavaScript <code>number</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type" target="_blank" rel="noreferrer">Разделе 6.1.6</a> Спецификации языка ECMAScript. Обратите внимание, что полный диапазон <code>int64_t</code> не может быть представлен с полной точностью в JavaScript. Целочисленные значения вне диапазона <a href="https://tc39.github.io/ecma262/#sec-number.min_safe_integer" target="_blank" rel="noreferrer"><code>Number.MIN_SAFE_INTEGER</code></a> <code>-(2**53 - 1)</code> - <a href="https://tc39.github.io/ecma262/#sec-number.max_safe_integer" target="_blank" rel="noreferrer"><code>Number.MAX_SAFE_INTEGER</code></a> <code>(2**53 - 1)</code> потеряют точность.</p><h4 id="napi_create_double" tabindex="-1"><code>napi_create_double</code> <a class="header-anchor" href="#napi_create_double" aria-label="Permalink to “napi_create_double”">​</a></h4><p><strong>Добавлено в: v8.4.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">double</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: Значение двойной точности для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API используется для преобразования типа C <code>double</code> в тип JavaScript <code>number</code>.</p><p>Тип JavaScript <code>number</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type" target="_blank" rel="noreferrer">Разделе 6.1.6</a> Спецификации языка ECMAScript.</p><h4 id="napi_create_bigint_int64" tabindex="-1"><code>napi_create_bigint_int64</code> <a class="header-anchor" href="#napi_create_bigint_int64" aria-label="Permalink to “napi_create_bigint_int64”">​</a></h4><p><strong>Добавлено в: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Целочисленное значение для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>BigInt</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API преобразует тип C <code>int64_t</code> в тип JavaScript <code>BigInt</code>.</p><h4 id="napi_create_bigint_uint64" tabindex="-1"><code>napi_create_bigint_uint64</code> <a class="header-anchor" href="#napi_create_bigint_uint64" aria-label="Permalink to “napi_create_bigint_uint64”">​</a></h4><p><strong>Добавлено в: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_uint64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      uint64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Беззнаковое целочисленное значение для представления в JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>BigInt</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API преобразует тип C <code>uint64_t</code> в тип JavaScript <code>BigInt</code>.</p><h4 id="napi_create_bigint_words" tabindex="-1"><code>napi_create_bigint_words</code> <a class="header-anchor" href="#napi_create_bigint_words" aria-label="Permalink to “napi_create_bigint_words”">​</a></h4><p><strong>Добавлено в: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_bigint_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sign_bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> word_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] sign_bit</code>: Определяет, будет ли результирующий <code>BigInt</code> положительным или отрицательным.</li><li><code>[in] word_count</code>: Длина массива <code>words</code>.</li><li><code>[in] words</code>: Массив 64-битных слов <code>uint64_t</code> в порядке little-endian.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>BigInt</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API преобразует массив беззнаковых 64-битных слов в одно значение <code>BigInt</code>.</p><p>Результирующий <code>BigInt</code> вычисляется как: (–1) (<code>words[0]</code> × (2) + <code>words[1]</code> × (2) + …)</p><h4 id="napi_create_string_latin1" tabindex="-1"><code>napi_create_string_latin1</code> <a class="header-anchor" href="#napi_create_string_latin1" aria-label="Permalink to “napi_create_string_latin1”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке ISO-8859-1.</li><li><code>[in] length</code>: Длина строки в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулевым символом.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>string</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>string</code> из C-строки в кодировке ISO-8859-1. Нативная строка копируется.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="node_api_create_external_string_latin1" tabindex="-1"><code>node_api_create_external_string_latin1</code> <a class="header-anchor" href="#node_api_create_external_string_latin1" aria-label="Permalink to “node_api_create_external_string_latin1”">​</a></h4><p><strong>Добавлено в: v20.4.0, v18.18.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Stability: 1</a> - Experimental</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_external_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> copied</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p><code>[in] env</code>: Среда, в которой вызывается API.</p></li><li><p><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке ISO-8859-1.</p></li><li><p><code>[in] length</code>: Длина строки в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулевым символом.</p></li><li><p><code>[in] finalize_callback</code>: Функция, вызываемая при сборке строки. Функция будет вызвана со следующими параметрами:</p><ul><li><code>[in] env</code>: Среда, в которой выполняется надстройка. Это значение может быть null, если строка собирается в рамках завершения рабочего процесса или основного экземпляра Node.js.</li><li><code>[in] data</code>: Это значение <code>str</code> в виде указателя <code>void*</code>.</li><li><code>[in] finalize_hint</code>: Это значение <code>finalize_hint</code>, которое было передано в API. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию. Этот параметр является необязательным. Передача значения null означает, что надстройке не нужно уведомлять о сборе соответствующей строки JavaScript.</li></ul></li><li><p><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов финализации во время сборки.</p></li><li><p><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>string</code>.</p></li><li><p><code>[out] copied</code>: Указывает, была ли скопирована строка. Если это так, то финализатор уже будет вызван для уничтожения <code>str</code>.</p></li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>string</code> из C-строки в кодировке ISO-8859-1. Нативная строка может быть не скопирована и, следовательно, должна существовать в течение всего жизненного цикла значения JavaScript.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="napi_create_string_utf16" tabindex="-1"><code>napi_create_string_utf16</code> <a class="header-anchor" href="#napi_create_string_utf16" aria-label="Permalink to “napi_create_string_utf16”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке UTF16-LE.</li><li><code>[in] length</code>: Длина строки в двухбайтовых кодовых единицах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>string</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>string</code> из C-строки в кодировке UTF16-LE. Нативная строка копируется.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">Разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="node_api_create_external_string_utf16" tabindex="-1"><code>node_api_create_external_string_utf16</code> <a class="header-anchor" href="#node_api_create_external_string_utf16" aria-label="Permalink to “node_api_create_external_string_utf16”">​</a></h4><p><strong>Добавлено в: v20.4.0, v18.18.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Стабильно: 1 - Экспериментально]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментально</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_external_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                      char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> copied</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><p><code>[in] env</code>: Среда, в которой вызывается API.</p></li><li><p><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке UTF16-LE.</p></li><li><p><code>[in] length</code>: Длина строки в двухбайтовых кодовых единицах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</p></li><li><p><code>[in] finalize_callback</code>: Функция, вызываемая при сборке строки. Функция будет вызываться со следующими параметрами:</p><ul><li><code>[in] env</code>: Среда, в которой работает аддон. Это значение может быть null, если строка собирается как часть завершения рабочего процесса или основного экземпляра Node.js.</li><li><code>[in] data</code>: Это значение <code>str</code> в виде указателя <code>void*</code>.</li><li><code>[in] finalize_hint</code>: Это значение <code>finalize_hint</code>, которое было передано в API. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию. Этот параметр является необязательным. Передача значения null означает, что аддону не нужно получать уведомления при сборке соответствующей строки JavaScript.</li></ul></li><li><p><code>[in] finalize_hint</code>: Необязательная подсказка для передачи в обратный вызов финализации во время сборки.</p></li><li><p><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>string</code>.</p></li><li><p><code>[out] copied</code>: Указывает, была ли скопирована строка. Если это так, финализатор уже был вызван для уничтожения <code>str</code>.</p></li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>string</code> из C-строки в кодировке UTF16-LE. Нативная строка может быть не скопирована и, следовательно, должна существовать в течение всего жизненного цикла значения JavaScript.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">Разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="napi_create_string_utf8" tabindex="-1"><code>napi_create_string_utf8</code> <a class="header-anchor" href="#napi_create_string_utf8" aria-label="Permalink to “napi_create_string_utf8”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке UTF8.</li><li><code>[in] length</code>: Длина строки в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript <code>string</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает значение JavaScript <code>string</code> из C-строки в кодировке UTF8. Нативная строка копируется.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">Разделе 6.1.4</a> спецификации языка ECMAScript.</p><h3 id="functions-to-create-optimized-property-keys" tabindex="-1">Функции для создания оптимизированных ключей свойств <a class="header-anchor" href="#functions-to-create-optimized-property-keys" aria-label="Permalink to “Функции для создания оптимизированных ключей свойств”">​</a></h3><p>Многие JavaScript движки, включая V8, используют интернированные строки в качестве ключей для установки и получения значений свойств. Они обычно используют хеш-таблицу для создания и поиска таких строк. Хотя это добавляет некоторую стоимость за создание каждого ключа, это улучшает производительность после этого, позволяя сравнивать указатели строк вместо целых строк.</p><p>Если новая строка JavaScript предназначена для использования в качестве ключа свойства, то для некоторых JavaScript движков будет более эффективно использовать функции в этом разделе. В противном случае используйте функции <code>napi_create_string_utf8</code> или <code>node_api_create_external_string_utf8</code>, поскольку при создании/хранении строк с помощью методов создания ключей свойств могут возникнуть дополнительные накладные расходы.</p><h4 id="node_api_create_property_key_latin1" tabindex="-1"><code>node_api_create_property_key_latin1</code> <a class="header-anchor" href="#node_api_create_property_key_latin1" aria-label="Permalink to “node_api_create_property_key_latin1”">​</a></h4><p><strong>Добавлено в версии: v22.9.0, v20.18.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Стабильно: 1 - Экспериментально]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментально</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status NAPI_CDECL </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_property_key_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                           const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                           size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                           napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке ISO-8859-1.</li><li><code>[in] length</code>: Длина строки в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий оптимизированный JavaScript <code>string</code>, который будет использоваться в качестве ключа свойства для объектов.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает оптимизированное значение JavaScript <code>string</code> из C-строки в кодировке ISO-8859-1, которое будет использоваться в качестве ключа свойства для объектов. Нативная строка копируется. В отличие от <code>napi_create_string_latin1</code>, последующие вызовы этой функции с тем же указателем <code>str</code> могут выиграть от ускорения создания запрошенного <code>napi_value</code>, в зависимости от движка.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">Разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="node_api_create_property_key_utf16" tabindex="-1"><code>node_api_create_property_key_utf16</code> <a class="header-anchor" href="#node_api_create_property_key_utf16" aria-label="Permalink to “node_api_create_property_key_utf16”">​</a></h4><p><strong>Добавлено в: v21.7.0, v20.12.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментальная функция</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status NAPI_CDECL </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_property_key_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                          const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                          size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                          napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке UTF16-LE.</li><li><code>[in] length</code>: Длина строки в двухбайтовых кодовых единицах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий оптимизированную JavaScript <code>string</code>, которая будет использоваться в качестве ключа свойства для объектов.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает оптимизированное значение JavaScript <code>string</code> из C-строки в кодировке UTF16-LE, которое будет использоваться в качестве ключа свойства для объектов. Нативная строка копируется.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">разделе 6.1.4</a> спецификации языка ECMAScript.</p><h4 id="node_api_create_property_key_utf8" tabindex="-1"><code>node_api_create_property_key_utf8</code> <a class="header-anchor" href="#node_api_create_property_key_utf8" aria-label="Permalink to “node_api_create_property_key_utf8”">​</a></h4><p><strong>Добавлено в: v22.9.0, v20.18.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментальная функция</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status NAPI_CDECL </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_create_property_key_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                         const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                         size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                         napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] str</code>: Символьный буфер, представляющий строку в кодировке UTF8.</li><li><code>[in] length</code>: Длина строки в двухбайтовых кодовых единицах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий оптимизированную JavaScript <code>string</code>, которая будет использоваться в качестве ключа свойства для объектов.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает оптимизированное значение JavaScript <code>string</code> из C-строки в кодировке UTF8, которое будет использоваться в качестве ключа свойства для объектов. Нативная строка копируется.</p><p>Тип JavaScript <code>string</code> описан в <a href="https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type" target="_blank" rel="noreferrer">разделе 6.1.4</a> спецификации языка ECMAScript.</p><h3 id="functions-to-convert-from-node-api-to-c-types" tabindex="-1">Функции для преобразования из Node-API в типы C <a class="header-anchor" href="#functions-to-convert-from-node-api-to-c-types" aria-label="Permalink to “Функции для преобразования из Node-API в типы C”">​</a></h3><h4 id="napi_get_array_length" tabindex="-1"><code>napi_get_array_length</code> <a class="header-anchor" href="#napi_get_array_length" aria-label="Permalink to “napi_get_array_length”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_array_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>Array</code>, длина которого запрашивается.</li><li><code>[out] result</code>: <code>uint32</code>, представляющий длину массива.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API возвращает длину массива.</p><p>Длина <code>Array</code> описана в <a href="https://tc39.github.io/ecma262/#sec-properties-of-array-instances-length" target="_blank" rel="noreferrer">Разделе 22.1.4.1</a> спецификации языка ECMAScript.</p><h4 id="napi_get_arraybuffer_info" tabindex="-1"><code>napi_get_arraybuffer_info</code> <a class="header-anchor" href="#napi_get_arraybuffer_info" aria-label="Permalink to “napi_get_arraybuffer_info”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_arraybuffer_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] arraybuffer</code>: <code>napi_value</code>, представляющий <code>ArrayBuffer</code>, для которого выполняется запрос.</li><li><code>[out] data</code>: Базовый буфер данных <code>ArrayBuffer</code>. Если byte_length равен <code>0</code>, это может быть <code>NULL</code> или любое другое значение указателя.</li><li><code>[out] byte_length</code>: Длина базового буфера данных в байтах.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API используется для получения базового буфера данных <code>ArrayBuffer</code> и его длины.</p><p><em>ВНИМАНИЕ</em>: Будьте осторожны при использовании этого API. Время жизни базового буфера данных управляется <code>ArrayBuffer</code> даже после его возврата. Возможным безопасным способом использования этого API является его использование в сочетании с <a href="/ru/nodejs/api/n-api#napi-create-reference"><code>napi_create_reference</code></a>, который можно использовать для гарантированного контроля над временем жизни <code>ArrayBuffer</code>. Также безопасно использовать возвращенный буфер данных в том же обратном вызове, если нет вызовов других API, которые могут вызвать GC.</p><h4 id="napi_get_buffer_info" tabindex="-1"><code>napi_get_buffer_info</code> <a class="header-anchor" href="#napi_get_buffer_info" aria-label="Permalink to “napi_get_buffer_info”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_buffer_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий собой запрашиваемый <code>node::Buffer</code> или <code>Uint8Array</code>.</li><li><code>[out] data</code>: Базовый буфер данных <code>node::Buffer</code> или <code>Uint8Array</code>. Если длина равна <code>0</code>, это может быть <code>NULL</code> или любое другое значение указателя.</li><li><code>[out] length</code>: Длина в байтах базового буфера данных.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот метод возвращает те же <code>data</code> и <code>byte_length</code>, что и <a href="/ru/nodejs/api/n-api#napi-get-typedarray-info"><code>napi_get_typedarray_info</code></a>. И <code>napi_get_typedarray_info</code> также принимает <code>node::Buffer</code> (Uint8Array) в качестве значения.</p><p>Этот API используется для получения базового буфера данных <code>node::Buffer</code> и его длины.</p><p><em>Предупреждение</em>: Будьте осторожны при использовании этого API, поскольку время жизни базового буфера данных не гарантируется, если он управляется VM.</p><h4 id="napi_get_prototype" tabindex="-1"><code>napi_get_prototype</code> <a class="header-anchor" href="#napi_get_prototype" aria-label="Permalink to “napi_get_prototype”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] object</code>: <code>napi_value</code>, представляющий JavaScript <code>Object</code>, чей прототип нужно вернуть. Возвращает эквивалент <code>Object.getPrototypeOf</code> (который не совпадает со свойством <code>prototype</code> функции).</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий прототип данного объекта.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><h4 id="napi_get_typedarray_info" tabindex="-1"><code>napi_get_typedarray_info</code> <a class="header-anchor" href="#napi_get_typedarray_info" aria-label="Permalink to “napi_get_typedarray_info”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_typedarray_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_typedarray_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                     napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] typedarray</code>: <code>napi_value</code>, представляющий <code>TypedArray</code>, чьи свойства нужно запросить.</li><li><code>[out] type</code>: Скалярный тип данных элементов внутри <code>TypedArray</code>.</li><li><code>[out] length</code>: Количество элементов в <code>TypedArray</code>.</li><li><code>[out] data</code>: Буфер данных, лежащий в основе <code>TypedArray</code>, скорректированный значением <code>byte_offset</code>, так что он указывает на первый элемент в <code>TypedArray</code>. Если длина массива равна <code>0</code>, это может быть <code>NULL</code> или любое другое значение указателя.</li><li><code>[out] arraybuffer</code>: <code>ArrayBuffer</code>, лежащий в основе <code>TypedArray</code>.</li><li><code>[out] byte_offset</code>: Смещение в байтах внутри базового собственного массива, в котором расположен первый элемент массива. Значение для параметра data уже скорректировано так, что data указывает на первый элемент в массиве. Следовательно, первый байт собственного массива будет находиться по адресу <code>data - byte_offset</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API возвращает различные свойства типизированного массива.</p><p>Любой из выходных параметров может быть <code>NULL</code>, если это свойство не требуется.</p><p><em>Предупреждение</em>: Будьте осторожны при использовании этого API, поскольку базовый буфер данных управляется VM.</p><h4 id="napi_get_dataview_info" tabindex="-1"><code>napi_get_dataview_info</code> <a class="header-anchor" href="#napi_get_dataview_info" aria-label="Permalink to “napi_get_dataview_info”">​</a></h4><p><strong>Added in: v8.3.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_dataview_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> byte_offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] dataview</code>: <code>napi_value</code>, представляющий <code>DataView</code>, чьи свойства нужно запросить.</li><li><code>[out] byte_length</code>: Количество байтов в <code>DataView</code>.</li><li><code>[out] data</code>: Буфер данных, лежащий в основе <code>DataView</code>. Если byte_length равен <code>0</code>, это может быть <code>NULL</code> или любое другое значение указателя.</li><li><code>[out] arraybuffer</code>: <code>ArrayBuffer</code>, лежащий в основе <code>DataView</code>.</li><li><code>[out] byte_offset</code>: Смещение байтов внутри буфера данных, с которого начинается проецирование <code>DataView</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Любой из выходных параметров может быть <code>NULL</code>, если это свойство не нужно.</p><p>Этот API возвращает различные свойства <code>DataView</code>.</p><h4 id="napi_get_date_value" tabindex="-1"><code>napi_get_date_value</code> <a class="header-anchor" href="#napi_get_date_value" aria-label="Permalink to “napi_get_date_value”">​</a></h4><p><strong>Added in: v11.11.0, v10.17.0</strong></p><p><strong>N-API version: 5</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_date_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                double*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>Date</code>.</li><li><code>[out] result</code>: Значение времени в виде <code>double</code>, представленное в миллисекундах с полуночи начала 01 января 1970 года UTC.</li></ul><p>Этот API не учитывает високосные секунды; они игнорируются, так как ECMAScript соответствует спецификации времени POSIX.</p><p>Возвращает <code>napi_ok</code>, если API успешно выполнен. Если передано значение <code>napi_value</code>, не являющееся датой, возвращает <code>napi_date_expected</code>.</p><p>Этот API возвращает примитив C double значения времени для данного JavaScript <code>Date</code>.</p><h4 id="napi_get_value_bool" tabindex="-1"><code>napi_get_value_bool</code> <a class="header-anchor" href="#napi_get_value_bool" aria-label="Permalink to “napi_get_value_bool”">​</a></h4><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>Boolean</code>.</li><li><code>[out] result</code>: C примитив boolean, эквивалентный данному JavaScript <code>Boolean</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен. Если передано значение <code>napi_value</code>, не являющееся логическим, возвращает <code>napi_boolean_expected</code>.</p><p>Этот API возвращает C примитив boolean, эквивалентный данному JavaScript <code>Boolean</code>.</p><h4 id="napi_get_value_double" tabindex="-1"><code>napi_get_value_double</code> <a class="header-anchor" href="#napi_get_value_double" aria-label="Permalink to “napi_get_value_double”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_double</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  double*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющее JavaScript <code>number</code>.</li><li><code>[out] result</code>: C примитив типа double, эквивалентный заданному JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен. Если передано нечисловое значение <code>napi_value</code>, возвращается <code>napi_number_expected</code>.</p><p>Этот API возвращает C примитив типа double, эквивалентный заданному JavaScript <code>number</code>.</p><h4 id="napi_get_value_bigint_int64" tabindex="-1"><code>napi_get_value_bigint_int64</code> <a class="header-anchor" href="#napi_get_value_bigint_int64" aria-label="Permalink to “napi_get_value_bigint_int64”">​</a></h4><p><strong>Добавлено в: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> lossless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющее JavaScript <code>BigInt</code>.</li><li><code>[out] result</code>: C примитив <code>int64_t</code>, эквивалентный заданному JavaScript <code>BigInt</code>.</li><li><code>[out] lossless</code>: Указывает, было ли преобразование значения <code>BigInt</code> выполнено без потерь.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен. Если передано не-<code>BigInt</code> значение, возвращается <code>napi_bigint_expected</code>.</p><p>Этот API возвращает C примитив <code>int64_t</code>, эквивалентный заданному JavaScript <code>BigInt</code>. При необходимости он будет усекать значение, устанавливая <code>lossless</code> в <code>false</code>.</p><h4 id="napi_get_value_bigint_uint64" tabindex="-1"><code>napi_get_value_bigint_uint64</code> <a class="header-anchor" href="#napi_get_value_bigint_uint64" aria-label="Permalink to “napi_get_value_bigint_uint64”">​</a></h4><p><strong>Добавлено в: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_uint64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> lossless</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющее JavaScript <code>BigInt</code>.</li><li><code>[out] result</code>: C примитив <code>uint64_t</code>, эквивалентный заданному JavaScript <code>BigInt</code>.</li><li><code>[out] lossless</code>: Указывает, было ли преобразование значения <code>BigInt</code> выполнено без потерь.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен. Если передано не-<code>BigInt</code> значение, возвращается <code>napi_bigint_expected</code>.</p><p>Этот API возвращает C примитив <code>uint64_t</code>, эквивалентный заданному JavaScript <code>BigInt</code>. При необходимости он будет усекать значение, устанавливая <code>lossless</code> в <code>false</code>.</p><h4 id="napi_get_value_bigint_words" tabindex="-1"><code>napi_get_value_bigint_words</code> <a class="header-anchor" href="#napi_get_value_bigint_words" aria-label="Permalink to “napi_get_value_bigint_words”">​</a></h4><p><strong>Добавлено в версии: v10.7.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_bigint_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        int*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sign_bit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> word_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        uint64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>BigInt</code>.</li><li><code>[out] sign_bit</code>: Целое число, представляющее, является ли JavaScript <code>BigInt</code> положительным или отрицательным.</li><li><code>[in/out] word_count</code>: Должен быть инициализирован длиной массива <code>words</code>. При возврате будет установлено фактическое количество слов, необходимое для хранения этого <code>BigInt</code>.</li><li><code>[out] words</code>: Указатель на предварительно выделенный 64-битный массив слов.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API преобразует одно значение <code>BigInt</code> в знаковый бит, 64-битный массив с обратным порядком байтов и количество элементов в массиве. <code>sign_bit</code> и <code>words</code> могут быть установлены в <code>NULL</code>, чтобы получить только <code>word_count</code>.</p><h4 id="napi_get_value_external" tabindex="-1"><code>napi_get_value_external</code> <a class="header-anchor" href="#napi_get_value_external" aria-label="Permalink to “napi_get_value_external”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_external</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий внешнее JavaScript значение.</li><li><code>[out] result</code>: Указатель на данные, обернутые JavaScript внешним значением.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно. Если передан не внешний <code>napi_value</code>, возвращает <code>napi_invalid_arg</code>.</p><p>Этот API извлекает указатель на внешние данные, который ранее был передан в <code>napi_create_external()</code>.</p><h4 id="napi_get_value_int32" tabindex="-1"><code>napi_get_value_int32</code> <a class="header-anchor" href="#napi_get_value_int32" aria-label="Permalink to “napi_get_value_int32”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 int32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li><li><code>[out] result</code>: C <code>int32</code> примитив, эквивалентный заданному JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно. Если передан не числовой <code>napi_value</code>, возвращает <code>napi_number_expected</code>.</p><p>Этот API возвращает C <code>int32</code> примитив, эквивалентный заданному JavaScript <code>number</code>.</p><p>Если число превышает диапазон 32-битного целого числа, результат усекается до эквивалента младших 32 бит. Это может привести к тому, что большое положительное число станет отрицательным, если значение &gt; 2 - 1.</p><p>Неконечные числовые значения (<code>NaN</code>, <code>+Infinity</code> или <code>-Infinity</code>) устанавливают результат в ноль.</p><h4 id="napi_get_value_int64" tabindex="-1"><code>napi_get_value_int64</code> <a class="header-anchor" href="#napi_get_value_int64" aria-label="Permalink to “napi_get_value_int64”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_int64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющее JavaScript <code>number</code>.</li><li><code>[out] result</code>: C <code>int64</code> примитив, эквивалентный данному JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено. Если передано нечисловое значение <code>napi_value</code>, возвращает <code>napi_number_expected</code>.</p><p>Этот API возвращает C <code>int64</code> примитив, эквивалентный данному JavaScript <code>number</code>.</p><p>Значения <code>number</code>, выходящие за пределы диапазона <a href="https://tc39.github.io/ecma262/#sec-number.min_safe_integer" target="_blank" rel="noreferrer"><code>Number.MIN_SAFE_INTEGER</code></a> <code>-(2**53 - 1)</code> - <a href="https://tc39.github.io/ecma262/#sec-number.max_safe_integer" target="_blank" rel="noreferrer"><code>Number.MAX_SAFE_INTEGER</code></a> <code>(2**53 - 1)</code>, потеряют точность.</p><p>Неконечные числовые значения (<code>NaN</code>, <code>+Infinity</code> или <code>-Infinity</code>) устанавливают результат в ноль.</p><h4 id="napi_get_value_string_latin1" tabindex="-1"><code>napi_get_value_string_latin1</code> <a class="header-anchor" href="#napi_get_value_string_latin1" aria-label="Permalink to “napi_get_value_string_latin1”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_latin1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющее строку JavaScript.</li><li><code>[in] buf</code>: Буфер для записи строки в кодировке ISO-8859-1. Если передано значение <code>NULL</code>, длина строки в байтах, исключая нулевой терминатор, возвращается в <code>result</code>.</li><li><code>[in] bufsize</code>: Размер целевого буфера. Если этого значения недостаточно, возвращаемая строка усекается и завершается нулем.</li><li><code>[out] result</code>: Количество байтов, скопированных в буфер, исключая нулевой терминатор.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено. Если передано значение <code>napi_value</code>, не являющееся строкой, возвращает <code>napi_string_expected</code>.</p><p>Этот API возвращает строку в кодировке ISO-8859-1, соответствующую переданному значению.</p><h4 id="napi_get_value_string_utf8" tabindex="-1"><code>napi_get_value_string_utf8</code> <a class="header-anchor" href="#napi_get_value_string_utf8" aria-label="Permalink to “napi_get_value_string_utf8”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий строку JavaScript.</li><li><code>[in] buf</code>: Буфер для записи строки в кодировке UTF8. Если передано значение <code>NULL</code>, в <code>result</code> возвращается длина строки в байтах, исключая завершающий нуль-терминатор.</li><li><code>[in] bufsize</code>: Размер целевого буфера. Если это значение недостаточно, возвращаемая строка усекается и завершается нулем.</li><li><code>[out] result</code>: Количество байтов, скопированных в буфер, исключая завершающий нуль-терминатор.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно. Если передано значение <code>napi_value</code>, не являющееся <code>string</code>, возвращается <code>napi_string_expected</code>.</p><p>Этот API возвращает строку в кодировке UTF8, соответствующую переданному значению.</p><h4 id="napi_get_value_string_utf16" tabindex="-1"><code>napi_get_value_string_utf16</code> <a class="header-anchor" href="#napi_get_value_string_utf16" aria-label="Permalink to “napi_get_value_string_utf16”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_string_utf16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                                        char16_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> buf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> bufsize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                        size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий строку JavaScript.</li><li><code>[in] buf</code>: Буфер для записи строки в кодировке UTF16-LE. Если передано значение <code>NULL</code>, возвращается длина строки в 2-байтовых единицах кода, исключая завершающий нуль-терминатор.</li><li><code>[in] bufsize</code>: Размер целевого буфера. Если это значение недостаточно, возвращаемая строка усекается и завершается нулем.</li><li><code>[out] result</code>: Количество 2-байтовых единиц кода, скопированных в буфер, исключая завершающий нуль-терминатор.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно. Если передано значение <code>napi_value</code>, не являющееся <code>string</code>, возвращается <code>napi_string_expected</code>.</p><p>Этот API возвращает строку в кодировке UTF16, соответствующую переданному значению.</p><h4 id="napi_get_value_uint32" tabindex="-1"><code>napi_get_value_uint32</code> <a class="header-anchor" href="#napi_get_value_uint32" aria-label="Permalink to “napi_get_value_uint32”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_value_uint32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: <code>napi_value</code>, представляющий JavaScript <code>number</code>.</li><li><code>[out] result</code>: Примитив C, эквивалентный данному <code>napi_value</code>, как <code>uint32_t</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено. Если передается нечисловое <code>napi_value</code>, возвращает <code>napi_number_expected</code>.</p><p>Этот API возвращает примитив C, эквивалентный данному <code>napi_value</code>, как <code>uint32_t</code>.</p><h3 id="functions-to-get-global-instances" tabindex="-1">Функции для получения глобальных экземпляров <a class="header-anchor" href="#functions-to-get-global-instances" aria-label="Permalink to “Функции для получения глобальных экземпляров”">​</a></h3><h4 id="napi_get_boolean" tabindex="-1"><code>napi_get_boolean</code> <a class="header-anchor" href="#napi_get_boolean" aria-label="Permalink to “napi_get_boolean”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение логического типа, которое нужно получить.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript синглтон <code>Boolean</code>, который нужно получить.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API используется для возврата JavaScript синглтон объекта, который используется для представления заданного логического значения.</p><h4 id="napi_get_global" tabindex="-1"><code>napi_get_global</code> <a class="header-anchor" href="#napi_get_global" aria-label="Permalink to “napi_get_global”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript объект <code>global</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API возвращает объект <code>global</code>.</p><h4 id="napi_get_null" tabindex="-1"><code>napi_get_null</code> <a class="header-anchor" href="#napi_get_null" aria-label="Permalink to “napi_get_null”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript объект <code>null</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API возвращает объект <code>null</code>.</p><h4 id="napi_get_undefined" tabindex="-1"><code>napi_get_undefined</code> <a class="header-anchor" href="#napi_get_undefined" aria-label="Permalink to “napi_get_undefined”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий значение JavaScript Undefined.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API возвращает объект Undefined.</p><h2 id="working-with-javascript-values-and-abstract-operations" tabindex="-1">Работа со значениями JavaScript и абстрактными операциями <a class="header-anchor" href="#working-with-javascript-values-and-abstract-operations" aria-label="Permalink to “Работа со значениями JavaScript и абстрактными операциями”">​</a></h2><p>Node-API предоставляет набор API для выполнения некоторых абстрактных операций над значениями JavaScript. Некоторые из этих операций задокументированы в <a href="https://tc39.github.io/ecma262/#sec-abstract-operations" target="_blank" rel="noreferrer">Разделе 7</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a>.</p><p>Эти API поддерживают выполнение одного из следующего:</p><h3 id="napi_coerce_to_bool" tabindex="-1"><code>napi_coerce_to_bool</code> <a class="header-anchor" href="#napi_coerce_to_bool" aria-label="Permalink to “napi_coerce_to_bool”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение JavaScript, которое необходимо привести.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее приведенное JavaScript <code>Boolean</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API реализует абстрактную операцию <code>ToBoolean()</code>, как определено в <a href="https://tc39.github.io/ecma262/#sec-toboolean" target="_blank" rel="noreferrer">Разделе 7.1.2</a> Спецификации языка ECMAScript.</p><h3 id="napi_coerce_to_number" tabindex="-1"><code>napi_coerce_to_number</code> <a class="header-anchor" href="#napi_coerce_to_number" aria-label="Permalink to “napi_coerce_to_number”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_number</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение JavaScript, которое необходимо привести.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее приведенное JavaScript <code>number</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API реализует абстрактную операцию <code>ToNumber()</code>, как определено в <a href="https://tc39.github.io/ecma262/#sec-tonumber" target="_blank" rel="noreferrer">Разделе 7.1.3</a> Спецификации языка ECMAScript. Эта функция потенциально запускает JS-код, если переданное значение является объектом.</p><h3 id="napi_coerce_to_object" tabindex="-1"><code>napi_coerce_to_object</code> <a class="header-anchor" href="#napi_coerce_to_object" aria-label="Permalink to “napi_coerce_to_object”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение JavaScript, которое необходимо привести.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее приведенный JavaScript <code>Object</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API реализует абстрактную операцию <code>ToObject()</code>, как определено в <a href="https://tc39.github.io/ecma262/#sec-toobject" target="_blank" rel="noreferrer">Разделе 7.1.13</a> Спецификации языка ECMAScript.</p><h3 id="napi_coerce_to_string" tabindex="-1"><code>napi_coerce_to_string</code> <a class="header-anchor" href="#napi_coerce_to_string" aria-label="Permalink to “napi_coerce_to_string”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_coerce_to_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Преобразуемое значение JavaScript.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее преобразованную JavaScript <code>string</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершен.</p><p>Этот API реализует абстрактную операцию <code>ToString()</code>, как определено в <a href="https://tc39.github.io/ecma262/#sec-toobject" target="_blank" rel="noreferrer">Разделе 7.1.13</a> Спецификации языка ECMAScript. Эта функция потенциально запускает JS-код, если переданное значение является объектом.</p><h3 id="napi_typeof" tabindex="-1"><code>napi_typeof</code> <a class="header-anchor" href="#napi_typeof" aria-label="Permalink to “napi_typeof”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_valuetype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение JavaScript, тип которого необходимо запросить.</li><li><code>[out] result</code>: Тип значения JavaScript.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершен.</p><ul><li><code>napi_invalid_arg</code>, если тип <code>value</code> не является известным типом ECMAScript и <code>value</code> не является внешним значением.</li></ul><p>Этот API представляет поведение, аналогичное вызову оператора <code>typeof</code> для объекта, как определено в <a href="https://tc39.github.io/ecma262/#sec-typeof-operator" target="_blank" rel="noreferrer">Разделе 12.5.5</a> Спецификации языка ECMAScript. Однако есть некоторые различия:</p><p>Если <code>value</code> имеет недопустимый тип, возвращается ошибка.</p><h3 id="napi_instanceof" tabindex="-1"><code>napi_instanceof</code> <a class="header-anchor" href="#napi_instanceof" aria-label="Permalink to “napi_instanceof”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                            bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] object</code>: Значение JavaScript для проверки.</li><li><code>[in] constructor</code>: Объект JavaScript-функции функции-конструктора, с которой выполняется проверка.</li><li><code>[out] result</code>: Логическое значение, которое устанавливается в true, если <code>object instanceof constructor</code> имеет значение true.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно завершен.</p><p>Этот API представляет вызов оператора <code>instanceof</code> для объекта, как определено в <a href="https://tc39.github.io/ecma262/#sec-instanceofoperator" target="_blank" rel="noreferrer">Разделе 12.10.4</a> Спецификации языка ECMAScript.</p><h3 id="napi_is_array" tabindex="-1"><code>napi_is_array</code> <a class="header-anchor" href="#napi_is_array" aria-label="Permalink to “napi_is_array”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Проверяемое значение JavaScript.</li><li><code>[out] result</code>: Указывает, является ли данный объект массивом.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API представляет собой вызов операции <code>IsArray</code> для объекта, как определено в <a href="https://tc39.github.io/ecma262/#sec-isarray" target="_blank" rel="noreferrer">Разделе 7.2.2</a> Спецификации языка ECMAScript.</p><h3 id="napi_is_arraybuffer" tabindex="-1"><code>napi_is_arraybuffer</code> <a class="header-anchor" href="#napi_is_arraybuffer" aria-label="Permalink to “napi_is_arraybuffer”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Проверяемое значение JavaScript.</li><li><code>[out] result</code>: Указывает, является ли данный объект <code>ArrayBuffer</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API проверяет, является ли переданный <code>Object</code> буфером массива.</p><h3 id="napi_is_buffer" tabindex="-1"><code>napi_is_buffer</code> <a class="header-anchor" href="#napi_is_buffer" aria-label="Permalink to “napi_is_buffer”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Проверяемое значение JavaScript.</li><li><code>[out] result</code>: Указывает, представляет ли данный <code>napi_value</code> объект <code>node::Buffer</code> или <code>Uint8Array</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API проверяет, является ли переданный <code>Object</code> буфером или Uint8Array. <a href="/ru/nodejs/api/n-api#napi-is-typedarray"><code>napi_is_typedarray</code></a> следует предпочесть, если вызывающему необходимо проверить, является ли значение Uint8Array.</p><h3 id="napi_is_date" tabindex="-1"><code>napi_is_date</code> <a class="header-anchor" href="#napi_is_date" aria-label="Permalink to “napi_is_date”">​</a></h3><p><strong>Добавлено в: v11.11.0, v10.17.0</strong></p><p><strong>Версия N-API: 5</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_date</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Проверяемое значение JavaScript.</li><li><code>[out] result</code>: Указывает, представляет ли данный <code>napi_value</code> объект JavaScript <code>Date</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API проверяет, является ли переданный <code>Object</code> датой.</p><h3 id="napi_is_error_1" tabindex="-1"><code>napi_is_error</code> <a class="header-anchor" href="#napi_is_error_1" aria-label="Permalink to “napi_is_error”">​</a></h3><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: JavaScript значение для проверки.</li><li><code>[out] result</code>: Указывает, представляет ли данный <code>napi_value</code> объект <code>Error</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API проверяет, является ли переданный <code>Object</code> объектом <code>Error</code>.</p><h3 id="napi_is_typedarray" tabindex="-1"><code>napi_is_typedarray</code> <a class="header-anchor" href="#napi_is_typedarray" aria-label="Permalink to “napi_is_typedarray”">​</a></h3><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_typedarray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: JavaScript значение для проверки.</li><li><code>[out] result</code>: Указывает, представляет ли данный <code>napi_value</code> <code>TypedArray</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API проверяет, является ли переданный <code>Object</code> типизированным массивом.</p><h3 id="napi_is_dataview" tabindex="-1"><code>napi_is_dataview</code> <a class="header-anchor" href="#napi_is_dataview" aria-label="Permalink to “napi_is_dataview”">​</a></h3><p><strong>Added in: v8.3.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_dataview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: JavaScript значение для проверки.</li><li><code>[out] result</code>: Указывает, представляет ли данный <code>napi_value</code> <code>DataView</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API проверяет, является ли переданный <code>Object</code> <code>DataView</code>.</p><h3 id="napi_strict_equals" tabindex="-1"><code>napi_strict_equals</code> <a class="header-anchor" href="#napi_strict_equals" aria-label="Permalink to “napi_strict_equals”">​</a></h3><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_strict_equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">lhs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rhs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] lhs</code>: JavaScript значение для проверки.</li><li><code>[in] rhs</code>: JavaScript значение для сравнения.</li><li><code>[out] result</code>: Указывает, равны ли два объекта <code>napi_value</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API представляет собой вызов алгоритма строгого равенства, как определено в <a href="https://tc39.github.io/ecma262/#sec-strict-equality-comparison" target="_blank" rel="noreferrer">Разделе 7.2.14</a> спецификации языка ECMAScript.</p><h3 id="napi_detach_arraybuffer" tabindex="-1"><code>napi_detach_arraybuffer</code> <a class="header-anchor" href="#napi_detach_arraybuffer" aria-label="Permalink to “napi_detach_arraybuffer”">​</a></h3><p><strong>Добавлено в: v13.0.0, v12.16.0, v10.22.0</strong></p><p><strong>Версия N-API: 7</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_detach_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] arraybuffer</code>: JavaScript <code>ArrayBuffer</code>, который необходимо отсоединить.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено. Если передается неотсоединяемый <code>ArrayBuffer</code>, возвращает <code>napi_detachable_arraybuffer_expected</code>.</p><p>Как правило, <code>ArrayBuffer</code> не является отсоединяемым, если он был отсоединен ранее. Движок может налагать дополнительные условия на то, является ли <code>ArrayBuffer</code> отсоединяемым. Например, V8 требует, чтобы <code>ArrayBuffer</code> был внешним, то есть созданным с помощью <a href="/ru/nodejs/api/n-api#napi-create-external-arraybuffer"><code>napi_create_external_arraybuffer</code></a>.</p><p>Этот API представляет собой вызов операции отсоединения <code>ArrayBuffer</code>, как определено в <a href="https://tc39.es/ecma262/#sec-detacharraybuffer" target="_blank" rel="noreferrer">Разделе 24.1.1.3</a> спецификации языка ECMAScript.</p><h3 id="napi_is_detached_arraybuffer" tabindex="-1"><code>napi_is_detached_arraybuffer</code> <a class="header-anchor" href="#napi_is_detached_arraybuffer" aria-label="Permalink to “napi_is_detached_arraybuffer”">​</a></h3><p><strong>Добавлено в: v13.3.0, v12.16.0, v10.22.0</strong></p><p><strong>Версия N-API: 7</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_detached_arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                         napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arraybuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                         bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] arraybuffer</code>: JavaScript <code>ArrayBuffer</code>, который необходимо проверить.</li><li><code>[out] result</code>: Указывает, является ли <code>arraybuffer</code> отсоединенным.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Считается, что <code>ArrayBuffer</code> отсоединен, если его внутренние данные равны <code>null</code>.</p><p>Этот API представляет собой вызов операции <code>IsDetachedBuffer</code> для <code>ArrayBuffer</code>, как определено в <a href="https://tc39.es/ecma262/#sec-isdetachedbuffer" target="_blank" rel="noreferrer">Разделе 24.1.1.2</a> спецификации языка ECMAScript.</p><h2 id="working-with-javascript-properties" tabindex="-1">Работа со свойствами JavaScript <a class="header-anchor" href="#working-with-javascript-properties" aria-label="Permalink to “Работа со свойствами JavaScript”">​</a></h2><p>Node-API предоставляет набор API для получения и установки свойств в объектах JavaScript. Некоторые из этих типов документированы в <a href="https://tc39.github.io/ecma262/#sec-abstract-operations" target="_blank" rel="noreferrer">Разделе 7</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a>.</p><p>Свойства в JavaScript представлены как кортеж ключа и значения. В основном, все ключи свойств в Node-API могут быть представлены в одной из следующих форм:</p><ul><li>Именованные: простая строка в кодировке UTF8</li><li>Целочисленно-индексированные: значение индекса, представленное <code>uint32_t</code></li><li>Значение JavaScript: они представлены в Node-API как <code>napi_value</code>. Это может быть <code>napi_value</code>, представляющий <code>string</code>, <code>number</code> или <code>symbol</code>.</li></ul><p>Значения Node-API представлены типом <code>napi_value</code>. Любой вызов Node-API, требующий значения JavaScript, принимает <code>napi_value</code>. Однако ответственность за то, чтобы <code>napi_value</code> был типа JavaScript, ожидаемого API, лежит на вызывающей стороне.</p><p>API, документированные в этом разделе, предоставляют простой интерфейс для получения и установки свойств в произвольных объектах JavaScript, представленных <code>napi_value</code>.</p><p>Например, рассмотрим следующий фрагмент кода JavaScript:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj.myProp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Эквивалент можно сделать с помощью значений Node-API следующим фрагментом:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const obj = {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value obj, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a napi_value for 123</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// obj.myProp = 123</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, obj, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;myProp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Индексированные свойства можно устанавливать аналогичным образом. Рассмотрим следующий фрагмент кода JavaScript:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arr[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Эквивалент можно сделать с помощью значений Node-API следующим фрагментом:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arr = [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value arr, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create a napi_value for &#39;hello&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// arr[123] = &#39;hello&#39;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, arr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, value);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Свойства можно извлекать с помощью API, описанных в этом разделе. Рассмотрим следующий фрагмент кода JavaScript:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arr[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Ниже приведен приблизительный эквивалент на Node-API:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arr = []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value arr, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const value = arr[123]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, arr, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Наконец, несколько свойств также можно определить в объекте по соображениям производительности. Рассмотрим следующий JavaScript:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Object.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defineProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;foo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, writable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, configurable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, enumerable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;bar&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, writable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, configurable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, enumerable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Ниже приведен приблизительный эквивалент на Node-API:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_status_generic_failure;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const obj = {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value obj;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Create napi_values for 123 and 456</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value fooValue, barValue;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fooValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">456</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">barValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Set the properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_property_descriptor descriptors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;foo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fooValue, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, barValue, napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                obj,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(descriptors) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">descriptors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                descriptors);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="structures" tabindex="-1">Структуры <a class="header-anchor" href="#structures" aria-label="Permalink to “Структуры”">​</a></h3><h4 id="napi_property_attributes" tabindex="-1"><code>napi_property_attributes</code> <a class="header-anchor" href="#napi_property_attributes" aria-label="Permalink to “napi_property_attributes”">​</a></h4><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v14.12.0</td><td>добавлены <code>napi_default_method</code> и <code>napi_default_property</code>.</td></tr></tbody></table></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_configurable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Используется с napi_define_class для различения статических свойств</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // от свойств экземпляра. Игнорируется napi_define_properties.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_static </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // По умолчанию для методов класса.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default_method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_configurable,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // По умолчанию для свойств объекта, как в JS obj[prop].</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_default_jsproperty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_writable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          napi_enumerable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          napi_configurable,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_property_attributes;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>napi_property_attributes</code> - это флаги, используемые для управления поведением свойств, установленных в объекте JavaScript. За исключением <code>napi_static</code>, они соответствуют атрибутам, перечисленным в <a href="https://tc39.github.io/ecma262/#table-2" target="_blank" rel="noreferrer">Разделе 6.1.7.1</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a>. Они могут быть одним или несколькими из следующих битовых флагов:</p><ul><li><code>napi_default</code>: Никакие явные атрибуты не установлены для свойства. По умолчанию свойство доступно только для чтения, не перечисляемо и не конфигурируемо.</li><li><code>napi_writable</code>: Свойство доступно для записи.</li><li><code>napi_enumerable</code>: Свойство перечисляемо.</li><li><code>napi_configurable</code>: Свойство конфигурируемо, как определено в <a href="https://tc39.github.io/ecma262/#table-2" target="_blank" rel="noreferrer">Разделе 6.1.7.1</a> <a href="https://tc39.github.io/ecma262/" target="_blank" rel="noreferrer">Спецификации языка ECMAScript</a>.</li><li><code>napi_static</code>: Свойство будет определено как статическое свойство класса, в отличие от свойства экземпляра, которое является значением по умолчанию. Используется только <a href="/ru/nodejs/api/n-api#napi-define-class"><code>napi_define_class</code></a>. Игнорируется <code>napi_define_properties</code>.</li><li><code>napi_default_method</code>: Как метод в классе JS, свойство конфигурируемое и доступное для записи, но не перечисляемое.</li><li><code>napi_default_jsproperty</code>: Как свойство, установленное через присваивание в JavaScript, свойство доступно для записи, перечисляемо и конфигурируемо.</li></ul><h4 id="napi_property_descriptor" tabindex="-1"><code>napi_property_descriptor</code> <a class="header-anchor" href="#napi_property_descriptor" aria-label="Permalink to “napi_property_descriptor”">​</a></h4><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // One of utf8name or name should be NULL.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> utf8name;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value name;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback method;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback getter;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_callback setter;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value value;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_property_attributes attributes;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_property_descriptor;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><code>utf8name</code>: Необязательная строка, описывающая ключ для свойства, закодированная как UTF8. Для свойства должно быть указано либо <code>utf8name</code>, либо <code>name</code>.</li><li><code>name</code>: Необязательное <code>napi_value</code>, которое указывает на JavaScript строку или символ, используемый в качестве ключа для свойства. Для свойства должно быть указано либо <code>utf8name</code>, либо <code>name</code>.</li><li><code>value</code>: Значение, которое извлекается при получении доступа к свойству, если свойство является свойством данных. Если это передано, установите для <code>getter</code>, <code>setter</code>, <code>method</code> и <code>data</code> значение <code>NULL</code> (поскольку эти члены не будут использоваться).</li><li><code>getter</code>: Функция, вызываемая при получении доступа к свойству. Если это передано, установите для <code>value</code> и <code>method</code> значение <code>NULL</code> (поскольку эти члены не будут использоваться). Данная функция вызывается неявно во время выполнения, когда к свойству обращаются из кода JavaScript (или если получение свойства выполняется с использованием вызова Node-API). <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a> предоставляет более подробную информацию.</li><li><code>setter</code>: Функция, вызываемая при установке значения свойства. Если это передано, установите для <code>value</code> и <code>method</code> значение <code>NULL</code> (поскольку эти члены не будут использоваться). Данная функция вызывается неявно во время выполнения, когда свойство устанавливается из кода JavaScript (или если установка свойства выполняется с использованием вызова Node-API). <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a> предоставляет более подробную информацию.</li><li><code>method</code>: Установите это, чтобы свойство <code>value</code> объекта дескриптора свойства было JavaScript функцией, представленной <code>method</code>. Если это передано, установите для <code>value</code>, <code>getter</code> и <code>setter</code> значение <code>NULL</code> (поскольку эти члены не будут использоваться). <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a> предоставляет более подробную информацию.</li><li><code>attributes</code>: Атрибуты, связанные с конкретным свойством. См. <a href="/ru/nodejs/api/n-api#napi-property-attributes"><code>napi_property_attributes</code></a>.</li><li><code>data</code>: Данные обратного вызова, передаваемые в <code>method</code>, <code>getter</code> и <code>setter</code>, если эта функция вызывается.</li></ul><h3 id="functions" tabindex="-1">Функции <a class="header-anchor" href="#functions" aria-label="Permalink to “Функции”">​</a></h3><h4 id="napi_get_property_names" tabindex="-1"><code>napi_get_property_names</code> <a class="header-anchor" href="#napi_get_property_names" aria-label="Permalink to “napi_get_property_names”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_property_names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого извлекаются свойства.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий массив значений JavaScript, которые представляют имена свойств объекта. API можно использовать для итерации по <code>result</code> с помощью <a href="/ru/nodejs/api/n-api#napi-get-array-length"><code>napi_get_array_length</code></a> и <a href="/ru/nodejs/api/n-api#napi-get-element"><code>napi_get_element</code></a>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API возвращает имена перечислимых свойств <code>object</code> в виде массива строк. Свойства <code>object</code>, ключом которых является символ, не будут включены.</p><h4 id="napi_get_all_property_names" tabindex="-1"><code>napi_get_all_property_names</code> <a class="header-anchor" href="#napi_get_all_property_names" aria-label="Permalink to “napi_get_all_property_names”">​</a></h4><p><strong>Добавлено в версии: v13.7.0, v12.17.0, v10.20.0</strong></p><p><strong>Версия N-API: 6</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_all_property_names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_collection_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_filter </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_key_conversion </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key_conversion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого извлекаются свойства.</li><li><code>[in] key_mode</code>: Следует ли также извлекать свойства прототипа.</li><li><code>[in] key_filter</code>: Какие свойства извлекать (перечислимые/читаемые/записываемые).</li><li><code>[in] key_conversion</code>: Следует ли преобразовывать пронумерованные ключи свойств в строки.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий массив значений JavaScript, которые представляют имена свойств объекта. <a href="/ru/nodejs/api/n-api#napi-get-array-length"><code>napi_get_array_length</code></a> и <a href="/ru/nodejs/api/n-api#napi-get-element"><code>napi_get_element</code></a> можно использовать для итерации по <code>result</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API возвращает массив, содержащий имена доступных свойств этого объекта.</p><h4 id="napi_set_property" tabindex="-1"><code>napi_set_property</code> <a class="header-anchor" href="#napi_set_property" aria-label="Permalink to “napi_set_property”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, для которого устанавливается свойство.</li><li><code>[in] key</code>: Имя устанавливаемого свойства.</li><li><code>[in] value</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API устанавливает свойство в переданном <code>Object</code>.</p><h4 id="napi_get_property" tabindex="-1"><code>napi_get_property</code> <a class="header-anchor" href="#napi_get_property" aria-label="Permalink to “napi_get_property”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого извлекается свойство.</li><li><code>[in] key</code>: Имя извлекаемого свойства.</li><li><code>[out] result</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API получает запрошенное свойство из переданного <code>Object</code>.</p><h4 id="napi_has_property" tabindex="-1"><code>napi_has_property</code> <a class="header-anchor" href="#napi_has_property" aria-label="Permalink to “napi_has_property”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] key</code>: Имя свойства, наличие которого необходимо проверить.</li><li><code>[out] result</code>: Указывает, существует ли свойство в объекте.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API проверяет, имеет ли переданный <code>Object</code> указанное свойство.</p><h4 id="napi_delete_property" tabindex="-1"><code>napi_delete_property</code> <a class="header-anchor" href="#napi_delete_property" aria-label="Permalink to “napi_delete_property”">​</a></h4><p><strong>Добавлено в: v8.2.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] key</code>: Имя удаляемого свойства.</li><li><code>[out] result</code>: Указывает, было ли удаление свойства успешным. <code>result</code> можно необязательно игнорировать, передав <code>NULL</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API пытается удалить собственное свойство <code>key</code> из <code>object</code>.</p><h4 id="napi_has_own_property" tabindex="-1"><code>napi_has_own_property</code> <a class="header-anchor" href="#napi_has_own_property" aria-label="Permalink to “napi_has_own_property”">​</a></h4><p><strong>Добавлено в версии: v8.2.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_own_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] key</code>: Имя собственного свойства, существование которого необходимо проверить.</li><li><code>[out] result</code>: Указывает, существует ли собственное свойство в объекте.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API проверяет, имеет ли переданный <code>Object</code> собственное свойство с указанным именем. <code>key</code> должен быть <code>string</code> или <code>symbol</code>, иначе будет выдана ошибка. Node-API не будет выполнять преобразование между типами данных.</p><h4 id="napi_set_named_property" tabindex="-1"><code>napi_set_named_property</code> <a class="header-anchor" href="#napi_set_named_property" aria-label="Permalink to “napi_set_named_property”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, для которого необходимо установить свойство.</li><li><code>[in] utf8Name</code>: Имя свойства, которое необходимо установить.</li><li><code>[in] value</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот метод эквивалентен вызову <a href="/ru/nodejs/api/n-api#napi-set-property"><code>napi_set_property</code></a> с <code>napi_value</code>, созданным из строки, переданной как <code>utf8Name</code>.</p><h4 id="napi_get_named_property" tabindex="-1"><code>napi_get_named_property</code> <a class="header-anchor" href="#napi_get_named_property" aria-label="Permalink to “napi_get_named_property”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого необходимо получить свойство.</li><li><code>[in] utf8Name</code>: Имя свойства, которое необходимо получить.</li><li><code>[out] result</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот метод эквивалентен вызову <a href="/ru/nodejs/api/n-api#napi-get-property"><code>napi_get_property</code></a> с <code>napi_value</code>, созданным из строки, переданной как <code>utf8Name</code>.</p><h4 id="napi_has_named_property" tabindex="-1"><code>napi_has_named_property</code> <a class="header-anchor" href="#napi_has_named_property" aria-label="Permalink to “napi_has_named_property”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] utf8Name</code>: Имя свойства, существование которого нужно проверить.</li><li><code>[out] result</code>: Существует ли свойство в объекте или нет.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот метод эквивалентен вызову <a href="/ru/nodejs/api/n-api#napi-has-property"><code>napi_has_property</code></a> с <code>napi_value</code>, созданным из строки, переданной как <code>utf8Name</code>.</p><h4 id="napi_set_element" tabindex="-1"><code>napi_set_element</code> <a class="header-anchor" href="#napi_set_element" aria-label="Permalink to “napi_set_element”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_set_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, для которого устанавливаются свойства.</li><li><code>[in] index</code>: Индекс устанавливаемого свойства.</li><li><code>[in] value</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API устанавливает элемент в переданном <code>Object</code>.</p><h4 id="napi_get_element" tabindex="-1"><code>napi_get_element</code> <a class="header-anchor" href="#napi_get_element" aria-label="Permalink to “napi_get_element”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого извлекается свойство.</li><li><code>[in] index</code>: Индекс получаемого свойства.</li><li><code>[out] result</code>: Значение свойства.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API получает элемент по запрошенному индексу.</p><h4 id="napi_has_element" tabindex="-1"><code>napi_has_element</code> <a class="header-anchor" href="#napi_has_element" aria-label="Permalink to “napi_has_element”">​</a></h4><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_has_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] index</code>: Индекс свойства, существование которого нужно проверить.</li><li><code>[out] result</code>: Существует ли свойство в объекте или нет.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API возвращает, имеет ли переданный <code>Object</code> элемент по запрошенному индексу.</p><h4 id="napi_delete_element" tabindex="-1"><code>napi_delete_element</code> <a class="header-anchor" href="#napi_delete_element" aria-label="Permalink to “napi_delete_element”">​</a></h4><p><strong>Добавлено в версии: v8.2.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается Node-API.</li><li><code>[in] object</code>: Объект для запроса.</li><li><code>[in] index</code>: Индекс свойства, которое нужно удалить.</li><li><code>[out] result</code>: Успешно ли удаление элемента. <code>result</code> может быть опционально проигнорирован путем передачи <code>NULL</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот API пытается удалить указанный <code>index</code> из <code>object</code>.</p><h4 id="napi_define_properties" tabindex="-1"><code>napi_define_properties</code> <a class="header-anchor" href="#napi_define_properties" aria-label="Permalink to “napi_define_properties”">​</a></h4><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_define_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> property_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_property_descriptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается Node-API.</li><li><code>[in] object</code>: Объект, из которого нужно получить свойства.</li><li><code>[in] property_count</code>: Количество элементов в массиве <code>properties</code>.</li><li><code>[in] properties</code>: Массив дескрипторов свойств.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот метод позволяет эффективно определить несколько свойств для заданного объекта. Свойства определяются с использованием дескрипторов свойств (см. <a href="/ru/nodejs/api/n-api#napi-property-descriptor"><code>napi_property_descriptor</code></a>). Имея массив таких дескрипторов свойств, этот API будет устанавливать свойства для объекта по одному, как определено в <code>DefineOwnProperty()</code> (описано в <a href="https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc" target="_blank" rel="noreferrer">Разделе 9.1.6</a> спецификации ECMA-262).</p><h4 id="napi_object_freeze" tabindex="-1"><code>napi_object_freeze</code> <a class="header-anchor" href="#napi_object_freeze" aria-label="Permalink to “napi_object_freeze”">​</a></h4><p><strong>Добавлено в версии: v14.14.0, v12.20.0</strong></p><p><strong>Версия N-API: 8</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_object_freeze</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается Node-API.</li><li><code>[in] object</code>: Объект для заморозки.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Этот метод замораживает заданный объект. Это предотвращает добавление новых свойств, удаление существующих свойств, изменение перечисляемости, конфигурируемости или возможности записи существующих свойств, а также изменение значений существующих свойств. Это также предотвращает изменение прототипа объекта. Это описано в <a href="https://tc39.es/ecma262/#sec-object.freeze" target="_blank" rel="noreferrer">Разделе 19.1.2.6</a> спецификации ECMA-262.</p><h4 id="napi_object_seal" tabindex="-1"><code>napi_object_seal</code> <a class="header-anchor" href="#napi_object_seal" aria-label="Permalink to “napi_object_seal”">​</a></h4><p><strong>Добавлено в: v14.14.0, v12.20.0</strong></p><p><strong>Версия N-API: 8</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_object_seal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается Node-API.</li><li><code>[in] object</code>: Объект для запечатывания.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнена успешно.</p><p>Этот метод запечатывает заданный объект. Это предотвращает добавление новых свойств, а также отмечает все существующие свойства как неконфигурируемые. Это описано в <a href="https://tc39.es/ecma262/#sec-object.seal" target="_blank" rel="noreferrer">Разделе 19.1.2.20</a> спецификации ECMA-262.</p><h2 id="working-with-javascript-functions" tabindex="-1">Работа с функциями JavaScript <a class="header-anchor" href="#working-with-javascript-functions" aria-label="Permalink to “Работа с функциями JavaScript”">​</a></h2><p>Node-API предоставляет набор API, которые позволяют коду JavaScript вызывать нативный код. Node-API, поддерживающие обратный вызов в нативный код, принимают функции обратного вызова, представленные типом <code>napi_callback</code>. Когда JavaScript VM выполняет обратный вызов в нативный код, вызывается предоставленная функция <code>napi_callback</code>. API, задокументированные в этом разделе, позволяют функции обратного вызова выполнять следующие действия:</p><ul><li>Получать информацию о контексте, в котором был вызван обратный вызов.</li><li>Получать аргументы, переданные в обратный вызов.</li><li>Возвращать <code>napi_value</code> из обратного вызова.</li></ul><p>Кроме того, Node-API предоставляет набор функций, которые позволяют вызывать функции JavaScript из нативного кода. Можно либо вызвать функцию как обычный вызов функции JavaScript, либо как функцию-конструктор.</p><p>Любые данные, отличные от <code>NULL</code>, которые передаются в этот API через поле <code>data</code> элементов <code>napi_property_descriptor</code>, могут быть связаны с <code>object</code> и освобождены, когда <code>object</code> будет собран сборщиком мусора, передав и <code>object</code>, и данные в <a href="/ru/nodejs/api/n-api#napi-add-finalizer"><code>napi_add_finalizer</code></a>.</p><h3 id="napi_call_function" tabindex="-1"><code>napi_call_function</code> <a class="header-anchor" href="#napi_call_function" aria-label="Permalink to “napi_call_function”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_call_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] recv</code>: Значение <code>this</code>, передаваемое вызываемой функции.</li><li><code>[in] func</code>: <code>napi_value</code>, представляющее функцию JavaScript, которую нужно вызвать.</li><li><code>[in] argc</code>: Количество элементов в массиве <code>argv</code>.</li><li><code>[in] argv</code>: Массив <code>napi_values</code>, представляющий значения JavaScript, переданные в качестве аргументов функции.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющее возвращенный объект JavaScript.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнена успешно.</p><p>Этот метод позволяет вызывать объект функции JavaScript из нативного аддона. Это основной механизм обратного вызова <em>из</em> нативного кода аддона <em>в</em> JavaScript. Для особого случая вызова в JavaScript после асинхронной операции см. <a href="/ru/nodejs/api/n-api#napi-make-callback"><code>napi_make_callback</code></a>.</p><p>Пример использования может выглядеть следующим образом. Рассмотрим следующий фрагмент кода JavaScript:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AddTwo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global.AddTwo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AddTwo;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Затем, приведенная выше функция может быть вызвана из нативного аддона с помощью следующего кода:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Получить функцию с именем &quot;AddTwo&quot; в глобальном объекте</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value global, add_two, arg;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AddTwo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">add_two</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arg = 1337</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1337</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// AddTwo(arg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value return_val;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_call_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, add_two, argc, argv, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">return_val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Преобразовать результат обратно в нативный тип</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_value_int32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, return_val, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="napi_create_function" tabindex="-1"><code>napi_create_function</code> <a class="header-anchor" href="#napi_create_function" aria-label="Permalink to “napi_create_function”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] utf8Name</code>: Необязательное имя функции, закодированное как UTF8. Оно видно в JavaScript как свойство <code>name</code> нового объекта-функции.</li><li><code>[in] length</code>: Длина <code>utf8name</code> в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулем.</li><li><code>[in] cb</code>: Нативная функция, которая должна быть вызвана при вызове этого объекта-функции. <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a> предоставляет больше деталей.</li><li><code>[in] data</code>: Предоставленный пользователем контекст данных. Он будет передан обратно в функцию при последующем вызове.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий JavaScript объект-функцию для вновь созданной функции.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API позволяет автору аддона создавать объект-функцию в нативном коде. Это основной механизм, позволяющий вызывать нативный код аддона <em>из</em> JavaScript.</p><p>Вновь созданная функция автоматически не видна из скрипта после этого вызова. Вместо этого свойство должно быть явно установлено на любом объекте, видимом для JavaScript, чтобы функция была доступна из скрипта.</p><p>Чтобы предоставить функцию как часть экспорта модуля аддона, установите вновь созданную функцию в объект exports. Пример модуля может выглядеть следующим образом:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value fn;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SayHello, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fn);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_set_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, exports, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sayHello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, fn);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> exports;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAPI_MODULE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NODE_GYP_MODULE_NAME, Init)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Учитывая приведенный выше код, аддон можно использовать из JavaScript следующим образом:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myaddon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./addon&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myaddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Строка, переданная в <code>require()</code>, является именем цели в <code>binding.gyp</code>, отвечающей за создание файла <code>.node</code>.</p><p>Любые не <code>NULL</code> данные, которые передаются в этот API через параметр <code>data</code>, могут быть связаны с результирующей JavaScript функцией (которая возвращается в параметре <code>result</code>) и освобождены всякий раз, когда функция собирается сборщиком мусора, путем передачи JavaScript функции и данных в <a href="/ru/nodejs/api/n-api#napi-add-finalizer"><code>napi_add_finalizer</code></a>.</p><p>JavaScript <code>Function</code> описаны в <a href="https://tc39.github.io/ecma262/#sec-function-objects" target="_blank" rel="noreferrer">Разделе 19.2</a> Спецификации языка ECMAScript.</p><h3 id="napi_get_cb_info" tabindex="-1"><code>napi_get_cb_info</code> <a class="header-anchor" href="#napi_get_cb_info" aria-label="Permalink to “napi_get_cb_info”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cbinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             size_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> thisArg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] cbinfo</code>: Информация обратного вызова, переданная в функцию обратного вызова.</li><li><code>[in-out] argc</code>: Указывает длину предоставленного массива <code>argv</code> и получает фактическое количество аргументов. <code>argc</code> можно необязательно игнорировать, передав <code>NULL</code>.</li><li><code>[out] argv</code>: C массив <code>napi_value</code>, в который будут скопированы аргументы. Если аргументов больше, чем предоставленное количество, копируется только запрошенное количество аргументов. Если предоставлено меньше аргументов, чем заявлено, остаток <code>argv</code> заполняется значениями <code>napi_value</code>, представляющими <code>undefined</code>. <code>argv</code> можно необязательно игнорировать, передав <code>NULL</code>.</li><li><code>[out] thisArg</code>: Получает аргумент JavaScript <code>this</code> для вызова. <code>thisArg</code> можно необязательно игнорировать, передав <code>NULL</code>.</li><li><code>[out] data</code>: Получает указатель на данные для обратного вызова. <code>data</code> можно необязательно игнорировать, передав <code>NULL</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнился.</p><p>Этот метод используется внутри функции обратного вызова для получения подробной информации о вызове, такой как аргументы и указатель <code>this</code>, из данной информации обратного вызова.</p><h3 id="napi_get_new_target" tabindex="-1"><code>napi_get_new_target</code> <a class="header-anchor" href="#napi_get_new_target" aria-label="Permalink to “napi_get_new_target”">​</a></h3><p><strong>Добавлено в: v8.6.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_new_target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cbinfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] cbinfo</code>: Информация обратного вызова, переданная в функцию обратного вызова.</li><li><code>[out] result</code>: <code>new.target</code> вызова конструктора.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнился.</p><p>Этот API возвращает <code>new.target</code> вызова конструктора. Если текущий обратный вызов не является вызовом конструктора, результатом будет <code>NULL</code>.</p><h3 id="napi_new_instance" tabindex="-1"><code>napi_new_instance</code> <a class="header-anchor" href="#napi_new_instance" aria-label="Permalink to “napi_new_instance”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_new_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] cons</code>: <code>napi_value</code>, представляющий функцию JavaScript, вызываемую как конструктор.</li><li><code>[in] argc</code>: Количество элементов в массиве <code>argv</code>.</li><li><code>[in] argv</code>: Массив значений JavaScript как <code>napi_value</code>, представляющий аргументы конструктора. Если <code>argc</code> равно нулю, этот параметр можно опустить, передав <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий возвращаемый объект JavaScript, который в данном случае является созданным объектом.</li></ul><p>Этот метод используется для создания нового значения JavaScript с использованием заданного <code>napi_value</code>, представляющего конструктор объекта. Например, рассмотрим следующий фрагмент:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.param </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> param;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> arg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyObject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Следующее может быть аппроксимировано в Node-API с использованием следующего фрагмента:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Получить функцию-конструктор MyObject</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value global, constructor, arg, value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_named_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, global, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyObject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const arg = &quot;hello&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_string_utf8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NAPI_AUTO_LENGTH, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">arg;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const value = new MyObject(arg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_new_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, constructor, argc, argv, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Возвращает <code>napi_ok</code>, если API успешно завершился.</p><h2 id="object-wrap" tabindex="-1">Обертка объекта <a class="header-anchor" href="#object-wrap" aria-label="Permalink to “Обертка объекта”">​</a></h2><p>Node-API предлагает способ &quot;обернуть&quot; классы и экземпляры C++, чтобы конструктор и методы класса можно было вызывать из JavaScript.</p><p>Для обернутых объектов может быть трудно отличить функцию, вызванную в прототипе класса, от функции, вызванной в экземпляре класса. Распространенным шаблоном, используемым для решения этой проблемы, является сохранение постоянной ссылки на конструктор класса для последующих проверок <code>instanceof</code>.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value MyClass_constructor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_reference_value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, MyClass::es_constructor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">MyClass_constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, es_this, MyClass_constructor, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_ok </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (is_instance) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // napi_unwrap() ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // иначе...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Ссылка должна быть освобождена, когда она больше не нужна.</p><p>Бывают случаи, когда <code>napi_instanceof()</code> недостаточно для обеспечения того, что объект JavaScript является оберткой для определенного собственного типа. Это особенно актуально, когда обернутые объекты JavaScript передаются обратно в аддон через статические методы, а не как значение <code>this</code> методов прототипа. В таких случаях есть вероятность, что они могут быть неправильно развернуты.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myAddon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./build/Release/my_addon.node&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`openDatabase()\` возвращает объект JavaScript, который оборачивает нативный дескриптор базы данных.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dbHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`query()\` возвращает объект JavaScript, который оборачивает нативный дескриптор запроса.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> queryHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dbHandle, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Gimme ALL the things!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// В строке ниже есть случайная ошибка. Первым параметром для</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// \`myAddon.queryHasRecords()\` должен быть дескриптор базы данных (\`dbHandle\`), а не</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// дескриптор запроса (\`query\`), поэтому правильное условие для цикла while</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// должно быть</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// myAddon.queryHasRecords(dbHandle, queryHandle)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (myAddon.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryHasRecords</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(queryHandle, dbHandle)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // получить записи</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>В приведенном выше примере <code>myAddon.queryHasRecords()</code> - это метод, который принимает два аргумента. Первый - это дескриптор базы данных, а второй - дескриптор запроса. Внутри он разворачивает первый аргумент и приводит полученный указатель к нативному дескриптору базы данных. Затем он разворачивает второй аргумент и приводит полученный указатель к дескриптору запроса. Если аргументы переданы в неправильном порядке, приведение типов сработает, однако существует большая вероятность того, что основная операция базы данных завершится с ошибкой или даже вызовет недопустимый доступ к памяти.</p><p>Чтобы гарантировать, что указатель, полученный из первого аргумента, действительно является указателем на дескриптор базы данных, и, аналогично, чтобы указатель, полученный из второго аргумента, действительно является указателем на дескриптор запроса, реализация <code>queryHasRecords()</code> должна выполнить проверку типа. Сохранение конструктора класса JavaScript, из которого был создан дескриптор базы данных, и конструктора, из которого был создан дескриптор запроса, в <code>napi_ref</code>s может помочь, поскольку <code>napi_instanceof()</code> можно использовать для проверки того, что экземпляры, переданные в <code>queryHashRecords()</code>, действительно имеют правильный тип.</p><p>К сожалению, <code>napi_instanceof()</code> не защищает от манипулирования прототипом. Например, прототип экземпляра дескриптора базы данных можно установить в прототип конструктора для экземпляров дескриптора запроса. В этом случае экземпляр дескриптора базы данных может отображаться как экземпляр дескриптора запроса и пройдет тест <code>napi_instanceof()</code> для экземпляра дескриптора запроса, все еще содержа указатель на дескриптор базы данных.</p><p>С этой целью Node-API предоставляет возможности пометки типа.</p><p>Тег типа - это 128-битное целое число, уникальное для аддона. Node-API предоставляет структуру <code>napi_type_tag</code> для хранения тега типа. Когда такое значение передается вместе с объектом JavaScript или <a href="/ru/nodejs/api/n-api#napi-create-external">внешним</a> объектом, хранящимся в <code>napi_value</code>, в <code>napi_type_tag_object()</code>, объект JavaScript будет &quot;помечен&quot; тегом типа. &quot;Метка&quot; невидима на стороне JavaScript. Когда объект JavaScript поступает в нативную привязку, <code>napi_check_object_type_tag()</code> можно использовать вместе с исходным тегом типа, чтобы определить, был ли объект JavaScript ранее &quot;помечен&quot; тегом типа. Это создает возможность проверки типа с большей точностью, чем может обеспечить <code>napi_instanceof()</code>, поскольку такая пометка типа переживает манипуляции с прототипом и выгрузку/перезагрузку аддона.</p><p>Продолжая приведенный выше пример, следующая скелетная реализация аддона иллюстрирует использование <code>napi_type_tag_object()</code> и <code>napi_check_object_type_tag()</code>.</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Это значение является тегом типа для дескриптора базы данных. Команда</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   uuidgen | sed -r -e &#39;s/-//g&#39; -e &#39;s/(.{16})(.*)/0x\\1, 0x\\2/&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// можно использовать для получения двух значений, с помощью которых можно инициализировать структуру.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag DatabaseHandleTypeTag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1edf75a38336451d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a5ed9ce2e4c00c38</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Это значение является тегом типа для дескриптора запроса.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag QueryHandleTypeTag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9c73317f9fad44a3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">93c3920bf3b0ad6a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value result;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Выполнить основное действие, которое приводит к дескриптору базы данных.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  DatabaseHandle</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dbHandle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> open_database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Создать новый, пустой объект JS.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Пометить объект, чтобы указать, что он содержит указатель на \`DatabaseHandle\`.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_type_tag_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DatabaseHandleTypeTag);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Сохранить указатель на структуру \`DatabaseHandle\` внутри объекта JS.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, result, dbHandle, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Позже, когда мы получим объект JavaScript, претендующий на роль дескриптора базы данных,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// мы можем использовать \`napi_check_object_type_tag()\`, чтобы убедиться, что это действительно</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// дескриптор.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_callback_info </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_status status;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> argc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_db_handle;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_cb_info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, info, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">argc, argv, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Проверить, что объект, переданный в качестве первого параметра, имеет ранее</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // примененный тег.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_check_object_type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                                      argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DatabaseHandleTypeTag,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                      &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_db_handle);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Выдать \`TypeError\`, если это не так.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is_db_handle) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Выдать TypeError.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h3 id="napi_define_class" tabindex="-1"><code>napi_define_class</code> <a class="header-anchor" href="#napi_define_class" aria-label="Permalink to “napi_define_class”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_define_class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> utf8name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> property_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_property_descriptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] utf8name</code>: Имя функции конструктора JavaScript. Для ясности рекомендуется использовать имя класса C++ при обертке класса C++.</li><li><code>[in] length</code>: Длина <code>utf8name</code> в байтах или <code>NAPI_AUTO_LENGTH</code>, если строка завершается нулевым символом.</li><li><code>[in] constructor</code>: Функция обратного вызова, которая обрабатывает создание экземпляров класса. При обертке класса C++ этот метод должен быть статическим членом с сигнатурой <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a>. Конструктор класса C++ не может быть использован. <a href="/ru/nodejs/api/n-api#napi-callback"><code>napi_callback</code></a> предоставляет более подробную информацию.</li><li><code>[in] data</code>: Необязательные данные, передаваемые в функцию обратного вызова конструктора в качестве свойства <code>data</code> информации обратного вызова.</li><li><code>[in] property_count</code>: Количество элементов в аргументе массива <code>properties</code>.</li><li><code>[in] properties</code>: Массив дескрипторов свойств, описывающих статические свойства данных и свойства экземпляра, аксессоры и методы класса. См. <code>napi_property_descriptor</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий функцию конструктора для класса.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Определяет класс JavaScript, включая:</p><ul><li>Функция конструктора JavaScript, имеющая имя класса. При обертке соответствующего класса C++ обратный вызов, переданный через <code>constructor</code>, может быть использован для создания нового экземпляра класса C++, который затем можно поместить внутрь создаваемого экземпляра объекта JavaScript с помощью <a href="/ru/nodejs/api/n-api#napi-wrap"><code>napi_wrap</code></a>.</li><li>Свойства функции конструктора, реализация которых может вызывать соответствующие <em>статические</em> свойства данных, аксессоры и методы класса C++ (определенные дескрипторами свойств с атрибутом <code>napi_static</code>).</li><li>Свойства объекта <code>prototype</code> функции конструктора. При обертке класса C++ <em>нестатические</em> свойства данных, аксессоры и методы класса C++ могут быть вызваны из статических функций, заданных в дескрипторах свойств без атрибута <code>napi_static</code>, после извлечения экземпляра класса C++, помещенного внутрь экземпляра объекта JavaScript с помощью <a href="/ru/nodejs/api/n-api#napi-unwrap"><code>napi_unwrap</code></a>.</li></ul><p>При обертке класса C++ обратный вызов конструктора C++, переданный через <code>constructor</code>, должен быть статическим методом класса, который вызывает фактический конструктор класса, затем оборачивает новый экземпляр C++ в объект JavaScript и возвращает объект-обертку. См. <a href="/ru/nodejs/api/n-api#napi-wrap"><code>napi_wrap</code></a> для получения подробной информации.</p><p>Функция конструктора JavaScript, возвращаемая из <a href="/ru/nodejs/api/n-api#napi-define-class"><code>napi_define_class</code></a>, часто сохраняется и используется позже для создания новых экземпляров класса из машинного кода и/или для проверки, являются ли предоставленные значения экземплярами класса. В этом случае, чтобы предотвратить сборку значения функции мусором, можно создать строгую постоянную ссылку на нее с помощью <a href="/ru/nodejs/api/n-api#napi-create-reference"><code>napi_create_reference</code></a>, гарантируя, что счетчик ссылок будет поддерживаться &gt;= 1.</p><p>Любые данные, отличные от <code>NULL</code>, которые передаются в этот API через параметр <code>data</code> или через поле <code>data</code> элементов массива <code>napi_property_descriptor</code>, могут быть связаны с результирующим конструктором JavaScript (который возвращается в параметре <code>result</code>) и освобождены всякий раз, когда класс собирается мусором, путем передачи как функции JavaScript, так и данных в <a href="/ru/nodejs/api/n-api#napi-add-finalizer"><code>napi_add_finalizer</code></a>.</p><h3 id="napi_wrap" tabindex="-1"><code>napi_wrap</code> <a class="header-anchor" href="#napi_wrap" aria-label="Permalink to “napi_wrap”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> native_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                      void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                      napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] js_object</code>: JavaScript объект, который будет оберткой для native объекта.</li><li><code>[in] native_object</code>: Native экземпляр, который будет обернут в JavaScript объект.</li><li><code>[in] finalize_cb</code>: Необязательный native callback, который может быть использован для освобождения native экземпляра, когда JavaScript объект был собран сборщиком мусора. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет больше деталей.</li><li><code>[in] finalize_hint</code>: Необязательная контекстная подсказка, которая передается в finalize callback.</li><li><code>[out] result</code>: Необязательная ссылка на обернутый объект.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Оборачивает native экземпляр в JavaScript объект. Native экземпляр может быть извлечен позже с помощью <code>napi_unwrap()</code>.</p><p>Когда JavaScript код вызывает конструктор для класса, который был определен с помощью <code>napi_define_class()</code>, вызывается <code>napi_callback</code> для конструктора. После создания экземпляра native класса, callback должен затем вызвать <code>napi_wrap()</code>, чтобы обернуть вновь созданный экземпляр в уже созданный JavaScript объект, который является аргументом <code>this</code> для callback конструктора. (Этот объект <code>this</code> был создан из <code>prototype</code> функции конструктора, поэтому он уже имеет определения всех свойств и методов экземпляра.)</p><p>Обычно при оборачивании экземпляра класса следует предоставить finalize callback, который просто удаляет native экземпляр, который получен в качестве аргумента <code>data</code> в finalize callback.</p><p>Необязательная возвращаемая ссылка изначально является слабой ссылкой, что означает, что она имеет счетчик ссылок равный 0. Обычно этот счетчик ссылок временно увеличивается во время асинхронных операций, которые требуют, чтобы экземпляр оставался валидным.</p><p><em>Внимание</em>: Необязательная возвращаемая ссылка (если она получена) должна быть удалена с помощью <a href="/ru/nodejs/api/n-api#napi-delete-reference"><code>napi_delete_reference</code></a> ТОЛЬКО в ответ на вызов finalize callback. Если она будет удалена до этого, то finalize callback может никогда не быть вызван. Поэтому, при получении ссылки также требуется finalize callback, чтобы обеспечить правильное удаление ссылки.</p><p>Finalizer callback могут быть отложены, оставляя окно, где объект был собран сборщиком мусора (и слабая ссылка недействительна), но finalizer еще не был вызван. При использовании <code>napi_get_reference_value()</code> на слабых ссылках, возвращенных <code>napi_wrap()</code>, вы все равно должны обрабатывать пустой результат.</p><p>Повторный вызов <code>napi_wrap()</code> для объекта вернет ошибку. Чтобы связать другой native экземпляр с объектом, сначала используйте <code>napi_remove_wrap()</code>.</p><h3 id="napi_unwrap" tabindex="-1"><code>napi_unwrap</code> <a class="header-anchor" href="#napi_unwrap" aria-label="Permalink to “napi_unwrap”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_unwrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] js_object</code>: Объект, связанный с нативным экземпляром.</li><li><code>[out] result</code>: Указатель на обернутый нативный экземпляр.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Извлекает нативный экземпляр, который был ранее обернут в JavaScript-объект с помощью <code>napi_wrap()</code>.</p><p>Когда код JavaScript вызывает метод или аксессор свойства класса, вызывается соответствующий <code>napi_callback</code>. Если обратный вызов предназначен для метода экземпляра или аксессора, тогда аргументом <code>this</code> для обратного вызова является объект-обертка; обернутый экземпляр C++, который является целью вызова, может быть получен путем вызова <code>napi_unwrap()</code> для объекта-обертки.</p><h3 id="napi_remove_wrap" tabindex="-1"><code>napi_remove_wrap</code> <a class="header-anchor" href="#napi_remove_wrap" aria-label="Permalink to “napi_remove_wrap”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_remove_wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] js_object</code>: Объект, связанный с нативным экземпляром.</li><li><code>[out] result</code>: Указатель на обернутый нативный экземпляр.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Извлекает нативный экземпляр, который был ранее обернут в JavaScript-объект <code>js_object</code> с помощью <code>napi_wrap()</code>, и удаляет обертку. Если с оберткой был связан обратный вызов финализации, он больше не будет вызываться, когда JavaScript-объект станет мусором.</p><h3 id="napi_type_tag_object" tabindex="-1"><code>napi_type_tag_object</code> <a class="header-anchor" href="#napi_type_tag_object" aria-label="Permalink to “napi_type_tag_object”">​</a></h3><p><strong>Добавлено в: v14.8.0, v12.19.0</strong></p><p><strong>Версия N-API: 8</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_type_tag_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                 const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] js_object</code>: JavaScript-объект или <a href="/ru/nodejs/api/n-api#napi-create-external">external</a>, который нужно пометить.</li><li><code>[in] type_tag</code>: Тег, которым нужно пометить объект.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Связывает значение указателя <code>type_tag</code> с JavaScript-объектом или <a href="/ru/nodejs/api/n-api#napi-create-external">external</a>. Затем можно использовать <code>napi_check_object_type_tag()</code> для сравнения тега, прикрепленного к объекту, с тегом, принадлежащим аддону, чтобы убедиться, что объект имеет правильный тип.</p><p>Если объект уже имеет связанный тег типа, этот API вернет <code>napi_invalid_arg</code>.</p><h3 id="napi_check_object_type_tag" tabindex="-1"><code>napi_check_object_type_tag</code> <a class="header-anchor" href="#napi_check_object_type_tag" aria-label="Permalink to “napi_check_object_type_tag”">​</a></h3><p><strong>Добавлено в: v14.8.0, v12.19.0</strong></p><p><strong>Версия N-API: 8</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_check_object_type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_type_tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> type_tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] js_object</code>: JavaScript объект или <a href="/ru/nodejs/api/n-api#napi-create-external">внешний</a> (external), чей тег типа необходимо проверить.</li><li><code>[in] type_tag</code>: Тег, с которым нужно сравнить любой тег, найденный в объекте.</li><li><code>[out] result</code>: Указывает, соответствует ли заданный тег типа тегу типа объекта. Возвращает <code>false</code>, если тег типа не был найден в объекте.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнено успешно.</p><p>Сравнивает указатель, заданный как <code>type_tag</code>, с любым указателем, который можно найти в <code>js_object</code>. Если в <code>js_object</code> не найден тег или, если тег найден, но он не соответствует <code>type_tag</code>, тогда <code>result</code> устанавливается в <code>false</code>. Если тег найден и он соответствует <code>type_tag</code>, тогда <code>result</code> устанавливается в <code>true</code>.</p><h3 id="napi_add_finalizer" tabindex="-1"><code>napi_add_finalizer</code> <a class="header-anchor" href="#napi_add_finalizer" aria-label="Permalink to “napi_add_finalizer”">​</a></h3><p><strong>Добавлено в: v8.0.0</strong></p><p><strong>Версия N-API: 5</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_add_finalizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">js_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               node_api_basic_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                               void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] js_object</code>: JavaScript объект, к которому будут прикреплены собственные данные.</li><li><code>[in] finalize_data</code>: Необязательные данные, которые будут переданы в <code>finalize_cb</code>.</li><li><code>[in] finalize_cb</code>: Собственная функция обратного вызова, которая будет использоваться для освобождения собственных данных, когда JavaScript объект будет собран сборщиком мусора. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию.</li><li><code>[in] finalize_hint</code>: Необязательная контекстная подсказка, которая передается в функцию обратного вызова финализатора.</li><li><code>[out] result</code>: Необязательная ссылка на JavaScript объект.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнено успешно.</p><p>Добавляет функцию обратного вызова <code>napi_finalize</code>, которая будет вызвана, когда JavaScript объект в <code>js_object</code> будет собран сборщиком мусора.</p><p>Этот API можно вызывать несколько раз для одного JavaScript объекта.</p><p><em>Внимание</em>: Необязательная возвращаемая ссылка (если получена) должна быть удалена с помощью <a href="/ru/nodejs/api/n-api#napi-delete-reference"><code>napi_delete_reference</code></a> ТОЛЬКО в ответ на вызов функции обратного вызова финализатора. Если она будет удалена раньше, функция обратного вызова финализатора может никогда не быть вызвана. Поэтому, при получении ссылки также требуется функция обратного вызова финализатора, чтобы обеспечить правильное удаление ссылки.</p><h4 id="node_api_post_finalizer" tabindex="-1"><code>node_api_post_finalizer</code> <a class="header-anchor" href="#node_api_post_finalizer" aria-label="Permalink to “node_api_post_finalizer”">​</a></h4><p><strong>Добавлено в: v21.0.0, v20.10.0, v18.19.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> - Экспериментальная функция</p></div><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_post_finalizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                    napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                    void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> finalize_hint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Окружение, в котором вызывается API.</li><li><code>[in] finalize_cb</code>: Нативная функция обратного вызова, которая будет использоваться для освобождения нативных данных, когда объект JavaScript будет собран сборщиком мусора. <a href="/ru/nodejs/api/n-api#napi-finalize"><code>napi_finalize</code></a> предоставляет более подробную информацию.</li><li><code>[in] finalize_data</code>: Необязательные данные для передачи в <code>finalize_cb</code>.</li><li><code>[in] finalize_hint</code>: Необязательная контекстная подсказка, которая передается в функцию обратного вызова финализатора.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнено.</p><p>Планирует асинхронный вызов <code>napi_finalize</code> в цикле событий.</p><p>Обычно финализаторы вызываются во время сборки объектов GC (сборщиком мусора). В этот момент вызов любого Node-API, который может вызвать изменения в состоянии GC, будет отключен и приведет к сбою Node.js.</p><p><code>node_api_post_finalizer</code> помогает обойти это ограничение, позволяя надстройке отложить вызовы таких Node-API на момент времени, когда финализация GC уже не выполняется.</p><h2 id="simple-asynchronous-operations" tabindex="-1">Простые асинхронные операции <a class="header-anchor" href="#simple-asynchronous-operations" aria-label="Permalink to “Простые асинхронные операции”">​</a></h2><p>Модулям расширений часто необходимо использовать асинхронные вспомогательные функции из libuv как часть своей реализации. Это позволяет им планировать выполнение работы в асинхронном режиме, чтобы их методы могли возвращаться до завершения работы. Это позволяет им избежать блокировки общего выполнения приложения Node.js.</p><p>Node-API предоставляет ABI-стабильный интерфейс для этих вспомогательных функций, который охватывает наиболее распространенные случаи асинхронного использования.</p><p>Node-API определяет структуру <code>napi_async_work</code>, которая используется для управления асинхронными работниками. Экземпляры создаются/удаляются с помощью <a href="/ru/nodejs/api/n-api#napi-create-async-work"><code>napi_create_async_work</code></a> и <a href="/ru/nodejs/api/n-api#napi-delete-async-work"><code>napi_delete_async_work</code></a>.</p><p>Функции обратного вызова <code>execute</code> и <code>complete</code> — это функции, которые будут вызваны, когда исполнитель будет готов к выполнению, и когда он завершит свою задачу соответственно.</p><p>Функция <code>execute</code> должна избегать выполнения каких-либо вызовов Node-API, которые могут привести к выполнению JavaScript или взаимодействию с объектами JavaScript. Чаще всего любой код, которому необходимо выполнять вызовы Node-API, следует помещать в функцию обратного вызова <code>complete</code>. Избегайте использования параметра <code>napi_env</code> в функции обратного вызова execute, так как это, скорее всего, приведет к выполнению JavaScript.</p><p>Эти функции реализуют следующие интерфейсы:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_execute_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                            void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_async_complete_callback)(napi_env env,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                             napi_status status,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                             void*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>При вызове этих методов параметр <code>data</code> будет предоставленными надстройкой данными <code>void*</code>, которые были переданы в вызов <code>napi_create_async_work</code>.</p><p>После создания асинхронный работник может быть поставлен в очередь на выполнение с помощью функции <a href="/ru/nodejs/api/n-api#napi-queue-async-work"><code>napi_queue_async_work</code></a>:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_queue_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="/ru/nodejs/api/n-api#napi-cancel-async-work"><code>napi_cancel_async_work</code></a> можно использовать, если необходимо отменить работу до начала ее выполнения.</p><p>После вызова <a href="/ru/nodejs/api/n-api#napi-cancel-async-work"><code>napi_cancel_async_work</code></a> функция обратного вызова <code>complete</code> будет вызвана со значением статуса <code>napi_cancelled</code>. Работу не следует удалять до вызова функции обратного вызова <code>complete</code>, даже если она была отменена.</p><h3 id="napi_create_async_work" tabindex="-1"><code>napi_create_async_work</code> <a class="header-anchor" href="#napi_create_async_work" aria-label="Permalink to “napi_create_async_work”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v8.6.0</td><td>Добавлены параметры <code>async_resource</code> и <code>async_resource_name</code>.</td></tr><tr><td>v8.0.0</td><td>Добавлено в: v8.0.0</td></tr></tbody></table></div><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_execute_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_complete_callback </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">complete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                   void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] async_resource</code>: Необязательный объект, связанный с асинхронной работой, который будет передан в возможные <code>async_hooks</code> <a href="/ru/nodejs/api/async_hooks#initasyncid-type-triggerasyncid-resource"><code>init</code> хуки</a>.</li><li><code>[in] async_resource_name</code>: Идентификатор типа ресурса, предоставляемый для диагностической информации, предоставляемой API <code>async_hooks</code>.</li><li><code>[in] execute</code>: Нативная функция, которая должна быть вызвана для асинхронного выполнения логики. Данная функция вызывается из потока пула рабочих потоков и может выполняться параллельно с потоком основного цикла событий.</li><li><code>[in] complete</code>: Нативная функция, которая будет вызвана при завершении или отмене асинхронной логики. Данная функция вызывается из потока основного цикла событий. <a href="/ru/nodejs/api/n-api#napi-async-complete-callback"><code>napi_async_complete_callback</code></a> предоставляет более подробную информацию.</li><li><code>[in] data</code>: Предоставляемый пользователем контекст данных. Он будет передан обратно в функции execute и complete.</li><li><code>[out] result</code>: <code>napi_async_work*</code>, который является дескриптором для вновь созданной асинхронной работы.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API выделяет объект работы, который используется для асинхронного выполнения логики. Он должен быть освобожден с помощью <a href="/ru/nodejs/api/n-api#napi-delete-async-work"><code>napi_delete_async_work</code></a>, как только работа больше не требуется.</p><p><code>async_resource_name</code> должна быть строкой, завершающейся нулем, в кодировке UTF-8.</p><p>Идентификатор <code>async_resource_name</code> предоставляется пользователем и должен отражать тип выполняемой асинхронной работы. Также рекомендуется применять пространства имен к идентификатору, например, путем включения имени модуля. См. <a href="/ru/nodejs/api/async_hooks#type"><code>документацию async_hooks</code></a> для получения дополнительной информации.</p><h3 id="napi_delete_async_work" tabindex="-1"><code>napi_delete_async_work</code> <a class="header-anchor" href="#napi_delete_async_work" aria-label="Permalink to “napi_delete_async_work”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_delete_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] work</code>: Дескриптор, возвращенный вызовом <code>napi_create_async_work</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API освобождает ранее выделенный рабочий объект.</p><p>Этот API можно вызвать, даже если есть ожидающее исключение JavaScript.</p><h3 id="napi_queue_async_work" tabindex="-1"><code>napi_queue_async_work</code> <a class="header-anchor" href="#napi_queue_async_work" aria-label="Permalink to “napi_queue_async_work”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_queue_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] work</code>: Дескриптор, возвращенный вызовом <code>napi_create_async_work</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API запрашивает, чтобы ранее выделенная работа была запланирована для выполнения. После успешного возврата этого API, его нельзя вызывать снова с тем же элементом <code>napi_async_work</code>, иначе результат будет неопределенным.</p><h3 id="napi_cancel_async_work" tabindex="-1"><code>napi_cancel_async_work</code> <a class="header-anchor" href="#napi_cancel_async_work" aria-label="Permalink to “napi_cancel_async_work”">​</a></h3><p><strong>Добавлено в версии: v8.0.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_cancel_async_work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   napi_async_work </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">work</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] work</code>: Дескриптор, возвращенный вызовом <code>napi_create_async_work</code>.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнен успешно.</p><p>Этот API отменяет поставленную в очередь работу, если она еще не была начата. Если она уже начала выполняться, ее нельзя отменить, и будет возвращено <code>napi_generic_failure</code>. В случае успеха будет вызван обратный вызов <code>complete</code> со значением статуса <code>napi_cancelled</code>. Работу не следует удалять до вызова обратного вызова <code>complete</code>, даже если она была успешно отменена.</p><p>Этот API можно вызвать, даже если есть ожидающее исключение JavaScript.</p><h2 id="custom-asynchronous-operations" tabindex="-1">Пользовательские асинхронные операции <a class="header-anchor" href="#custom-asynchronous-operations" aria-label="Permalink to “Пользовательские асинхронные операции”">​</a></h2><p>Простые API асинхронной работы, описанные выше, могут не подходить для каждого сценария. При использовании любого другого асинхронного механизма необходимы следующие API, чтобы гарантировать правильное отслеживание асинхронной операции средой выполнения.</p><h3 id="napi_async_init" tabindex="-1"><code>napi_async_init</code> <a class="header-anchor" href="#napi_async_init" aria-label="Permalink to “napi_async_init”">​</a></h3><p><strong>Добавлено в: v8.6.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_async_init</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_async_context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] async_resource</code>: Объект, связанный с асинхронной работой, который будет передан в возможные хуки <code>init</code> <code>async_hooks</code> <a href="/ru/nodejs/api/async_hooks#initasyncid-type-triggerasyncid-resource"><code>init</code> hooks</a> и может быть доступен через <a href="/ru/nodejs/api/async_hooks#async-hooksexecutionasyncresource"><code>async_hooks.executionAsyncResource()</code></a>.</li><li><code>[in] async_resource_name</code>: Идентификатор для типа ресурса, который предоставляется для диагностической информации, предоставляемой API <code>async_hooks</code>.</li><li><code>[out] result</code>: Инициализированный асинхронный контекст.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Объект <code>async_resource</code> необходимо поддерживать в активном состоянии до <a href="/ru/nodejs/api/n-api#napi-async-destroy"><code>napi_async_destroy</code></a>, чтобы API, связанные с <code>async_hooks</code>, работали правильно. Чтобы сохранить совместимость ABI с предыдущими версиями, <code>napi_async_context</code> не поддерживают строгую ссылку на объекты <code>async_resource</code>, чтобы избежать утечек памяти. Однако, если <code>async_resource</code> собирается сборщиком мусора JavaScript engine до того, как <code>napi_async_context</code> будет уничтожен <code>napi_async_destroy</code>, вызов API, связанных с <code>napi_async_context</code>, таких как <a href="/ru/nodejs/api/n-api#napi-open-callback-scope"><code>napi_open_callback_scope</code></a> и <a href="/ru/nodejs/api/n-api#napi-make-callback"><code>napi_make_callback</code></a>, может вызвать проблемы, такие как потеря асинхронного контекста при использовании API <code>AsyncLocalStorage</code>.</p><p>Чтобы сохранить совместимость ABI с предыдущими версиями, передача <code>NULL</code> для <code>async_resource</code> не приводит к ошибке. Однако это не рекомендуется, так как это приведет к нежелательному поведению с хуками <code>init</code> <code>async_hooks</code> <a href="/ru/nodejs/api/async_hooks#initasyncid-type-triggerasyncid-resource"><code>init</code> hooks</a> и <code>async_hooks.executionAsyncResource()</code>, поскольку ресурс теперь требуется базовой реализацией <code>async_hooks</code>, чтобы обеспечить связь между асинхронными обратными вызовами.</p><h3 id="napi_async_destroy" tabindex="-1"><code>napi_async_destroy</code> <a class="header-anchor" href="#napi_async_destroy" aria-label="Permalink to “napi_async_destroy”">​</a></h3><p><strong>Добавлено в: v8.6.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_async_destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                               napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] async_context</code>: Асинхронный контекст, который необходимо уничтожить.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h3 id="napi_make_callback" tabindex="-1"><code>napi_make_callback</code> <a class="header-anchor" href="#napi_make_callback" aria-label="Permalink to “napi_make_callback”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v8.6.0</td><td>Добавлен параметр <code>async_context</code>.</td></tr><tr><td>v8.0.0</td><td>Добавлено в: v8.0.0</td></tr></tbody></table></div><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_make_callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                           const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                           napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] async_context</code>: Контекст для асинхронной операции, которая вызывает обратный вызов. Обычно это должно быть значение, ранее полученное из <a href="/ru/nodejs/api/n-api#napi-async-init"><code>napi_async_init</code></a>. Чтобы сохранить ABI-совместимость с предыдущими версиями, передача <code>NULL</code> для <code>async_context</code> не приводит к ошибке. Однако это приводит к неправильной работе асинхронных хуков. Потенциальные проблемы включают потерю асинхронного контекста при использовании API <code>AsyncLocalStorage</code>.</li><li><code>[in] recv</code>: Значение <code>this</code>, передаваемое вызываемой функции.</li><li><code>[in] func</code>: <code>napi_value</code>, представляющий вызываемую JavaScript-функцию.</li><li><code>[in] argc</code>: Количество элементов в массиве <code>argv</code>.</li><li><code>[in] argv</code>: Массив значений JavaScript в виде <code>napi_value</code>, представляющий аргументы функции. Если <code>argc</code> равно нулю, этот параметр может быть опущен путем передачи <code>NULL</code>.</li><li><code>[out] result</code>: <code>napi_value</code>, представляющий возвращаемый объект JavaScript.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнился успешно.</p><p>Этот метод позволяет вызывать объект JavaScript-функции из нативного аддона. Этот API похож на <code>napi_call_function</code>. Однако он используется для вызова <em>из</em> нативного кода <em>обратно</em> в JavaScript <em>после</em> возврата из асинхронной операции (когда в стеке нет другого скрипта). Это довольно простая обертка вокруг <code>node::MakeCallback</code>.</p><p>Обратите внимание, что <em>не</em> обязательно использовать <code>napi_make_callback</code> из <code>napi_async_complete_callback</code>; в этой ситуации асинхронный контекст обратного вызова уже настроен, поэтому прямого вызова <code>napi_call_function</code> достаточно и уместно. Использование функции <code>napi_make_callback</code> может потребоваться при реализации пользовательского асинхронного поведения, которое не использует <code>napi_create_async_work</code>.</p><p>Любые <code>process.nextTick</code> или Promises, запланированные в очереди микрозадач JavaScript во время обратного вызова, выполняются до возврата в C/C++.</p><h3 id="napi_open_callback_scope" tabindex="-1"><code>napi_open_callback_scope</code> <a class="header-anchor" href="#napi_open_callback_scope" aria-label="Permalink to “napi_open_callback_scope”">​</a></h3><p><strong>Добавлено в версии: v9.6.0</strong></p><p><strong>Версия N-API: 3</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_open_callback_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resource_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_async_context </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                 napi_callback_scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] resource_object</code>: Объект, связанный с асинхронной работой, который будет передан возможным хукам <code>async_hooks</code> <a href="/ru/nodejs/api/async_hooks#initasyncid-type-triggerasyncid-resource"><code>init</code> hooks</a>. Этот параметр устарел и игнорируется во время выполнения. Вместо этого используйте параметр <code>async_resource</code> в <a href="/ru/nodejs/api/n-api#napi-async-init"><code>napi_async_init</code></a>.</li><li><code>[in] context</code>: Контекст для асинхронной операции, которая вызывает обратный вызов. Это должно быть значение, ранее полученное из <a href="/ru/nodejs/api/n-api#napi-async-init"><code>napi_async_init</code></a>.</li><li><code>[out] result</code>: Вновь созданная область видимости.</li></ul><p>Бывают случаи (например, разрешение промисов), когда необходимо иметь эквивалент области видимости, связанной с обратным вызовом, при выполнении определенных вызовов Node-API. Если в стеке нет другого скрипта, функции <a href="/ru/nodejs/api/n-api#napi-open-callback-scope"><code>napi_open_callback_scope</code></a> и <a href="/ru/nodejs/api/n-api#napi-close-callback-scope"><code>napi_close_callback_scope</code></a> можно использовать для открытия/закрытия необходимой области видимости.</p><h3 id="napi_close_callback_scope" tabindex="-1"><code>napi_close_callback_scope</code> <a class="header-anchor" href="#napi_close_callback_scope" aria-label="Permalink to “napi_close_callback_scope”">​</a></h3><p><strong>Добавлено в версии: v9.6.0</strong></p><p><strong>Версия N-API: 3</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_close_callback_scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                  napi_callback_scope </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] scope</code>: Область видимости, которую необходимо закрыть.</li></ul><p>Этот API можно вызывать, даже если есть ожидающее исключение JavaScript.</p><h2 id="version-management" tabindex="-1">Управление версиями <a class="header-anchor" href="#version-management" aria-label="Permalink to “Управление версиями”">​</a></h2><h3 id="napi_get_node_version" tabindex="-1"><code>napi_get_node_version</code> <a class="header-anchor" href="#napi_get_node_version" aria-label="Permalink to “napi_get_node_version”">​</a></h3><p><strong>Добавлено в версии: v8.4.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> major;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> minor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patch;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> release;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} napi_node_version;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_node_version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_node_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] version</code>: Указатель на информацию о версии самого Node.js.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Эта функция заполняет структуру <code>version</code> основной, дополнительной и корректирующей версией Node.js, которая в данный момент запущена, а поле <code>release</code> значением <a href="/ru/nodejs/api/process#processrelease"><code>process.release.name</code></a>.</p><p>Возвращенный буфер выделен статически и не требует освобождения.</p><h3 id="napi_get_version" tabindex="-1"><code>napi_get_version</code> <a class="header-anchor" href="#napi_get_version" aria-label="Permalink to “napi_get_version”">​</a></h3><p><strong>Added in: v8.0.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                             uint32_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: Самая высокая поддерживаемая версия Node-API.</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнена успешно.</p><p>Этот API возвращает самую высокую версию Node-API, поддерживаемую средой выполнения Node.js. Планируется, что Node-API будет аддитивным, чтобы более новые версии Node.js могли поддерживать дополнительные функции API. Чтобы позволить надстройке использовать более новую функцию при работе с версиями Node.js, которые ее поддерживают, при этом обеспечивая резервное поведение при работе с версиями Node.js, которые ее не поддерживают:</p><ul><li>Вызовите <code>napi_get_version()</code>, чтобы определить, доступен ли API.</li><li>Если доступно, динамически загрузите указатель на функцию с помощью <code>uv_dlsym()</code>.</li><li>Используйте динамически загруженный указатель для вызова функции.</li><li>Если функция недоступна, предоставьте альтернативную реализацию, которая не использует функцию.</li></ul><h2 id="memory-management" tabindex="-1">Управление памятью <a class="header-anchor" href="#memory-management" aria-label="Permalink to “Управление памятью”">​</a></h2><h3 id="napi_adjust_external_memory" tabindex="-1"><code>napi_adjust_external_memory</code> <a class="header-anchor" href="#napi_adjust_external_memory" aria-label="Permalink to “napi_adjust_external_memory”">​</a></h3><p><strong>Added in: v8.5.0</strong></p><p><strong>N-API version: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_adjust_external_memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    int64_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> change_in_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                    int64_t*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] change_in_bytes</code>: Изменение во внешней памяти, выделенной и поддерживаемой объектами JavaScript.</li><li><code>[out] result</code>: Скорректированное значение</li></ul><p>Возвращает <code>napi_ok</code>, если API выполнена успешно.</p><p>Эта функция предоставляет V8 информацию об объеме внешней выделенной памяти, которая поддерживается объектами JavaScript (т. е. объект JavaScript, который указывает на свою собственную память, выделенную собственной надстройкой). Регистрация внешней выделенной памяти будет запускать глобальные сборки мусора чаще, чем это было бы в противном случае.</p><h2 id="promises" tabindex="-1">Промисы <a class="header-anchor" href="#promises" aria-label="Permalink to “Промисы”">​</a></h2><p>Node-API предоставляет средства для создания объектов <code>Promise</code>, как описано в <a href="https://tc39.github.io/ecma262/#sec-promise-objects" target="_blank" rel="noreferrer">разделе 25.4</a> спецификации ECMA. Он реализует промисы как пару объектов. Когда промис создается с помощью <code>napi_create_promise()</code>, создается и возвращается объект &quot;отложенный&quot; вместе с <code>Promise</code>. Отложенный объект привязан к созданному <code>Promise</code> и является единственным средством разрешения или отклонения <code>Promise</code> с помощью <code>napi_resolve_deferred()</code> или <code>napi_reject_deferred()</code>. Отложенный объект, созданный <code>napi_create_promise()</code>, освобождается <code>napi_resolve_deferred()</code> или <code>napi_reject_deferred()</code>. Объект <code>Promise</code> может быть возвращен в JavaScript, где его можно использовать обычным образом.</p><p>Например, чтобы создать промис и передать его асинхронному работнику:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_deferred deferred;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value promise;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Создаем промис.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_create_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Передаем отложенное значение функции, выполняющей асинхронное действие.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">do_something_asynchronous</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(deferred);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Возвращаем промис в JS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> promise;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Приведенная выше функция <code>do_something_asynchronous()</code> выполнит свое асинхронное действие, а затем разрешит или отклонит отложенное значение, тем самым завершив промис и освободив отложенное значение:</p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_deferred deferred;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_value undefined;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Создаем значение, которым завершим отложенное значение.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_get_undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Разрешаем или отклоняем промис, связанный с отложенным значением, в зависимости от</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// того, успешно ли выполнено асинхронное действие.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (asynchronous_action_succeeded) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_resolve_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, deferred, undefined);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> napi_reject_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(env, deferred, undefined);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> napi_ok) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// На этом этапе отложенное значение было освобождено, поэтому мы должны присвоить ему значение NULL.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">deferred </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="napi_create_promise" tabindex="-1"><code>napi_create_promise</code> <a class="header-anchor" href="#napi_create_promise" aria-label="Permalink to “napi_create_promise”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_deferred</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] deferred</code>: Недавно созданный отложенный объект, который позже можно передать в <code>napi_resolve_deferred()</code> или <code>napi_reject_deferred()</code> для разрешения или отклонения связанного промиса соответственно.</li><li><code>[out] promise</code>: JavaScript промис, связанный с отложенным объектом.</li></ul><p>Возвращает <code>napi_ok</code>, если API успешно выполнен.</p><p>Этот API создает отложенный объект и JavaScript промис.</p><h3 id="napi_resolve_deferred" tabindex="-1"><code>napi_resolve_deferred</code> <a class="header-anchor" href="#napi_resolve_deferred" aria-label="Permalink to “napi_resolve_deferred”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_resolve_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_deferred </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                  napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolution</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] deferred</code>: Отложенный объект, связанный промис которого нужно разрешить.</li><li><code>[in] resolution</code>: Значение, с которым нужно разрешить промис.</li></ul><p>Этот API разрешает JavaScript промис посредством отложенного объекта, с которым он связан. Таким образом, его можно использовать только для разрешения JavaScript промисов, для которых доступен соответствующий отложенный объект. Это фактически означает, что промис должен быть создан с использованием <code>napi_create_promise()</code>, а отложенный объект, возвращенный из этого вызова, должен быть сохранен, чтобы его можно было передать в этот API.</p><p>Отложенный объект освобождается после успешного завершения.</p><h3 id="napi_reject_deferred" tabindex="-1"><code>napi_reject_deferred</code> <a class="header-anchor" href="#napi_reject_deferred" aria-label="Permalink to “napi_reject_deferred”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_reject_deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_deferred </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">deferred</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rejection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] deferred</code>: Отложенный объект, связанный промис которого нужно отклонить.</li><li><code>[in] rejection</code>: Значение, с которым нужно отклонить промис.</li></ul><p>Этот API отклоняет JavaScript промис посредством отложенного объекта, с которым он связан. Таким образом, его можно использовать только для отклонения JavaScript промисов, для которых доступен соответствующий отложенный объект. Это фактически означает, что промис должен быть создан с использованием <code>napi_create_promise()</code>, а отложенный объект, возвращенный из этого вызова, должен быть сохранен, чтобы его можно было передать в этот API.</p><p>Отложенный объект освобождается после успешного завершения.</p><h3 id="napi_is_promise" tabindex="-1"><code>napi_is_promise</code> <a class="header-anchor" href="#napi_is_promise" aria-label="Permalink to “napi_is_promise”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_is_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                            bool*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> is_promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] value</code>: Значение для проверки</li><li><code>[out] is_promise</code>: Флаг, указывающий, является ли <code>promise</code> встроенным объектом promise (то есть, объектом promise, созданным базовым движком).</li></ul><h2 id="script-execution" tabindex="-1">Выполнение скрипта <a class="header-anchor" href="#script-execution" aria-label="Permalink to “Выполнение скрипта”">​</a></h2><p>Node-API предоставляет API для выполнения строки, содержащей JavaScript, с использованием базового движка JavaScript.</p><h3 id="napi_run_script" tabindex="-1"><code>napi_run_script</code> <a class="header-anchor" href="#napi_run_script" aria-label="Permalink to “napi_run_script”">​</a></h3><p><strong>Добавлено в: v8.5.0</strong></p><p><strong>Версия N-API: 1</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_run_script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                        napi_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] script</code>: Строка JavaScript, содержащая скрипт для выполнения.</li><li><code>[out] result</code>: Значение, полученное в результате выполнения скрипта.</li></ul><p>Эта функция выполняет строку кода JavaScript и возвращает его результат со следующими оговорками:</p><ul><li>В отличие от <code>eval</code>, эта функция не позволяет скрипту получить доступ к текущей лексической области видимости и, следовательно, также не позволяет получить доступ к <a href="/ru/nodejs/api/modules#the-module-scope">области видимости модуля</a>, что означает, что псевдо-глобальные переменные, такие как <code>require</code>, не будут доступны.</li><li>Скрипт может получить доступ к <a href="/ru/nodejs/api/globals">глобальной области видимости</a>. Объявления функций и <code>var</code> в скрипте будут добавлены в объект <a href="/ru/nodejs/api/globals#global"><code>global</code></a>. Объявления переменных, сделанные с использованием <code>let</code> и <code>const</code>, будут видны глобально, но не будут добавлены в объект <a href="/ru/nodejs/api/globals#global"><code>global</code></a>.</li><li>Значение <code>this</code> внутри скрипта - это <a href="/ru/nodejs/api/globals#global"><code>global</code></a>.</li></ul><h2 id="libuv-event-loop" tabindex="-1">Цикл событий libuv <a class="header-anchor" href="#libuv-event-loop" aria-label="Permalink to “Цикл событий libuv”">​</a></h2><p>Node-API предоставляет функцию для получения текущего цикла событий, связанного с определенным <code>napi_env</code>.</p><h3 id="napi_get_uv_event_loop" tabindex="-1"><code>napi_get_uv_event_loop</code> <a class="header-anchor" href="#napi_get_uv_event_loop" aria-label="Permalink to “napi_get_uv_event_loop”">​</a></h3><p><strong>Добавлено в: v9.3.0, v8.10.0</strong></p><p><strong>Версия N-API: 2</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_uv_event_loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                               struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uv_loop_s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] loop</code>: Текущий экземпляр цикла libuv.</li></ul><p>Примечание: Хотя libuv был относительно стабилен с течением времени, он не предоставляет гарантии стабильности ABI. Следует избегать использования этой функции. Ее использование может привести к тому, что дополнение не будет работать в разных версиях Node.js. <a href="/ru/nodejs/api/n-api#asynchronous-thread-safe-function-calls">Асинхронные безопасные для потоков вызовы функций</a> являются альтернативой для многих случаев использования.</p><h2 id="asynchronous-thread-safe-function-calls" tabindex="-1">Асинхронные потокобезопасные вызовы функций <a class="header-anchor" href="#asynchronous-thread-safe-function-calls" aria-label="Permalink to “Асинхронные потокобезопасные вызовы функций”">​</a></h2><p>Функции JavaScript обычно могут быть вызваны только из основного потока нативного дополнения. Если дополнение создает дополнительные потоки, то функции Node-API, требующие <code>napi_env</code>, <code>napi_value</code> или <code>napi_ref</code>, не должны вызываться из этих потоков.</p><p>Когда дополнение имеет дополнительные потоки и функции JavaScript должны быть вызваны на основе обработки, завершенной этими потоками, эти потоки должны взаимодействовать с основным потоком дополнения, чтобы основной поток мог вызывать функции JavaScript от их имени. API потокобезопасных функций предоставляет простой способ сделать это.</p><p>Эти API предоставляют тип <code>napi_threadsafe_function</code>, а также API для создания, уничтожения и вызова объектов этого типа. <code>napi_create_threadsafe_function()</code> создает постоянную ссылку на <code>napi_value</code>, который содержит функцию JavaScript, которую можно вызывать из нескольких потоков. Вызовы происходят асинхронно. Это означает, что значения, с которыми должен быть вызван обратный вызов JavaScript, будут помещены в очередь, и для каждого значения в очереди в конечном итоге будет сделан вызов функции JavaScript.</p><p>При создании <code>napi_threadsafe_function</code> можно предоставить обратный вызов <code>napi_finalize</code>. Этот обратный вызов будет вызван в основном потоке, когда потокобезопасная функция будет уничтожена. Он получает контекст и данные завершения, предоставленные во время конструирования, и предоставляет возможность очистки после потоков, например, путем вызова <code>uv_thread_join()</code>. <strong>Помимо потока основного цикла, никакие потоки не должны использовать потокобезопасную функцию после завершения обратного вызова завершения.</strong></p><p><code>context</code>, предоставленный во время вызова <code>napi_create_threadsafe_function()</code>, можно получить из любого потока с помощью вызова <code>napi_get_threadsafe_function_context()</code>.</p><h3 id="calling-a-thread-safe-function" tabindex="-1">Вызов потокобезопасной функции <a class="header-anchor" href="#calling-a-thread-safe-function" aria-label="Permalink to “Вызов потокобезопасной функции”">​</a></h3><p><code>napi_call_threadsafe_function()</code> может использоваться для инициирования вызова в JavaScript. <code>napi_call_threadsafe_function()</code> принимает параметр, который контролирует, ведет ли себя API блокирующим образом. Если установлено значение <code>napi_tsfn_nonblocking</code>, API ведет себя неблокирующим образом, возвращая <code>napi_queue_full</code>, если очередь была заполнена, что предотвращает успешное добавление данных в очередь. Если установлено значение <code>napi_tsfn_blocking</code>, API блокируется, пока не появится свободное место в очереди. <code>napi_call_threadsafe_function()</code> никогда не блокируется, если потокобезопасная функция была создана с максимальным размером очереди, равным 0.</p><p><code>napi_call_threadsafe_function()</code> не следует вызывать с <code>napi_tsfn_blocking</code> из потока JavaScript, потому что, если очередь заполнена, это может привести к взаимоблокировке потока JavaScript.</p><p>Фактический вызов в JavaScript контролируется обратным вызовом, заданным через параметр <code>call_js_cb</code>. <code>call_js_cb</code> вызывается в основном потоке один раз для каждого значения, которое было помещено в очередь успешным вызовом <code>napi_call_threadsafe_function()</code>. Если такой обратный вызов не задан, будет использован обратный вызов по умолчанию, и результирующий вызов JavaScript не будет иметь аргументов. Обратный вызов <code>call_js_cb</code> получает функцию JavaScript для вызова в качестве <code>napi_value</code> в своих параметрах, а также указатель контекста <code>void*</code>, использованный при создании <code>napi_threadsafe_function</code>, и следующий указатель данных, созданный одним из вторичных потоков. Затем обратный вызов может использовать API, такой как <code>napi_call_function()</code>, для вызова в JavaScript.</p><p>Обратный вызов также может быть вызван с <code>env</code> и <code>call_js_cb</code>, установленными в <code>NULL</code>, чтобы указать, что вызовы в JavaScript больше невозможны, в то время как элементы остаются в очереди и могут нуждаться в освобождении. Обычно это происходит, когда процесс Node.js завершается при активной потокобезопасной функции.</p><p>Нет необходимости вызывать JavaScript через <code>napi_make_callback()</code>, потому что Node-API запускает <code>call_js_cb</code> в контексте, подходящем для обратных вызовов.</p><p>Ноль или более элементов в очереди могут быть вызваны в каждом тике цикла событий. Приложения не должны зависеть от конкретного поведения, кроме того, что будет достигнут прогресс в вызове обратных вызовов, и события будут вызываться по мере продвижения времени.</p><h3 id="reference-counting-of-thread-safe-functions" tabindex="-1">Подсчет ссылок на потокобезопасные функции <a class="header-anchor" href="#reference-counting-of-thread-safe-functions" aria-label="Permalink to “Подсчет ссылок на потокобезопасные функции”">​</a></h3><p>Потоки могут добавляться и удаляться из объекта <code>napi_threadsafe_function</code> во время его существования. Таким образом, в дополнение к указанию начального количества потоков при создании, можно вызвать <code>napi_acquire_threadsafe_function</code>, чтобы указать, что новый поток начнет использовать потокобезопасную функцию. Аналогично, можно вызвать <code>napi_release_threadsafe_function</code>, чтобы указать, что существующий поток прекратит использовать потокобезопасную функцию.</p><p>Объекты <code>napi_threadsafe_function</code> уничтожаются, когда каждый поток, использующий объект, вызвал <code>napi_release_threadsafe_function()</code> или получил статус возврата <code>napi_closing</code> в ответ на вызов <code>napi_call_threadsafe_function</code>. Очередь опустошается перед уничтожением <code>napi_threadsafe_function</code>. <code>napi_release_threadsafe_function()</code> должен быть последним вызовом API, сделанным в сочетании с данной <code>napi_threadsafe_function</code>, потому что после завершения вызова нет гарантии, что <code>napi_threadsafe_function</code> все еще выделена. По той же причине не используйте потокобезопасную функцию после получения возвращаемого значения <code>napi_closing</code> в ответ на вызов <code>napi_call_threadsafe_function</code>. Данные, связанные с <code>napi_threadsafe_function</code>, могут быть освобождены в ее обратном вызове <code>napi_finalize</code>, который был передан в <code>napi_create_threadsafe_function()</code>. Параметр <code>initial_thread_count</code> функции <code>napi_create_threadsafe_function</code> обозначает начальное количество приобретений потокобезопасных функций, вместо многократного вызова <code>napi_acquire_threadsafe_function</code> при создании.</p><p>Как только количество потоков, использующих <code>napi_threadsafe_function</code>, достигает нуля, никакие другие потоки не могут начать использовать ее, вызвав <code>napi_acquire_threadsafe_function()</code>. Фактически, все последующие вызовы API, связанные с ней, за исключением <code>napi_release_threadsafe_function()</code>, вернут значение ошибки <code>napi_closing</code>.</p><p>Потокобезопасная функция может быть &quot;прервана&quot; путем присвоения значения <code>napi_tsfn_abort</code> функции <code>napi_release_threadsafe_function()</code>. Это приведет к тому, что все последующие API, связанные с потокобезопасной функцией, за исключением <code>napi_release_threadsafe_function()</code>, вернут <code>napi_closing</code> даже до того, как ее счетчик ссылок достигнет нуля. В частности, <code>napi_call_threadsafe_function()</code> вернет <code>napi_closing</code>, тем самым информируя потоки о том, что больше невозможно делать асинхронные вызовы потокобезопасной функции. Это можно использовать в качестве критерия для завершения потока. <strong>После получения возвращаемого значения <code>napi_closing</code> от <code>napi_call_threadsafe_function()</code> поток больше не должен использовать потокобезопасную функцию, потому что больше нет гарантии, что она выделена.</strong></p><h3 id="deciding-whether-to-keep-the-process-running" tabindex="-1">Решение о поддержании работы процесса <a class="header-anchor" href="#deciding-whether-to-keep-the-process-running" aria-label="Permalink to “Решение о поддержании работы процесса”">​</a></h3><p>Подобно дескрипторам libuv, функции, безопасные для потоков, могут быть &quot;связаны&quot; и &quot;несвязаны&quot;. &quot;Связанная&quot; функция, безопасная для потоков, будет поддерживать цикл событий в потоке, в котором она создана, до тех пор, пока функция, безопасная для потоков, не будет уничтожена. В отличие от этого, &quot;несвязанная&quot; функция, безопасная для потоков, не будет препятствовать выходу из цикла событий. Для этой цели существуют API <code>napi_ref_threadsafe_function</code> и <code>napi_unref_threadsafe_function</code>.</p><p><code>napi_unref_threadsafe_function</code> не помечает функции, безопасные для потоков, как доступные для уничтожения, и <code>napi_ref_threadsafe_function</code> не предотвращает их уничтожение.</p><h3 id="napi_create_threadsafe_function" tabindex="-1"><code>napi_create_threadsafe_function</code> <a class="header-anchor" href="#napi_create_threadsafe_function" aria-label="Permalink to “napi_create_threadsafe_function”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v12.6.0, v10.17.0</td><td>Параметр <code>func</code> стал необязательным с пользовательским <code>call_js_cb</code>.</td></tr><tr><td>v10.6.0</td><td>Добавлено в: v10.6.0</td></tr></tbody></table></div><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_create_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_value </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">async_resource_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> max_queue_size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> initial_thread_count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> thread_finalize_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_finalize </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">thread_finalize_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_threadsafe_function_call_js </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">call_js_cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                napi_threadsafe_function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] func</code>: Необязательная функция JavaScript, вызываемая из другого потока. Она должна быть предоставлена, если <code>NULL</code> передается в <code>call_js_cb</code>.</li><li><code>[in] async_resource</code>: Необязательный объект, связанный с асинхронной работой, который будет передан возможным хукам <code>init</code> <a href="/ru/nodejs/api/async_hooks#initasyncid-type-triggerasyncid-resource"><code>async_hooks</code></a>.</li><li><code>[in] async_resource_name</code>: Строка JavaScript, предоставляющая идентификатор для вида ресурса, предоставляемого для диагностической информации, предоставляемой API <code>async_hooks</code>.</li><li><code>[in] max_queue_size</code>: Максимальный размер очереди. <code>0</code> для отсутствия ограничений.</li><li><code>[in] initial_thread_count</code>: Начальное количество приобретений, то есть начальное количество потоков, включая основной поток, которые будут использовать эту функцию.</li><li><code>[in] thread_finalize_data</code>: Необязательные данные, передаваемые в <code>thread_finalize_cb</code>.</li><li><code>[in] thread_finalize_cb</code>: Необязательная функция, вызываемая при уничтожении <code>napi_threadsafe_function</code>.</li><li><code>[in] context</code>: Необязательные данные для присоединения к результирующей <code>napi_threadsafe_function</code>.</li><li><code>[in] call_js_cb</code>: Необязательный обратный вызов, который вызывает функцию JavaScript в ответ на вызов из другого потока. Этот обратный вызов будет вызван в основном потоке. Если он не указан, функция JavaScript будет вызываться без параметров и со значением <code>undefined</code> в качестве значения <code>this</code>. <a href="/ru/nodejs/api/n-api#napi-threadsafe-function-call-js"><code>napi_threadsafe_function_call_js</code></a> предоставляет более подробную информацию.</li><li><code>[out] result</code>: Асинхронная функция JavaScript, безопасная для потоков.</li></ul><p><strong>История изменений:</strong></p><ul><li>Экспериментальный (<code>NAPI_EXPERIMENTAL</code> определен): Неперехваченные исключения, выброшенные в <code>call_js_cb</code>, обрабатываются событием <a href="/ru/nodejs/api/process#event-uncaughtexception"><code>&#39;uncaughtException&#39;</code></a> вместо игнорирования.</li></ul><h3 id="napi_get_threadsafe_function_context" tabindex="-1"><code>napi_get_threadsafe_function_context</code> <a class="header-anchor" href="#napi_get_threadsafe_function_context" aria-label="Permalink to “napi_get_threadsafe_function_context”">​</a></h3><p><strong>Добавлено в версии: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_get_threadsafe_function_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                     void**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] func</code>: Потокобезопасная функция, для которой требуется получить контекст.</li><li><code>[out] result</code>: Место для хранения контекста.</li></ul><p>Этот API может быть вызван из любого потока, который использует <code>func</code>.</p><h3 id="napi_call_threadsafe_function" tabindex="-1"><code>napi_call_threadsafe_function</code> <a class="header-anchor" href="#napi_call_threadsafe_function" aria-label="Permalink to “napi_call_threadsafe_function”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v14.5.0</td><td>Поддержка <code>napi_would_deadlock</code> была отменена.</td></tr><tr><td>v14.1.0</td><td>Возвращает <code>napi_would_deadlock</code> при вызове с <code>napi_tsfn_blocking</code> из основного потока или рабочего потока, и очередь заполнена.</td></tr><tr><td>v10.6.0</td><td>Добавлено в версии: v10.6.0</td></tr></tbody></table></div><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_call_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                              void*</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                              napi_threadsafe_function_call_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">is_blocking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>[in] func</code>: Асинхронная потокобезопасная функция JavaScript, которую следует вызвать.</li><li><code>[in] data</code>: Данные для отправки в JavaScript через обратный вызов <code>call_js_cb</code>, предоставленный при создании потокобезопасной функции JavaScript.</li><li><code>[in] is_blocking</code>: Флаг, значение которого может быть либо <code>napi_tsfn_blocking</code>, чтобы указать, что вызов должен блокироваться, если очередь заполнена, либо <code>napi_tsfn_nonblocking</code>, чтобы указать, что вызов должен немедленно возвращать статус <code>napi_queue_full</code> всякий раз, когда очередь заполнена.</li></ul><p>Этот API не следует вызывать с <code>napi_tsfn_blocking</code> из потока JavaScript, потому что, если очередь заполнена, это может привести к взаимоблокировке потока JavaScript.</p><p>Этот API вернет <code>napi_closing</code>, если <code>napi_release_threadsafe_function()</code> был вызван с параметром <code>abort</code>, установленным в <code>napi_tsfn_abort</code> из любого потока. Значение добавляется в очередь только в том случае, если API возвращает <code>napi_ok</code>.</p><p>Этот API может быть вызван из любого потока, который использует <code>func</code>.</p><h3 id="napi_acquire_threadsafe_function" tabindex="-1"><code>napi_acquire_threadsafe_function</code> <a class="header-anchor" href="#napi_acquire_threadsafe_function" aria-label="Permalink to “napi_acquire_threadsafe_function”">​</a></h3><p><strong>Добавлено в версии: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_acquire_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] func</code>: Асинхронная потокобезопасная функция JavaScript, которую следует начать использовать.</li></ul><p>Поток должен вызвать этот API перед передачей <code>func</code> в любые другие потокобезопасные API-функции, чтобы указать, что он будет использовать <code>func</code>. Это предотвращает уничтожение <code>func</code>, когда все остальные потоки перестали ее использовать.</p><p>Этот API может быть вызван из любого потока, который начнет использовать <code>func</code>.</p><h3 id="napi_release_threadsafe_function" tabindex="-1"><code>napi_release_threadsafe_function</code> <a class="header-anchor" href="#napi_release_threadsafe_function" aria-label="Permalink to “napi_release_threadsafe_function”">​</a></h3><p><strong>Добавлено в: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_release_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 napi_threadsafe_function_release_mode </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] func</code>: Асинхронная потокобезопасная JavaScript-функция, счетчик ссылок которой необходимо уменьшить.</li><li><code>[in] mode</code>: Флаг, значение которого может быть либо <code>napi_tsfn_release</code>, чтобы указать, что текущий поток больше не будет вызывать потокобезопасную функцию, либо <code>napi_tsfn_abort</code>, чтобы указать, что в дополнение к текущему потоку ни один другой поток не должен вызывать потокобезопасную функцию. Если установлено значение <code>napi_tsfn_abort</code>, последующие вызовы <code>napi_call_threadsafe_function()</code> будут возвращать <code>napi_closing</code>, и никакие другие значения не будут помещены в очередь.</li></ul><p>Поток должен вызывать этот API, когда он перестает использовать <code>func</code>. Передача <code>func</code> в какие-либо потокобезопасные API после вызова этого API имеет неопределенные результаты, поскольку <code>func</code> могла быть уничтожена.</p><p>Этот API можно вызывать из любого потока, который перестанет использовать <code>func</code>.</p><h3 id="napi_ref_threadsafe_function" tabindex="-1"><code>napi_ref_threadsafe_function</code> <a class="header-anchor" href="#napi_ref_threadsafe_function" aria-label="Permalink to “napi_ref_threadsafe_function”">​</a></h3><p><strong>Добавлено в: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_ref_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] func</code>: Потокобезопасная функция для создания ссылки.</li></ul><p>Этот API используется для указания того, что цикл событий, выполняющийся в основном потоке, не должен завершаться до тех пор, пока <code>func</code> не будет уничтожена. Подобно <a href="https://docs.libuv.org/en/v1.x/handle#c.uv_ref" target="_blank" rel="noreferrer"><code>uv_ref</code></a>, он также является идемпотентным.</p><p><code>napi_unref_threadsafe_function</code> не помечает потокобезопасные функции как способные быть уничтоженными, а <code>napi_ref_threadsafe_function</code> не предотвращает их уничтожение. Для этой цели доступны <code>napi_acquire_threadsafe_function</code> и <code>napi_release_threadsafe_function</code>.</p><p>Этот API можно вызывать только из основного потока.</p><h3 id="napi_unref_threadsafe_function" tabindex="-1"><code>napi_unref_threadsafe_function</code> <a class="header-anchor" href="#napi_unref_threadsafe_function" aria-label="Permalink to “napi_unref_threadsafe_function”">​</a></h3><p><strong>Добавлено в: v10.6.0</strong></p><p><strong>Версия N-API: 4</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">napi_unref_threadsafe_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, napi_threadsafe_function </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[in] func</code>: Потокобезопасная функция для удаления ссылки.</li></ul><p>Этот API используется для указания того, что цикл событий, выполняющийся в основном потоке, может завершиться до уничтожения <code>func</code>. Подобно <a href="https://docs.libuv.org/en/v1.x/handle#c.uv_unref" target="_blank" rel="noreferrer"><code>uv_unref</code></a>, он также является идемпотентным.</p><p>Этот API можно вызывать только из основного потока.</p><h2 id="miscellaneous-utilities" tabindex="-1">Разные утилиты <a class="header-anchor" href="#miscellaneous-utilities" aria-label="Permalink to “Разные утилиты”">​</a></h2><h3 id="node_api_get_module_file_name" tabindex="-1"><code>node_api_get_module_file_name</code> <a class="header-anchor" href="#node_api_get_module_file_name" aria-label="Permalink to “node_api_get_module_file_name”">​</a></h3><p><strong>Добавлено в: v15.9.0, v14.18.0, v12.22.0</strong></p><p><strong>Версия N-API: 9</strong></p><div class="language-C line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NAPI_EXTERN napi_status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node_api_get_module_file_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node_api_basic_env </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> char**</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>[in] env</code>: Среда, в которой вызывается API.</li><li><code>[out] result</code>: URL-адрес, содержащий абсолютный путь к месту, откуда была загружена надстройка. Для файла в локальной файловой системе он будет начинаться с <code>file://</code>. Строка завершается нулем и принадлежит <code>env</code>, поэтому ее нельзя изменять или освобождать.</li></ul><p><code>result</code> может быть пустой строкой, если процесс загрузки надстройки не может установить имя файла надстройки во время загрузки.</p>`,1599)])}var s=e(a,[[`render`,o]]);export{i as __pageData,s as default};