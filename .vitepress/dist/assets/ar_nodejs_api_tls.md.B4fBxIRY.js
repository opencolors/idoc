import{__plugin_vue_export_helper_default as e,createElementBlock as t,createStaticVNode as n,openBlock as r}from"./chunks/plugin-vue_export-helper.Bts1mPc7.js";const i=JSON.parse(`{"title":"توثيق Node.js - TLS (أمان طبقة النقل)","description":"يغطي هذا القسم من توثيق Node.js وحدة TLS (أمان طبقة النقل)، التي توفر تنفيذ بروتوكولات TLS و SSL. يشمل ذلك تفاصيل حول إنشاء اتصالات آمنة، وإدارة الشهادات، والتعامل مع الاتصال الآمن، والعديد من الخيارات لتكوين TLS/SSL في تطبيقات Node.js.","frontmatter":{"title":"توثيق Node.js - TLS (أمان طبقة النقل)","description":"يغطي هذا القسم من توثيق Node.js وحدة TLS (أمان طبقة النقل)، التي توفر تنفيذ بروتوكولات TLS و SSL. يشمل ذلك تفاصيل حول إنشاء اتصالات آمنة، وإدارة الشهادات، والتعامل مع الاتصال الآمن، والعديد من الخيارات لتكوين TLS/SSL في تطبيقات Node.js.","head":[["meta",{"name":"og:title","content":"توثيق Node.js - TLS (أمان طبقة النقل) | Node.js - iDoc.dev"}],["meta",{"name":"og:description","content":"يغطي هذا القسم من توثيق Node.js وحدة TLS (أمان طبقة النقل)، التي توفر تنفيذ بروتوكولات TLS و SSL. يشمل ذلك تفاصيل حول إنشاء اتصالات آمنة، وإدارة الشهادات، والتعامل مع الاتصال الآمن، والعديد من الخيارات لتكوين TLS/SSL في تطبيقات Node.js."}],["meta",{"name":"twitter:title","content":"توثيق Node.js - TLS (أمان طبقة النقل) | Node.js - iDoc.dev"}],["meta",{"name":"twitter:description","content":"يغطي هذا القسم من توثيق Node.js وحدة TLS (أمان طبقة النقل)، التي توفر تنفيذ بروتوكولات TLS و SSL. يشمل ذلك تفاصيل حول إنشاء اتصالات آمنة، وإدارة الشهادات، والتعامل مع الاتصال الآمن، والعديد من الخيارات لتكوين TLS/SSL في تطبيقات Node.js."}],["link",{"rel":"canonical","href":"https://idoc.dev/ar/nodejs/api/tls"}],["meta",{"property":"og:url","content":"https://idoc.dev/ar/nodejs/api/tls"}]]},"headers":[],"relativePath":"ar/nodejs/api/tls.md","filePath":"ar/nodejs/api/tls.md","lastUpdated":1749464498000}`),a={name:`ar/nodejs/api/tls.md`};function o(e,i,a,o,s,c){return r(),t(`div`,null,i[0]||=[n(`<h1 id="tls-ssl" tabindex="-1">TLS (SSL) <a class="header-anchor" href="#tls-ssl" aria-label="Permalink to “TLS (SSL)”">​</a></h1><div class="tip custom-block"><p class="custom-block-title">[Stable: 2 - Stable]</p><p><a href="/ar/nodejs/api/documentation#stability-index">مستقر: 2</a> <a href="/ar/nodejs/api/documentation#stability-index">الاستقرار: 2</a> - مستقر</p></div><p><strong>شفرة المصدر:</strong> <a href="https://github.com/nodejs/node/blob/v23.5.0/lib/tls.js" target="_blank" rel="noreferrer">lib/tls.js</a></p><p>توفر وحدة <code>node:tls</code> تطبيقًا لبروتوكولات أمان طبقة النقل (TLS) وطبقة المقابس الآمنة (SSL) المبنية على OpenSSL. يمكن الوصول إلى الوحدة باستخدام:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-14" id="tab-15" checked><label data-title="ESM" for="tab-15">ESM</label><input type="radio" name="group-14" id="tab-16"><label data-title="CJS" for="tab-16">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div></div><h2 id="determining-if-crypto-support-is-unavailable" tabindex="-1">تحديد ما إذا كان دعم التشفير غير متوفر <a class="header-anchor" href="#determining-if-crypto-support-is-unavailable" aria-label="Permalink to “تحديد ما إذا كان دعم التشفير غير متوفر”">​</a></h2><p>من الممكن إنشاء Node.js بدون تضمين دعم وحدة <code>node:crypto</code>. في مثل هذه الحالات، ستؤدي محاولة <code>import</code> من <code>tls</code> أو استدعاء <code>require(&#39;node:tls&#39;)</code> إلى حدوث خطأ.</p><p>عند استخدام CommonJS، يمكن التقاط الخطأ الذي تم طرحه باستخدام try/catch:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tls;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tls support is disabled!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>عند استخدام الكلمة المفتاحية <code>import</code> المعجمية لـ ESM، لا يمكن التقاط الخطأ إلا إذا تم تسجيل معالج لـ <code>process.on(&#39;uncaughtException&#39;)</code> <em>قبل</em> إجراء أي محاولة لتحميل الوحدة (باستخدام، على سبيل المثال، وحدة التحميل المسبق).</p><p>عند استخدام ESM، إذا كانت هناك فرصة لتشغيل التعليمات البرمجية على إصدار من Node.js حيث لم يتم تمكين دعم التشفير، ففكر في استخدام الدالة <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import" target="_blank" rel="noreferrer"><code>import()</code></a> بدلاً من الكلمة المفتاحية <code>import</code> المعجمية:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tls;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tls </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tls support is disabled!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="tls/ssl-concepts" tabindex="-1">مفاهيم TLS/SSL <a class="header-anchor" href="#tls/ssl-concepts" aria-label="Permalink to “مفاهيم TLS/SSL”">​</a></h2><p>TLS/SSL هي مجموعة من البروتوكولات التي تعتمد على بنية المفتاح العام (PKI) لتمكين الاتصال الآمن بين العميل والخادم. بالنسبة لمعظم الحالات الشائعة، يجب أن يكون لكل خادم مفتاح خاص.</p><p>يمكن إنشاء المفاتيح الخاصة بعدة طرق. يوضح المثال أدناه استخدام واجهة سطر الأوامر OpenSSL لإنشاء مفتاح خاص RSA ذي 2048 بت:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>باستخدام TLS/SSL، يجب أن يكون لجميع الخوادم (وبعض العملاء) <em>شهادة</em>. الشهادات هي <em>مفاتيح عامة</em> تتوافق مع مفتاح خاص، ويتم توقيعها رقميًا إما بواسطة مرجع مصدق أو بواسطة مالك المفتاح الخاص (يشار إلى هذه الشهادات باسم &quot;موقعة ذاتيًا&quot;). الخطوة الأولى للحصول على شهادة هي إنشاء ملف <em>طلب توقيع الشهادة</em> (CSR).</p><p>يمكن استخدام واجهة سطر الأوامر OpenSSL لإنشاء CSR لمفتاح خاص:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-csr.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>بمجرد إنشاء ملف CSR، يمكن إرساله إلى مرجع مصدق للتوقيع أو استخدامه لإنشاء شهادة موقعة ذاتيًا.</p><p>يوضح المثال التالي إنشاء شهادة موقعة ذاتيًا باستخدام واجهة سطر الأوامر OpenSSL:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-csr.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -signkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>بمجرد إنشاء الشهادة، يمكن استخدامها لإنشاء ملف <code>.pfx</code> أو <code>.p12</code>:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkcs12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -export</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -inkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      -certfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ca-cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ryans.pfx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>أين:</p><ul><li><code>in</code>: هي الشهادة الموقعة</li><li><code>inkey</code>: هو المفتاح الخاص المرتبط بها</li><li><code>certfile</code>: عبارة عن سلسلة متسلسلة من جميع شهادات مرجع الشهادة (CA) في ملف واحد، على سبيل المثال <code>cat ca1-cert.pem ca2-cert.pem \\&gt; ca-cert.pem</code></li></ul><h3 id="perfect-forward-secrecy" tabindex="-1">السرية الأمامية التامة <a class="header-anchor" href="#perfect-forward-secrecy" aria-label="Permalink to “السرية الأمامية التامة”">​</a></h3><p>يصف مصطلح <em><a href="https://en.wikipedia.org/wiki/Perfect_forward_secrecy">السرية الأمامية</a></em> أو <em>السرية الأمامية التامة</em> ميزة لطرق الاتفاق على المفاتيح (أي تبادل المفاتيح). أي أن مفاتيح الخادم والعميل تُستخدم للتفاوض على مفاتيح مؤقتة جديدة تُستخدم تحديدًا وفقط لجلسة الاتصال الحالية. عمليًا، هذا يعني أنه حتى إذا تم اختراق المفتاح الخاص للخادم، لا يمكن للمتطفلين فك تشفير الاتصال إلا إذا تمكن المهاجم من الحصول على زوج المفاتيح الذي تم إنشاؤه خصيصًا للجلسة.</p><p>يتم تحقيق السرية الأمامية التامة عن طريق إنشاء زوج مفاتيح عشوائيًا للاتفاق على المفاتيح في كل مصافحة TLS/SSL (على عكس استخدام نفس المفتاح لجميع الجلسات). تسمى الطرق التي تنفذ هذه التقنية &quot;زائلة&quot;.</p><p>تُستخدم حاليًا طريقتان بشكل شائع لتحقيق السرية الأمامية التامة (لاحظ الحرف &quot;E&quot; المضاف إلى الاختصارات التقليدية):</p><ul><li><a href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman" target="_blank" rel="noreferrer">ECDHE</a>: نسخة زائلة من بروتوكول الاتفاق على المفاتيح منحنى إهليلجي ديفي هيلمان.</li><li><a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange" target="_blank" rel="noreferrer">DHE</a>: نسخة زائلة من بروتوكول الاتفاق على المفاتيح ديفي هيلمان.</li></ul><p>يتم تمكين السرية الأمامية التامة باستخدام ECDHE افتراضيًا. يمكن استخدام الخيار <code>ecdhCurve</code> عند إنشاء خادم TLS لتخصيص قائمة منحنيات ECDH المدعومة للاستخدام. راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a> لمزيد من المعلومات.</p><p>يتم تعطيل DHE افتراضيًا ولكن يمكن تمكينه جنبًا إلى جنب مع ECDHE عن طريق تعيين الخيار <code>dhparam</code> على <code>&#39;auto&#39;</code>. يتم دعم معلمات DHE المخصصة أيضًا ولكن لا يُشجع عليها لصالح المعلمات المعروفة المحددة تلقائيًا.</p><p>كانت السرية الأمامية التامة اختيارية حتى TLSv1.2. اعتبارًا من TLSv1.3، يتم استخدام (EC)DHE دائمًا (باستثناء اتصالات PSK فقط).</p><h3 id="alpn-and-sni" tabindex="-1">ALPN و SNI <a class="header-anchor" href="#alpn-and-sni" aria-label="Permalink to “ALPN و SNI”">​</a></h3><p>ALPN (ملحق التفاوض على بروتوكول طبقة التطبيق) و SNI (إشارة اسم الخادم) هما امتدادات مصافحة TLS:</p><ul><li>ALPN: يسمح باستخدام خادم TLS واحد لبروتوكولات متعددة (HTTP، HTTP/2)</li><li>SNI: يسمح باستخدام خادم TLS واحد لأسماء مضيفين متعددة بشهادات مختلفة.</li></ul><h3 id="pre-shared-keys" tabindex="-1">مفاتيح مشتركة مسبقًا <a class="header-anchor" href="#pre-shared-keys" aria-label="Permalink to “مفاتيح مشتركة مسبقًا”">​</a></h3><p>يتوفر دعم TLS-PSK كبديل للمصادقة العادية القائمة على الشهادات. يستخدم مفتاحًا مشتركًا مسبقًا بدلاً من الشهادات لمصادقة اتصال TLS، مما يوفر مصادقة متبادلة. TLS-PSK والبنية التحتية للمفتاح العام ليسا متعارضين. يمكن للعملاء والخوادم استيعاب كليهما، واختيار أحدهما أثناء خطوة التفاوض العادية على الشيفرة.</p><p>يُعد TLS-PSK خيارًا جيدًا فقط في الحالات التي توجد فيها وسائل لمشاركة مفتاح بشكل آمن مع كل جهاز متصل، لذلك فهو لا يحل محل البنية التحتية للمفتاح العام (PKI) لمعظم استخدامات TLS. شهد تطبيق TLS-PSK في OpenSSL العديد من العيوب الأمنية في السنوات الأخيرة، ويرجع ذلك في الغالب إلى استخدامه فقط من قبل أقلية من التطبيقات. يرجى النظر في جميع الحلول البديلة قبل التبديل إلى شيفرات PSK. عند إنشاء PSK، من الأهمية بمكان استخدام إنتروبيا كافية كما هو موضح في <a href="https://tools.ietf.org/html/rfc4086" target="_blank" rel="noreferrer">RFC 4086</a>. إن اشتقاق سر مشترك من كلمة مرور أو مصادر أخرى منخفضة الإنتروبيا ليس آمنًا.</p><p>يتم تعطيل شيفرات PSK افتراضيًا، وبالتالي فإن استخدام TLS-PSK يتطلب تحديد مجموعة شيفرات بشكل صريح باستخدام خيار <code>ciphers</code>. يمكن استرداد قائمة الشيفرات المتاحة عبر <code>openssl ciphers -v &#39;PSK&#39;</code>. جميع شيفرات TLS 1.3 مؤهلة لـ PSK ويمكن استردادها عبر <code>openssl ciphers -v -s -tls1_3 -psk</code>. عند اتصال العميل، يجب تمرير <code>checkServerIdentity</code> مخصص لأن الإعداد الافتراضي سيفشل في حالة عدم وجود شهادة.</p><p>وفقًا لـ <a href="https://tools.ietf.org/html/rfc4279" target="_blank" rel="noreferrer">RFC 4279</a>، يجب دعم هويات PSK التي يصل طولها إلى 128 بايتًا و PSK التي يصل طولها إلى 64 بايتًا. اعتبارًا من OpenSSL 1.1.0، يبلغ الحد الأقصى لحجم الهوية 128 بايتًا، والحد الأقصى لطول PSK هو 256 بايتًا.</p><p>لا يدعم التنفيذ الحالي ردود نداء PSK غير المتزامنة بسبب قيود OpenSSL API الأساسي.</p><p>لاستخدام TLS-PSK، يجب على العميل والخادم تحديد خيار <code>pskCallback</code>، وهي دالة تُرجع PSK المراد استخدامه (والذي يجب أن يكون متوافقًا مع ملخص الشيفرة المحدد).</p><p>سيتم استدعاؤه أولاً على العميل:</p><ul><li>hint: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> رسالة اختيارية مرسلة من الخادم لمساعدة العميل على تحديد الهوية التي سيتم استخدامها أثناء التفاوض. دائمًا <code>null</code> إذا تم استخدام TLS 1.3.</li><li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> في شكل <code>{ psk: \\&lt;Buffer|TypedArray|DataView\\&gt;, identity: \\&lt;string\\&gt; }</code> أو <code>null</code>.</li></ul><p>ثم على الخادم:</p><ul><li>socket: <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a> مثيل مقبس الخادم، وهو مكافئ لـ <code>this</code>.</li><li>identity: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> معلمة الهوية المرسلة من العميل.</li><li>Returns: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> PSK (أو <code>null</code>).</li></ul><p>تؤدي القيمة المرجعية <code>null</code> إلى إيقاف عملية التفاوض وإرسال رسالة تنبيه <code>unknown_psk_identity</code> إلى الطرف الآخر. إذا كان الخادم يرغب في إخفاء حقيقة أن هوية PSK غير معروفة، فيجب على رد النداء توفير بعض البيانات العشوائية كـ <code>psk</code> لجعل الاتصال يفشل مع <code>decrypt_error</code> قبل انتهاء التفاوض.</p><h3 id="client-initiated-renegotiation-attack-mitigation" tabindex="-1">تخفيف هجمات إعادة التفاوض التي يبدأها العميل <a class="header-anchor" href="#client-initiated-renegotiation-attack-mitigation" aria-label="Permalink to “تخفيف هجمات إعادة التفاوض التي يبدأها العميل”">​</a></h3><p>يسمح بروتوكول TLS للعملاء بإعادة التفاوض على جوانب معينة من جلسة TLS. لسوء الحظ، تتطلب إعادة التفاوض على الجلسة قدرًا غير متناسب من موارد جانب الخادم، مما يجعلها ناقلًا محتملًا لهجمات رفض الخدمة.</p><p>للتخفيف من المخاطر، تقتصر إعادة التفاوض على ثلاث مرات كل عشر دقائق. يتم إصدار حدث <code>&#39;error&#39;</code> على مثيل <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a> عند تجاوز هذا الحد. الحدود قابلة للتكوين:</p><ul><li><code>tls.CLIENT_RENEG_LIMIT</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> يحدد عدد طلبات إعادة التفاوض. <strong>افتراضي:</strong> <code>3</code>.</li><li><code>tls.CLIENT_RENEG_WINDOW</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> يحدد نافذة إعادة التفاوض الزمنية بالثواني. <strong>افتراضي:</strong> <code>600</code> (10 دقائق).</li></ul><p>يجب عدم تعديل حدود إعادة التفاوض الافتراضية دون فهم كامل للآثار والمخاطر.</p><p>لا يدعم TLSv1.3 إعادة التفاوض.</p><h3 id="session-resumption" tabindex="-1">استئناف الجلسة <a class="header-anchor" href="#session-resumption" aria-label="Permalink to “استئناف الجلسة”">​</a></h3><p>يمكن أن يكون إنشاء جلسة TLS بطيئًا نسبيًا. يمكن تسريع العملية عن طريق حفظ حالة الجلسة وإعادة استخدامها لاحقًا. هناك عدة آليات للقيام بذلك، تتم مناقشتها هنا من الأقدم إلى الأحدث (والأفضل).</p><h4 id="session-identifiers" tabindex="-1">معرفات الجلسة <a class="header-anchor" href="#session-identifiers" aria-label="Permalink to “معرفات الجلسة”">​</a></h4><p>تقوم الخوادم بإنشاء معرف فريد للاتصالات الجديدة وإرساله إلى العميل. يحفظ العملاء والخوادم حالة الجلسة. عند إعادة الاتصال، يرسل العملاء معرف حالة الجلسة المحفوظة الخاصة بهم، وإذا كانت الخادم يحتوي أيضًا على حالة لهذا المعرف، فيمكنه الموافقة على استخدامه. وإلا، فستقوم الخادم بإنشاء جلسة جديدة. راجع <a href="https://www.ietf.org/rfc/rfc2246.txt" target="_blank" rel="noreferrer">RFC 2246</a> لمزيد من المعلومات، صفحة 23 و 30.</p><p>يتم دعم الاستئناف باستخدام معرفات الجلسة من قبل معظم متصفحات الويب عند إجراء طلبات HTTPS.</p><p>بالنسبة إلى Node.js، ينتظر العملاء حدث <a href="/ar/nodejs/api/tls#event-session"><code>&#39;session&#39;</code></a> للحصول على بيانات الجلسة، ويوفرون البيانات لخيار <code>session</code> الخاص بـ <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> اللاحق لإعادة استخدام الجلسة. يجب على الخوادم تنفيذ معالجات لأحداث <a href="/ar/nodejs/api/tls#event-newsession"><code>&#39;newSession&#39;</code></a> و <a href="/ar/nodejs/api/tls#event-resumesession"><code>&#39;resumeSession&#39;</code></a> لحفظ واستعادة بيانات الجلسة باستخدام معرف الجلسة كمفتاح البحث لإعادة استخدام الجلسات. لإعادة استخدام الجلسات عبر موازنات التحميل أو العاملين في المجموعة، يجب على الخوادم استخدام ذاكرة تخزين مؤقت للجلسة مشتركة (مثل Redis) في معالجات الجلسة الخاصة بهم.</p><h4 id="session-tickets" tabindex="-1">تذاكر الجلسة <a class="header-anchor" href="#session-tickets" aria-label="Permalink to “تذاكر الجلسة”">​</a></h4><p>تقوم الخوادم بتشفير حالة الجلسة بأكملها وإرسالها إلى العميل على شكل &quot;تذكرة&quot;. عند إعادة الاتصال، يتم إرسال الحالة إلى الخادم في الاتصال الأولي. تتجنب هذه الآلية الحاجة إلى ذاكرة تخزين مؤقت للجلسة من جانب الخادم. إذا لم يستخدم الخادم التذكرة، لأي سبب (فشل في فك تشفيرها، أو أنها قديمة جدًا، وما إلى ذلك)، فسيقوم بإنشاء جلسة جديدة وإرسال تذكرة جديدة. راجع <a href="https://tools.ietf.org/html/rfc5077" target="_blank" rel="noreferrer">RFC 5077</a> لمزيد من المعلومات.</p><p>أصبح الاستئناف باستخدام تذاكر الجلسة مدعومًا بشكل شائع من قبل العديد من متصفحات الويب عند إجراء طلبات HTTPS.</p><p>بالنسبة إلى Node.js، يستخدم العملاء نفس واجهات برمجة التطبيقات (APIs) للاستئناف باستخدام معرفات الجلسة كما هو الحال للاستئناف باستخدام تذاكر الجلسة. لأغراض التصحيح، إذا أعادت <a href="/ar/nodejs/api/tls#tlssocketgettlsticket"><code>tls.TLSSocket.getTLSTicket()</code></a> قيمة، فإن بيانات الجلسة تحتوي على تذكرة، وإلا فإنها تحتوي على حالة جلسة من جانب العميل.</p><p>مع TLSv1.3، كن على علم بأنه قد يتم إرسال عدة تذاكر من قبل الخادم، مما يؤدي إلى أحداث <code>&#39;session&#39;</code> متعددة، راجع <a href="/ar/nodejs/api/tls#event-session"><code>&#39;session&#39;</code></a> لمزيد من المعلومات.</p><p>لا تحتاج خوادم العملية الواحدة إلى تنفيذ محدد لاستخدام تذاكر الجلسة. لاستخدام تذاكر الجلسة عبر إعادة تشغيل الخادم أو موازنات التحميل، يجب أن تمتلك جميع الخوادم نفس مفاتيح التذاكر. هناك ثلاثة مفاتيح داخلية بحجم 16 بايت، ولكن واجهة برمجة التطبيقات (API) الخاصة بـ tls تعرضها كمخزن مؤقت واحد بحجم 48 بايت لراحة المستخدم.</p><p>من الممكن الحصول على مفاتيح التذاكر عن طريق استدعاء <a href="/ar/nodejs/api/tls#servergetticketkeys"><code>server.getTicketKeys()</code></a> على مثيل خادم واحد ثم توزيعها، ولكن من المعقول أكثر إنشاء 48 بايت من البيانات العشوائية الآمنة بشكل آمن وتعيينها باستخدام خيار <code>ticketKeys</code> الخاص بـ <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a>. يجب إعادة إنشاء المفاتيح بانتظام ويمكن إعادة تعيين مفاتيح الخادم باستخدام <a href="/ar/nodejs/api/tls#serversetticketkeyskeys"><code>server.setTicketKeys()</code></a>.</p><p>مفاتيح تذاكر الجلسة هي مفاتيح تشفير، و <em><strong>يجب تخزينها بشكل آمن</strong></em>. مع TLS 1.2 والإصدارات الأقدم، إذا تم اختراقها، فيمكن فك تشفير جميع الجلسات التي استخدمت التذاكر المشفرة بها. يجب عدم تخزينها على القرص، ويجب إعادة إنشائها بانتظام.</p><p>إذا أعلن العملاء عن دعمهم للتذاكر، فسيرسلها الخادم. يمكن للخادم تعطيل التذاكر عن طريق توفير <code>require(&#39;node:constants&#39;).SSL_OP_NO_TICKET</code> في <code>secureOptions</code>.</p><p>تنتهي صلاحية كل من معرفات الجلسة وتذاكر الجلسة، مما يتسبب في قيام الخادم بإنشاء جلسات جديدة. يمكن تكوين المهلة باستخدام خيار <code>sessionTimeout</code> الخاص بـ <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a>.</p><p>بالنسبة لجميع الآليات، عندما يفشل الاستئناف، ستقوم الخوادم بإنشاء جلسات جديدة. نظرًا لأن الفشل في استئناف الجلسة لا يتسبب في فشل اتصال TLS/HTTPS، فمن السهل عدم ملاحظة ضعف أداء TLS غير الضروري. يمكن استخدام OpenSSL CLI للتحقق من أن الخوادم تستأنف الجلسات. استخدم الخيار <code>-reconnect</code> لـ <code>openssl s_client</code>، على سبيل المثال:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -reconnect</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>اقرأ مخرجات التصحيح. يجب أن يقول الاتصال الأول &quot;New&quot;، على سبيل المثال:</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>New, TLSv1.2, Cipher is ECDHE-RSA-AES128-GCM-SHA256</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>يجب أن تقول الاتصالات اللاحقة &quot;Reused&quot;، على سبيل المثال:</p><div class="language-text line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Reused, TLSv1.2, Cipher is ECDHE-RSA-AES128-GCM-SHA256</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="modifying-the-default-tls-cipher-suite" tabindex="-1">تعديل مجموعة تشفير TLS الافتراضية <a class="header-anchor" href="#modifying-the-default-tls-cipher-suite" aria-label="Permalink to “تعديل مجموعة تشفير TLS الافتراضية”">​</a></h2><p>تم تصميم Node.js مع مجموعة افتراضية من تشفيرات TLS الممكنة والمعطلة. يمكن تكوين قائمة التشفير الافتراضية هذه عند بناء Node.js للسماح للتوزيعات بتوفير قائمتها الافتراضية الخاصة.</p><p>يمكن استخدام الأمر التالي لإظهار مجموعة التشفير الافتراضية:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crypto.constants.defaultCoreCipherList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;:&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;\\n&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TLS_AES_256_GCM_SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TLS_CHACHA20_POLY1305_SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TLS_AES_128_GCM_SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES128-GCM-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-ECDSA-AES128-GCM-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES256-GCM-SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-ECDSA-AES256-GCM-SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DHE-RSA-AES128-GCM-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES128-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DHE-RSA-AES128-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES256-SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DHE-RSA-AES256-SHA384</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES256-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DHE-RSA-AES256-SHA256</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HIGH</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aNULL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eNULL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EXPORT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DES</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RC4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MD5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PSK</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SRP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CAMELLIA</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>يمكن استبدال هذا الإعداد الافتراضي بالكامل باستخدام مفتاح سطر الأوامر <a href="/ar/nodejs/api/cli#tls-cipher-listlist"><code>--tls-cipher-list</code></a> (مباشرة ، أو عبر متغير البيئة <a href="/ar/nodejs/api/cli#node-optionsoptions"><code>NODE_OPTIONS</code></a>). على سبيل المثال ، يجعل ما يلي <code>ECDHE-RSA-AES128-GCM-SHA256:!RC4</code> مجموعة تشفير TLS الافتراضية:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-cipher-list=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ECDHE-RSA-AES128-GCM-SHA256:!RC4&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NODE_OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--tls-cipher-list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ECDHE-RSA-AES128-GCM-SHA256:!RC4&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>للتحقق ، استخدم الأمر التالي لإظهار قائمة التشفير المحددة ، لاحظ الفرق بين <code>defaultCoreCipherList</code> و <code>defaultCipherList</code>:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tls-cipher-list=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ECDHE-RSA-AES128-GCM-SHA256:!RC4&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> crypto.constants.defaultCipherList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;:&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;\\n&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ECDHE-RSA-AES128-GCM-SHA256</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RC4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>على سبيل المثال. يتم تعيين قائمة <code>defaultCoreCipherList</code> في وقت التحويل البرمجي ويتم تعيين <code>defaultCipherList</code> في وقت التشغيل.</p><p>لتعديل مجموعات التشفير الافتراضية من داخل وقت التشغيل ، قم بتعديل المتغير <code>tls.DEFAULT_CIPHERS</code> ، يجب إجراء ذلك قبل الاستماع إلى أي مآخذ توصيل ، ولن يؤثر على مآخذ التوصيل المفتوحة بالفعل. على سبيل المثال:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remove Obsolete CBC Ciphers and RSA Key Exchange based Ciphers as they don&#39;t provide Forward Secrecy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tls.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DEFAULT_CIPHERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +=</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;:!ECDHE-RSA-AES128-SHA:!ECDHE-RSA-AES128-SHA256:!ECDHE-RSA-AES256-SHA:!ECDHE-RSA-AES256-SHA384&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;:!ECDHE-ECDSA-AES128-SHA:!ECDHE-ECDSA-AES128-SHA256:!ECDHE-ECDSA-AES256-SHA:!ECDHE-ECDSA-AES256-SHA384&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;:!kRSA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>يمكن أيضًا استبدال الإعداد الافتراضي على أساس كل عميل أو خادم باستخدام خيار <code>ciphers</code> من <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>، والذي يتوفر أيضًا في <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a> و <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> وعند إنشاء <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a> جديدة.</p><p>يمكن أن تحتوي قائمة التشفير على مزيج من أسماء مجموعة تشفير TLSv1.3 ، وتلك التي تبدأ بـ <code>&#39;TLS_&#39;</code> ، ومواصفات لمجموعات تشفير TLSv1.2 والإصدارات الأقدم. يدعم تشفير TLSv1.2 تنسيق مواصفات قديم ، راجع وثائق OpenSSL <a href="https://www.openssl.org/docs/man1.1.1/man1/ciphers#CIPHER-LIST-FORMAT" target="_blank" rel="noreferrer">تنسيق قائمة التشفير</a> للحصول على التفاصيل ، ولكن هذه المواصفات <em>لا</em> تنطبق على تشفيرات TLSv1.3. لا يمكن تمكين مجموعات TLSv1.3 إلا من خلال تضمين اسمها الكامل في قائمة التشفير. لا يمكن ، على سبيل المثال ، تمكينها أو تعطيلها باستخدام مواصفات TLSv1.2 القديمة <code>&#39;EECDH&#39;</code> أو <code>&#39;!EECDH&#39;</code>.</p><p>على الرغم من الترتيب النسبي لمجموعات تشفير TLSv1.3 و TLSv1.2 ، فإن بروتوكول TLSv1.3 أكثر أمانًا بشكل ملحوظ من TLSv1.2 ، وسيتم اختياره دائمًا على TLSv1.2 إذا كانت المصافحة تشير إلى أنه مدعوم ، وإذا تم تمكين أي مجموعات تشفير TLSv1.3.</p><p>تم تحديد مجموعة التشفير الافتراضية المضمنة في Node.js بعناية لتعكس أفضل الممارسات الأمنية الحالية وتخفيف المخاطر. يمكن أن يكون لتغيير مجموعة التشفير الافتراضية تأثير كبير على أمان التطبيق. يجب استخدام مفتاح <code>--tls-cipher-list</code> وخيار <code>ciphers</code> فقط إذا كان ذلك ضروريًا للغاية.</p><p>تفضل مجموعة التشفير الافتراضية تشفيرات GCM لإعداد <a href="https://www.chromium.org/Home/chromium-security/education/tls#TOC-Cipher-Suites" target="_blank" rel="noreferrer">Chrome &#39;التشفير الحديث&#39;</a> وتفضل أيضًا تشفيرات ECDHE و DHE للسرية الأمامية المثالية ، مع تقديم <em>بعض</em> التوافق مع الإصدارات السابقة.</p><p>لا يمكن للعملاء القدامى الذين يعتمدون على تشفيرات RC4 أو DES غير الآمنة والقديمة (مثل Internet Explorer 6) إكمال عملية المصافحة بالتكوين الافتراضي. إذا كان <em>يجب</em> دعم هؤلاء العملاء ، فقد تقدم <a href="https://wiki.mozilla.org/Security/Server_Side_TLS" target="_blank" rel="noreferrer">توصيات TLS</a> مجموعة تشفير متوافقة. لمزيد من التفاصيل حول التنسيق ، راجع وثائق OpenSSL <a href="https://www.openssl.org/docs/man1.1.1/man1/ciphers#CIPHER-LIST-FORMAT" target="_blank" rel="noreferrer">تنسيق قائمة التشفير</a>.</p><p>لا يوجد سوى خمس مجموعات تشفير TLSv1.3:</p><ul><li><code>&#39;TLS_AES_256_GCM_SHA384&#39;</code></li><li><code>&#39;TLS_CHACHA20_POLY1305_SHA256&#39;</code></li><li><code>&#39;TLS_AES_128_GCM_SHA256&#39;</code></li><li><code>&#39;TLS_AES_128_CCM_SHA256&#39;</code></li><li><code>&#39;TLS_AES_128_CCM_8_SHA256&#39;</code></li></ul><p>يتم تمكين الثلاثة الأولى افتراضيًا. تدعم TLSv1.3 مجموعات <code>CCM</code> ، لأنها قد تكون أكثر فعالية من حيث الأداء على الأنظمة المقيدة ، ولكنها غير ممكنة افتراضيًا لأنها توفر أمانًا أقل.</p><h2 id="openssl-security-level" tabindex="-1">مستوى أمان OpenSSL <a class="header-anchor" href="#openssl-security-level" aria-label="Permalink to “مستوى أمان OpenSSL”">​</a></h2><p>تفرض مكتبة OpenSSL مستويات أمان للتحكم في الحد الأدنى المقبول من الأمان للعمليات المشفرة. تتراوح مستويات أمان OpenSSL من 0 إلى 5، حيث يفرض كل مستوى متطلبات أمان أكثر صرامة. مستوى الأمان الافتراضي هو 1، وهو مناسب بشكل عام لمعظم التطبيقات الحديثة. ومع ذلك، تتطلب بعض الميزات والبروتوكولات القديمة، مثل TLSv1، مستوى أمان أقل (<code>SECLEVEL=0</code>) لكي تعمل بشكل صحيح. لمزيد من المعلومات التفصيلية، يرجى الرجوع إلى <a href="https://www.openssl.org/docs/manmaster/man3/SSL_CTX_set_security_level#DEFAULT-CALLBACK-BEHAVIOUR" target="_blank" rel="noreferrer">وثائق OpenSSL حول مستويات الأمان</a>.</p><h3 id="setting-security-levels" tabindex="-1">تعيين مستويات الأمان <a class="header-anchor" href="#setting-security-levels" aria-label="Permalink to “تعيين مستويات الأمان”">​</a></h3><p>لضبط مستوى الأمان في تطبيق Node.js الخاص بك، يمكنك تضمين <code>@SECLEVEL=X</code> داخل سلسلة تشفير، حيث <code>X</code> هو مستوى الأمان المطلوب. على سبيل المثال، لتعيين مستوى الأمان إلى 0 أثناء استخدام قائمة تشفير OpenSSL الافتراضية، يمكنك استخدام:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-368" id="tab-369" checked><label data-title="ESM" for="tab-369">ESM</label><input type="radio" name="group-368" id="tab-370"><label data-title="CJS" for="tab-370">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createServer, connect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ ciphers: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEFAULT@SECLEVEL=0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TLSv1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Client connected with protocol:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, { ciphers: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEFAULT@SECLEVEL=0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, maxVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TLSv1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ ciphers: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEFAULT@SECLEVEL=0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TLSv1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Client connected with protocol:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port, { ciphers: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEFAULT@SECLEVEL=0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, maxVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;TLSv1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><p>يؤدي هذا النهج إلى تعيين مستوى الأمان إلى 0، مما يسمح باستخدام الميزات القديمة مع الاستمرار في الاستفادة من تشفير OpenSSL الافتراضي.</p><h3 id="using" tabindex="-1">استخدام <a class="header-anchor" href="#using" aria-label="Permalink to “استخدام”">​</a></h3><p>يمكنك أيضًا تعيين مستوى الأمان والتشفير من سطر الأوامر باستخدام <code>--tls-cipher-list=DEFAULT@SECLEVEL=X</code> كما هو موضح في <a href="/ar/nodejs/api/tls#modifying-the-default-tls-cipher-suite">تعديل مجموعة تشفير TLS الافتراضية</a>. ومع ذلك، يُنصح عمومًا بعدم استخدام خيار سطر الأوامر لتعيين التشفير ويفضل تكوين التشفير للسياقات الفردية داخل كود التطبيق الخاص بك، حيث يوفر هذا النهج تحكمًا أفضل ويقلل من خطر تخفيض مستوى الأمان عالميًا.</p><h2 id="x509-certificate-error-codes" tabindex="-1">رموز أخطاء شهادات X509 <a class="header-anchor" href="#x509-certificate-error-codes" aria-label="Permalink to “رموز أخطاء شهادات X509”">​</a></h2><p>يمكن أن تفشل وظائف متعددة بسبب أخطاء الشهادات التي يتم الإبلاغ عنها بواسطة OpenSSL. في مثل هذه الحالة، توفر الوظيفة <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;Error&gt;</a> عبر رد الاتصال الخاص بها والتي تحتوي على خاصية <code>code</code> يمكن أن تأخذ إحدى القيم التالية:</p><ul><li><code>&#39;UNABLE_TO_GET_ISSUER_CERT&#39;</code>: غير قادر على الحصول على شهادة الجهة المصدرة.</li><li><code>&#39;UNABLE_TO_GET_CRL&#39;</code>: غير قادر على الحصول على CRL الشهادة.</li><li><code>&#39;UNABLE_TO_DECRYPT_CERT_SIGNATURE&#39;</code>: غير قادر على فك تشفير توقيع الشهادة.</li><li><code>&#39;UNABLE_TO_DECRYPT_CRL_SIGNATURE&#39;</code>: غير قادر على فك تشفير توقيع CRL.</li><li><code>&#39;UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY&#39;</code>: غير قادر على فك ترميز المفتاح العام للمصدر.</li><li><code>&#39;CERT_SIGNATURE_FAILURE&#39;</code>: فشل توقيع الشهادة.</li><li><code>&#39;CRL_SIGNATURE_FAILURE&#39;</code>: فشل توقيع CRL.</li><li><code>&#39;CERT_NOT_YET_VALID&#39;</code>: الشهادة ليست صالحة بعد.</li><li><code>&#39;CERT_HAS_EXPIRED&#39;</code>: الشهادة منتهية الصلاحية.</li><li><code>&#39;CRL_NOT_YET_VALID&#39;</code>: CRL ليست صالحة بعد.</li><li><code>&#39;CRL_HAS_EXPIRED&#39;</code>: CRL منتهية الصلاحية.</li><li><code>&#39;ERROR_IN_CERT_NOT_BEFORE_FIELD&#39;</code>: خطأ في تنسيق حقل notBefore للشهادة.</li><li><code>&#39;ERROR_IN_CERT_NOT_AFTER_FIELD&#39;</code>: خطأ في تنسيق حقل notAfter للشهادة.</li><li><code>&#39;ERROR_IN_CRL_LAST_UPDATE_FIELD&#39;</code>: خطأ في تنسيق حقل lastUpdate لـ CRL.</li><li><code>&#39;ERROR_IN_CRL_NEXT_UPDATE_FIELD&#39;</code>: خطأ في تنسيق حقل nextUpdate لـ CRL.</li><li><code>&#39;OUT_OF_MEM&#39;</code>: نفاد الذاكرة.</li><li><code>&#39;DEPTH_ZERO_SELF_SIGNED_CERT&#39;</code>: شهادة موقعة ذاتيًا.</li><li><code>&#39;SELF_SIGNED_CERT_IN_CHAIN&#39;</code>: شهادة موقعة ذاتيًا في سلسلة الشهادات.</li><li><code>&#39;UNABLE_TO_GET_ISSUER_CERT_LOCALLY&#39;</code>: غير قادر على الحصول على شهادة المصدر المحلية.</li><li><code>&#39;UNABLE_TO_VERIFY_LEAF_SIGNATURE&#39;</code>: غير قادر على التحقق من الشهادة الأولى.</li><li><code>&#39;CERT_CHAIN_TOO_LONG&#39;</code>: سلسلة الشهادات طويلة جدًا.</li><li><code>&#39;CERT_REVOKED&#39;</code>: الشهادة ملغاة.</li><li><code>&#39;INVALID_CA&#39;</code>: شهادة CA غير صالحة.</li><li><code>&#39;PATH_LENGTH_EXCEEDED&#39;</code>: تجاوز قيد طول المسار.</li><li><code>&#39;INVALID_PURPOSE&#39;</code>: غرض الشهادة غير مدعوم.</li><li><code>&#39;CERT_UNTRUSTED&#39;</code>: الشهادة غير موثوق بها.</li><li><code>&#39;CERT_REJECTED&#39;</code>: الشهادة مرفوضة.</li><li><code>&#39;HOSTNAME_MISMATCH&#39;</code>: عدم تطابق اسم المضيف.</li></ul><h2 id="class-tlscryptostream" tabindex="-1">الفئة: <code>tls.CryptoStream</code> <a class="header-anchor" href="#class-tlscryptostream" aria-label="Permalink to “الفئة: tls.CryptoStream”">​</a></h2><p><strong>أضيف في: v0.3.4</strong></p><p><strong>تم الإهمال منذ: v0.11.3</strong></p><div class="danger custom-block"><p class="custom-block-title">[مستقر: 0 - مهمل]</p><p><a href="/ar/nodejs/api/documentation#stability-index">مستقر: 0</a> <a href="/ar/nodejs/api/documentation#stability-index">الاستقرار: 0</a> - مهمل: استخدم <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a> بدلاً من ذلك.</p></div><p>تمثل الفئة <code>tls.CryptoStream</code> دفقًا من البيانات المشفرة. هذه الفئة مهملة ولا ينبغي استخدامها بعد الآن.</p><h3 id="cryptostreambyteswritten" tabindex="-1"><code>cryptoStream.bytesWritten</code> <a class="header-anchor" href="#cryptostreambyteswritten" aria-label="Permalink to “cryptoStream.bytesWritten”">​</a></h3><p><strong>أضيف في: v0.3.4</strong></p><p><strong>تم الإهمال منذ: v0.11.3</strong></p><p>تعيد الخاصية <code>cryptoStream.bytesWritten</code> إجمالي عدد البايتات المكتوبة إلى المقبس الأساسي <em>بما في ذلك</em> البايتات المطلوبة لتنفيذ بروتوكول TLS.</p><h2 id="class-tlssecurepair" tabindex="-1">الفئة: <code>tls.SecurePair</code> <a class="header-anchor" href="#class-tlssecurepair" aria-label="Permalink to “الفئة: tls.SecurePair”">​</a></h2><p><strong>أضيف في: v0.3.2</strong></p><p><strong>تم الإهمال منذ: v0.11.3</strong></p><div class="danger custom-block"><p class="custom-block-title">[مستقر: 0 - مهمل]</p><p><a href="/ar/nodejs/api/documentation#stability-index">مستقر: 0</a> <a href="/ar/nodejs/api/documentation#stability-index">الاستقرار: 0</a> - مهمل: استخدم <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a> بدلاً من ذلك.</p></div><p>تم إرجاعه بواسطة <a href="/ar/nodejs/api/tls#tlscreatesecurepaircontext-isserver-requestcert-rejectunauthorized-options"><code>tls.createSecurePair()</code></a>.</p><h3 id="event-secure" tabindex="-1">الحدث: <code>&#39;secure&#39;</code> <a class="header-anchor" href="#event-secure" aria-label="Permalink to “الحدث: &#39;secure&#39;”">​</a></h3><p><strong>أضيف في: v0.3.2</strong></p><p><strong>تم الإهمال منذ: v0.11.3</strong></p><p>يتم إطلاق الحدث <code>&#39;secure&#39;</code> بواسطة كائن <code>SecurePair</code> بمجرد إنشاء اتصال آمن.</p><p>كما هو الحال مع التحقق من حدث <a href="/ar/nodejs/api/tls#event-secureconnection"><code>&#39;secureConnection&#39;</code></a> الخاص بالخادم، يجب فحص <code>pair.cleartext.authorized</code> للتأكد مما إذا كانت الشهادة المستخدمة مصرح بها بشكل صحيح.</p><h2 id="class-tlsserver" tabindex="-1">الفئة: <code>tls.Server</code> <a class="header-anchor" href="#class-tlsserver" aria-label="Permalink to “الفئة: tls.Server”">​</a></h2><p><strong>أضيف في: v0.3.2</strong></p><ul><li>يمتد: <a href="/ar/nodejs/api/net#class-netserver">&lt;net.Server&gt;</a></li></ul><p>يقبل الاتصالات المشفرة باستخدام TLS أو SSL.</p><h3 id="event-connection" tabindex="-1">الحدث: <code>&#39;connection&#39;</code> <a class="header-anchor" href="#event-connection" aria-label="Permalink to “الحدث: &#39;connection&#39;”">​</a></h3><p><strong>أضيف في: v0.3.2</strong></p><ul><li><code>socket</code> <a href="/ar/nodejs/api/stream#class-streamduplex">&lt;stream.Duplex&gt;</a></li></ul><p>يتم إطلاق هذا الحدث عند إنشاء دفق TCP جديد، قبل أن تبدأ مصافحة TLS. <code>socket</code> هو عادةً كائن من النوع <a href="/ar/nodejs/api/net#class-netsocket"><code>net.Socket</code></a> ولكن لن يتلقى أحداثًا على عكس المقبس الذي تم إنشاؤه من حدث <code>&#39;connection&#39;</code> الخاص بـ <a href="/ar/nodejs/api/net#class-netserver"><code>net.Server</code></a>. عادةً لا يرغب المستخدمون في الوصول إلى هذا الحدث.</p><p>يمكن أيضًا إطلاق هذا الحدث صراحةً من قبل المستخدمين لحقن الاتصالات في خادم TLS. في هذه الحالة، يمكن تمرير أي دفق <a href="/ar/nodejs/api/stream#class-streamduplex"><code>Duplex</code></a>.</p><h3 id="event-keylog" tabindex="-1">الحدث: <code>&#39;keylog&#39;</code> <a class="header-anchor" href="#event-keylog" aria-label="Permalink to “الحدث: &#39;keylog&#39;”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v12.3.0، الإصدار v10.20.0</strong></p><ul><li><code>line</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> سطر من نص ASCII، بتنسيق <code>SSLKEYLOGFILE</code> الخاص بـ NSS.</li><li><code>tlsSocket</code> <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a> مثيل <code>tls.TLSSocket</code> الذي تم إنشاؤه عليه.</li></ul><p>يتم إطلاق الحدث <code>keylog</code> عندما يتم إنشاء أو استقبال مادة مفتاح بواسطة اتصال بهذا الخادم (عادةً قبل اكتمال المصافحة، ولكن ليس بالضرورة). يمكن تخزين مادة المفتاح هذه لتصحيح الأخطاء، حيث إنها تسمح بفك تشفير حركة مرور TLS التي تم التقاطها. قد يتم إطلاقه عدة مرات لكل مقبس.</p><p>حالة الاستخدام النموذجية هي إلحاق الأسطر المستلمة بملف نصي مشترك، والذي يستخدمه برنامج لاحقًا (مثل Wireshark) لفك تشفير حركة المرور:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> logFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/tmp/ssl-keys.log&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { flags: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;keylog&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tlsSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (tlsSocket.remoteAddress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// سجل المفاتيح فقط لعنوان IP معين</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  logFile.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="event-newsession" tabindex="-1">الحدث: <code>&#39;newSession&#39;</code> <a class="header-anchor" href="#event-newsession" aria-label="Permalink to “الحدث: &#39;newSession&#39;”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>الإصدار v0.11.12</td><td>يتم الآن دعم وسيطة <code>callback</code>.</td></tr><tr><td>الإصدار v0.9.2</td><td>تمت الإضافة في: الإصدار v0.9.2</td></tr></tbody></table></div><p>يتم إطلاق الحدث <code>&#39;newSession&#39;</code> عند إنشاء جلسة TLS جديدة. يمكن استخدام هذا لتخزين الجلسات في وحدة تخزين خارجية. يجب توفير البيانات إلى استدعاء رد الاتصال <a href="/ar/nodejs/api/tls#event-resumesession"><code>&#39;resumeSession&#39;</code></a>.</p><p>يتم تمرير ثلاث وسيطات إلى معاودة الاتصال المستمع عند استدعائها:</p><ul><li><code>sessionId</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> معرف جلسة TLS</li><li><code>sessionData</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> بيانات جلسة TLS</li><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> دالة رد اتصال لا تأخذ أي وسيطات يجب استدعاؤها لكي يتم إرسال البيانات أو استقبالها عبر الاتصال الآمن.</li></ul><p>سيؤثر الاستماع إلى هذا الحدث فقط على الاتصالات التي تم إنشاؤها بعد إضافة مستمع الحدث.</p><h3 id="event-ocsprequest" tabindex="-1">الحدث: <code>&#39;OCSPRequest&#39;</code> <a class="header-anchor" href="#event-ocsprequest" aria-label="Permalink to “الحدث: &#39;OCSPRequest&#39;”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v0.11.13</strong></p><p>يتم إطلاق الحدث <code>&#39;OCSPRequest&#39;</code> عندما يرسل العميل طلبًا لحالة الشهادة. يتم تمرير ثلاث وسيطات إلى معاودة الاتصال المستمع عند استدعائها:</p><ul><li><code>certificate</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> شهادة الخادم</li><li><code>issuer</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> شهادة جهة الإصدار</li><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> دالة رد اتصال يجب استدعاؤها لتوفير نتائج طلب OCSP.</li></ul><p>يمكن تحليل شهادة الخادم الحالية للحصول على عنوان URL الخاص بـ OCSP ومعرف الشهادة؛ بعد الحصول على استجابة OCSP، يتم بعد ذلك استدعاء <code>callback(null, resp)</code>، حيث <code>resp</code> هو مثيل <code>Buffer</code> يحتوي على استجابة OCSP. كلا من <code>certificate</code> و <code>issuer</code> هما تمثيلات DER <code>Buffer</code> للشهادات الأساسية وشهادات جهة الإصدار. يمكن استخدامها للحصول على معرف شهادة OCSP وعنوان URL لنقطة نهاية OCSP.</p><p>بدلاً من ذلك، يمكن استدعاء <code>callback(null, null)</code>، مما يشير إلى عدم وجود استجابة OCSP.</p><p>سيؤدي استدعاء <code>callback(err)</code> إلى استدعاء <code>socket.destroy(err)</code>.</p><p>التدفق النموذجي لطلب OCSP هو كما يلي:</p><p>يمكن أن يكون <code>issuer</code> هو <code>null</code> إذا كانت الشهادة موقعة ذاتيًا أو إذا لم تكن جهة الإصدار موجودة في قائمة الشهادات الجذر. (يمكن توفير جهة إصدار عبر خيار <code>ca</code> عند إنشاء اتصال TLS.)</p><p>سيؤثر الاستماع إلى هذا الحدث فقط على الاتصالات التي تم إنشاؤها بعد إضافة مستمع الحدث.</p><p>يمكن استخدام وحدة npm مثل <a href="https://www.npmjs.com/package/asn1.js" target="_blank" rel="noreferrer">asn1.js</a> لتحليل الشهادات.</p><h3 id="event-resumesession" tabindex="-1">الحدث: <code>&#39;resumeSession&#39;</code> <a class="header-anchor" href="#event-resumesession" aria-label="Permalink to “الحدث: &#39;resumeSession&#39;”">​</a></h3><p><strong>تمت إضافته في: الإصدار v0.9.2</strong></p><p>يتم إصدار الحدث <code>&#39;resumeSession&#39;</code> عندما يطلب العميل استئناف جلسة TLS سابقة. يتم تمرير دالة الاستماع (listener callback) بوسيطتين عند استدعائها:</p><ul><li><code>sessionId</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> مُعرّف جلسة TLS</li><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> دالة رد نداء يتم استدعاؤها عند استعادة الجلسة السابقة: <code>callback([err[, sessionData]])</code><ul><li><code>err</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;Error&gt;</a></li><li><code>sessionData</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul></li></ul><p>يجب أن يبحث مستمع الحدث في وحدة تخزين خارجية عن <code>sessionData</code> التي تم حفظها بواسطة معالج الحدث <a href="/ar/nodejs/api/tls#event-newsession"><code>&#39;newSession&#39;</code></a> باستخدام <code>sessionId</code> المحدد. إذا تم العثور عليها، فقم باستدعاء <code>callback(null, sessionData)</code> لاستئناف الجلسة. إذا لم يتم العثور عليها، فلا يمكن استئناف الجلسة. يجب استدعاء <code>callback()</code> بدون <code>sessionData</code> حتى يمكن أن تستمر المصافحة (handshake) وإنشاء جلسة جديدة. من الممكن استدعاء <code>callback(err)</code> لإنهاء الاتصال الوارد وتدمير المقبس (socket).</p><p>الاستماع إلى هذا الحدث سيكون له تأثير فقط على الاتصالات التي يتم إنشاؤها بعد إضافة مستمع الحدث.</p><p>يوضح ما يلي استئناف جلسة TLS:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tlsSessionStore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;newSession&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tlsSessionStore[id.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hex&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;resumeSession&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tlsSessionStore[id.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hex&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="event-secureconnection" tabindex="-1">الحدث: <code>&#39;secureConnection&#39;</code> <a class="header-anchor" href="#event-secureconnection" aria-label="Permalink to “الحدث: &#39;secureConnection&#39;”">​</a></h3><p><strong>تمت إضافته في: الإصدار v0.3.2</strong></p><p>يتم إصدار الحدث <code>&#39;secureConnection&#39;</code> بعد اكتمال عملية المصافحة لاتصال جديد بنجاح. يتم تمرير دالة الاستماع (listener callback) بوسيطة واحدة عند استدعائها:</p><ul><li><code>tlsSocket</code> <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a> مقبس TLS المنشأ.</li></ul><p>الخاصية <code>tlsSocket.authorized</code> هي قيمة <code>boolean</code> تشير إلى ما إذا كان قد تم التحقق من العميل بواسطة إحدى جهات إصدار الشهادات (Certificate Authorities) المقدمة للخادم. إذا كانت قيمة <code>tlsSocket.authorized</code> هي <code>false</code>، فسيتم تعيين <code>socket.authorizationError</code> لوصف كيفية فشل التفويض. بناءً على إعدادات خادم TLS، قد تظل الاتصالات غير المصرح بها مقبولة.</p><p>الخاصية <code>tlsSocket.alpnProtocol</code> هي سلسلة تحتوي على بروتوكول ALPN المحدد. عندما لا يكون لـ ALPN بروتوكول محدد لأن العميل أو الخادم لم يرسل امتداد ALPN، فإن <code>tlsSocket.alpnProtocol</code> تساوي <code>false</code>.</p><p>الخاصية <code>tlsSocket.servername</code> هي سلسلة تحتوي على اسم الخادم المطلوب عبر SNI.</p><h3 id="event-tlsclienterror" tabindex="-1">الحدث: <code>&#39;tlsClientError&#39;</code> <a class="header-anchor" href="#event-tlsclienterror" aria-label="Permalink to “الحدث: &#39;tlsClientError&#39;”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v6.0.0</strong></p><p>يتم إصدار الحدث <code>&#39;tlsClientError&#39;</code> عند حدوث خطأ قبل إنشاء اتصال آمن. يتم تمرير وسيطتين إلى دالة رد الاتصال للمستمع عند استدعائها:</p><ul><li><code>exception</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;Error&gt;</a> كائن <code>Error</code> يصف الخطأ.</li><li><code>tlsSocket</code> <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a> مثيل <code>tls.TLSSocket</code> الذي نشأ منه الخطأ.</li></ul><h3 id="serveraddcontexthostname-context" tabindex="-1"><code>server.addContext(hostname, context)</code> <a class="header-anchor" href="#serveraddcontexthostname-context" aria-label="Permalink to “server.addContext(hostname, context)”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v0.5.3</strong></p><ul><li><code>hostname</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم مضيف SNI أو حرف بدل (مثل <code>&#39;*&#39;</code>).</li><li><code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> | <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions">&lt;tls.SecureContext&gt;</a> كائن يحتوي على أي من الخصائص المحتملة من وسائط <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> <code>options</code> (مثل <code>key</code> و <code>cert</code> و <code>ca</code> وما إلى ذلك)، أو كائن سياق TLS تم إنشاؤه باستخدام <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> نفسه.</li></ul><p>تضيف الطريقة <code>server.addContext()</code> سياقًا آمنًا سيتم استخدامه إذا كان اسم SNI لطلب العميل يطابق <code>hostname</code> (أو حرف البدل) المحدد.</p><p>عند وجود سياقات مطابقة متعددة، يتم استخدام السياق الذي تمت إضافته مؤخرًا.</p><h3 id="serveraddress" tabindex="-1"><code>server.address()</code> <a class="header-anchor" href="#serveraddress" aria-label="Permalink to “server.address()”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v0.6.0</strong></p><ul><li>إرجاع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>إرجاع العنوان المرتبط واسم عائلة العناوين ومنفذ الخادم كما أبلغ عنها نظام التشغيل. راجع <a href="/ar/nodejs/api/net#serveraddress"><code>net.Server.address()</code></a> لمزيد من المعلومات.</p><h3 id="serverclosecallback" tabindex="-1"><code>server.close([callback])</code> <a class="header-anchor" href="#serverclosecallback" aria-label="Permalink to “server.close([callback])”">​</a></h3><p><strong>تمت الإضافة في: الإصدار v0.3.2</strong></p><ul><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> دالة رد الاتصال للمستمع التي سيتم تسجيلها للاستماع إلى حدث <code>&#39;close&#39;</code> لمثيل الخادم.</li><li>إرجاع: <a href="/ar/nodejs/api/tls#class-tlsserver">&lt;tls.Server&gt;</a></li></ul><p>تمنع الطريقة <code>server.close()</code> الخادم من قبول اتصالات جديدة.</p><p>تعمل هذه الوظيفة بشكل غير متزامن. سيتم إصدار الحدث <code>&#39;close&#39;</code> عندما لا يكون للخادم أي اتصالات مفتوحة أخرى.</p><h3 id="servergetticketkeys" tabindex="-1"><code>server.getTicketKeys()</code> <a class="header-anchor" href="#servergetticketkeys" aria-label="Permalink to “server.getTicketKeys()”">​</a></h3><p><strong>تمت الإضافة في: v3.0.0</strong></p><ul><li>Returns: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> مخزن مؤقت بحجم 48 بايت يحتوي على مفاتيح تذاكر الجلسة.</li></ul><p>إرجاع مفاتيح تذاكر الجلسة.</p><p>انظر <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><h3 id="serverlisten" tabindex="-1"><code>server.listen()</code> <a class="header-anchor" href="#serverlisten" aria-label="Permalink to “server.listen()”">​</a></h3><p>يبدأ الخادم في الاستماع للاتصالات المشفرة. هذه الطريقة مماثلة لـ <a href="/ar/nodejs/api/net#serverlisten"><code>server.listen()</code></a> من <a href="/ar/nodejs/api/net#class-netserver"><code>net.Server</code></a>.</p><h3 id="serversetsecurecontextoptions" tabindex="-1"><code>server.setSecureContext(options)</code> <a class="header-anchor" href="#serversetsecurecontextoptions" aria-label="Permalink to “server.setSecureContext(options)”">​</a></h3><p><strong>تمت الإضافة في: v11.0.0</strong></p><ul><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> كائن يحتوي على أي من الخصائص المحتملة من وسائط <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> <code>options</code> (مثل <code>key</code>، <code>cert</code>، <code>ca</code>، إلخ).</li></ul><p>تستبدل طريقة <code>server.setSecureContext()</code> السياق الآمن لخادم موجود. لا يتم مقاطعة الاتصالات الحالية بالخادم.</p><h3 id="serversetticketkeyskeys" tabindex="-1"><code>server.setTicketKeys(keys)</code> <a class="header-anchor" href="#serversetticketkeyskeys" aria-label="Permalink to “server.setTicketKeys(keys)”">​</a></h3><p><strong>تمت الإضافة في: v3.0.0</strong></p><ul><li><code>keys</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> مخزن مؤقت بحجم 48 بايت يحتوي على مفاتيح تذاكر الجلسة.</li></ul><p>تعيين مفاتيح تذاكر الجلسة.</p><p>التغييرات التي تطرأ على مفاتيح التذاكر فعالة فقط لاتصالات الخادم المستقبلية. ستستخدم اتصالات الخادم الحالية أو المعلقة حاليًا المفاتيح السابقة.</p><p>انظر <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><h2 id="class-tlstlssocket" tabindex="-1">الفئة: <code>tls.TLSSocket</code> <a class="header-anchor" href="#class-tlstlssocket" aria-label="Permalink to “الفئة: tls.TLSSocket”">​</a></h2><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li>تمتد: <a href="/ar/nodejs/api/net#class-netsocket">&lt;net.Socket&gt;</a></li></ul><p>تجري تشفيرًا شفافًا للبيانات المكتوبة وجميع مفاوضات TLS المطلوبة.</p><p>تنفذ مثيلات <code>tls.TLSSocket</code> واجهة <a href="/ar/nodejs/api/stream#stream">Stream</a> المزدوجة.</p><p>ستعيد الطرق التي تُرجع بيانات تعريف اتصال TLS (على سبيل المثال <a href="/ar/nodejs/api/tls#tlssocketgetpeercertificatedetailed"><code>tls.TLSSocket.getPeerCertificate()</code></a>) البيانات فقط أثناء فتح الاتصال.</p><h3 id="new-tlstlssocketsocket-options" tabindex="-1"><code>new tls.TLSSocket(socket[, options])</code> <a class="header-anchor" href="#new-tlstlssocketsocket-options" aria-label="Permalink to “new tls.TLSSocket(socket[, options])”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[سجل التغييرات]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v12.2.0</td><td>خيار <code>enableTrace</code> مدعوم الآن.</td></tr><tr><td>v5.0.0</td><td>خيارات ALPN مدعومة الآن.</td></tr><tr><td>v0.11.4</td><td>تمت إضافته في: v0.11.4</td></tr></tbody></table></div><ul><li><code>socket</code> <a href="/ar/nodejs/api/net#class-netsocket">&lt;net.Socket&gt;</a> | <a href="/ar/nodejs/api/stream#class-streamduplex">&lt;stream.Duplex&gt;</a> على جانب الخادم، أي دفق <code>Duplex</code>. على جانب العميل، أي مثيل لـ <a href="/ar/nodejs/api/net#class-netsocket"><code>net.Socket</code></a> (لدعم دفق <code>Duplex</code> عام على جانب العميل، يجب استخدام <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>).</li><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a><ul><li><code>enableTrace</code>: انظر <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>isServer</code>: بروتوكول SSL/TLS غير متماثل، يجب أن تعرف TLSSockets ما إذا كان سيتم التعامل معها كخادم أو عميل. إذا كانت القيمة <code>true</code>، فسيتم إنشاء مقبس TLS كخادم. <strong>الافتراضي:</strong> <code>false</code>.</li><li><code>server</code> <a href="/ar/nodejs/api/net#class-netserver">&lt;net.Server&gt;</a> مثيل <a href="/ar/nodejs/api/net#class-netserver"><code>net.Server</code></a>.</li><li><code>requestCert</code>: ما إذا كان سيتم مصادقة النظير البعيد عن طريق طلب شهادة. يطلب العملاء دائمًا شهادة الخادم. يمكن للخوادم (إذا كانت <code>isServer</code> صحيحة) تعيين <code>requestCert</code> على true لطلب شهادة العميل.</li><li><code>rejectUnauthorized</code>: انظر <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>ALPNProtocols</code>: انظر <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>SNICallback</code>: انظر <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>session</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> مثيل <code>Buffer</code> يحتوي على جلسة TLS.</li><li><code>requestOCSP</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> إذا كانت <code>true</code>، تحدد أنه سيتم إضافة امتداد طلب حالة OCSP إلى ترحيب العميل وسيتم إصدار حدث <code>&#39;OCSPResponse&#39;</code> على المقبس قبل إنشاء اتصال آمن</li><li><code>secureContext</code>: كائن سياق TLS تم إنشاؤه باستخدام <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. إذا لم يتم توفير <code>secureContext</code>، فسيتم إنشاء واحد عن طريق تمرير كائن <code>options</code> بأكمله إلى <code>tls.createSecureContext()</code>.</li><li>...: خيارات <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> التي يتم استخدامها إذا كان خيار <code>secureContext</code> مفقودًا. بخلاف ذلك، يتم تجاهلها.</li></ul></li></ul><p>قم بإنشاء كائن <code>tls.TLSSocket</code> جديد من مقبس TCP موجود.</p><h3 id="event-keylog_1" tabindex="-1">الحدث: <code>&#39;keylog&#39;</code> <a class="header-anchor" href="#event-keylog_1" aria-label="Permalink to “الحدث: &#39;keylog&#39;”">​</a></h3><p><strong>أضيف في: الإصدار v12.3.0، v10.20.0</strong></p><ul><li><code>line</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> سطر من نص ASCII، بتنسيق <code>SSLKEYLOGFILE</code> الخاص بـ NSS.</li></ul><p>يتم إطلاق الحدث <code>keylog</code> على <code>tls.TLSSocket</code> عند إنشاء أو استقبال مادة المفتاح بواسطة المقبس. يمكن تخزين مادة المفتاح هذه للتصحيح، لأنها تسمح بفك تشفير حركة مرور TLS التي تم التقاطها. قد يتم إطلاقه عدة مرات، قبل أو بعد اكتمال المصافحة.</p><p>حالة الاستخدام النموذجية هي إلحاق الأسطر المستلمة بملف نصي مشترك، والذي يتم استخدامه لاحقًا بواسطة برنامج (مثل Wireshark) لفك تشفير حركة المرور:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> logFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/tmp/ssl-keys.log&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { flags: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tlsSocket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;keylog&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logFile.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="event-ocspresponse" tabindex="-1">الحدث: <code>&#39;OCSPResponse&#39;</code> <a class="header-anchor" href="#event-ocspresponse" aria-label="Permalink to “الحدث: &#39;OCSPResponse&#39;”">​</a></h3><p><strong>أضيف في: الإصدار v0.11.13</strong></p><p>يتم إطلاق الحدث <code>&#39;OCSPResponse&#39;</code> إذا تم تعيين الخيار <code>requestOCSP</code> عند إنشاء <code>tls.TLSSocket</code> وتم استلام استجابة OCSP. يتم تمرير وسيطة واحدة إلى دالة رد الاتصال للمستمع عند استدعائها:</p><ul><li><code>response</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> استجابة OCSP الخاصة بالخادم</li></ul><p>عادةً ما تكون <code>response</code> كائنًا موقعًا رقميًا من CA الخاص بالخادم يحتوي على معلومات حول حالة إبطال شهادة الخادم.</p><h3 id="event-secureconnect" tabindex="-1">الحدث: <code>&#39;secureConnect&#39;</code> <a class="header-anchor" href="#event-secureconnect" aria-label="Permalink to “الحدث: &#39;secureConnect&#39;”">​</a></h3><p><strong>أضيف في: الإصدار v0.11.4</strong></p><p>يتم إطلاق الحدث <code>&#39;secureConnect&#39;</code> بعد اكتمال عملية المصافحة لاتصال جديد بنجاح. سيتم استدعاء دالة رد الاتصال للمستمع بغض النظر عما إذا كانت شهادة الخادم مصرحًا بها أم لا. تقع على عاتق العميل مسؤولية التحقق من الخاصية <code>tlsSocket.authorized</code> لتحديد ما إذا كانت شهادة الخادم موقعة من قبل أحد CAs المحددة. إذا كانت <code>tlsSocket.authorized === false</code>، فيمكن العثور على الخطأ بفحص الخاصية <code>tlsSocket.authorizationError</code>. إذا تم استخدام ALPN، فيمكن التحقق من الخاصية <code>tlsSocket.alpnProtocol</code> لتحديد البروتوكول المتفاوض عليه.</p><p>لا يتم إطلاق الحدث <code>&#39;secureConnect&#39;</code> عند إنشاء <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a> باستخدام الدالة الإنشائية <code>new tls.TLSSocket()</code>.</p><h3 id="event-session" tabindex="-1">الحدث: <code>&#39;session&#39;</code> <a class="header-anchor" href="#event-session" aria-label="Permalink to “الحدث: &#39;session&#39;”">​</a></h3><p><strong>تمت إضافته في: الإصدار v11.10.0</strong></p><ul><li><code>session</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul><p>يتم إصدار الحدث <code>&#39;session&#39;</code> على عميل <code>tls.TLSSocket</code> عندما تتوفر جلسة جديدة أو تذكرة TLS. قد يكون هذا قبل اكتمال المصافحة أو بعدها، اعتمادًا على إصدار بروتوكول TLS الذي تم التفاوض عليه. لا يتم إصدار الحدث على الخادم، أو إذا لم يتم إنشاء جلسة جديدة، على سبيل المثال، عند استئناف الاتصال. بالنسبة لبعض إصدارات بروتوكول TLS، قد يتم إصدار الحدث عدة مرات، وفي هذه الحالة يمكن استخدام جميع الجلسات للاستئناف.</p><p>على العميل، يمكن توفير <code>session</code> إلى خيار <code>session</code> في <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> لاستئناف الاتصال.</p><p>راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><p>بالنسبة إلى TLSv1.2 والإصدارات الأقدم، يمكن استدعاء <a href="/ar/nodejs/api/tls#tlssocketgetsession"><code>tls.TLSSocket.getSession()</code></a> بمجرد اكتمال المصافحة. بالنسبة إلى TLSv1.3، لا يُسمح ببروتوكول الاستئناف المستند إلى التذاكر إلا بموجب البروتوكول، ويتم إرسال تذاكر متعددة، ولا يتم إرسال التذاكر حتى بعد اكتمال المصافحة. لذلك من الضروري انتظار الحدث <code>&#39;session&#39;</code> للحصول على جلسة قابلة للاستئناف. يجب أن تستخدم التطبيقات الحدث <code>&#39;session&#39;</code> بدلاً من <code>getSession()</code> للتأكد من أنها ستعمل مع جميع إصدارات TLS. يجب على التطبيقات التي تتوقع فقط الحصول على جلسة واحدة أو استخدامها الاستماع إلى هذا الحدث مرة واحدة فقط:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tlsSocket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;session&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">session</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // يمكن استخدام الجلسة على الفور أو لاحقًا.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tls.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    session: session,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // خيارات اتصال أخرى...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="tlssocketaddress" tabindex="-1"><code>tlsSocket.address()</code> <a class="header-anchor" href="#tlssocketaddress" aria-label="Permalink to “tlsSocket.address()”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v18.4.0</td><td>ترجع الخاصية <code>family</code> الآن سلسلة بدلاً من رقم.</td></tr><tr><td>v18.0.0</td><td>ترجع الخاصية <code>family</code> الآن رقمًا بدلاً من سلسلة.</td></tr><tr><td>v0.11.4</td><td>تمت إضافته في: v0.11.4</td></tr></tbody></table></div><ul><li>الإرجاع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>يُرجع <code>address</code> المرتبط واسم <code>family</code> العنوان و<code>port</code> المقبس الأساسي كما تم الإبلاغ عنه بواسطة نظام التشغيل: <code>{ port: 12346, family: &#39;IPv4&#39;, address: &#39;127.0.0.1&#39; }</code>.</p><h3 id="tlssocketauthorizationerror" tabindex="-1"><code>tlsSocket.authorizationError</code> <a class="header-anchor" href="#tlssocketauthorizationerror" aria-label="Permalink to “tlsSocket.authorizationError”">​</a></h3><p><strong>أضيف في:</strong> v0.11.4</p><p>إرجاع سبب عدم التحقق من شهادة النظير. يتم تعيين هذه الخاصية فقط عندما يكون <code>tlsSocket.authorized === false</code>.</p><h3 id="tlssocketauthorized" tabindex="-1"><code>tlsSocket.authorized</code> <a class="header-anchor" href="#tlssocketauthorized" aria-label="Permalink to “tlsSocket.authorized”">​</a></h3><p><strong>أضيف في:</strong> v0.11.4</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a></li></ul><p>تكون هذه الخاصية <code>true</code> إذا تم توقيع شهادة النظير بواسطة إحدى هيئات التصديق المحددة عند إنشاء مثيل <code>tls.TLSSocket</code>، وإلا فإنها تكون <code>false</code>.</p><h3 id="tlssocketdisablerenegotiation" tabindex="-1"><code>tlsSocket.disableRenegotiation()</code> <a class="header-anchor" href="#tlssocketdisablerenegotiation" aria-label="Permalink to “tlsSocket.disableRenegotiation()”">​</a></h3><p><strong>أضيف في:</strong> v8.4.0</p><p>تعطيل إعادة التفاوض لـ TLS لهذا المثيل <code>TLSSocket</code>. بمجرد استدعائه، ستحفز محاولات إعادة التفاوض حدث <code>&#39;error&#39;</code> على <code>TLSSocket</code>.</p><h3 id="tlssocketenabletrace" tabindex="-1"><code>tlsSocket.enableTrace()</code> <a class="header-anchor" href="#tlssocketenabletrace" aria-label="Permalink to “tlsSocket.enableTrace()”">​</a></h3><p><strong>أضيف في:</strong> v12.2.0</p><p>عند التمكين، تتم كتابة معلومات تتبع حزمة TLS إلى <code>stderr</code>. يمكن استخدام هذا لتصحيح مشكلات اتصال TLS.</p><p>تنسيق الإخراج مطابق لإخراج <code>openssl s_client -trace</code> أو <code>openssl s_server -trace</code>. على الرغم من أنه يتم إنتاجه بواسطة دالة <code>SSL_trace()</code> في OpenSSL، إلا أن التنسيق غير موثق، ويمكن أن يتغير دون إشعار، ولا ينبغي الاعتماد عليه.</p><h3 id="tlssocketencrypted" tabindex="-1"><code>tlsSocket.encrypted</code> <a class="header-anchor" href="#tlssocketencrypted" aria-label="Permalink to “tlsSocket.encrypted”">​</a></h3><p><strong>أضيف في:</strong> v0.11.4</p><p>إرجاع <code>true</code> دائمًا. يمكن استخدام هذا لتمييز مآخذ توصيل TLS عن مثيلات <code>net.Socket</code> العادية.</p><h3 id="tlssocketexportkeyingmateriallength-label-context" tabindex="-1"><code>tlsSocket.exportKeyingMaterial(length, label[, context])</code> <a class="header-anchor" href="#tlssocketexportkeyingmateriallength-label-context" aria-label="Permalink to “tlsSocket.exportKeyingMaterial(length, label[, context])”">​</a></h3><p><strong>أضيف في:</strong> v13.10.0, v12.17.0</p><ul><li><code>length</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> عدد البايتات المراد استردادها من مادة المفتاح.</li><li><code>label</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> تسمية خاصة بالتطبيق، وعادةً ما تكون قيمة من <a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml#exporter-labels" target="_blank" rel="noreferrer">سجل ملصقات مصدر IANA</a>.</li><li><code>context</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> قم بتوفير سياق اختياريًا.</li><li>إرجاع: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> البايتات المطلوبة من مادة المفتاح.</li></ul><p>تستخدم مادة المفتاح للتحقق من الصحة لمنع أنواع مختلفة من الهجمات في بروتوكولات الشبكة، على سبيل المثال في مواصفات IEEE 802.1X.</p><p>مثال</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> keyingMaterial</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tlsSocket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exportKeyingMaterial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;client finished&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> مثال لقيمة الإرجاع الخاصة بـ keyingMaterial:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> &lt;Buffer 76 26 af 99 c5 56 8e 42 09 91 ef 9f 93 cb ad 6c 7b 65 f8 53 f1 d8 d9</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    12 5a 33 b8 b5 25 df 7b 37 9f e0 e2 4f b8 67 83 a3 2f cd 5d 41 42 4c 91</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    74 ef 2c ... المزيد من 78 بايت&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>راجع وثائق OpenSSL <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_export_keying_material" target="_blank" rel="noreferrer"><code>SSL_export_keying_material</code></a> لمزيد من المعلومات.</p><h3 id="tlssocketgetcertificate" tabindex="-1"><code>tlsSocket.getCertificate()</code> <a class="header-anchor" href="#tlssocketgetcertificate" aria-label="Permalink to “tlsSocket.getCertificate()”">​</a></h3><p><strong>أُضيف في: الإصدار v11.2.0</strong></p><ul><li>يُعيد: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>يُعيد كائنًا يمثل الشهادة المحلية. يحتوي الكائن المُعاد على بعض الخصائص التي تتوافق مع حقول الشهادة.</p><p>راجع <a href="/ar/nodejs/api/tls#tlssocketgetpeercertificatedetailed"><code>tls.TLSSocket.getPeerCertificate()</code></a> للحصول على مثال على بنية الشهادة.</p><p>إذا لم تكن هناك شهادة محلية، فسيتم إرجاع كائن فارغ. إذا تم تدمير socket، فسيتم إرجاع <code>null</code>.</p><h3 id="tlssocketgetcipher" tabindex="-1"><code>tlsSocket.getCipher()</code> <a class="header-anchor" href="#tlssocketgetcipher" aria-label="Permalink to “tlsSocket.getCipher()”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[التاريخ]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v13.4.0, v12.16.0</td><td>إعادة اسم IETF للشفرة كـ <code>standardName</code>.</td></tr><tr><td>v12.0.0</td><td>إعادة الحد الأدنى من إصدار الشفرة، بدلاً من سلسلة ثابتة (<code>&#39;TLSv1/SSLv3&#39;</code>).</td></tr><tr><td>v0.11.4</td><td>أُضيف في: الإصدار v0.11.4</td></tr></tbody></table></div><ul><li>يُعيد: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a><ul><li><code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم OpenSSL لمجموعة الشفرات.</li><li><code>standardName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم IETF لمجموعة الشفرات.</li><li><code>version</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> الحد الأدنى لإصدار بروتوكول TLS الذي تدعمه مجموعة الشفرات هذه. للحصول على البروتوكول الذي تم التفاوض عليه الفعلي، انظر <a href="/ar/nodejs/api/tls#tlssocketgetprotocol"><code>tls.TLSSocket.getProtocol()</code></a>.</li></ul></li></ul><p>يُعيد كائنًا يحتوي على معلومات حول مجموعة الشفرات التي تم التفاوض عليها.</p><p>على سبيل المثال، بروتوكول TLSv1.2 مع شفرة AES256-SHA:</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AES256-SHA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;standardName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLS_RSA_WITH_AES_256_CBC_SHA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SSLv3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>راجع <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_CIPHER_get_name" target="_blank" rel="noreferrer">SSL_CIPHER_get_name</a> لمزيد من المعلومات.</p><h3 id="tlssocketgetephemeralkeyinfo" tabindex="-1"><code>tlsSocket.getEphemeralKeyInfo()</code> <a class="header-anchor" href="#tlssocketgetephemeralkeyinfo" aria-label="Permalink to “tlsSocket.getEphemeralKeyInfo()”">​</a></h3><p><strong>أُضيف في: الإصدار v5.0.0</strong></p><ul><li>يُعيد: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>يُعيد كائنًا يمثل النوع والاسم والحجم لمعامل تبادل مفتاح عابر في <a href="/ar/nodejs/api/tls#perfect-forward-secrecy">السرية الأمامية المثالية</a> على اتصال العميل. يُعيد كائنًا فارغًا عندما لا يكون تبادل المفاتيح عابرًا. نظرًا لأن هذا مدعوم فقط على socket العميل؛ يتم إرجاع <code>null</code> إذا تم استدعاؤه على socket الخادم. الأنواع المدعومة هي <code>&#39;DH&#39;</code> و <code>&#39;ECDH&#39;</code>. الخاصية <code>name</code> متاحة فقط عندما يكون النوع هو <code>&#39;ECDH&#39;</code>.</p><p>على سبيل المثال: <code>{ type: &#39;ECDH&#39;, name: &#39;prime256v1&#39;, size: 256 }</code>.</p><h3 id="tlssocketgetfinished" tabindex="-1">‏<code>tlsSocket.getFinished()</code> <a class="header-anchor" href="#tlssocketgetfinished" aria-label="Permalink to “‏tlsSocket.getFinished()”">​</a></h3><p><strong>تمت الإضافة في: الإصدار 9.9.0</strong></p><ul><li>الإرجاع: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a> أحدث رسالة <code>Finished</code> تم إرسالها إلى المقبس كجزء من مصافحة SSL/TLS، أو <code>undefined</code> إذا لم يتم إرسال أي رسالة <code>Finished</code> حتى الآن.</li></ul><p>بما أن رسائل <code>Finished</code> هي خلاصات رسائل للمصافحة الكاملة (بإجمالي 192 بت لـ TLS 1.0 وأكثر لـ SSL 3.0)، فيمكن استخدامها لإجراءات المصادقة الخارجية عندما لا تكون المصادقة التي يوفرها SSL/TLS مرغوبة أو كافية.</p><p>يتوافق مع روتين <code>SSL_get_finished</code> في OpenSSL ويمكن استخدامه لتنفيذ ربط قناة <code>tls-unique</code> من <a href="https://tools.ietf.org/html/rfc5929" target="_blank" rel="noreferrer">RFC 5929</a>.</p><h3 id="tlssocketgetpeercertificatedetailed" tabindex="-1">‏<code>tlsSocket.getPeerCertificate([detailed])</code> <a class="header-anchor" href="#tlssocketgetpeercertificatedetailed" aria-label="Permalink to “‏tlsSocket.getPeerCertificate([detailed])”">​</a></h3><p><strong>تمت الإضافة في: الإصدار 0.11.4</strong></p><ul><li>‏<code>detailed</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> قم بتضمين سلسلة الشهادات الكاملة إذا كانت القيمة <code>true</code>، وإلا قم بتضمين شهادة النظير فقط.</li><li>الإرجاع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> كائن الشهادة.</li></ul><p>يُرجع كائنًا يمثل شهادة النظير. إذا لم يقدم النظير شهادة، فسيتم إرجاع كائن فارغ. إذا تم تدمير المقبس، فسيتم إرجاع <code>null</code>.</p><p>إذا طُلبت سلسلة الشهادات الكاملة، فستتضمن كل شهادة خاصية <code>issuerCertificate</code> تحتوي على كائن يمثل شهادة المُصدر الخاص بها.</p><h4 id="certificate-object" tabindex="-1">كائن الشهادة <a class="header-anchor" href="#certificate-object" aria-label="Permalink to “كائن الشهادة”">​</a></h4><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>الإصدار 19.1.0، الإصدار 18.13.0</td><td>إضافة خاصية &quot;ca&quot;.</td></tr><tr><td>الإصدار 17.2.0، الإصدار 16.14.0</td><td>إضافة fingerprint512.</td></tr><tr><td>الإصدار 11.4.0</td><td>دعم معلومات المفتاح العام للمنحنى الإهليلجي.</td></tr></tbody></table></div><p>يحتوي كائن الشهادة على خصائص تتوافق مع حقول الشهادة.</p><ul><li>‏<code>ca</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> ‏<code>true</code> إذا كانت سلطة شهادات (CA)، و<code>false</code> بخلاف ذلك.</li><li>‏<code>raw</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> بيانات شهادة X.509 المشفرة بـ DER.</li><li>‏<code>subject</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> موضوع الشهادة، الموصوف من حيث البلد (<code>C</code>) والولاية أو المقاطعة (<code>ST</code>) والمحلية (<code>L</code>) والمؤسسة (<code>O</code>) والوحدة التنظيمية (<code>OU</code>) والاسم الشائع (<code>CN</code>). الاسم الشائع هو عادة اسم DNS مع شهادات TLS. مثال: <code>{C: &#39;UK&#39;, ST: &#39;BC&#39;, L: &#39;Metro&#39;, O: &#39;Node Fans&#39;, OU: &#39;Docs&#39;, CN: &#39;example.com&#39;}</code>.</li><li>‏<code>issuer</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> مُصدر الشهادة، الموصوف بنفس الشروط مثل <code>subject</code>.</li><li>‏<code>valid_from</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> تاريخ ووقت صلاحية الشهادة من.</li><li>‏<code>valid_to</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> تاريخ ووقت صلاحية الشهادة إلى.</li><li>‏<code>serialNumber</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> الرقم التسلسلي للشهادة، كسلسلة سداسية عشرية. مثال: <code>&#39;B9B0D332A1AA5635&#39;</code>.</li><li>‏<code>fingerprint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> خلاصة SHA-1 للشهادة المشفرة بـ DER. يتم إرجاعها كسلسلة سداسية عشرية مفصولة بـ <code>:</code>. مثال: <code>&#39;2A:7A:C2:DD:...&#39;</code>.</li><li>‏<code>fingerprint256</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> خلاصة SHA-256 للشهادة المشفرة بـ DER. يتم إرجاعها كسلسلة سداسية عشرية مفصولة بـ <code>:</code>. مثال: <code>&#39;2A:7A:C2:DD:...&#39;</code>.</li><li>‏<code>fingerprint512</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> خلاصة SHA-512 للشهادة المشفرة بـ DER. يتم إرجاعها كسلسلة سداسية عشرية مفصولة بـ <code>:</code>. مثال: <code>&#39;2A:7A:C2:DD:...&#39;</code>.</li><li>‏<code>ext_key_usage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noreferrer">&lt;Array&gt;</a> (اختياري) استخدام المفتاح الموسع، مجموعة من OID.</li><li>‏<code>subjectaltname</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> (اختياري) سلسلة تحتوي على أسماء متسلسلة للموضوع، بديل لأسماء <code>subject</code>.</li><li>‏<code>infoAccess</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noreferrer">&lt;Array&gt;</a> (اختياري) مصفوفة تصف AuthorityInfoAccess، المستخدمة مع OCSP.</li><li>‏<code>issuerCertificate</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> (اختياري) كائن شهادة المُصدر. بالنسبة للشهادات الموقعة ذاتيًا، قد يكون هذا مرجعًا دائريًا.</li></ul><p>قد تحتوي الشهادة على معلومات حول المفتاح العام، اعتمادًا على نوع المفتاح.</p><p>بالنسبة لمفاتيح RSA، يمكن تعريف الخصائص التالية:</p><ul><li>‏<code>bits</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> حجم بت RSA. مثال: <code>1024</code>.</li><li>‏<code>exponent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> أس RSA، كسلسلة في تدوين الأرقام السداسية العشرية. مثال: <code>&#39;0x010001&#39;</code>.</li><li>‏<code>modulus</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> معامل RSA، كسلسلة سداسية عشرية. مثال: <code>&#39;B56CE45CB7...&#39;</code>.</li><li>‏<code>pubkey</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> المفتاح العام.</li></ul><p>بالنسبة لمفاتيح EC، يمكن تعريف الخصائص التالية:</p><ul><li>‏<code>pubkey</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> المفتاح العام.</li><li>‏<code>bits</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> حجم المفتاح بالبت. مثال: <code>256</code>.</li><li>‏<code>asn1Curve</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> (اختياري) اسم ASN.1 لـ OID للمنحنى الإهليلجي. يتم تحديد المنحنيات المعروفة بواسطة OID. على الرغم من أنه من غير المعتاد، فمن المحتمل أن يتم تحديد المنحنى بخصائصه الرياضية، وفي هذه الحالة لن يكون له OID. مثال: <code>&#39;prime256v1&#39;</code>.</li><li>‏<code>nistCurve</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> (اختياري) اسم NIST للمنحنى الإهليلجي، إذا كان لديه اسم (لم يتم تعيين أسماء لجميع المنحنيات المعروفة بواسطة NIST). مثال: <code>&#39;P-256&#39;</code>.</li></ul><p>مثال على شهادة:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OU</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Domain Control Validated&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PositiveSSL Wildcard&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     CN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*.nodejs.org&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  issuer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">C</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;GB&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Greater Manchester&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Salford&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     O</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;COMODO CA Limited&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     CN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;COMODO RSA Domain Validation Secure Server CA&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  subjectaltname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DNS:*.nodejs.org, DNS:nodejs.org&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  infoAccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;CA Issuers - URI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://crt.comodoca.com/COMODORSADomainValidationSecureServerCA.crt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     &#39;OCSP - URI&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http://ocsp.comodoca.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ] },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  modulus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;B56CE45CB740B09A13F64AC543B712FF9EE8E4C284B542A1708A27E82A8D151CA178153E12E6DDA15BF70FFD96CB8A88618641BDFCCA03527E665B70D779C8A349A6F88FD4EF6557180BD4C98192872BCFE3AF56E863C09DDD8BC1EC58DF9D94F914F0369102B2870BECFA1348A0838C9C49BD1C20124B442477572347047506B1FCD658A80D0C44BCC16BC5C5496CFE6E4A8428EF654CD3D8972BF6E5BFAD59C93006830B5EB1056BBB38B53D1464FA6E02BFDF2FF66CD949486F0775EC43034EC2602AEFBF1703AD221DAA2A88353C3B6A688EFE8387811F645CEED7B3FE46E1F8B9F59FAD028F349B9BC14211D5830994D055EEA3D547911E07A0ADDEB8A82B9188E58720D95CD478EEC9AF1F17BE8141BE80906F1A339445A7EB5B285F68039B0F294598A7D1C0005FC22B5271B0752F58CCDEF8C8FD856FB7AE21C80B8A2CE983AE94046E53EDE4CB89F42502D31B5360771C01C80155918637490550E3F555E2EE75CC8C636DDE3633CFEDD62E91BF0F7688273694EEEBA20C2FC9F14A2A435517BC1D7373922463409AB603295CEB0BB53787A334C9CA3CA8B30005C5A62FC0715083462E00719A8FA3ED0A9828C3871360A73F8B04A4FC1E71302844E9BB9940B77E745C9D91F226D71AFCAD4B113AAF68D92B24DDB4A2136B55A1CD1ADF39605B63CB639038ED0F4C987689866743A68769CC55847E4A06D6E2E3F1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  exponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;0x10001&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  pubkey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Buffer</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  valid_from: &#39;Aug 14 00:00:00 2017 GMT&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  valid_to: &#39;Nov 20 23:59:59 2019 GMT&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fingerprint: &#39;01:02:59:D9:C3:D2:0D:08:F7:82:4E:44:A4:B4:53:C5:E2:3A:87:4D&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fingerprint256: &#39;69:AE:1A:6A:D4:3D:C6:C1:1B:EA:C6:23:DE:BA:2A:14:62:62:93:5C:7A:EA:06:41:9B:0B:BC:87:CE:48:4E:02&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fingerprint512: &#39;19:2B:3E:C3:B3:5B:32:E8:AE:BB:78:97:27:E4:BA:6C:39:C9:92:79:4F:31:46:39:E2:70:E5:5F:89:42:17:C9:E8:64:CA:FF:BB:72:56:73:6E:28:8A:92:7E:A3:2A:15:8B:C2:E0:45:CA:C3:BC:EA:40:52:EC:CA:A2:68:CB:32&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ext_key_usage: [ &#39;1.3.6.1.5.5.7.3.1&#39;, &#39;1.3.6.1.5.5.7.3.2&#39; ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  serialNumber: &#39;66593D57F20CBC573E433381B5FEC280&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raw: &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Buffer</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> ...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt; }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="tlssocketgetpeerfinished" tabindex="-1"><code>tlsSocket.getPeerFinished()</code> <a class="header-anchor" href="#tlssocketgetpeerfinished" aria-label="Permalink to “tlsSocket.getPeerFinished()”">​</a></h3><p><strong>أُضيف في: v9.9.0</strong></p><ul><li>Returns: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;undefined&gt;</a> أحدث رسالة <code>Finished</code> يُتوقع استلامها أو تم استلامها فعليًا من المقبس كجزء من مصافحة SSL/TLS، أو <code>undefined</code> إذا لم تكن هناك رسالة <code>Finished</code> حتى الآن.</li></ul><p>بما أن رسائل <code>Finished</code> هي ملخصات رسائل المصافحة الكاملة (بإجمالي 192 بت لـ TLS 1.0 وأكثر لـ SSL 3.0)، فيمكن استخدامها لإجراءات المصادقة الخارجية عندما لا تكون المصادقة التي يوفرها SSL/TLS مرغوبة أو كافية.</p><p>يتوافق مع روتين <code>SSL_get_peer_finished</code> في OpenSSL ويمكن استخدامه لتنفيذ ربط قناة <code>tls-unique</code> من <a href="https://tools.ietf.org/html/rfc5929" target="_blank" rel="noreferrer">RFC 5929</a>.</p><h3 id="tlssocketgetpeerx509certificate" tabindex="-1"><code>tlsSocket.getPeerX509Certificate()</code> <a class="header-anchor" href="#tlssocketgetpeerx509certificate" aria-label="Permalink to “tlsSocket.getPeerX509Certificate()”">​</a></h3><p><strong>أُضيف في: v15.9.0</strong></p><ul><li>Returns: <a href="/ar/nodejs/api/crypto#class-x509certificate">&lt;X509Certificate&gt;</a></li></ul><p>إرجاع شهادة النظير ككائن <a href="/ar/nodejs/api/crypto#class-x509certificate">&lt;X509Certificate&gt;</a>.</p><p>إذا لم تكن هناك شهادة نظير، أو تم تدمير المقبس، فسيتم إرجاع <code>undefined</code>.</p><h3 id="tlssocketgetprotocol" tabindex="-1"><code>tlsSocket.getProtocol()</code> <a class="header-anchor" href="#tlssocketgetprotocol" aria-label="Permalink to “tlsSocket.getProtocol()”">​</a></h3><p><strong>أُضيف في: v5.7.0</strong></p><ul><li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" target="_blank" rel="noreferrer">&lt;null&gt;</a></li></ul><p>إرجاع سلسلة تحتوي على إصدار بروتوكول SSL/TLS المتفاوض عليه للاتصال الحالي. سيتم إرجاع القيمة <code>&#39;unknown&#39;</code> للمآخذ المتصلة التي لم تكمل عملية المصافحة. سيتم إرجاع القيمة <code>null</code> لمآخذ الخادم أو مآخذ العميل المنفصلة.</p><p>إصدارات البروتوكول هي:</p><ul><li><code>&#39;SSLv3&#39;</code></li><li><code>&#39;TLSv1&#39;</code></li><li><code>&#39;TLSv1.1&#39;</code></li><li><code>&#39;TLSv1.2&#39;</code></li><li><code>&#39;TLSv1.3&#39;</code></li></ul><p>راجع وثائق OpenSSL <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_get_version" target="_blank" rel="noreferrer"><code>SSL_get_version</code></a> لمزيد من المعلومات.</p><h3 id="tlssocketgetsession" tabindex="-1"><code>tlsSocket.getSession()</code> <a class="header-anchor" href="#tlssocketgetsession" aria-label="Permalink to “tlsSocket.getSession()”">​</a></h3><p><strong>أُضيف في: v0.11.4</strong></p><ul><li><a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul><p>إرجاع بيانات جلسة TLS أو <code>undefined</code> إذا لم يتم التفاوض على أي جلسة. على العميل، يمكن توفير البيانات لخيار <code>session</code> في <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> لاستئناف الاتصال. على الخادم، قد يكون ذلك مفيدًا لتصحيح الأخطاء.</p><p>راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><p>ملاحظة: يعمل <code>getSession()</code> فقط مع TLSv1.2 والإصدارات الأقدم. بالنسبة إلى TLSv1.3، يجب على التطبيقات استخدام حدث <a href="/ar/nodejs/api/tls#event-session"><code>&#39;session&#39;</code></a> (وهو يعمل أيضًا مع TLSv1.2 والإصدارات الأقدم).</p><h3 id="tlssocketgetsharedsigalgs" tabindex="-1"><code>tlsSocket.getSharedSigalgs()</code> <a class="header-anchor" href="#tlssocketgetsharedsigalgs" aria-label="Permalink to “tlsSocket.getSharedSigalgs()”">​</a></h3><p><strong>تمت الإضافة في: v12.11.0</strong></p><ul><li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank" rel="noreferrer">&lt;Array&gt;</a> قائمة بخوارزميات التوقيع المشتركة بين الخادم والعميل بترتيب تنازلي للأفضلية.</li></ul><p>راجع <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_get_shared_sigalgs" target="_blank" rel="noreferrer">SSL_get_shared_sigalgs</a> لمزيد من المعلومات.</p><h3 id="tlssocketgettlsticket" tabindex="-1"><code>tlsSocket.getTLSTicket()</code> <a class="header-anchor" href="#tlssocketgettlsticket" aria-label="Permalink to “tlsSocket.getTLSTicket()”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a></li></ul><p>بالنسبة إلى العميل، تُرجع تذكرة جلسة TLS إذا كانت متوفرة، أو <code>undefined</code>. بالنسبة للخادم، تُرجع دائمًا <code>undefined</code>.</p><p>قد يكون ذلك مفيدًا لتصحيح الأخطاء.</p><p>راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><h3 id="tlssocketgetx509certificate" tabindex="-1"><code>tlsSocket.getX509Certificate()</code> <a class="header-anchor" href="#tlssocketgetx509certificate" aria-label="Permalink to “tlsSocket.getX509Certificate()”">​</a></h3><p><strong>تمت الإضافة في: v15.9.0</strong></p><ul><li>Returns: <a href="/ar/nodejs/api/crypto#class-x509certificate">&lt;X509Certificate&gt;</a></li></ul><p>تُرجع الشهادة المحلية ككائن <a href="/ar/nodejs/api/crypto#class-x509certificate">&lt;X509Certificate&gt;</a>.</p><p>إذا لم تكن هناك شهادة محلية، أو تم تدمير المقبس، فسيتم إرجاع <code>undefined</code>.</p><h3 id="tlssocketissessionreused" tabindex="-1"><code>tlsSocket.isSessionReused()</code> <a class="header-anchor" href="#tlssocketissessionreused" aria-label="Permalink to “tlsSocket.isSessionReused()”">​</a></h3><p><strong>تمت الإضافة في: v0.5.6</strong></p><ul><li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> <code>true</code> إذا تم إعادة استخدام الجلسة، و <code>false</code> بخلاف ذلك.</li></ul><p>راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</p><h3 id="tlssocketlocaladdress" tabindex="-1"><code>tlsSocket.localAddress</code> <a class="header-anchor" href="#tlssocketlocaladdress" aria-label="Permalink to “tlsSocket.localAddress”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></li></ul><p>تُرجع التمثيل السلسلي لعنوان IP المحلي.</p><h3 id="tlssocketlocalport" tabindex="-1"><code>tlsSocket.localPort</code> <a class="header-anchor" href="#tlssocketlocalport" aria-label="Permalink to “tlsSocket.localPort”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a></li></ul><p>تُرجع التمثيل الرقمي للمنفذ المحلي.</p><h3 id="tlssocketremoteaddress" tabindex="-1"><code>tlsSocket.remoteAddress</code> <a class="header-anchor" href="#tlssocketremoteaddress" aria-label="Permalink to “tlsSocket.remoteAddress”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></li></ul><p>تُرجع التمثيل السلسلي لعنوان IP البعيد. على سبيل المثال، <code>&#39;74.125.127.100&#39;</code> أو <code>&#39;2001:4860:a005::68&#39;</code>.</p><h3 id="tlssocketremotefamily" tabindex="-1"><code>tlsSocket.remoteFamily</code> <a class="header-anchor" href="#tlssocketremotefamily" aria-label="Permalink to “tlsSocket.remoteFamily”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a></li></ul><p>إرجاع التمثيل النصي لعائلة IP البعيدة. <code>&#39;IPv4&#39;</code> أو <code>&#39;IPv6&#39;</code>.</p><h3 id="tlssocketremoteport" tabindex="-1"><code>tlsSocket.remotePort</code> <a class="header-anchor" href="#tlssocketremoteport" aria-label="Permalink to “tlsSocket.remotePort”">​</a></h3><p><strong>تمت الإضافة في: v0.11.4</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;integer&gt;</a></li></ul><p>إرجاع التمثيل الرقمي للمنفذ البعيد. على سبيل المثال، <code>443</code>.</p><h3 id="tlssocketrenegotiateoptions-callback" tabindex="-1"><code>tlsSocket.renegotiate(options, callback)</code> <a class="header-anchor" href="#tlssocketrenegotiateoptions-callback" aria-label="Permalink to “tlsSocket.renegotiate(options, callback)”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v18.0.0</td><td>تمرير استدعاء غير صالح إلى وسيطة <code>callback</code> يطرح الآن <code>ERR_INVALID_ARG_TYPE</code> بدلاً من <code>ERR_INVALID_CALLBACK</code>.</td></tr><tr><td>v0.11.8</td><td>تمت الإضافة في: v0.11.8</td></tr></tbody></table></div><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>rejectUnauthorized</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> إذا لم يكن <code>false</code>، يتم التحقق من شهادة الخادم مقابل قائمة CAs المقدمة. يتم إصدار حدث <code>&#39;error&#39;</code> إذا فشل التحقق؛ يحتوي <code>err.code</code> على رمز خطأ OpenSSL. <strong>الافتراضي:</strong> <code>true</code>.</li><li><code>requestCert</code></li></ul></li><li><p><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> إذا أعادت <code>renegotiate()</code> القيمة <code>true</code>، فسيتم إرفاق رد الاتصال مرة واحدة بحدث <code>&#39;secure&#39;</code>. إذا أعادت <code>renegotiate()</code> القيمة <code>false</code>، فسيتم استدعاء <code>callback</code> في التكرار التالي مع وجود خطأ، ما لم يتم تدمير <code>tlsSocket</code>، وفي هذه الحالة لن يتم استدعاء <code>callback</code> على الإطلاق.</p></li><li><p>الإرجاع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> <code>true</code> إذا تم بدء إعادة التفاوض، <code>false</code> بخلاف ذلك.</p></li></ul><p>تبدأ الطريقة <code>tlsSocket.renegotiate()</code> عملية إعادة التفاوض على TLS. عند الانتهاء، سيتم تمرير وسيطة واحدة إلى وظيفة <code>callback</code> وهي إما <code>Error</code> (إذا فشل الطلب) أو <code>null</code>.</p><p>يمكن استخدام هذه الطريقة لطلب شهادة نظير بعد إنشاء الاتصال الآمن.</p><p>عند التشغيل كخادم، سيتم تدمير المقبس بخطأ بعد مهلة <code>handshakeTimeout</code>.</p><p>بالنسبة إلى TLSv1.3، لا يمكن بدء إعادة التفاوض، فهو غير مدعوم من قبل البروتوكول.</p><h3 id="tlssocketsetkeycertcontext" tabindex="-1"><code>tlsSocket.setKeyCert(context)</code> <a class="header-anchor" href="#tlssocketsetkeycertcontext" aria-label="Permalink to “tlsSocket.setKeyCert(context)”">​</a></h3><p><strong>أُضيف في: v22.5.0, v20.17.0</strong></p><ul><li><code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;الكائن&gt;</a> | <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions">&lt;tls.SecureContext&gt;</a> كائن يحتوي على الأقل على الخصائص <code>key</code> و <code>cert</code> من <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> <code>options</code>، أو كائن سياق TLS تم إنشاؤه باستخدام <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> نفسه.</li></ul><p>تقوم الدالة <code>tlsSocket.setKeyCert()</code> بتعيين المفتاح الخاص والشهادة المراد استخدامها للمأخذ. هذا مفيد بشكل أساسي إذا كنت ترغب في تحديد شهادة خادم من <code>ALPNCallback</code> لخادم TLS.</p><h3 id="tlssocketsetmaxsendfragmentsize" tabindex="-1"><code>tlsSocket.setMaxSendFragment(size)</code> <a class="header-anchor" href="#tlssocketsetmaxsendfragmentsize" aria-label="Permalink to “tlsSocket.setMaxSendFragment(size)”">​</a></h3><p><strong>أُضيف في: v0.11.11</strong></p><ul><li><code>size</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;رقم&gt;</a> الحد الأقصى لحجم جزء TLS. القيمة القصوى هي <code>16384</code>. <strong>الافتراضي:</strong> <code>16384</code>.</li><li>يُرجع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;منطقي&gt;</a></li></ul><p>تقوم الدالة <code>tlsSocket.setMaxSendFragment()</code> بتعيين الحد الأقصى لحجم جزء TLS. تُرجع <code>true</code> إذا نجح تعيين الحد؛ <code>false</code> خلاف ذلك.</p><p>يؤدي تقليل أحجام الأجزاء إلى تقليل زمن انتقال التخزين المؤقت على العميل: يتم تخزين الأجزاء الأكبر مؤقتًا بواسطة طبقة TLS حتى يتم استلام الجزء بأكمله والتحقق من سلامته؛ يمكن أن تغطي الأجزاء الكبيرة عدة رحلات ذهابًا وإيابًا ويمكن أن يتأخر معالجتها بسبب فقدان الحزم أو إعادة ترتيبها. ومع ذلك، تضيف الأجزاء الأصغر بايتات تأطير TLS إضافية وعبء وحدة المعالجة المركزية، مما قد يقلل من إنتاجية الخادم الإجمالية.</p><h2 id="tlscheckserveridentityhostname-cert" tabindex="-1"><code>tls.checkServerIdentity(hostname, cert)</code> <a class="header-anchor" href="#tlscheckserveridentityhostname-cert" aria-label="Permalink to “tls.checkServerIdentity(hostname, cert)”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v17.3.1, v16.13.2, v14.18.3, v12.22.9</td><td>تم تعطيل دعم أسماء بديلة للموضوع <code>uniformResourceIdentifier</code> استجابةً لـ CVE-2021-44531.</td></tr><tr><td>v0.8.4</td><td>أُضيف في: v0.8.4</td></tr></tbody></table></div><ul><li><code>hostname</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;سلسلة&gt;</a> اسم المضيف أو عنوان IP للتحقق من الشهادة مقابله.</li><li><code>cert</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;الكائن&gt;</a> <a href="/ar/nodejs/api/tls#certificate-object">كائن شهادة</a> يمثل شهادة النظير.</li><li>يُرجع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;خطأ&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;غير معرف&gt;</a></li></ul><p>للتحقق مما إذا كانت الشهادة <code>cert</code> صادرة لـ <code>hostname</code>.</p><p>يُرجع كائن <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;خطأ&gt;</a>، ويملؤه بـ <code>reason</code> و <code>host</code> و <code>cert</code> عند الفشل. عند النجاح، يُرجع <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" target="_blank" rel="noreferrer">&lt;غير معرف&gt;</a>.</p><p>تهدف هذه الدالة إلى استخدامها مع الخيار <code>checkServerIdentity</code> الذي يمكن تمريره إلى <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> وعلى هذا النحو تعمل على <a href="/ar/nodejs/api/tls#certificate-object">كائن شهادة</a>. لأغراض أخرى، ضع في اعتبارك استخدام <a href="/ar/nodejs/api/crypto#x509checkhostname-options"><code>x509.checkHost()</code></a> بدلاً من ذلك.</p><p>يمكن استبدال هذه الدالة بتوفير دالة بديلة كخيار <code>options.checkServerIdentity</code> الذي يتم تمريره إلى <code>tls.connect()</code>. يمكن للدالة المستبدلة استدعاء <code>tls.checkServerIdentity()</code> بالطبع، لزيادة عمليات التحقق التي تتم مع التحقق الإضافي.</p><p>يتم استدعاء هذه الدالة فقط إذا اجتازت الشهادة جميع عمليات التحقق الأخرى، مثل أن تكون صادرة عن CA موثوق به (<code>options.ca</code>).</p><p>الإصدارات السابقة من Node.js قبلت بشكل غير صحيح الشهادات لاسم <code>hostname</code> معين إذا كان اسم بديل للموضوع <code>uniformResourceIdentifier</code> مطابقًا موجودًا (انظر <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44531" target="_blank" rel="noreferrer">CVE-2021-44531</a>). يمكن للتطبيقات التي ترغب في قبول أسماء بديلة للموضوع <code>uniformResourceIdentifier</code> استخدام دالة <code>options.checkServerIdentity</code> مخصصة تنفذ السلوك المطلوب.</p><h2 id="tlsconnectoptions-callback" tabindex="-1"><code>tls.connect(options[, callback])</code> <a class="header-anchor" href="#tlsconnectoptions-callback" aria-label="Permalink to “tls.connect(options[, callback])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>الإصدار v15.1.0, v14.18.0</td><td>تمت إضافة خيار <code>onread</code>.</td></tr><tr><td>الإصدار v14.1.0, v13.14.0</td><td>تم قبول خيار <code>highWaterMark</code> الآن.</td></tr><tr><td>الإصدار v13.6.0, v12.16.0</td><td>خيار <code>pskCallback</code> مدعوم الآن.</td></tr><tr><td>الإصدار v12.9.0</td><td>دعم خيار <code>allowHalfOpen</code>.</td></tr><tr><td>الإصدار v12.4.0</td><td>خيار <code>hints</code> مدعوم الآن.</td></tr><tr><td>الإصدار v12.2.0</td><td>خيار <code>enableTrace</code> مدعوم الآن.</td></tr><tr><td>الإصدار v11.8.0, v10.16.0</td><td>خيار <code>timeout</code> مدعوم الآن.</td></tr><tr><td>الإصدار v8.0.0</td><td>خيار <code>lookup</code> مدعوم الآن.</td></tr><tr><td>الإصدار v8.0.0</td><td>يمكن أن يكون خيار <code>ALPNProtocols</code> الآن <code>TypedArray</code> أو <code>DataView</code>.</td></tr><tr><td>الإصدار v5.0.0</td><td>خيارات ALPN مدعومة الآن.</td></tr><tr><td>الإصدار v5.3.0, v4.7.0</td><td>خيار <code>secureContext</code> مدعوم الآن.</td></tr><tr><td>الإصدار v0.11.3</td><td>تمت إضافته في: v0.11.3</td></tr></tbody></table></div><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;الكائن&gt;</a></p><ul><li><code>enableTrace</code>: انظر <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>host</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;سلسلة&gt;</a> المضيف الذي يجب أن يتصل به العميل. <strong>الافتراضي:</strong> <code>&#39;localhost&#39;</code>.</li><li><code>port</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;رقم&gt;</a> المنفذ الذي يجب أن يتصل به العميل.</li><li><code>path</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;سلسلة&gt;</a> ينشئ اتصال مقبس Unix إلى المسار. إذا تم تحديد هذا الخيار، فسيتم تجاهل <code>host</code> و <code>port</code>.</li><li><code>socket</code> <a href="/ar/nodejs/api/stream#class-streamduplex">&lt;stream.Duplex&gt;</a> ينشئ اتصالاً آمنًا على مقبس معين بدلاً من إنشاء مقبس جديد. عادةً ما يكون هذا مثيلاً لـ <a href="/ar/nodejs/api/net#class-netsocket"><code>net.Socket</code></a>، ولكن يُسمح بأي دفق <code>Duplex</code>. إذا تم تحديد هذا الخيار، فسيتم تجاهل <code>path</code> و <code>host</code> و <code>port</code> باستثناء التحقق من الشهادة. عادةً ما يكون المقبس متصلاً بالفعل عند تمريره إلى <code>tls.connect()</code>، ولكن يمكن توصيله لاحقًا. اتصال/قطع الاتصال/تدمير <code>socket</code> هي مسؤولية المستخدم؛ لن يؤدي استدعاء <code>tls.connect()</code> إلى استدعاء <code>net.connect()</code>.</li><li><code>allowHalfOpen</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;منطقية&gt;</a> إذا تم تعيينها على <code>false</code>، فسينهي المقبس تلقائيًا الجانب القابل للكتابة عندما ينتهي الجانب القابل للقراءة. إذا تم تعيين خيار <code>socket</code>، فلن يكون لهذا الخيار أي تأثير. راجع خيار <code>allowHalfOpen</code> في <a href="/ar/nodejs/api/net#class-netsocket"><code>net.Socket</code></a> للحصول على التفاصيل. <strong>الافتراضي:</strong> <code>false</code>.</li><li><code>rejectUnauthorized</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;منطقية&gt;</a> إذا لم يكن <code>false</code>، فسيتم التحقق من شهادة الخادم مقابل قائمة CAs المقدمة. يتم إصدار حدث <code>&#39;error&#39;</code> إذا فشل التحقق؛ يحتوي <code>err.code</code> على رمز خطأ OpenSSL. <strong>الافتراضي:</strong> <code>true</code>.</li><li><code>pskCallback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;دالة&gt;</a> بالنسبة لتفاوض TLS-PSK، انظر <a href="/ar/nodejs/api/tls#pre-shared-keys">مفاتيح مشتركة مسبقًا</a>.</li><li><code>ALPNProtocols</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;سلسلة[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> مجموعة من السلاسل أو <code>Buffer</code> أو <code>TypedArray</code> أو <code>DataView</code>، أو <code>Buffer</code> واحد أو <code>TypedArray</code> أو <code>DataView</code> يحتوي على بروتوكولات ALPN المدعومة. يجب أن يكون تنسيق <code>Buffer</code> هو <code>[len][name][len][name]...</code> مثل <code>&#39;\\x08http/1.1\\x08http/1.0&#39;</code>، حيث يكون بايت <code>len</code> هو طول اسم البروتوكول التالي. عادةً ما يكون تمرير مجموعة أبسط بكثير، على سبيل المثال <code>[&#39;http/1.1&#39;, &#39;http/1.0&#39;]</code>. تتمتع البروتوكولات السابقة في القائمة بأولوية أعلى من البروتوكولات اللاحقة.</li><li><code>servername</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;سلسلة&gt;</a> اسم الخادم لامتداد SNI (إشارة اسم الخادم) TLS. إنه اسم المضيف الذي يتم الاتصال به، ويجب أن يكون اسم مضيف وليس عنوان IP. يمكن استخدامه بواسطة خادم متعدد الاستضافة لاختيار الشهادة الصحيحة لتقديمها للعميل، انظر خيار <code>SNICallback</code> في <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a>.</li><li><code>checkServerIdentity(servername, cert)</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;دالة&gt;</a> وظيفة رد نداء لاستخدامها (بدلاً من وظيفة <code>tls.checkServerIdentity()</code> المضمنة) عند التحقق من اسم مضيف الخادم (أو <code>servername</code> المقدمة عند تعيينها صراحةً) مقابل الشهادة. يجب أن يُرجع هذا <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noreferrer">&lt;خطأ&gt;</a> إذا فشل التحقق. يجب أن تُرجع الطريقة <code>undefined</code> إذا تم التحقق من <code>servername</code> و <code>cert</code>.</li><li><code>session</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> مثيل <code>Buffer</code>، يحتوي على جلسة TLS.</li><li><code>minDHSize</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;رقم&gt;</a> الحد الأدنى لحجم معلمة DH بالبتات لقبول اتصال TLS. عندما يقدم الخادم معلمة DH بحجم أقل من <code>minDHSize</code>، يتم تدمير اتصال TLS ويتم طرح خطأ. <strong>الافتراضي:</strong> <code>1024</code>.</li><li><code>highWaterMark</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;رقم&gt;</a> يتوافق مع معلمة دفق القراءة <code>highWaterMark</code>. <strong>الافتراضي:</strong> <code>16 * 1024</code>.</li><li><code>secureContext</code>: كائن سياق TLS تم إنشاؤه باستخدام <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. إذا <em>لم</em> يتم توفير <code>secureContext</code>، فسيتم إنشاء واحد عن طريق تمرير كائن <code>options</code> بالكامل إلى <code>tls.createSecureContext()</code>.</li><li><code>onread</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;الكائن&gt;</a> إذا كان خيار <code>socket</code> مفقودًا، فسيتم تخزين البيانات الواردة في <code>buffer</code> واحد وتمريرها إلى <code>callback</code> المقدمة عند وصول البيانات إلى المقبس، وإلا فسيتم تجاهل الخيار. انظر خيار <code>onread</code> في <a href="/ar/nodejs/api/net#class-netsocket"><code>net.Socket</code></a> للحصول على التفاصيل.</li><li>...: خيارات <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> التي يتم استخدامها إذا كان خيار <code>secureContext</code> مفقودًا، وإلا فسيتم تجاهلها.</li><li>...: أي خيار <a href="/ar/nodejs/api/net#socketconnectoptions-connectlistener"><code>socket.connect()</code></a> غير مدرج بالفعل.</li></ul></li><li><p><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;دالة&gt;</a></p></li><li><p>الإرجاع: <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a></p></li></ul><p>ستتم إضافة وظيفة <code>callback</code>، إذا تم تحديدها، كمستمع لحدث <a href="/ar/nodejs/api/tls#event-secureconnect"><code>&#39;secureConnect&#39;</code></a>.</p><p>تُرجع <code>tls.connect()</code> كائن <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a>.</p><p>على عكس واجهة برمجة تطبيقات <code>https</code>، لا تقوم <code>tls.connect()</code> بتمكين امتداد SNI (إشارة اسم الخادم) بشكل افتراضي، مما قد يتسبب في قيام بعض الخوادم بإرجاع شهادة غير صحيحة أو رفض الاتصال تمامًا. لتمكين SNI، قم بتعيين خيار <code>servername</code> بالإضافة إلى <code>host</code>.</p><p>يوضح ما يلي عميلاً لمثال خادم الصدى من <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a>:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-2354" id="tab-2355" checked><label data-title="ESM" for="tab-2355">ESM</label><input type="radio" name="group-2354" id="tab-2356"><label data-title="CJS" for="tab-2356">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// يفترض وجود خادم صدى يستمع على المنفذ 8000.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { connect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readFileSync } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { stdin } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:process&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا كان الخادم يتطلب مصادقة شهادة العميل.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا كان الخادم يستخدم شهادة موقعة ذاتيًا.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ca: [ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا لم تكن شهادة الخادم لـ &quot;localhost&quot;.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  checkServerIdentity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, options, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client connected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              socket.authorized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorized&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unauthorized&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stdin.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stdin.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server ends connection&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// يفترض وجود خادم صدى يستمع على المنفذ 8000.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا كان الخادم يتطلب مصادقة شهادة العميل.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا كان الخادم يستخدم شهادة موقعة ذاتيًا.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ca: [ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ضروري فقط إذا لم تكن شهادة الخادم لـ &quot;localhost&quot;.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  checkServerIdentity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> socket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, options, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client connected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              socket.authorized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorized&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unauthorized&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  process.stdin.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  process.stdin.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server ends connection&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></div></div><p>لإنشاء الشهادة والمفتاح لهذا المثال، قم بتشغيل:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -newkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa:2048</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -subj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/CN=localhost&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -keyout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ثم، لإنشاء شهادة <code>server-cert.pem</code> لهذا المثال، قم بتشغيل:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkcs12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -certpbe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AES-256-CBC</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -export</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server-cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -inkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="tlsconnectpath-options-callback" tabindex="-1"><code>tls.connect(path[, options][, callback])</code> <a class="header-anchor" href="#tlsconnectpath-options-callback" aria-label="Permalink to “tls.connect(path[, options][, callback])”">​</a></h2><p><strong>أُضيف في: v0.11.3</strong></p><ul><li><code>path</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> القيمة الافتراضية لـ <code>options.path</code>.</li><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> انظر <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>.</li><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> انظر <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>.</li><li>العائدات: <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a></li></ul><p>نفس <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> باستثناء أنه يمكن توفير <code>path</code> كمعامل بدلاً من خيار.</p><p>سيكون لخيار المسار، إذا تم تحديده، الأسبقية على معامل المسار.</p><h2 id="tlsconnectport-host-options-callback" tabindex="-1"><code>tls.connect(port[, host][, options][, callback])</code> <a class="header-anchor" href="#tlsconnectport-host-options-callback" aria-label="Permalink to “tls.connect(port[, host][, options][, callback])”">​</a></h2><p><strong>أُضيف في: v0.11.3</strong></p><ul><li><code>port</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> القيمة الافتراضية لـ <code>options.port</code>.</li><li><code>host</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> القيمة الافتراضية لـ <code>options.host</code>.</li><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a> انظر <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>.</li><li><code>callback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> انظر <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>.</li><li>العائدات: <a href="/ar/nodejs/api/tls#class-tlstlssocket">&lt;tls.TLSSocket&gt;</a></li></ul><p>نفس <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a> باستثناء أنه يمكن توفير <code>port</code> و <code>host</code> كمعاملات بدلاً من خيارات.</p><p>سيكون لخيار المنفذ أو المضيف، إذا تم تحديده، الأسبقية على أي معامل منفذ أو مضيف.</p><h2 id="tlscreatesecurecontextoptions" tabindex="-1"><code>tls.createSecureContext([options])</code> <a class="header-anchor" href="#tlscreatesecurecontextoptions" aria-label="Permalink to “tls.createSecureContext([options])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[تاريخ الإصدار]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v22.9.0, v20.18.0</td><td>تمت إضافة خيار <code>allowPartialTrustChain</code>.</td></tr><tr><td>v22.4.0, v20.16.0</td><td>يعتمد الخيار <code>clientCertEngine</code> و <code>privateKeyEngine</code> و <code>privateKeyIdentifier</code> على دعم المحرك المخصص في OpenSSL الذي تم إهماله في OpenSSL 3.</td></tr><tr><td>v19.8.0, v18.16.0</td><td>يمكن الآن تعيين الخيار <code>dhparam</code> على <code>&#39;auto&#39;</code> لتمكين DHE مع معلمات معروفة ومناسبة.</td></tr><tr><td>v12.12.0</td><td>تمت إضافة خيارات <code>privateKeyIdentifier</code> و <code>privateKeyEngine</code> للحصول على مفتاح خاص من محرك OpenSSL.</td></tr><tr><td>v12.11.0</td><td>تمت إضافة خيار <code>sigalgs</code> لتجاوز خوارزميات التوقيع المدعومة.</td></tr><tr><td>v12.0.0</td><td>تمت إضافة دعم TLSv1.3.</td></tr><tr><td>v11.5.0</td><td>يدعم الخيار <code>ca:</code> الآن <code>BEGIN TRUSTED CERTIFICATE</code>.</td></tr><tr><td>v11.4.0, v10.16.0</td><td>يمكن استخدام <code>minVersion</code> و <code>maxVersion</code> لتقييد إصدارات بروتوكول TLS المسموح بها.</td></tr><tr><td>v10.0.0</td><td>لم يعد بالإمكان تعيين <code>ecdhCurve</code> على <code>false</code> بسبب تغيير في OpenSSL.</td></tr><tr><td>v9.3.0</td><td>يمكن أن يتضمن الآن المعامل <code>options</code> <code>clientCertEngine</code>.</td></tr><tr><td>v9.0.0</td><td>يمكن أن يكون الخيار <code>ecdhCurve</code> الآن أسماء منحنيات متعددة مفصولة بـ <code>&#39;:&#39;</code> أو <code>&#39;auto&#39;</code>.</td></tr><tr><td>v7.3.0</td><td>إذا كان الخيار <code>key</code> عبارة عن مصفوفة، فلا تحتاج الإدخالات الفردية إلى خاصية <code>passphrase</code> بعد الآن. يمكن أن تكون إدخالات <code>Array</code> أيضًا مجرد <code>string</code> أو <code>Buffer</code> الآن.</td></tr><tr><td>v5.2.0</td><td>يمكن أن يكون الخيار <code>ca</code> الآن سلسلة واحدة تحتوي على شهادات CA متعددة.</td></tr><tr><td>v0.11.13</td><td>أُضيف في: v0.11.13</td></tr></tbody></table></div><ul><li><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a><ul><li><code>allowPartialTrustChain</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> التعامل مع الشهادات الوسيطة (غير الموقعة ذاتيًا) في قائمة شهادات CA الموثوق بها على أنها موثوقة.</li><li><code>ca</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> تجاوز اختياري لشهادات CA الموثوق بها. الافتراضي هو الوثوق بـ CAs المعروفة التي ترعاها Mozilla. يتم استبدال CAs الخاصة بـ Mozilla تمامًا عند تحديد CAs بشكل صريح باستخدام هذا الخيار. يمكن أن تكون القيمة سلسلة أو <code>Buffer</code>، أو <code>Array</code> من السلاسل و/أو <code>Buffer</code>s. يمكن أن تحتوي أي سلسلة أو <code>Buffer</code> على العديد من PEM CAs المتسلسلة معًا. يجب أن تكون شهادة النظير قابلة للتسلسل إلى CA موثوق بها من قبل الخادم ليتم مصادقة الاتصال. عند استخدام الشهادات غير القابلة للتسلسل إلى CA معروفة، يجب تحديد CA الخاصة بالشهادة بشكل صريح على أنها موثوقة وإلا سيفشل الاتصال في المصادقة. إذا كان النظير يستخدم شهادة لا تطابق أو تتسلسل إلى إحدى CAs الافتراضية، فاستخدم الخيار <code>ca</code> لتوفير شهادة CA يمكن أن تطابق شهادة النظير أو تتسلسل إليها. بالنسبة للشهادات الموقعة ذاتيًا، تكون الشهادة هي CA الخاصة بها، ويجب توفيرها. بالنسبة للشهادات المشفرة PEM، الأنواع المدعومة هي &quot;TRUSTED CERTIFICATE&quot; و &quot;X509 CERTIFICATE&quot; و &quot;CERTIFICATE&quot;. انظر أيضًا <a href="/ar/nodejs/api/tls#tlsrootcertificates"><code>tls.rootCertificates</code></a>.</li><li><code>cert</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> سلاسل الشهادات بتنسيق PEM. يجب توفير سلسلة شهادات واحدة لكل مفتاح خاص. يجب أن تتكون كل سلسلة شهادات من الشهادة المنسقة PEM لمفتاح <code>key</code> خاص مُقدَّم، متبوعة بالشهادات الوسيطة المنسقة PEM (إن وجدت)، بالترتيب، وعدم تضمين CA الجذر (يجب أن تكون CA الجذر معروفة مسبقًا للنظير، انظر <code>ca</code>). عند توفير سلاسل شهادات متعددة، ليس من الضروري أن تكون بنفس ترتيب مفاتيحها الخاصة في <code>key</code>. إذا لم يتم توفير الشهادات الوسيطة، فلن يتمكن النظير من التحقق من صحة الشهادة، وستفشل المصافحة.</li><li><code>sigalgs</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> قائمة خوارزميات التوقيع المدعومة مفصولة بنقطتين رأسيتين. يمكن أن تحتوي القائمة على خوارزميات التجزئة (<code>SHA256</code>، <code>MD5</code> وما إلى ذلك)، أو خوارزميات المفتاح العام (<code>RSA-PSS</code>، <code>ECDSA</code> وما إلى ذلك)، أو مجموعة من الاثنين معًا (على سبيل المثال، &#39;RSA+SHA384&#39;) أو أسماء مخطط TLS v1.3 (على سبيل المثال، <code>rsa_pss_pss_sha512</code>). انظر <a href="https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set1_sigalgs_list" target="_blank" rel="noreferrer">صفحات دليل OpenSSL</a> لمزيد من المعلومات.</li><li><code>ciphers</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> مواصفات مجموعة التشفير، لتحل محل الإعداد الافتراضي. لمزيد من المعلومات، انظر <a href="/ar/nodejs/api/tls#modifying-the-default-tls-cipher-suite">تعديل مجموعة تشفير TLS الافتراضية</a>. يمكن الحصول على التشفيرات المسموح بها عبر <a href="/ar/nodejs/api/tls#tlsgetciphers"><code>tls.getCiphers()</code></a>. يجب أن تكون أسماء التشفير بأحرف كبيرة حتى يقبلها OpenSSL.</li><li><code>clientCertEngine</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم محرك OpenSSL الذي يمكنه توفير شهادة العميل. <strong>مهملة.</strong></li><li><code>crl</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> CRLs المنسقة PEM (قوائم إبطال الشهادات).</li><li><code>dhparam</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> <code>&#39;auto&#39;</code> أو معلمات Diffie-Hellman المخصصة، المطلوبة لـ non-ECDHE <a href="/ar/nodejs/api/tls#perfect-forward-secrecy">السرية الأمامية المثالية</a>. إذا تم حذفه أو كان غير صالح، فسيتم تجاهل المعلمات بصمت ولن تتوفر تشفيرات DHE. <a href="https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman" target="_blank" rel="noreferrer">ECDHE</a> القائمة على <a href="/ar/nodejs/api/tls#perfect-forward-secrecy">السرية الأمامية المثالية</a> ستظل متاحة.</li><li><code>ecdhCurve</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> سلسلة تصف منحنى مسمى أو قائمة NIDs أو أسماء منحنيات مفصولة بنقطتين رأسيتين، على سبيل المثال <code>P-521:P-384:P-256</code>، لاستخدامها لاتفاقية مفتاح ECDH. اضبط على <code>auto</code> لتحديد المنحنى تلقائيًا. استخدم <a href="/ar/nodejs/api/crypto#cryptogetcurves"><code>crypto.getCurves()</code></a> للحصول على قائمة بأسماء المنحنيات المتاحة. في الإصدارات الحديثة، سيعرض <code>openssl ecparam -list_curves</code> أيضًا اسم ووصف كل منحنى إهليلجي متاح. <strong>الافتراضي:</strong> <a href="/ar/nodejs/api/tls#tlsdefault-ecdh-curve"><code>tls.DEFAULT_ECDH_CURVE</code></a>.</li><li><code>honorCipherOrder</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> محاولة استخدام تفضيلات مجموعة التشفير الخاصة بالخادم بدلاً من تفضيلات العميل. عندما تكون <code>true</code>، يتسبب في تعيين <code>SSL_OP_CIPHER_SERVER_PREFERENCE</code> في <code>secureOptions</code>، انظر <a href="/ar/nodejs/api/crypto#openssl-options">خيارات OpenSSL</a> لمزيد من المعلومات.</li><li><code>key</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object[]&gt;</a> المفاتيح الخاصة بتنسيق PEM. يسمح PEM بخيار تشفير المفاتيح الخاصة. سيتم فك تشفير المفاتيح المشفرة باستخدام <code>options.passphrase</code>. يمكن توفير مفاتيح متعددة تستخدم خوارزميات مختلفة إما كمصفوفة من سلاسل أو مخازن مؤقتة للمفاتيح غير المشفرة، أو مصفوفة من الكائنات بالشكل <code>{pem: \\&lt;string|buffer\\&gt;[, passphrase: \\&lt;string\\&gt;]}</code>. يمكن أن يظهر شكل الكائن فقط في مصفوفة. <code>object.passphrase</code> اختياري. سيتم فك تشفير المفاتيح المشفرة باستخدام <code>object.passphrase</code> إذا تم توفيره، أو <code>options.passphrase</code> إذا لم يكن كذلك.</li><li><code>privateKeyEngine</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم محرك OpenSSL للحصول على المفتاح الخاص منه. يجب استخدامه مع <code>privateKeyIdentifier</code>. <strong>مهملة.</strong></li><li><code>privateKeyIdentifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> معرف للمفتاح الخاص الذي يديره محرك OpenSSL. يجب استخدامه مع <code>privateKeyEngine</code>. يجب عدم تعيينه مع <code>key</code>، لأن كلا الخيارين يحددان مفتاحًا خاصًا بطرق مختلفة. <strong>مهملة.</strong></li><li><code>maxVersion</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اضبط اختياريًا الحد الأقصى لإصدار TLS المسموح به. أحد <code>&#39;TLSv1.3&#39;</code> أو <code>&#39;TLSv1.2&#39;</code> أو <code>&#39;TLSv1.1&#39;</code> أو <code>&#39;TLSv1&#39;</code>. لا يمكن تحديده مع الخيار <code>secureProtocol</code>؛ استخدم أحدهما أو الآخر. <strong>الافتراضي:</strong> <a href="/ar/nodejs/api/tls#tlsdefault-max-version"><code>tls.DEFAULT_MAX_VERSION</code></a>.</li><li><code>minVersion</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اضبط اختياريًا الحد الأدنى لإصدار TLS المسموح به. أحد <code>&#39;TLSv1.3&#39;</code> أو <code>&#39;TLSv1.2&#39;</code> أو <code>&#39;TLSv1.1&#39;</code> أو <code>&#39;TLSv1&#39;</code>. لا يمكن تحديده مع الخيار <code>secureProtocol</code>؛ استخدم أحدهما أو الآخر. تجنب التعيين إلى أقل من TLSv1.2، ولكن قد يكون ذلك مطلوبًا للتوافق التشغيلي. قد تتطلب الإصدارات التي تسبق TLSv1.2 تخفيض <a href="/ar/nodejs/api/tls#openssl-security-level">مستوى أمان OpenSSL</a>. <strong>الافتراضي:</strong> <a href="/ar/nodejs/api/tls#tlsdefault-min-version"><code>tls.DEFAULT_MIN_VERSION</code></a>.</li><li><code>passphrase</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> عبارة مرور مشتركة تستخدم لمفتاح خاص واحد و/أو PFX.</li><li><code>pfx</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object[]&gt;</a> مفتاح خاص وسلسلة شهادات بتشفير PFX أو PKCS12. <code>pfx</code> هو بديل لتوفير <code>key</code> و <code>cert</code> بشكل فردي. عادة ما يكون PFX مشفرًا، وإذا كان كذلك، فسيتم استخدام <code>passphrase</code> لفك تشفيره. يمكن توفير PFX متعدد إما كمصفوفة من مخازن مؤقتة PFX غير مشفرة، أو مصفوفة من الكائنات بالشكل <code>{buf: \\&lt;string|buffer\\&gt;[, passphrase: \\&lt;string\\&gt;]}</code>. يمكن أن يظهر شكل الكائن فقط في مصفوفة. <code>object.passphrase</code> اختياري. سيتم فك تشفير PFX المشفر باستخدام <code>object.passphrase</code> إذا تم توفيره، أو <code>options.passphrase</code> إذا لم يكن كذلك.</li><li><code>secureOptions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> يؤثر اختياريًا على سلوك بروتوكول OpenSSL، وهو أمر غير ضروري عادةً. يجب استخدام هذا بحذر إذا كان على الإطلاق! القيمة هي قناع بت رقمي لخيارات <code>SSL_OP_*</code> من <a href="/ar/nodejs/api/crypto#openssl-options">خيارات OpenSSL</a>.</li><li><code>secureProtocol</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> آلية قديمة لتحديد إصدار بروتوكول TLS المراد استخدامه، فهي لا تدعم التحكم المستقل في الحد الأدنى والحد الأقصى للإصدار، ولا تدعم قصر البروتوكول على TLSv1.3. استخدم <code>minVersion</code> و <code>maxVersion</code> بدلاً من ذلك. يتم سرد القيم الممكنة كـ <a href="https://www.openssl.org/docs/man1.1.1/man7/ssl#Dealing-with-Protocol-Methods" target="_blank" rel="noreferrer">SSL_METHODS</a>، استخدم أسماء الوظائف كسلاسل. على سبيل المثال، استخدم <code>&#39;TLSv1_1_method&#39;</code> لفرض إصدار TLS 1.1، أو <code>&#39;TLS_method&#39;</code> للسماح بأي إصدار بروتوكول TLS يصل إلى TLSv1.3. لا يوصى باستخدام إصدارات TLS الأقل من 1.2، ولكن قد يكون ذلك مطلوبًا للتوافق التشغيلي. <strong>الافتراضي:</strong> لا شيء، انظر <code>minVersion</code>.</li><li><code>sessionIdContext</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> معرف مبهم يستخدمه الخوادم لضمان عدم مشاركة حالة الجلسة بين التطبيقات. غير مستخدم من قبل العملاء.</li><li><code>ticketKeys</code>: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> 48 بايت من البيانات العشوائية الزائفة المشفرة بقوة. انظر <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</li><li><code>sessionTimeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> عدد الثواني التي بعدها لن تكون جلسة TLS التي أنشأها الخادم قابلة للاستئناف. انظر <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات. <strong>الافتراضي:</strong> <code>300</code>.</li></ul></li></ul><p><a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a> يضبط القيمة الافتراضية للخيار <code>honorCipherOrder</code> على <code>true</code>، تترك واجهات برمجة التطبيقات الأخرى التي تنشئ سياقات آمنة دون تعيينها.</p><p><a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a> يستخدم قيمة تجزئة SHA1 مقتطعة 128 بت تم إنشاؤها من <code>process.argv</code> كقيمة افتراضية للخيار <code>sessionIdContext</code>، لا تحتوي واجهات برمجة التطبيقات الأخرى التي تنشئ سياقات آمنة على قيمة افتراضية.</p><p>يقوم الأسلوب <code>tls.createSecureContext()</code> بإنشاء كائن <code>SecureContext</code>. إنه قابل للاستخدام كمعامل للعديد من واجهات برمجة تطبيقات <code>tls</code>، مثل <a href="/ar/nodejs/api/tls#serveraddcontexthostname-context"><code>server.addContext()</code></a>، ولكن ليس لديه أي أساليب عامة. لا يدعم مُنشئ <a href="/ar/nodejs/api/tls#class-tlsserver"><code>tls.Server</code></a> والأسلوب <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a> الخيار <code>secureContext</code>.</p><p>المفتاح <em>مطلوب</em> للتشفيرات التي تستخدم الشهادات. يمكن استخدام <code>key</code> أو <code>pfx</code> لتوفيره.</p><p>إذا لم يتم إعطاء الخيار <code>ca</code>، فسوف تستخدم Node.js افتراضيًا <a href="https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins/certdata.txt" target="_blank" rel="noreferrer">قائمة CAs الموثوق بها علنًا من Mozilla</a>.</p><p>لا يُنصح باستخدام معلمات DHE المخصصة لصالح الخيار الجديد <code>dhparam: &#39;auto&#39;</code>. عند التعيين على <code>&#39;auto&#39;</code>، سيتم تحديد معلمات DHE المعروفة ذات القوة الكافية تلقائيًا. بخلاف ذلك، إذا لزم الأمر، يمكن استخدام <code>openssl dhparam</code> لإنشاء معلمات مخصصة. يجب أن يكون طول المفتاح أكبر من أو يساوي 1024 بت وإلا سيتم طرح خطأ. على الرغم من أن 1024 بت مسموح به، استخدم 2048 بت أو أكبر لأمان أقوى.</p><h2 id="tlscreatesecurepaircontext-isserver-requestcert-rejectunauthorized-options" tabindex="-1"><code>tls.createSecurePair([context][, isServer][, requestCert][, rejectUnauthorized][, options])</code> <a class="header-anchor" href="#tlscreatesecurepaircontext-isserver-requestcert-rejectunauthorized-options" aria-label="Permalink to “tls.createSecurePair([context][, isServer][, requestCert][, rejectUnauthorized][, options])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v5.0.0</td><td>خيارات ALPN مدعومة الآن.</td></tr><tr><td>v0.11.3</td><td>مهمل منذ: v0.11.3</td></tr><tr><td>v0.3.2</td><td>تمت الإضافة في: v0.3.2</td></tr></tbody></table></div><div class="danger custom-block"><p class="custom-block-title">[مستقر: 0 - مهمل]</p><p><a href="/ar/nodejs/api/documentation#stability-index">مستقر: 0</a> <a href="/ar/nodejs/api/documentation#stability-index">الاستقرار: 0</a> - مهمل: استخدم <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a> بدلاً من ذلك.</p></div><ul><li><code>context</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;الكائن&gt;</a> كائن سياق آمن كما هو مُرجع بواسطة <code>tls.createSecureContext()</code></li><li><code>isServer</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;بولياني&gt;</a> <code>true</code> لتحديد أنه يجب فتح اتصال TLS هذا كخادم.</li><li><code>requestCert</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;بولياني&gt;</a> <code>true</code> لتحديد ما إذا كان يجب على الخادم طلب شهادة من العميل المتصل. ينطبق فقط عندما تكون <code>isServer</code> هي <code>true</code>.</li><li><code>rejectUnauthorized</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;بولياني&gt;</a> إذا لم تكن <code>false</code> سيرفض الخادم تلقائيًا العملاء الذين لديهم شهادات غير صالحة. ينطبق فقط عندما تكون <code>isServer</code> هي <code>true</code>.</li><li><code>options</code><ul><li><code>enableTrace</code>: راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>secureContext</code>: كائن سياق TLS من <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a></li><li><code>isServer</code>: إذا كانت <code>true</code> سيتم إنشاء مقبس TLS في وضع الخادم. <strong>افتراضي:</strong> <code>false</code>.</li><li><code>server</code> <a href="/ar/nodejs/api/net#class-netserver">&lt;net.Server&gt;</a> مثيل <a href="/ar/nodejs/api/net#class-netserver"><code>net.Server</code></a></li><li><code>requestCert</code>: راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>rejectUnauthorized</code>: راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>ALPNProtocols</code>: راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>SNICallback</code>: راجع <a href="/ar/nodejs/api/tls#tlscreateserveroptions-secureconnectionlistener"><code>tls.createServer()</code></a></li><li><code>session</code> <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> مثيل <code>Buffer</code> يحتوي على جلسة TLS.</li><li><code>requestOCSP</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;بولياني&gt;</a> إذا كانت <code>true</code>، تحدد أنه ستتم إضافة ملحق طلب حالة OCSP إلى تحية العميل وسيتم إصدار حدث <code>&#39;OCSPResponse&#39;</code> على المقبس قبل إنشاء اتصال آمن.</li></ul></li></ul><p>يقوم بإنشاء كائن زوج آمن جديد مع تدفقين، أحدهما يقرأ ويكتب البيانات المشفرة والآخر يقرأ ويكتب بيانات النص الواضح. بشكل عام، يتم توجيه التدفق المشفر من/إلى تدفق بيانات مشفرة واردة ويستخدم تدفق النص الواضح كبديل للتدفق المشفر الأولي.</p><p><code>tls.createSecurePair()</code> يُرجع كائن <code>tls.SecurePair</code> مع خصائص تدفق <code>cleartext</code> و <code>encrypted</code>.</p><p>استخدام <code>cleartext</code> لديه نفس واجهة برمجة التطبيقات مثل <a href="/ar/nodejs/api/tls#class-tlstlssocket"><code>tls.TLSSocket</code></a>.</p><p>تم الآن إهمال طريقة <code>tls.createSecurePair()</code> لصالح <code>tls.TLSSocket()</code>. على سبيل المثال، الكود:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tls.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createSecurePair</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ... */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pair.encrypted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pair.encrypted);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>يمكن استبداله بـ:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secureSocket </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tls.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TLSSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket, options);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>حيث أن <code>secureSocket</code> لديه نفس واجهة برمجة التطبيقات مثل <code>pair.cleartext</code>.</p><h2 id="tlscreateserveroptions-secureconnectionlistener" tabindex="-1"><code>tls.createServer([options][, secureConnectionListener])</code> <a class="header-anchor" href="#tlscreateserveroptions-secureconnectionlistener" aria-label="Permalink to “tls.createServer([options][, secureConnectionListener])”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v22.4.0, v20.16.0</td><td>يعتمد خيار <code>clientCertEngine</code> على دعم محرك مخصص في OpenSSL الذي تم إهماله في OpenSSL 3.</td></tr><tr><td>v19.0.0</td><td>إذا تم تعيين <code>ALPNProtocols</code>، فسيتم إنهاء الاتصالات الواردة التي ترسل ملحق ALPN بدون بروتوكولات مدعومة بتنبيه <code>no_application_protocol</code> قاتل.</td></tr><tr><td>v20.4.0, v18.19.0</td><td>يمكن أن يتضمن المعامل <code>options</code> الآن <code>ALPNCallback</code>.</td></tr><tr><td>v12.3.0</td><td>يدعم المعامل <code>options</code> الآن خيارات <code>net.createServer()</code>.</td></tr><tr><td>v9.3.0</td><td>يمكن أن يتضمن المعامل <code>options</code> الآن <code>clientCertEngine</code>.</td></tr><tr><td>v8.0.0</td><td>يمكن أن يكون خيار <code>ALPNProtocols</code> الآن <code>TypedArray</code> أو <code>DataView</code>.</td></tr><tr><td>v5.0.0</td><td>خيارات ALPN مدعومة الآن.</td></tr><tr><td>v0.3.2</td><td>تمت الإضافة في: v0.3.2</td></tr></tbody></table></div><ul><li><p><code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></p><ul><li><code>ALPNProtocols</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray[]&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView[]&gt;</a> | <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noreferrer">&lt;TypedArray&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank" rel="noreferrer">&lt;DataView&gt;</a> مصفوفة من السلاسل أو <code>Buffer</code>s أو <code>TypedArray</code>s أو <code>DataView</code>s، أو <code>Buffer</code> أو <code>TypedArray</code> أو <code>DataView</code> واحد يحتوي على بروتوكولات ALPN المدعومة. يجب أن يكون تنسيق <code>Buffer</code>s هو <code>[len][name][len][name]...</code> على سبيل المثال <code>0x05hello0x05world</code>، حيث يكون البايت الأول هو طول اسم البروتوكول التالي. عادةً ما يكون تمرير مصفوفة أبسط بكثير، على سبيل المثال <code>[&#39;hello&#39;, &#39;world&#39;]</code>. (يجب ترتيب البروتوكولات حسب أولويتها.)</li><li><code>ALPNCallback</code>: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> إذا تم تعيينه، فسيتم استدعاء هذا عندما يفتح عميل اتصالًا باستخدام ملحق ALPN. سيتم تمرير وسيطة واحدة إلى الاستدعاء: كائن يحتوي على حقلي <code>servername</code> و <code>protocols</code>، على التوالي يحتويان على اسم الخادم من ملحق SNI (إن وجد) ومصفوفة من سلاسل أسماء بروتوكول ALPN. يجب أن يُرجع الاستدعاء إما إحدى السلاسل المدرجة في <code>protocols</code>، والتي سيتم إرجاعها إلى العميل كبروتوكول ALPN المحدد، أو <code>undefined</code>، لرفض الاتصال بتنبيه قاتل. إذا تم إرجاع سلسلة لا تتطابق مع أحد بروتوكولات ALPN الخاصة بالعميل، فسيتم طرح خطأ. لا يمكن استخدام هذا الخيار مع خيار <code>ALPNProtocols</code>، وسيؤدي تعيين كلا الخيارين إلى طرح خطأ.</li><li><code>clientCertEngine</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> اسم محرك OpenSSL الذي يمكنه توفير شهادة العميل. <strong>تم الإهمال.</strong></li><li><code>enableTrace</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> إذا كان <code>true</code>، فسيتم استدعاء <a href="/ar/nodejs/api/tls#tlssocketenabletrace"><code>tls.TLSSocket.enableTrace()</code></a> على الاتصالات الجديدة. يمكن تمكين التتبع بعد إنشاء الاتصال الآمن، ولكن يجب استخدام هذا الخيار لتتبع إعداد الاتصال الآمن. <strong>الافتراضي:</strong> <code>false</code>.</li><li><code>handshakeTimeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> قم بإجهاض الاتصال إذا لم تنتهِ مصافحة SSL/TLS في العدد المحدد من المللي ثانية. يتم إصدار <code>&#39;tlsClientError&#39;</code> على كائن <code>tls.Server</code> كلما انتهت مهلة المصافحة. <strong>الافتراضي:</strong> <code>120000</code> (120 ثانية).</li><li><code>rejectUnauthorized</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> إذا لم يكن <code>false</code>، فسيرفض الخادم أي اتصال غير مصرح به بقائمة CAs المقدمة. هذا الخيار له تأثير فقط إذا كان <code>requestCert</code> هو <code>true</code>. <strong>الافتراضي:</strong> <code>true</code>.</li><li><code>requestCert</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" target="_blank" rel="noreferrer">&lt;boolean&gt;</a> إذا كان <code>true</code>، فسيطلب الخادم شهادة من العملاء الذين يتصلون ويحاولون التحقق من هذه الشهادة. <strong>الافتراضي:</strong> <code>false</code>.</li><li><code>sessionTimeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" target="_blank" rel="noreferrer">&lt;number&gt;</a> عدد الثواني التي بعدها لن يكون من الممكن استئناف جلسة TLS التي أنشأها الخادم. راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات. <strong>الافتراضي:</strong> <code>300</code>.</li><li><code>SNICallback(servername, callback)</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> دالة سيتم استدعاؤها إذا كان العميل يدعم ملحق SNI TLS. سيتم تمرير وسيطتين عند الاستدعاء: <code>servername</code> و <code>callback</code>. <code>callback</code> هو استدعاء الخطأ الأول الذي يأخذ وسيطتين اختياريتين: <code>error</code> و <code>ctx</code>. <code>ctx</code>، إذا تم توفيره، هو مثيل <code>SecureContext</code>. يمكن استخدام <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> للحصول على <code>SecureContext</code> مناسب. إذا تم استدعاء <code>callback</code> بوسيطة <code>ctx</code> زائفة، فسيتم استخدام سياق الأمان الافتراضي للخادم. إذا لم يتم توفير <code>SNICallback</code>، فسيتم استخدام الاستدعاء الافتراضي مع واجهة برمجة تطبيقات عالية المستوى (انظر أدناه).</li><li><code>ticketKeys</code>: <a href="/ar/nodejs/api/buffer#class-buffer">&lt;Buffer&gt;</a> 48 بايت من البيانات العشوائية الزائفة القوية المشفرة. راجع <a href="/ar/nodejs/api/tls#session-resumption">استئناف الجلسة</a> لمزيد من المعلومات.</li><li><code>pskCallback</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a> لتفاوض TLS-PSK، راجع <a href="/ar/nodejs/api/tls#pre-shared-keys">المفاتيح المشتركة مسبقًا</a>.</li><li><code>pskIdentityHint</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> تلميح اختياري لإرساله إلى العميل للمساعدة في تحديد الهوية أثناء تفاوض TLS-PSK. سيتم تجاهله في TLS 1.3. عند الفشل في تعيين pskIdentityHint، سيتم إصدار <code>&#39;tlsClientError&#39;</code> مع رمز <code>&#39;ERR_TLS_PSK_SET_IDENTITY_HINT_FAILED&#39;</code>.</li><li>...: يمكن توفير أي خيار <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. بالنسبة للخوادم، عادةً ما تكون خيارات الهوية (<code>pfx</code> أو <code>key</code>/<code>cert</code> أو <code>pskCallback</code>) مطلوبة.</li><li>...: يمكن توفير أي خيار <a href="/ar/nodejs/api/net#netcreateserveroptions-connectionlistener"><code>net.createServer()</code></a>.</li></ul></li><li><p><code>secureConnectionListener</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noreferrer">&lt;Function&gt;</a></p></li><li><p>الإرجاع: <a href="/ar/nodejs/api/tls#class-tlsserver">&lt;tls.Server&gt;</a></p></li></ul><p>ينشئ <a href="/ar/nodejs/api/tls#class-tlsserver"><code>tls.Server</code></a> جديدًا. يتم تعيين <code>secureConnectionListener</code>، إذا تم توفيره، تلقائيًا كمستمع لحدث <a href="/ar/nodejs/api/tls#event-secureconnection"><code>&#39;secureConnection&#39;</code></a>.</p><p>تتم مشاركة خيارات <code>ticketKeys</code> تلقائيًا بين العاملين في وحدة <code>node:cluster</code>.</p><p>يوضح ما يلي خادم صدى بسيط:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-3035" id="tab-3036" checked><label data-title="ESM" for="tab-3036">ESM</label><input type="radio" name="group-3035" id="tab-3037"><label data-title="CJS" for="tab-3037">CJS</label></div><div class="blocks"><div class="language-js active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { createServer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readFileSync } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This is necessary only if using client certificate authentication.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  requestCert: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This is necessary only if the client uses a self-signed certificate.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ca: [ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server connected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              socket.authorized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorized&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unauthorized&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server bound&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:tls&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-key.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cert: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This is necessary only if using client certificate authentication.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  requestCert: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This is necessary only if the client uses a self-signed certificate.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ca: [ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;client-cert.pem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(options, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server connected&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              socket.authorized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorized&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unauthorized&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;welcome!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  socket.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(socket);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;server bound&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div></div><p>لإنشاء الشهادة والمفتاح لهذا المثال، قم بتشغيل:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -x509</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -newkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa:2048</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sha256</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -subj</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/CN=localhost&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -keyout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>بعد ذلك، لإنشاء شهادة <code>client-cert.pem</code> لهذا المثال، قم بتشغيل:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pkcs12</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -certpbe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> AES-256-CBC</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -export</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> client-cert.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -inkey</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server-key.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server-cert.pem</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>يمكن اختبار الخادم عن طريق الاتصال به باستخدام مثال العميل من <a href="/ar/nodejs/api/tls#tlsconnectoptions-callback"><code>tls.connect()</code></a>.</p><h2 id="tlsgetciphers" tabindex="-1"><code>tls.getCiphers()</code> <a class="header-anchor" href="#tlsgetciphers" aria-label="Permalink to “tls.getCiphers()”">​</a></h2><p><strong>تمت الإضافة في: الإصدار 0.10.2</strong></p><ul><li>الإرجاع: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a></li></ul><p>تقوم بإرجاع مصفوفة بأسماء تشفيرات TLS المدعومة. الأسماء هي بأحرف صغيرة لأسباب تاريخية، ولكن يجب أن تكون بأحرف كبيرة لاستخدامها في خيار <code>ciphers</code> الخاص بـ <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>.</p><p>ليست كل التشفيرات المدعومة مفعلة افتراضيًا. راجع <a href="/ar/nodejs/api/tls#modifying-the-default-tls-cipher-suite">تعديل مجموعة تشفير TLS الافتراضية</a>.</p><p>أسماء التشفير التي تبدأ بـ <code>&#39;tls_&#39;</code> هي لـ TLSv1.3، وجميع الأسماء الأخرى لـ TLSv1.2 والإصدارات الأقدم.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tls.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCiphers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [&#39;aes128-gcm-sha256&#39;, &#39;aes128-sha&#39;, ...]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="tlsrootcertificates" tabindex="-1"><code>tls.rootCertificates</code> <a class="header-anchor" href="#tlsrootcertificates" aria-label="Permalink to “tls.rootCertificates”">​</a></h2><p><strong>تمت الإضافة في: الإصدار 12.3.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string[]&gt;</a></li></ul><p>مصفوفة غير قابلة للتغيير من السلاسل النصية تمثل شهادات الجذر (بتنسيق PEM) من متجر Mozilla CA المجمّع كما هو مقدم من إصدار Node.js الحالي.</p><p>إن متجر CA المجمّع، كما هو مقدم من Node.js، هو لقطة من متجر Mozilla CA ثابتة في وقت الإصدار. إنه متطابق على جميع الأنظمة الأساسية المدعومة.</p><h2 id="tlsdefault_ecdh_curve" tabindex="-1"><code>tls.DEFAULT_ECDH_CURVE</code> <a class="header-anchor" href="#tlsdefault_ecdh_curve" aria-label="Permalink to “tls.DEFAULT_ECDH_CURVE”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[السجل]</p><table tabindex="0"><thead><tr><th>الإصدار</th><th>التغييرات</th></tr></thead><tbody><tr><td>v10.0.0</td><td>تم تغيير القيمة الافتراضية إلى <code>&#39;auto&#39;</code>.</td></tr><tr><td>v0.11.13</td><td>تمت الإضافة في: الإصدار 0.11.13</td></tr></tbody></table></div><p>اسم المنحنى الافتراضي المستخدم لاتفاقية مفتاح ECDH في خادم tls. القيمة الافتراضية هي <code>&#39;auto&#39;</code>. راجع <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a> لمزيد من المعلومات.</p><h2 id="tlsdefault_max_version" tabindex="-1"><code>tls.DEFAULT_MAX_VERSION</code> <a class="header-anchor" href="#tlsdefault_max_version" aria-label="Permalink to “tls.DEFAULT_MAX_VERSION”">​</a></h2><p><strong>تمت الإضافة في: الإصدار 11.4.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> القيمة الافتراضية للخيار <code>maxVersion</code> الخاص بـ <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. يمكن تعيين أي من إصدارات بروتوكول TLS المدعومة، <code>&#39;TLSv1.3&#39;</code> أو <code>&#39;TLSv1.2&#39;</code> أو <code>&#39;TLSv1.1&#39;</code> أو <code>&#39;TLSv1&#39;</code>. <strong>افتراضي:</strong> <code>&#39;TLSv1.3&#39;</code>، ما لم يتم تغييره باستخدام خيارات CLI. يؤدي استخدام <code>--tls-max-v1.2</code> إلى تعيين الافتراضي إلى <code>&#39;TLSv1.2&#39;</code>. يؤدي استخدام <code>--tls-max-v1.3</code> إلى تعيين الافتراضي إلى <code>&#39;TLSv1.3&#39;</code>. في حالة توفير عدة خيارات، يتم استخدام الحد الأقصى الأعلى.</li></ul><h2 id="tlsdefault_min_version" tabindex="-1"><code>tls.DEFAULT_MIN_VERSION</code> <a class="header-anchor" href="#tlsdefault_min_version" aria-label="Permalink to “tls.DEFAULT_MIN_VERSION”">​</a></h2><p><strong>أُضيف في: الإصدار v11.4.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> القيمة الافتراضية للخيار <code>minVersion</code> في <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. يمكن تعيين أي من إصدارات بروتوكول TLS المدعومة، <code>&#39;TLSv1.3&#39;</code> أو <code>&#39;TLSv1.2&#39;</code> أو <code>&#39;TLSv1.1&#39;</code> أو <code>&#39;TLSv1&#39;</code>. قد تتطلب الإصدارات قبل TLSv1.2 تخفيض <a href="/ar/nodejs/api/tls#openssl-security-level">مستوى أمان OpenSSL</a>. <strong>القيمة الافتراضية:</strong> <code>&#39;TLSv1.2&#39;</code>، ما لم يتم تغييرها باستخدام خيارات CLI. استخدام <code>--tls-min-v1.0</code> يضبط القيمة الافتراضية على <code>&#39;TLSv1&#39;</code>. استخدام <code>--tls-min-v1.1</code> يضبط القيمة الافتراضية على <code>&#39;TLSv1.1&#39;</code>. استخدام <code>--tls-min-v1.3</code> يضبط القيمة الافتراضية على <code>&#39;TLSv1.3&#39;</code>. في حالة توفير خيارات متعددة، يتم استخدام الحد الأدنى الأقل.</li></ul><h2 id="tlsdefault_ciphers" tabindex="-1"><code>tls.DEFAULT_CIPHERS</code> <a class="header-anchor" href="#tlsdefault_ciphers" aria-label="Permalink to “tls.DEFAULT_CIPHERS”">​</a></h2><p><strong>أُضيف في: الإصدار v19.8.0، v18.16.0</strong></p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> القيمة الافتراضية للخيار <code>ciphers</code> في <a href="/ar/nodejs/api/tls#tlscreatesecurecontextoptions"><code>tls.createSecureContext()</code></a>. يمكن تعيين أي من شفرات OpenSSL المدعومة. القيمة الافتراضية هي محتوى <code>crypto.constants.defaultCoreCipherList</code>، ما لم يتم تغييرها باستخدام خيارات CLI باستخدام <code>--tls-default-ciphers</code>.</li></ul>`,475)])}var s=e(a,[[`render`,o]]);export{i as __pageData,s as default};