import{__plugin_vue_export_helper_default as e,createElementBlock as t,createStaticVNode as n,openBlock as r}from"./chunks/plugin-vue_export-helper.Bts1mPc7.js";const i=JSON.parse(`{"title":"Node.js Permissions API","description":"The Node.js Permissions API documentation outlines how to manage and control permissions for various operations within Node.js applications, ensuring secure and controlled access to system resources.","frontmatter":{"title":"Node.js Permissions API","description":"The Node.js Permissions API documentation outlines how to manage and control permissions for various operations within Node.js applications, ensuring secure and controlled access to system resources.","head":[["meta",{"name":"og:title","content":"Node.js Permissions API | Node.js - iDoc.dev"}],["meta",{"name":"og:description","content":"The Node.js Permissions API documentation outlines how to manage and control permissions for various operations within Node.js applications, ensuring secure and controlled access to system resources."}],["meta",{"name":"twitter:title","content":"Node.js Permissions API | Node.js - iDoc.dev"}],["meta",{"name":"twitter:description","content":"The Node.js Permissions API documentation outlines how to manage and control permissions for various operations within Node.js applications, ensuring secure and controlled access to system resources."}],["link",{"rel":"canonical","href":"https://idoc.dev/nodejs/api/permissions"}],["meta",{"property":"og:url","content":"https://idoc.dev/nodejs/api/permissions"}]]},"headers":[],"relativePath":"nodejs/api/permissions.md","filePath":"en/nodejs/api/permissions.md","lastUpdated":1749464498000}`),a={name:`nodejs/api/permissions.md`};function o(e,i,a,o,s,c){return r(),t(`div`,null,i[0]||=[n(`<h1 id="permissions" tabindex="-1">Permissions <a class="header-anchor" href="#permissions" aria-label="Permalink to “Permissions”">​</a></h1><p><strong>Source Code:</strong> <a href="https://github.com/nodejs/node/blob/v23.8.0/src/permission.cc" target="_blank" rel="noreferrer">src/permission.cc</a></p><p>Permissions can be used to control what system resources the Node.js process has access to or what actions the process can take with those resources.</p><ul><li><a href="/nodejs/api/permissions#process-based-permissions">Process-based permissions</a> control the Node.js process&#39;s access to resources. The resource can be entirely allowed or denied, or actions related to it can be controlled. For example, file system reads can be allowed while denying writes. This feature does not protect against malicious code. According to the Node.js <a href="https://github.com/nodejs/node/blob/main/SECURITY.md" target="_blank" rel="noreferrer">Security Policy</a>, Node.js trusts any code it is asked to run.</li></ul><p>The permission model implements a &quot;seat belt&quot; approach, which prevents trusted code from unintentionally changing files or using resources that access has not explicitly been granted to. It does not provide security guarantees in the presence of malicious code. Malicious code can bypass the permission model and execute arbitrary code without the restrictions imposed by the permission model.</p><p>If you find a potential security vulnerability, please refer to our <a href="https://github.com/nodejs/node/blob/main/SECURITY.md" target="_blank" rel="noreferrer">Security Policy</a>.</p><h2 id="process-based-permissions" tabindex="-1">Process-based permissions <a class="header-anchor" href="#process-based-permissions" aria-label="Permalink to “Process-based permissions”">​</a></h2><h3 id="permission-model" tabindex="-1">Permission Model <a class="header-anchor" href="#permission-model" aria-label="Permalink to “Permission Model”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[History]</p><table tabindex="0"><thead><tr><th>Version</th><th>Changes</th></tr></thead><tbody><tr><td>v23.5.0</td><td>This feature is no longer experimental.</td></tr><tr><td>v20.0.0</td><td>Added in: v20.0.0</td></tr></tbody></table></div><div class="tip custom-block"><p class="custom-block-title">[Stable: 2 - Stable]</p><p><a href="/nodejs/api/documentation#stability-index">Stable: 2</a> <a href="/nodejs/api/documentation#stability-index">Stability: 2</a> - Stable.</p></div><p>The Node.js Permission Model is a mechanism for restricting access to specific resources during execution. The API exists behind a flag <a href="/nodejs/api/cli#permission"><code>--permission</code></a> which when enabled, will restrict access to all available permissions.</p><p>The available permissions are documented by the <a href="/nodejs/api/cli#permission"><code>--permission</code></a> flag.</p><p>When starting Node.js with <code>--permission</code>, the ability to access the file system through the <code>fs</code> module, spawn processes, use <code>node:worker_threads</code>, use native addons, use WASI, and enable the runtime inspector will be restricted.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permission</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Error:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Access</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restricted</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node:internal/main/run_main_module:23:47</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  code:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ERR_ACCESS_DENIED&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  permission:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;FileSystemRead&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resource:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/home/user/index.js&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Allowing access to spawning a process and creating worker threads can be done using the <a href="/nodejs/api/cli#allow-child-process"><code>--allow-child-process</code></a> and <a href="/nodejs/api/cli#allow-worker"><code>--allow-worker</code></a> respectively.</p><p>To allow native addons when using permission model, use the <a href="/nodejs/api/cli#allow-addons"><code>--allow-addons</code></a> flag. For WASI, use the <a href="/nodejs/api/cli#allow-wasi"><code>--allow-wasi</code></a> flag.</p><h4 id="runtime-api" tabindex="-1">Runtime API <a class="header-anchor" href="#runtime-api" aria-label="Permalink to “Runtime API”">​</a></h4><p>When enabling the Permission Model through the <a href="/nodejs/api/cli#permission"><code>--permission</code></a> flag a new property <code>permission</code> is added to the <code>process</code> object. This property contains one function:</p><h5 id="permissionhasscope-reference" tabindex="-1"><code>permission.has(scope[, reference])</code> <a class="header-anchor" href="#permissionhasscope-reference" aria-label="Permalink to “permission.has(scope[, reference])”">​</a></h5><p>API call to check permissions at runtime (<a href="/nodejs/api/process#processpermissionhasscope-reference"><code>permission.has()</code></a>)</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.permission.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs.write&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.permission.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs.write&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/home/rafaelgss/protected-folder&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.permission.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs.read&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.permission.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs.read&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/home/rafaelgss/protected-folder&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="file-system-permissions" tabindex="-1">File System Permissions <a class="header-anchor" href="#file-system-permissions" aria-label="Permalink to “File System Permissions”">​</a></h4><p>The Permission Model, by default, restricts access to the file system through the <code>node:fs</code> module. It does not guarantee that users will not be able to access the file system through other means, such as through the <code>node:sqlite</code> module.</p><p>To allow access to the file system, use the <a href="/nodejs/api/cli#allow-fs-read"><code>--allow-fs-read</code></a> and <a href="/nodejs/api/cli#allow-fs-write"><code>--allow-fs-write</code></a> flags:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permission</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --allow-fs-read=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --allow-fs-write=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hello</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> world!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The valid arguments for both flags are:</p><ul><li><code>*</code> - To allow all <code>FileSystemRead</code> or <code>FileSystemWrite</code> operations, respectively.</li><li>Paths delimited by comma (<code>,</code>) to allow only matching <code>FileSystemRead</code> or <code>FileSystemWrite</code> operations, respectively.</li></ul><p>Example:</p><ul><li><code>--allow-fs-read=*</code> - It will allow all <code>FileSystemRead</code> operations.</li><li><code>--allow-fs-write=*</code> - It will allow all <code>FileSystemWrite</code> operations.</li><li><code>--allow-fs-write=/tmp/</code> - It will allow <code>FileSystemWrite</code> access to the <code>/tmp/</code> folder.</li><li><code>--allow-fs-read=/tmp/ --allow-fs-read=/home/.gitignore</code> - It allows <code>FileSystemRead</code> access to the <code>/tmp/</code> folder <strong>and</strong> the <code>/home/.gitignore</code> path.</li></ul><p>Wildcards are supported too:</p><ul><li><code>--allow-fs-read=/home/test*</code> will allow read access to everything that matches the wildcard. e.g: <code>/home/test/file1</code> or <code>/home/test2</code></li></ul><p>After passing a wildcard character (<code>*</code>) all subsequent characters will be ignored. For example: <code>/home/*.js</code> will work similar to <code>/home/*</code>.</p><p>When the permission model is initialized, it will automatically add a wildcard (*) if the specified directory exists. For example, if <code>/home/test/files</code> exists, it will be treated as <code>/home/test/files/*</code>. However, if the directory does not exist, the wildcard will not be added, and access will be limited to <code>/home/test/files</code>. If you want to allow access to a folder that does not exist yet, make sure to explicitly include the wildcard: <code>/my-path/folder-do-not-exist/*</code>.</p><h4 id="permission-model-constraints" tabindex="-1">Using the Permission Model with <code>npx</code> <a class="header-anchor" href="#permission-model-constraints" aria-label="Permalink to “Using the Permission Model with npx”">​</a></h4><p>If you&#39;re using <a href="https://docs.npmjs.com/cli/commands/npx" target="_blank" rel="noreferrer"><code>npx</code></a> to execute a Node.js script, you can enable the Permission Model by passing the <code>--node-options</code> flag. For example:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --node-options=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--permission&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> package-name</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This sets the <code>NODE_OPTIONS</code> environment variable for all Node.js processes spawned by <a href="https://docs.npmjs.com/cli/commands/npx" target="_blank" rel="noreferrer"><code>npx</code></a>, without affecting the <code>npx</code> process itself.</p><p><strong>FileSystemRead Error with <code>npx</code></strong></p><p>The above command will likely throw a <code>FileSystemRead</code> invalid access error because Node.js requires file system read access to locate and execute the package. To avoid this:</p><p>Any arguments you would normally pass to <code>node</code> (e.g., <code>--allow-*</code> flags) can also be passed through the <code>--node-options</code> flag. This flexibility makes it easy to configure permissions as needed when using <code>npx</code>.</p><h4 id="limitations-and-known-issues" tabindex="-1">Permission Model constraints <a class="header-anchor" href="#limitations-and-known-issues" aria-label="Permalink to “Permission Model constraints”">​</a></h4><p>There are constraints you need to know before using this system:</p><ul><li><p>The model does not inherit to a child node process or a worker thread.</p></li><li><p>When using the Permission Model the following features will be restricted:</p><ul><li>Native modules</li><li>Child process</li><li>Worker Threads</li><li>Inspector protocol</li><li>File system access</li><li>WASI</li></ul></li><li><p>The Permission Model is initialized after the Node.js environment is set up. However, certain flags such as <code>--env-file</code> or <code>--openssl-config</code> are designed to read files before environment initialization. As a result, such flags are not subject to the rules of the Permission Model. The same applies for V8 flags that can be set via runtime through <code>v8.setFlagsFromString</code>.</p></li><li><p>OpenSSL engines cannot be requested at runtime when the Permission Model is enabled, affecting the built-in crypto, https, and tls modules.</p></li><li><p>Run-Time Loadable Extensions cannot be loaded when the Permission Model is enabled, affecting the sqlite module.</p></li><li><p>Using existing file descriptors via the <code>node:fs</code> module bypasses the Permission Model.</p></li></ul><h4 id="limitations-and-known-issues-1" tabindex="-1">Limitations and Known Issues <a class="header-anchor" href="#limitations-and-known-issues-1" aria-label="Permalink to “Limitations and Known Issues”">​</a></h4><ul><li>Symbolic links will be followed even to locations outside of the set of paths that access has been granted to. Relative symbolic links may allow access to arbitrary files and directories. When starting applications with the permission model enabled, you must ensure that no paths to which access has been granted contain relative symbolic links.</li></ul>`,45)])}var s=e(a,[[`render`,o]]);export{i as __pageData,s as default};