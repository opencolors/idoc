import{__plugin_vue_export_helper_default as e,createElementBlock as t,createStaticVNode as n,openBlock as r}from"./chunks/plugin-vue_export-helper.Bts1mPc7.js";const i=JSON.parse(`{"title":"ECMAScript модули в Node.js","description":"Эта страница предоставляет подробную документацию о том, как использовать модули ECMAScript (ESM) в Node.js, включая разрешение модулей, синтаксис импорта и экспорта, а также совместимость с CommonJS.","frontmatter":{"title":"ECMAScript модули в Node.js","description":"Эта страница предоставляет подробную документацию о том, как использовать модули ECMAScript (ESM) в Node.js, включая разрешение модулей, синтаксис импорта и экспорта, а также совместимость с CommonJS.","head":[["meta",{"name":"og:title","content":"ECMAScript модули в Node.js | Node.js - iDoc.dev"}],["meta",{"name":"og:description","content":"Эта страница предоставляет подробную документацию о том, как использовать модули ECMAScript (ESM) в Node.js, включая разрешение модулей, синтаксис импорта и экспорта, а также совместимость с CommonJS."}],["meta",{"name":"twitter:title","content":"ECMAScript модули в Node.js | Node.js - iDoc.dev"}],["meta",{"name":"twitter:description","content":"Эта страница предоставляет подробную документацию о том, как использовать модули ECMAScript (ESM) в Node.js, включая разрешение модулей, синтаксис импорта и экспорта, а также совместимость с CommonJS."}],["link",{"rel":"canonical","href":"https://idoc.dev/ru/nodejs/api/esm"}],["meta",{"property":"og:url","content":"https://idoc.dev/ru/nodejs/api/esm"}]]},"headers":[],"relativePath":"ru/nodejs/api/esm.md","filePath":"ru/nodejs/api/esm.md","lastUpdated":1749464498000}`),a={name:`ru/nodejs/api/esm.md`};function o(e,i,a,o,s,c){return r(),t(`div`,null,i[0]||=[n(`<h1 id="modules-ecmascript-modules" tabindex="-1">Модули: Модули ECMAScript <a class="header-anchor" href="#modules-ecmascript-modules" aria-label="Permalink to “Модули: Модули ECMAScript”">​</a></h1><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v23.1.0</td><td>Атрибуты импорта больше не являются экспериментальными.</td></tr><tr><td>v22.0.0</td><td>Прекращена поддержка утверждений импорта.</td></tr><tr><td>v21.0.0, v20.10.0, v18.20.0</td><td>Добавлена экспериментальная поддержка атрибутов импорта.</td></tr><tr><td>v20.0.0, v18.19.0</td><td>Хуки настройки модулей выполняются вне основного потока.</td></tr><tr><td>v18.6.0, v16.17.0</td><td>Добавлена поддержка цепочки хуков настройки модулей.</td></tr><tr><td>v17.1.0, v16.14.0</td><td>Добавлена экспериментальная поддержка утверждений импорта.</td></tr><tr><td>v17.0.0, v16.12.0</td><td>Объединены хуки настройки, удалены хуки <code>getFormat</code>, <code>getSource</code>, <code>transformSource</code> и <code>getGlobalPreloadCode</code>, добавлены хуки <code>load</code> и <code>globalPreload</code>, разрешен возврат <code>format</code> из хуков <code>resolve</code> или <code>load</code>.</td></tr><tr><td>v14.8.0</td><td>Снята отметка экспериментальной возможности с Top-Level Await.</td></tr><tr><td>v15.3.0, v14.17.0, v12.22.0</td><td>Стабилизирована реализация модулей.</td></tr><tr><td>v14.13.0, v12.20.0</td><td>Поддержка обнаружения именованных экспортов CommonJS.</td></tr><tr><td>v14.0.0, v13.14.0, v12.20.0</td><td>Удалено предупреждение об экспериментальных модулях.</td></tr><tr><td>v13.2.0, v12.17.0</td><td>Загрузка модулей ECMAScript больше не требует флага командной строки.</td></tr><tr><td>v12.0.0</td><td>Добавлена поддержка модулей ES, использующих расширение файла <code>.js</code> через поле <code>&quot;type&quot;</code> в <code>package.json</code>.</td></tr><tr><td>v8.5.0</td><td>Добавлено в: v8.5.0</td></tr></tbody></table></div><div class="tip custom-block"><p class="custom-block-title">[Стабильно: 2 - Стабильно]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 2</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 2</a> - Стабильно</p></div><h2 id="introduction" tabindex="-1">Введение <a class="header-anchor" href="#introduction" aria-label="Permalink to “Введение”">​</a></h2><p>Модули ECMAScript - это <a href="https://tc39.github.io/ecma262/#sec-modules" target="_blank" rel="noreferrer">официальный стандартный формат</a> для упаковки кода JavaScript для повторного использования. Модули определяются с использованием различных операторов <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noreferrer"><code>import</code></a> и <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export" target="_blank" rel="noreferrer"><code>export</code></a>.</p><p>В следующем примере модуля ES экспортируется функция:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// addTwo.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addTwo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { addTwo };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>В следующем примере модуля ES импортируется функция из <code>addTwo.mjs</code>:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { addTwo } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./addTwo.mjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Печатает: 6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addTwo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Node.js полностью поддерживает модули ECMAScript в том виде, в котором они в настоящее время специфицированы, и обеспечивает взаимодействие между ними и исходным форматом модулей, <a href="/ru/nodejs/api/modules">CommonJS</a>.</p><h2 id="enabling" tabindex="-1">Включение <a class="header-anchor" href="#enabling" aria-label="Permalink to “Включение”">​</a></h2><p>Node.js имеет две системы модулей: модули <a href="/ru/nodejs/api/modules">CommonJS</a> и модули ECMAScript.</p><p>Авторы могут указать Node.js интерпретировать JavaScript как ES модуль с помощью расширения файла <code>.mjs</code>, поля <a href="/ru/nodejs/api/packages#type"><code>&quot;type&quot;</code></a> в <code>package.json</code> со значением <code>&quot;module&quot;</code> или флага <a href="/ru/nodejs/api/cli#input-typetype"><code>--input-type</code></a> со значением <code>&quot;module&quot;</code>. Это явные маркеры того, что код предназначен для запуска в качестве ES модуля.</p><p>И наоборот, авторы могут явно указать Node.js интерпретировать JavaScript как CommonJS с помощью расширения файла <code>.cjs</code>, поля <a href="/ru/nodejs/api/packages#type"><code>&quot;type&quot;</code></a> в <code>package.json</code> со значением <code>&quot;commonjs&quot;</code> или флага <a href="/ru/nodejs/api/cli#input-typetype"><code>--input-type</code></a> со значением <code>&quot;commonjs&quot;</code>.</p><p>Когда код не имеет явных маркеров для какой-либо системы модулей, Node.js проверит исходный код модуля на наличие синтаксиса ES модуля. Если такой синтаксис найден, Node.js запустит код как ES модуль; в противном случае он запустит модуль как CommonJS. Подробнее см. в разделе <a href="/ru/nodejs/api/packages#determining-module-system">Определение системы модулей</a>.</p><h2 id="packages" tabindex="-1">Пакеты <a class="header-anchor" href="#packages" aria-label="Permalink to “Пакеты”">​</a></h2><p>Этот раздел был перенесен в <a href="/ru/nodejs/api/packages">Модули: Пакеты</a>.</p><h2 id="import-specifiers" tabindex="-1">Спецификаторы <code>import</code> <a class="header-anchor" href="#import-specifiers" aria-label="Permalink to “Спецификаторы import”">​</a></h2><h3 id="terminology" tabindex="-1">Терминология <a class="header-anchor" href="#terminology" aria-label="Permalink to “Терминология”">​</a></h3><p><em>Спецификатор</em> оператора <code>import</code> - это строка после ключевого слова <code>from</code>, например, <code>&#39;node:path&#39;</code> в <code>import { sep } from &#39;node:path&#39;</code>. Спецификаторы также используются в операторах <code>export from</code> и в качестве аргумента для выражения <code>import()</code>.</p><p>Существует три типа спецификаторов:</p><ul><li><em>Относительные спецификаторы</em>, такие как <code>&#39;./startup.js&#39;</code> или <code>&#39;../config.mjs&#39;</code>. Они ссылаются на путь, относительный к местоположению импортирующего файла. <em>Расширение файла всегда необходимо для них.</em></li><li><em>Голые спецификаторы</em>, такие как <code>&#39;some-package&#39;</code> или <code>&#39;some-package/shuffle&#39;</code>. Они могут ссылаться на основную точку входа пакета по имени пакета или на определенный модуль компонента внутри пакета, с префиксом имени пакета, как в примерах соответственно. <em>Включение расширения файла необходимо только для пакетов без поля <a href="packages.html#exports"><code>&quot;exports&quot;</code></a>.</em></li><li><em>Абсолютные спецификаторы</em>, такие как <code>&#39;file:///opt/nodejs/config.js&#39;</code>. Они ссылаются непосредственно и явно на полный путь.</li></ul><p>Разрешение голых спецификаторов обрабатывается <a href="/ru/nodejs/api/esm#resolution-algorithm-specification">алгоритмом разрешения и загрузки модулей Node.js</a>. Все остальные разрешения спецификаторов всегда разрешаются только со стандартной относительной <a href="https://url.spec.whatwg.org/" target="_blank" rel="noreferrer">URL</a> семантикой разрешения.</p><p>Как и в CommonJS, доступ к файлам модулей внутри пакетов можно получить, добавив путь к имени пакета, если только <a href="/ru/nodejs/api/packages#nodejs-packagejson-field-definitions"><code>package.json</code></a> пакета не содержит поле <a href="/ru/nodejs/api/packages#exports"><code>&quot;exports&quot;</code></a>, в этом случае доступ к файлам внутри пакетов можно получить только через пути, определенные в <a href="/ru/nodejs/api/packages#exports"><code>&quot;exports&quot;</code></a>.</p><p>Подробнее об этих правилах разрешения пакетов, которые применяются к голым спецификаторам в разрешении модулей Node.js, см. в <a href="/ru/nodejs/api/packages">документации по пакетам</a>.</p><h3 id="mandatory-file-extensions" tabindex="-1">Обязательные расширения файлов <a class="header-anchor" href="#mandatory-file-extensions" aria-label="Permalink to “Обязательные расширения файлов”">​</a></h3><p>При использовании ключевого слова <code>import</code> для разрешения относительных или абсолютных спецификаторов необходимо указать расширение файла. Индексы каталогов (например, <code>&#39;./startup/index.js&#39;</code>) также должны быть указаны полностью.</p><p>Это поведение соответствует тому, как <code>import</code> ведет себя в браузерных средах, при условии типично настроенного сервера.</p><h3 id="urls" tabindex="-1">URL-адреса <a class="header-anchor" href="#urls" aria-label="Permalink to “URL-адреса”">​</a></h3><p>ES-модули разрешаются и кэшируются как URL-адреса. Это означает, что специальные символы должны быть <a href="/ru/nodejs/api/url#percent-encoding-in-urls">percent-encoded</a>, например <code>#</code> с <code>%23</code> и <code>?</code> с <code>%3F</code>.</p><p>Поддерживаются схемы URL <code>file:</code>, <code>node:</code> и <code>data:</code>. Спецификатор, например <code>&#39;https://example.com/app.js&#39;</code>, не поддерживается изначально в Node.js, если не используется <a href="/ru/nodejs/api/module#import-from-https">пользовательский HTTPS-загрузчик</a>.</p><h4 id="file-urls" tabindex="-1"><code>file:</code> URL-адреса <a class="header-anchor" href="#file-urls" aria-label="Permalink to “file: URL-адреса”">​</a></h4><p>Модули загружаются несколько раз, если спецификатор <code>import</code>, используемый для их разрешения, имеет другой запрос или фрагмент.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./foo.mjs?query=1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// загружает ./foo.mjs с запросом &quot;?query=1&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./foo.mjs?query=2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// загружает ./foo.mjs с запросом &quot;?query=2&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Корневой каталог тома можно указать через <code>/</code>, <code>//</code> или <code>file:///</code>. Учитывая различия между <a href="https://url.spec.whatwg.org/" target="_blank" rel="noreferrer">URL</a> и разрешением путей (например, детали процентного кодирования), рекомендуется использовать <a href="/ru/nodejs/api/url#urlpathtofileurlpath-options">url.pathToFileURL</a> при импорте пути.</p><h4 id="data-imports" tabindex="-1"><code>data:</code> импорты <a class="header-anchor" href="#data-imports" aria-label="Permalink to “data: импорты”">​</a></h4><p><strong>Добавлено в: v12.10.0</strong></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" target="_blank" rel="noreferrer"><code>data:</code> URL-адреса</a> поддерживаются для импорта со следующими типами MIME:</p><ul><li><code>text/javascript</code> для ES-модулей</li><li><code>application/json</code> для JSON</li><li><code>application/wasm</code> для Wasm</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;data:text/javascript,console.log(&quot;hello!&quot;);&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;data:application/json,&quot;world!&quot;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>data:</code> URL-адреса разрешают только <a href="/ru/nodejs/api/esm#terminology">bare specifiers</a> для встроенных модулей и <a href="/ru/nodejs/api/esm#terminology">absolute specifiers</a>. Разрешение <a href="/ru/nodejs/api/esm#terminology">relative specifiers</a> не работает, потому что <code>data:</code> не является <a href="https://url.spec.whatwg.org/#special-scheme" target="_blank" rel="noreferrer">special scheme</a>. Например, попытка загрузить <code>./foo</code> из <code>data:text/javascript,import &quot;./foo&quot;;</code> не может быть разрешена, потому что нет концепции относительного разрешения для <code>data:</code> URL-адресов.</p><h4 id="node-imports" tabindex="-1"><code>node:</code> imports <a class="header-anchor" href="#node-imports" aria-label="Permalink to “node: imports”">​</a></h4><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v16.0.0, v14.18.0</td><td>Добавлена поддержка импорта <code>node:</code> в <code>require(...)</code>.</td></tr><tr><td>v14.13.1, v12.20.0</td><td>Добавлено в: v14.13.1, v12.20.0</td></tr></tbody></table></div><p>URL-адреса <code>node:</code> поддерживаются в качестве альтернативного способа загрузки встроенных модулей Node.js. Эта схема URL-адресов позволяет ссылаться на встроенные модули по допустимым абсолютным строкам URL-адресов.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs/promises&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="import-attributes" tabindex="-1">Атрибуты импорта <a class="header-anchor" href="#import-attributes" aria-label="Permalink to “Атрибуты импорта”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v21.0.0, v20.10.0, v18.20.0</td><td>Переход от утверждений импорта к атрибутам импорта.</td></tr><tr><td>v17.1.0, v16.14.0</td><td>Добавлено в: v17.1.0, v16.14.0</td></tr></tbody></table></div><div class="tip custom-block"><p class="custom-block-title">[Стабильно: 2 - Стабильно]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильно: 2</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 2</a> - Стабильно</p></div><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import/with" target="_blank" rel="noreferrer">Атрибуты импорта</a> - это встроенный синтаксис для операторов импорта модулей для передачи дополнительной информации вместе со спецификатором модуля.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fooData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./foo.json&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">barData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./bar.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { with: { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Node.js поддерживает только атрибут <code>type</code>, для которого он поддерживает следующие значения:</p><table tabindex="0"><thead><tr><th>Атрибут <code>type</code></th><th>Необходимо для</th></tr></thead><tbody><tr><td><code>&#39;json&#39;</code></td><td><a href="/ru/nodejs/api/esm#json-modules">JSON modules</a></td></tr><tr><td>Атрибут <code>type: &#39;json&#39;</code> является обязательным при импорте JSON-модулей.</td><td></td></tr></tbody></table><h2 id="built-in-modules" tabindex="-1">Встроенные модули <a class="header-anchor" href="#built-in-modules" aria-label="Permalink to “Встроенные модули”">​</a></h2><p><a href="/ru/nodejs/api/modules#built-in-modules">Встроенные модули</a> предоставляют именованные экспорты своего общедоступного API. Также предоставляется экспорт по умолчанию, который является значением экспортов CommonJS. Экспорт по умолчанию можно использовать, среди прочего, для изменения именованных экспортов. Именованные экспорты встроенных модулей обновляются только при вызове <a href="/ru/nodejs/api/module#modulesyncbuiltinesmexports"><code>module.syncBuiltinESMExports()</code></a>.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EventEmitter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:events&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EventEmitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readFile } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./foo.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(source);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs, { readFileSync } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { syncBuiltinESMExports } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:module&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Buffer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:buffer&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Buffer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello, ESM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">syncBuiltinESMExports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.readFileSync </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> readFileSync;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="import-expressions" tabindex="-1"><code>import()</code> expressions <a class="header-anchor" href="#import-expressions" aria-label="Permalink to “import() expressions”">​</a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import" target="_blank" rel="noreferrer">Dynamic <code>import()</code></a> поддерживается как в CommonJS, так и в ES-модулях. В CommonJS модулях он может быть использован для загрузки ES-модулей.</p><h2 id="importmeta" tabindex="-1"><code>import.meta</code> <a class="header-anchor" href="#importmeta" aria-label="Permalink to “import.meta”">​</a></h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">&lt;Object&gt;</a></li></ul><p>Мета-свойство <code>import.meta</code> является <code>Object</code>, который содержит следующие свойства. Оно поддерживается только в ES-модулях.</p><h3 id="importmetadirname" tabindex="-1"><code>import.meta.dirname</code> <a class="header-anchor" href="#importmetadirname" aria-label="Permalink to “import.meta.dirname”">​</a></h3><p><strong>Добавлено в: v21.2.0, v20.11.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Стабильность: 1 - Экспериментальная]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a>.2 - Кандидат на релиз</p></div><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Имя каталога текущего модуля. Это то же самое, что и <a href="/ru/nodejs/api/path#pathdirnamepath"><code>path.dirname()</code></a> от <a href="/ru/nodejs/api/esm#importmetafilename"><code>import.meta.filename</code></a>.</li></ul><h3 id="importmetafilename" tabindex="-1"><code>import.meta.filename</code> <a class="header-anchor" href="#importmetafilename" aria-label="Permalink to “import.meta.filename”">​</a></h3><p><strong>Добавлено в: v21.2.0, v20.11.0</strong></p><div class="warning custom-block"><p class="custom-block-title">[Стабильность: 1 - Экспериментальная]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a>.2 - Кандидат на релиз</p></div><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Полный абсолютный путь и имя файла текущего модуля с разрешенными символическими ссылками.</li><li>Это то же самое, что и <a href="/ru/nodejs/api/url#urlfileurltopathurl-options"><code>url.fileURLToPath()</code></a> от <a href="/ru/nodejs/api/esm#importmetaurl"><code>import.meta.url</code></a>.</li></ul><h3 id="importmetaurl" tabindex="-1"><code>import.meta.url</code> <a class="header-anchor" href="#importmetaurl" aria-label="Permalink to “import.meta.url”">​</a></h3><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Абсолютный <code>file:</code> URL модуля.</li></ul><p>Он определяется точно так же, как и в браузерах, предоставляя URL текущего файла модуля.</p><p>Это позволяет использовать полезные шаблоны, такие как относительная загрузка файлов:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { readFileSync } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./data.proto&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="importmetaresolvespecifier" tabindex="-1"><code>import.meta.resolve(specifier)</code> <a class="header-anchor" href="#importmetaresolvespecifier" aria-label="Permalink to “import.meta.resolve(specifier)”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v20.6.0, v18.19.0</td><td>Больше не скрыто за флагом CLI <code>--experimental-import-meta-resolve</code>, за исключением нестандартного параметра <code>parentURL</code>.</td></tr><tr><td>v20.6.0, v18.19.0</td><td>Этот API больше не выдает исключение при нацеливании на <code>file:</code> URL-адреса, которые не соответствуют существующему файлу в локальной файловой системе.</td></tr><tr><td>v20.0.0, v18.19.0</td><td>Этот API теперь возвращает строку синхронно вместо Promise.</td></tr><tr><td>v16.2.0, v14.18.0</td><td>Добавлена поддержка объекта WHATWG <code>URL</code> для параметра <code>parentURL</code>.</td></tr><tr><td>v13.9.0, v12.16.2</td><td>Добавлено в: v13.9.0, v12.16.2</td></tr></tbody></table></div><div class="warning custom-block"><p class="custom-block-title">[Стабильность: 1 - Экспериментальная]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 1</a>.2 - Кандидат на релиз</p></div><ul><li><code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Спецификатор модуля для разрешения относительно текущего модуля.</li><li>Возвращает: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> Абсолютная URL-строка, к которой будет разрешен спецификатор.</li></ul><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import.meta/resolve" target="_blank" rel="noreferrer"><code>import.meta.resolve</code></a> - это функция разрешения, относящаяся к модулю, которая ограничена каждым модулем, возвращая URL-строку.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dependencyAsset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;component-lib/asset.css&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file:///app/node_modules/component-lib/asset.css</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./dep.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file:///app/dep.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Поддерживаются все возможности разрешения модулей Node.js. Разрешения зависимостей зависят от разрешенных разрешений экспорта внутри пакета.</p><p><strong>Предостережения</strong>:</p><ul><li>Это может привести к синхронным операциям с файловой системой, что может повлиять на производительность аналогично <code>require.resolve</code>.</li><li>Эта функция недоступна во пользовательских загрузчиках (это может создать взаимоблокировку).</li></ul><p><strong>Нестандартный API</strong>:</p><p>При использовании флага <code>--experimental-import-meta-resolve</code> эта функция принимает второй аргумент:</p><ul><li><code>parent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" target="_blank" rel="noreferrer">&lt;string&gt;</a> | <a href="/ru/nodejs/api/url#the-whatwg-url-api">&lt;URL&gt;</a> Необязательный абсолютный URL родительского модуля для разрешения. <strong>По умолчанию:</strong> <code>import.meta.url</code></li></ul><h2 id="interoperability-with-commonjs" tabindex="-1">Взаимодействие с CommonJS <a class="header-anchor" href="#interoperability-with-commonjs" aria-label="Permalink to “Взаимодействие с CommonJS”">​</a></h2><h3 id="import-statements" tabindex="-1">Операторы <code>import</code> <a class="header-anchor" href="#import-statements" aria-label="Permalink to “Операторы import”">​</a></h3><p>Оператор <code>import</code> может ссылаться на модуль ES или модуль CommonJS. Операторы <code>import</code> разрешены только в модулях ES, но динамические выражения <a href="/ru/nodejs/api/esm#import-expressions"><code>import()</code></a> поддерживаются в CommonJS для загрузки модулей ES.</p><p>При импорте <a href="/ru/nodejs/api/esm#commonjs-namespaces">модулей CommonJS</a> объект <code>module.exports</code> предоставляется в качестве экспорта по умолчанию. Именованные экспорты могут быть доступны, предоставляются статическим анализом для удобства и лучшей совместимости с экосистемой.</p><h3 id="require" tabindex="-1"><code>require</code> <a class="header-anchor" href="#require" aria-label="Permalink to “require”">​</a></h3><p>Модуль CommonJS <code>require</code> в настоящее время поддерживает только загрузку синхронных модулей ES (то есть модулей ES, которые не используют <code>await</code> верхнего уровня).</p><p>Подробности см. в разделе <a href="/ru/nodejs/api/modules#loading-ecmascript-modules-using-require">Загрузка модулей ECMAScript с помощью <code>require()</code></a>.</p><h3 id="commonjs-namespaces" tabindex="-1">Пространства имен CommonJS <a class="header-anchor" href="#commonjs-namespaces" aria-label="Permalink to “Пространства имен CommonJS”">​</a></h3><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th style="text-align:left;">Версия</th><th style="text-align:left;">Изменения</th></tr></thead><tbody><tr><td style="text-align:left;">v23.0.0</td><td style="text-align:left;">Добавлен маркер экспорта <code>&#39;module.exports&#39;</code> в пространства имен CJS.</td></tr><tr><td style="text-align:left;">v14.13.0</td><td style="text-align:left;">Добавлено в: v14.13.0</td></tr></tbody></table></div><p>Модули CommonJS состоят из объекта <code>module.exports</code>, который может быть любого типа.</p><p>Для поддержки этого, при импорте CommonJS из модуля ECMAScript, создается обертка пространства имен для модуля CommonJS, которая всегда предоставляет ключ экспорта <code>default</code>, указывающий на значение <code>module.exports</code> CommonJS.</p><p>Кроме того, выполняется эвристический статический анализ исходного текста модуля CommonJS, чтобы получить наилучший статический список экспортов, предоставляемых в пространстве имен из значений в <code>module.exports</code>. Это необходимо, поскольку эти пространства имен должны быть построены до вычисления модуля CJS.</p><p>Эти объекты пространства имен CommonJS также предоставляют экспорт <code>default</code> как именованный экспорт <code>&#39;module.exports&#39;</code>, чтобы однозначно указать, что их представление в CommonJS использует это значение, а не значение пространства имен. Это отражает семантику обработки имени экспорта <code>&#39;module.exports&#39;</code> в поддержке взаимодействия <a href="/ru/nodejs/api/modules#loading-ecmascript-modules-using-require"><code>require(esm)</code></a>.</p><p>При импорте модуля CommonJS его можно надежно импортировать, используя импорт по умолчанию модуля ES или соответствующий синтаксис sugar:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cjs } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Идентично указанному выше</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cjsSugar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cjs);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cjs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cjsSugar);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Выводит:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   &lt;module.exports&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Этот экзотический объект пространства имен модуля можно наблюдать непосредственно при использовании <code>import * as m from &#39;cjs&#39;</code> или динамического импорта:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Выводит:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   [Module] { default: &lt;module.exports&gt;, &#39;module.exports&#39;: &lt;module.exports&gt; }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Для лучшей совместимости с существующим использованием в экосистеме JS Node.js дополнительно пытается определить именованные экспорты CommonJS каждого импортированного модуля CommonJS, чтобы предоставить их в качестве отдельных экспортов модуля ES, используя процесс статического анализа.</p><p>Например, рассмотрим модуль CommonJS, написанный:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// cjs.cjs</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;exported&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Предыдущий модуль поддерживает именованные импорты в модулях ES:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { name } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./cjs.cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Выводит: &#39;exported&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cjs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./cjs.cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cjs);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Выводит: { name: &#39;exported&#39; }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./cjs.cjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Выводит:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   [Module] {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     default: { name: &#39;exported&#39; },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     &#39;module.exports&#39;: { name: &#39;exported&#39; },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     name: &#39;exported&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Как видно из последнего примера протоколирования экзотического объекта пространства имен модуля, экспорт <code>name</code> копируется из объекта <code>module.exports</code> и устанавливается непосредственно в пространстве имен модуля ES при импорте модуля.</p><p>Обновления живых связываний или новые экспорты, добавленные в <code>module.exports</code>, не обнаруживаются для этих именованных экспортов.</p><p>Обнаружение именованных экспортов основано на общих синтаксических шаблонах, но не всегда правильно обнаруживает именованные экспорты. В этих случаях использование формы импорта по умолчанию, описанной выше, может быть лучшим вариантом.</p><p>Обнаружение именованных экспортов охватывает множество общих шаблонов экспорта, шаблонов реэкспорта и результатов работы инструментов сборки и транспиляторов. См. <a href="https://github.com/nodejs/cjs-module-lexer/tree/1.2.2" target="_blank" rel="noreferrer">cjs-module-lexer</a> для точной реализованной семантики.</p><h3 id="differences-between-es-modules-and-commonjs" tabindex="-1">Различия между модулями ES и CommonJS <a class="header-anchor" href="#differences-between-es-modules-and-commonjs" aria-label="Permalink to “Различия между модулями ES и CommonJS”">​</a></h3><h4 id="no-require-exports-or-moduleexports" tabindex="-1">Отсутствие <code>require</code>, <code>exports</code> или <code>module.exports</code> <a class="header-anchor" href="#no-require-exports-or-moduleexports" aria-label="Permalink to “Отсутствие require, exports или module.exports”">​</a></h4><p>В большинстве случаев <code>import</code> модуля ES можно использовать для загрузки модулей CommonJS.</p><p>При необходимости функцию <code>require</code> можно создать внутри модуля ES с помощью <a href="/ru/nodejs/api/module#modulecreaterequirefilename"><code>module.createRequire()</code></a>.</p><h4 id="no-__filename-or-__dirname" tabindex="-1">Отсутствие <code>__filename</code> или <code>__dirname</code> <a class="header-anchor" href="#no-__filename-or-__dirname" aria-label="Permalink to “Отсутствие __filename или __dirname”">​</a></h4><p>Эти переменные CommonJS недоступны в модулях ES.</p><p>Сценарии использования <code>__filename</code> и <code>__dirname</code> можно воспроизвести с помощью <a href="/ru/nodejs/api/esm#importmetafilename"><code>import.meta.filename</code></a> и <a href="/ru/nodejs/api/esm#importmetadirname"><code>import.meta.dirname</code></a>.</p><h4 id="no-addon-loading" tabindex="-1">Отсутствие загрузки аддонов <a class="header-anchor" href="#no-addon-loading" aria-label="Permalink to “Отсутствие загрузки аддонов”">​</a></h4><p><a href="/ru/nodejs/api/addons">Аддоны</a> в настоящее время не поддерживаются при импорте модулей ES.</p><p>Вместо этого их можно загружать с помощью <a href="/ru/nodejs/api/module#modulecreaterequirefilename"><code>module.createRequire()</code></a> или <a href="/ru/nodejs/api/process#processdlopenmodule-filename-flags"><code>process.dlopen</code></a>.</p><h4 id="no-requireresolve" tabindex="-1">Отсутствие <code>require.resolve</code> <a class="header-anchor" href="#no-requireresolve" aria-label="Permalink to “Отсутствие require.resolve”">​</a></h4><p>Относительное разрешение можно обработать с помощью <code>new URL(&#39;./local&#39;, import.meta.url)</code>.</p><p>Для полной замены <code>require.resolve</code> существует API <a href="/ru/nodejs/api/esm#importmetaresolvespecifier">import.meta.resolve</a>.</p><p>В качестве альтернативы можно использовать <code>module.createRequire()</code>.</p><h4 id="no-node_path" tabindex="-1">Отсутствие <code>NODE_PATH</code> <a class="header-anchor" href="#no-node_path" aria-label="Permalink to “Отсутствие NODE_PATH”">​</a></h4><p><code>NODE_PATH</code> не является частью разрешения спецификаторов <code>import</code>. Пожалуйста, используйте символические ссылки, если такое поведение желательно.</p><h4 id="no-requireextensions" tabindex="-1">Отсутствие <code>require.extensions</code> <a class="header-anchor" href="#no-requireextensions" aria-label="Permalink to “Отсутствие require.extensions”">​</a></h4><p><code>require.extensions</code> не используется <code>import</code>. Хуки настройки модулей могут предоставить замену.</p><h4 id="no-requirecache" tabindex="-1">Отсутствие <code>require.cache</code> <a class="header-anchor" href="#no-requirecache" aria-label="Permalink to “Отсутствие require.cache”">​</a></h4><p><code>require.cache</code> не используется <code>import</code>, поскольку загрузчик модулей ES имеет свой собственный отдельный кэш.</p><h2 id="json-modules" tabindex="-1">JSON-модули <a class="header-anchor" href="#json-modules" aria-label="Permalink to “JSON-модули”">​</a></h2><div class="info custom-block"><p class="custom-block-title">[История]</p><table tabindex="0"><thead><tr><th>Версия</th><th>Изменения</th></tr></thead><tbody><tr><td>v23.1.0</td><td>JSON-модули больше не являются экспериментальными.</td></tr></tbody></table></div><div class="tip custom-block"><p class="custom-block-title">[Stable: 2 - Stable]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 2</a> <a href="/ru/nodejs/api/documentation#stability-index">Стабильность: 2</a> - Стабильный</p></div><p>На JSON-файлы можно ссылаться через <code>import</code>:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> packageConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./package.json&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Синтаксис <code>with { type: &#39;json&#39; }</code> является обязательным; см. <a href="/ru/nodejs/api/esm#import-attributes">Атрибуты импорта</a>.</p><p>Импортированный JSON предоставляет только экспорт <code>default</code>. Поддержка именованных экспортов отсутствует. В кэше CommonJS создается запись кэша, чтобы избежать дублирования. Один и тот же объект возвращается в CommonJS, если JSON-модуль уже был импортирован из того же пути.</p><h2 id="wasm-modules" tabindex="-1">Wasm модули <a class="header-anchor" href="#wasm-modules" aria-label="Permalink to “Wasm модули”">​</a></h2><div class="warning custom-block"><p class="custom-block-title">[Stable: 1 - Experimental]</p><p><a href="/ru/nodejs/api/documentation#stability-index">Stable: 1</a> <a href="/ru/nodejs/api/documentation#stability-index">Stability: 1</a> - Experimental</p></div><p>Импорт модулей WebAssembly поддерживается с помощью флага <code>--experimental-wasm-modules</code>, позволяющего импортировать любые файлы <code>.wasm</code> как обычные модули, а также поддерживать их импорт модулей.</p><p>Эта интеграция соответствует <a href="https://github.com/webassembly/esm-integration" target="_blank" rel="noreferrer">Предложению по интеграции модулей ES для WebAssembly</a>.</p><p>Например, файл <code>index.mjs</code>, содержащий:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> M </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./module.wasm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>выполненный с помощью:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --experimental-wasm-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> index.mjs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>предоставит интерфейс экспорта для инстанцирования <code>module.wasm</code>.</p><h2 id="top-level-await" tabindex="-1"><code>await</code> верхнего уровня <a class="header-anchor" href="#top-level-await" aria-label="Permalink to “await верхнего уровня”">​</a></h2><p><strong>Добавлено в: v14.8.0</strong></p><p>Ключевое слово <code>await</code> может использоваться в теле верхнего уровня модуля ECMAScript.</p><p>Предполагая, что у нас есть <code>a.mjs</code> с</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> five</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>И <code>b.mjs</code> с</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { five } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./a.mjs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(five); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Logs \`5\`</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b.mjs</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # работает</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Если выражение <code>await</code> верхнего уровня никогда не разрешается, процесс <code>node</code> завершится с <a href="/ru/nodejs/api/process#exit-codes">кодом состояния</a> <code>13</code>.</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { spawn } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { execPath } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:process&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(execPath, [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;--input-type=module&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;--eval&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Никогда не разрешающийся Promise:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;await new Promise(() =&gt; {})&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;exit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Logs \`13\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="loaders" tabindex="-1">Загрузчики <a class="header-anchor" href="#loaders" aria-label="Permalink to “Загрузчики”">​</a></h2><p>Предыдущая документация по загрузчикам теперь находится в разделе <a href="/ru/nodejs/api/module#customization-hooks">Модули: Хуки кастомизации</a>.</p><h2 id="resolution-and-loading-algorithm" tabindex="-1">Алгоритм разрешения и загрузки <a class="header-anchor" href="#resolution-and-loading-algorithm" aria-label="Permalink to “Алгоритм разрешения и загрузки”">​</a></h2><h3 id="features" tabindex="-1">Функции <a class="header-anchor" href="#features" aria-label="Permalink to “Функции”">​</a></h3><p>Резолвер по умолчанию имеет следующие свойства:</p><ul><li>Разрешение на основе FileURL, как используется модулями ES</li><li>Относительное и абсолютное разрешение URL</li><li>Отсутствие расширений по умолчанию</li><li>Отсутствие основных файлов в папках</li><li>Поиск разрешения пакетов без спецификатора через node_modules</li><li>Не завершается с ошибкой при неизвестных расширениях или протоколах</li><li>Может опционально предоставить подсказку о формате для фазы загрузки</li></ul><p>Загрузчик по умолчанию имеет следующие свойства:</p><ul><li>Поддержка загрузки встроенных модулей через URL-адреса <code>node:</code></li><li>Поддержка загрузки &quot;встроенных&quot; модулей через URL-адреса <code>data:</code></li><li>Поддержка загрузки модулей <code>file:</code></li><li>Завершается с ошибкой для любого другого протокола URL</li><li>Завершается с ошибкой для неизвестных расширений для загрузки <code>file:</code> (поддерживает только <code>.cjs</code>, <code>.js</code> и <code>.mjs</code>)</li></ul><h3 id="resolution-algorithm" tabindex="-1">Алгоритм разрешения <a class="header-anchor" href="#resolution-algorithm" aria-label="Permalink to “Алгоритм разрешения”">​</a></h3><p>Алгоритм загрузки спецификатора ES-модуля задается с помощью метода <strong>ESM_RESOLVE</strong>, представленного ниже. Он возвращает разрешенный URL-адрес для спецификатора модуля относительно parentURL.</p><p>Алгоритм разрешения определяет полный разрешенный URL-адрес для загрузки модуля, а также предлагаемый формат модуля. Алгоритм разрешения не определяет, можно ли загрузить URL-адрес разрешенного протокола или разрешены ли расширения файлов. Вместо этого эти проверки применяются Node.js на этапе загрузки (например, если было запрошено загрузить URL-адрес, который имеет протокол, отличный от <code>file:</code>, <code>data:</code> или <code>node:</code>.)</p><p>Алгоритм также пытается определить формат файла на основе расширения (см. алгоритм <strong>ESM_FILE_FORMAT</strong> ниже). Если он не распознает расширение файла (например, если это не <code>.mjs</code>, <code>.cjs</code> или <code>.json</code>), то возвращается формат <code>undefined</code>, который вызовет ошибку на этапе загрузки.</p><p>Алгоритм определения формата модуля разрешенного URL-адреса предоставляется <strong>ESM_FILE_FORMAT</strong>, который возвращает уникальный формат модуля для любого файла. Формат <em>&quot;module&quot;</em> возвращается для модуля ECMAScript, в то время как формат <em>&quot;commonjs&quot;</em> используется для указания загрузки через устаревший загрузчик CommonJS. Дополнительные форматы, такие как <em>&quot;addon&quot;</em>, могут быть расширены в будущих обновлениях.</p><p>В следующих алгоритмах все ошибки подпрограмм распространяются как ошибки этих подпрограмм верхнего уровня, если не указано иное.</p><p><em>defaultConditions</em> - это массив условных имен окружения, <code>[&quot;node&quot;, &quot;import&quot;]</code>.</p><p>Разрешитель может выдать следующие ошибки:</p><ul><li><em>Invalid Module Specifier</em>: Спецификатор модуля является недопустимым URL-адресом, именем пакета или спецификатором подпути пакета.</li><li><em>Invalid Package Configuration</em>: Конфигурация package.json недействительна или содержит недопустимую конфигурацию.</li><li><em>Invalid Package Target</em>: Экспорты или импорты пакета определяют целевой модуль для пакета, который является недопустимым типом или строковым целевым объектом.</li><li><em>Package Path Not Exported</em>: Экспорты пакета не определяют и не разрешают целевой подпуть в пакете для данного модуля.</li><li><em>Package Import Not Defined</em>: Импорты пакета не определяют спецификатор.</li><li><em>Module Not Found</em>: Запрошенный пакет или модуль не существует.</li><li><em>Unsupported Directory Import</em>: Разрешенный путь соответствует каталогу, который не является поддерживаемой целью для импорта модулей.</li></ul><h3 id="resolution-algorithm-specification" tabindex="-1">Спецификация алгоритма разрешения <a class="header-anchor" href="#resolution-algorithm-specification" aria-label="Permalink to “Спецификация алгоритма разрешения”">​</a></h3><p><strong>ESM_RESOLVE</strong>(<em>specifier</em>, <em>parentURL</em>)</p><p><strong>PACKAGE_RESOLVE</strong>(<em>packageSpecifier</em>, <em>parentURL</em>)</p><p><strong>PACKAGE_SELF_RESOLVE</strong>(<em>packageName</em>, <em>packageSubpath</em>, <em>parentURL</em>)</p><p><strong>PACKAGE_EXPORTS_RESOLVE</strong>(<em>packageURL</em>, <em>subpath</em>, <em>exports</em>, <em>conditions</em>)</p><p><strong>PACKAGE_IMPORTS_RESOLVE</strong>(<em>specifier</em>, <em>parentURL</em>, <em>conditions</em>)</p><p><strong>PACKAGE_IMPORTS_EXPORTS_RESOLVE</strong>(<em>matchKey</em>, <em>matchObj</em>, <em>packageURL</em>, <em>isImports</em>, <em>conditions</em>)</p><p><strong>PATTERN_KEY_COMPARE</strong>(<em>keyA</em>, <em>keyB</em>)</p><p><strong>PACKAGE_TARGET_RESOLVE</strong>(<em>packageURL</em>, <em>target</em>, <em>patternMatch</em>, <em>isImports</em>, <em>conditions</em>)</p><p><strong>ESM_FILE_FORMAT</strong>(<em>url</em>)</p><p><strong>LOOKUP_PACKAGE_SCOPE</strong>(<em>url</em>)</p><p><strong>READ_PACKAGE_JSON</strong>(<em>packageURL</em>)</p><p><strong>DETECT_MODULE_SYNTAX</strong>(<em>source</em>)</p><h3 id="customizing-esm-specifier-resolution-algorithm" tabindex="-1">Настройка алгоритма разрешения спецификаторов ESM <a class="header-anchor" href="#customizing-esm-specifier-resolution-algorithm" aria-label="Permalink to “Настройка алгоритма разрешения спецификаторов ESM”">​</a></h3><p><a href="/ru/nodejs/api/module#customization-hooks">Хуки настройки модулей</a> предоставляют механизм для настройки алгоритма разрешения спецификаторов ESM. Примером, который обеспечивает разрешение в стиле CommonJS для спецификаторов ESM, является <a href="https://github.com/nodejs/loaders-test/tree/main/commonjs-extension-resolution-loader" target="_blank" rel="noreferrer">commonjs-extension-resolution-loader</a>.</p>`,191)])}var s=e(a,[[`render`,o]]);export{i as __pageData,s as default};