<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js パフォーマンス最適化のためのフレイムグラフ | API &amp; ガイド &amp; 開発者のドキュメントセンター</title>
    <meta name="description" content="関数に費やされた CPU 時間を視覚化し、Node.js のパフォーマンスを最適化するためのフレイムグラフの作成方法を学びます。">
    <meta name="generator" content="VitePress v2.0.0-alpha.5">
    <link rel="preload stylesheet" href="/assets/style.BOW9Aqd_.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <script type="module" src="/assets/chunks/metadata.f006ef31.js"></script>
    <script type="module" src="/assets/app.BOiumQCo.js"></script>
    <link rel="modulepreload" href="/assets/chunks/plugin-vue_export-helper.Bts1mPc7.js">
    <link rel="modulepreload" href="/assets/chunks/translation.CRvAmi0k.js">
    <link rel="modulepreload" href="/assets/chunks/VPLocalSearchBox.CpAM03QS.js">
    <link rel="modulepreload" href="/assets/ja_nodejs_guide_flame-graphs.md.DXrTlaQm.lean.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="theme-color" content="#5f67ee">
    <meta property="og:type" content="website">
    <meta property="og:title" content="iDoc | API &amp; Guide for Developers">
    <meta property="og:site_name" content="iDoc">
    <meta property="og:image" content="https://idoc.dev/logo.svg">
    <meta property="og:url" content="https://idoc.dev/ja/nodejs/guide/flame-graphs">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="idoc.dev">
    <meta name="twitter:image" content="https://idoc.dev/logo.svg">
    <meta name="twitter:title" content="Node.js パフォーマンス最適化のためのフレイムグラフ | Node.js - iDoc.dev">
    <meta name="twitter:creator" content="neo@idoc.dev">
    <meta name="twitter:url" content="https://node.idoc.dev/">
    <meta name="twitter:description" content="関数に費やされた CPU 時間を視覚化し、Node.js のパフォーマンスを最適化するためのフレイムグラフの作成方法を学びます。">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0C67TVVXR"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X0C67TVVXR");</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3961359407117622" crossorigin="anonymous"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="og:title" content="Node.js パフォーマンス最適化のためのフレイムグラフ | Node.js - iDoc.dev">
    <meta name="og:description" content="関数に費やされた CPU 時間を視覚化し、Node.js のパフォーマンスを最適化するためのフレイムグラフの作成方法を学びます。">
    <link rel="canonical" href="https://idoc.dev/ja/nodejs/guide/flame-graphs">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-4539713c><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-4539713c data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-cb5e22fa><div class="wrapper" data-v-cb5e22fa><div class="container" data-v-cb5e22fa><div class="title" data-v-cb5e22fa><div class="VPNavBarTitle has-sidebar" data-v-cb5e22fa data-v-d4488dd0><a class="title" href="/ja/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" width="24" height="24" alt="iDoc.dev" data-v-ab19afbb><!--]--><span data-v-d4488dd0>iDoc</span><!--[--><!--]--></a></div></div><div class="content" data-v-cb5e22fa><div class="content-body" data-v-cb5e22fa><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cb5e22fa><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="ドキュメントを検索"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">ドキュメントを検索</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cb5e22fa data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/ja/nodejs/api/synopsis" tabindex="0" data-v-020be4db data-v-815115f5><!--[--><span data-v-815115f5>API リファレンス</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/ja/nodejs/guide/what-is-nodejs" tabindex="0" data-v-020be4db data-v-815115f5><!--[--><span data-v-815115f5>ガイド</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-cb5e22fa data-v-acee064b data-v-9bb987dd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="言語選択" data-v-9bb987dd><span class="text" data-v-9bb987dd><span class="vpi-languages option-icon" data-v-9bb987dd></span><!----><span class="vpi-chevron-down text-icon" data-v-9bb987dd></span></span></button><div class="menu" data-v-9bb987dd><div class="VPMenu" data-v-9bb987dd data-v-2f78439e><!----><!--[--><!--[--><div class="items" data-v-acee064b><p class="title" data-v-acee064b>日本語</p><!--[--><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>English</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/zh/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/es/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/fr/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Français</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/pt/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/de/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Deutsch</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/it/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Italiano</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ko/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ru/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Русский</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ar/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>العربية</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-cb5e22fa data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-cb5e22fa data-v-f953d92f data-v-9bb987dd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9bb987dd><span class="vpi-more-horizontal icon" data-v-9bb987dd></span></button><div class="menu" data-v-9bb987dd><div class="VPMenu" data-v-9bb987dd data-v-2f78439e><!----><!--[--><!--[--><div class="group translations" data-v-f953d92f><p class="trans-title" data-v-f953d92f>日本語</p><!--[--><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>English</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/zh/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/es/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/fr/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Français</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/pt/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/de/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Deutsch</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/it/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Italiano</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ko/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ru/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Русский</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ar/nodejs/guide/flame-graphs" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>العربية</span><!--]--></a></div><!--]--></div><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>テーマ</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cb5e22fa data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cb5e22fa><div class="divider-line" data-v-cb5e22fa></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-4539713c data-v-6c0451ca><div class="container" data-v-6c0451ca><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-6c0451ca><span class="vpi-align-left menu-icon" data-v-6c0451ca></span><span class="menu-text" data-v-6c0451ca>メニュー</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-6c0451ca data-v-92b7576c><button data-v-92b7576c>トップに戻る</button><!----></div></div></div><aside class="VPSidebar" data-v-4539713c data-v-606f96d3><div class="curtain" data-v-606f96d3></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-606f96d3><span class="visually-hidden" id="sidebar-aria-label" data-v-606f96d3> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>入門ガイド</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/what-is-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>紹介</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/how-to-install-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js のインストール方法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/javascript-for-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js の JavaScript</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/differences-between-node-and-browser" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js とブラウザの違い</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/v8-engine" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>V8 JavaScript エンジン</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/npm-package-manager" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Npm パッケージマネージャー</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/ECMAScript-2015(ES6)-and-beyond" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ECMAScript 2015 (ES6) 以降</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/the-difference-between-development-and-production" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js: 開発と本番の違い</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-with-typescript" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>TypeScript を使用した Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-with-webassembly" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>WebAssembly を使用した Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/debugging-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js のデバッグ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/profiling-nodejs-applications" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js アプリケーションのプロファイリング</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/security-best-practices" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>セキュリティのベストプラクティス</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>非同期処理</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/asynchronous-flow-control" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>非同期フロー制御</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/overview-of-blocking-vs-non-blocking" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ブロッキングとノンブロッキングの概要</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/javascript-asynchronous-programming-and-callbacks" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>JavaScript の非同期プログラミングとコールバック</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/discover-javascript-timer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>JavaScript タイマーの概要</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-event-loop" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js イベントループ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-event-emitter" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js イベントエミッター</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/understanding-process-nexttick" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>process.nextTick() を理解する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/understanding-setimmediate" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>setImmediate() を理解する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/dont-block-the-event-loop" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>イベントループをブロックしない</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>ファイル操作</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-file-stats" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js ファイル統計</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/nodejs-file-path" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js ファイルパス</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/working-with-file-descriptors-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js のファイルディスクリプタを操作する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/reading-files-with-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js でファイルを読む</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/writing-files-with-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js でファイルに書き込む</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/working-with-folders-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js でフォルダを操作する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/how-to-work-with-different-filesystems" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>異なるファイルシステムを操作する方法</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>コマンドライン</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/run-nodejs-scripts-from-the-command-line" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>コマンドラインから Node.js スクリプトを実行する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/how-to-read-environment-variables-from-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js から環境変数を読む方法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/how-to-use-the-nodejs-repl" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js REPL の使用方法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/output-to-the-command-line-using-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js でコマンドラインに出力する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/accept-input-from-the-command-line-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>コマンドライン入力を受け付ける Node.js</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>モジュール</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/how-to-publish-a-nodejs-package" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js パッケージを公開する方法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/anatomy-of-an-http-transaction" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>HTTP トランザクション解析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/abi-stability" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ABI の安定性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/backpressuring-in-streams" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ストリームのバックプレッシャー処理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>診断</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/user-journey" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ユーザー体験</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/memory" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>メモリ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/live-debugging" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ライブデバッグ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/poor-performance" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>パフォーマンスの低下</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/flame-graphs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>フレームグラフ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>テストランナー</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/discovering-nodejs-test-runner" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js テストランナーを探索する</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/ja/nodejs/guide/using-nodejs-test-runner" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js テストランナーを使用する</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4539713c data-v-2652e39a><div class="VPDoc has-sidebar has-aside" data-v-2652e39a data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>ページナビゲーション</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-b7d7ef80><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _ja_nodejs_guide_flame-graphs" data-v-d668f7cc><div><h1 id="フレームグラフ" tabindex="-1">フレームグラフ <a class="header-anchor" href="#フレームグラフ" aria-label="Permalink to “フレームグラフ”">​</a></h1><h2 id="フレームグラフは何に役立つのか" tabindex="-1">フレームグラフは何に役立つのか？ <a class="header-anchor" href="#フレームグラフは何に役立つのか" aria-label="Permalink to “フレームグラフは何に役立つのか？”">​</a></h2><p>フレームグラフは、関数で消費されたCPU時間を可視化する方法です。同期操作に時間をかけすぎている箇所を特定するのに役立ちます。</p><h2 id="フレームグラフの作成方法" tabindex="-1">フレームグラフの作成方法 <a class="header-anchor" href="#フレームグラフの作成方法" aria-label="Permalink to “フレームグラフの作成方法”">​</a></h2><p>Node.jsのフレームグラフの作成は難しいと聞いたことがあるかもしれませんが、それは（もう）真実ではありません。Solaris VMはフレームグラフに必要なくなりました！</p><p>フレームグラフは<code>perf</code>の出力から生成されます。これはNode固有のツールではありません。CPU時間消費を可視化する最も強力な方法ですが、Node.js 8以降でJavaScriptコードが最適化される方法に問題がある可能性があります。以下の<a href="#perf-output-issues">perf出力の問題</a>セクションを参照してください。</p><h3 id="事前パッケージ化されたツールを使用する" tabindex="-1">事前パッケージ化されたツールを使用する <a class="header-anchor" href="#事前パッケージ化されたツールを使用する" aria-label="Permalink to “事前パッケージ化されたツールを使用する”">​</a></h3><p>ローカルでフレームグラフを生成する単一のステップが必要な場合は、<a href="https://www.npmjs.com/package/0x" target="_blank" rel="noreferrer">0x</a>を試してください。</p><p>本番環境のデプロイメントを診断するには、次のノートをお読みください：<a href="https://github.com/davidmarkclements/0x/blob/master/docs/production-servers.md" target="_blank" rel="noreferrer">0x production servers</a>。</p><h3 id="システムのperfツールでフレームグラフを作成する" tabindex="-1">システムのperfツールでフレームグラフを作成する <a class="header-anchor" href="#システムのperfツールでフレームグラフを作成する" aria-label="Permalink to “システムのperfツールでフレームグラフを作成する”">​</a></h3><p>このガイドの目的は、フレームグラフを作成する手順を示し、各ステップを制御できるようにすることです。</p><p>各ステップをよりよく理解したい場合は、詳細について説明する以下のセクションをご覧ください。</p><p>それでは、作業に取り掛かりましょう。</p><ol><li><code>perf</code>をインストールします（まだインストールされていない場合は、通常linux-tools-commonパッケージから入手できます）。</li><li><code>perf</code>の実行を試してください - カーネルモジュールがないというエラーが表示される場合があります。その場合は、それらもインストールしてください。</li><li>perfを有効にしてnodeを実行します（Node.jsのバージョンに固有のヒントについては、<a href="#perf-output-issues">perf出力の問題</a>を参照してください）。</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">perf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> record</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cycles:u</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --perf-basic-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="4"><li>パッケージがないためにperfを実行できないというエラーでない限り、警告は無視してください。カーネルモジュールサンプルにアクセスできないという警告が表示される場合がありますが、それは問題ありません。</li><li><code>perf script &gt; perfs.out</code>を実行して、後で可視化するデータファイルを生成します。より読みやすいグラフにするために、いくつかのクリーンアップを適用すると便利です。</li><li>まだインストールされていない場合は、stackvisをインストールします <code>npm i -g stackvis</code></li><li><code>stackvis perf &lt; perfs.out &gt; flamegraph.htm</code>を実行します。</li></ol><p>これで、お気に入りのブラウザでフレームグラフファイルを開き、燃える様子を見てください。色分けされているので、最も彩度の高いオレンジ色のバーに最初に焦点を当てることができます。それらはCPU負荷の高い関数を表している可能性があります。</p><p>言及する価値があること - フレームグラフの要素をクリックすると、その周囲の拡大図がグラフの上に表示されます。</p><h3 id="実行中のプロセスをサンプリングするために-perf-を使用する" tabindex="-1">実行中のプロセスをサンプリングするために <code>perf</code> を使用する <a class="header-anchor" href="#実行中のプロセスをサンプリングするために-perf-を使用する" aria-label="Permalink to “実行中のプロセスをサンプリングするために perf を使用する”">​</a></h3><p>これは、中断したくない既に実行中のプロセスからフレームグラフデータを記録するのに最適です。再現が難しい問題を抱えた本番プロセスを想像してみてください。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">perf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> record</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -F99</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pgrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sleep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>sleep 3</code> は何のためにあるのでしょうか？これは perf を実行し続けるためにあります。<code>-p</code> オプションが別の pid を指していても、コマンドはプロセスで実行され、そのプロセスで終了する必要があります。perf は、実際にそのコマンドをプロファイリングしているかどうかに関係なく、渡したコマンドのライフサイクルで実行されます。<code>sleep 3</code> は、perf が 3 秒間実行されるようにします。</p><p><code>-F</code>（プロファイリング頻度）が 99 に設定されているのはなぜですか？これは妥当なデフォルトです。必要に応じて調整できます。<code>-F99</code> は、perf に 1 秒あたり 99 サンプルを取得するように指示します。精度を高めるには、値を大きくします。値を小さくすると、出力が少なくなり、結果の精度が低下します。必要な精度は、CPU を集中的に使用する関数の実際の実行時間によって異なります。目に見える速度低下の原因を探している場合、1 秒あたり 99 フレームで十分すぎるはずです。</p><p>3 秒間の perf レコードを取得したら、上記の手順の最後の 2 つでフレームグラフを生成します。</p><h3 id="node-js-の内部関数をフィルタリングする" tabindex="-1">Node.js の内部関数をフィルタリングする <a class="header-anchor" href="#node-js-の内部関数をフィルタリングする" aria-label="Permalink to “Node.js の内部関数をフィルタリングする”">​</a></h3><p>通常、自分の呼び出しのパフォーマンスだけを見たいので、Node.js と V8 の内部関数をフィルタリングすると、グラフがはるかに読みやすくなります。perf ファイルは次のようにクリーンアップできます。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/(_libc_start|LazyCompile) |v8::internal::BuiltIn|Stub|LoadIC:\\[\\[&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/^$/d&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    perf.data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> perf.out</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>フレームグラフを読んで、キーとなる関数がほとんどの時間を占めているのに何かが欠けているように見える場合は、フィルターなしでフレームグラフを生成してみてください。Node.js 自体の問題のまれなケースかもしれません。</p><h3 id="node-js-のプロファイリングオプション" tabindex="-1">Node.js のプロファイリングオプション <a class="header-anchor" href="#node-js-のプロファイリングオプション" aria-label="Permalink to “Node.js のプロファイリングオプション”">​</a></h3><p><code>--perf-basic-prof-only-functions</code> と <code>--perf-basic-prof</code> は、JavaScript コードをデバッグするのに役立つ 2 つのオプションです。他のオプションは Node.js 自体をプロファイリングするために使用されます。これは、このガイドの範囲外です。</p><p><code>--perf-basic-prof-only-functions</code> は、出力が少ないため、オーバーヘッドが最も少ないオプションです。</p><h3 id="なぜそれらが必要なのか" tabindex="-1">なぜそれらが必要なのか？ <a class="header-anchor" href="#なぜそれらが必要なのか" aria-label="Permalink to “なぜそれらが必要なのか？”">​</a></h3><p>これらのオプションがなければ、フレームグラフは生成されますが、ほとんどのバーには <code>v8::Function::Call</code> と表示されます。</p><h2 id="perf-の出力に関する問題" tabindex="-1"><code>Perf</code> の出力に関する問題 <a class="header-anchor" href="#perf-の出力に関する問題" aria-label="Permalink to “Perf の出力に関する問題”">​</a></h2><h3 id="node-js-8-x-v8-パイプラインの変更" tabindex="-1">Node.js 8.x V8 パイプラインの変更 <a class="header-anchor" href="#node-js-8-x-v8-パイプラインの変更" aria-label="Permalink to “Node.js 8.x V8 パイプラインの変更”">​</a></h3><p>Node.js 8.x 以降には、V8 エンジンの JavaScript コンパイルパイプラインに新しい最適化が組み込まれており、perf では関数名/参照に到達できない場合があります。（これは Turbofan と呼ばれます）</p><p>その結果、フレームグラフで関数名が正しく取得できない可能性があります。</p><p>関数名が表示されるはずの場所に <code>ByteCodeHandler:</code> が表示されることに気づくでしょう。</p><p>0x にはそのための軽減策が組み込まれています。</p><p>詳細については、以下を参照してください。</p><ul><li><a href="https://github.com/nodejs/benchmarking/issues/168" target="_blank" rel="noreferrer">https://github.com/nodejs/benchmarking/issues/168</a></li><li><a href="https://github.com/nodejs/diagnostics/issues/148#issuecomment-369348961" target="_blank" rel="noreferrer">https://github.com/nodejs/diagnostics/issues/148#issuecomment-369348961</a></li></ul><h3 id="node-js-10" tabindex="-1">Node.js 10+ <a class="header-anchor" href="#node-js-10" aria-label="Permalink to “Node.js 10+”">​</a></h3><p>Node.js 10.x では、<code>--interpreted-frames-native-stack</code> フラグを使用して Turbofan の問題に対処しています。</p><p><code>node --interpreted-frames-native-stack --perf-basic-prof-only-functions</code> を実行すると、V8 がどのパイプラインを使用して JavaScript をコンパイルしたかに関係なく、フレームグラフに関数名が表示されます。</p><h3 id="フレームグラフ内の壊れたラベル" tabindex="-1">フレームグラフ内の壊れたラベル <a class="header-anchor" href="#フレームグラフ内の壊れたラベル" aria-label="Permalink to “フレームグラフ内の壊れたラベル”">​</a></h3><p>次のようなラベルが表示される場合</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_ZN2v88internal11interpreter17BytecodeGenerator15VisitStatementsEPMS0_8Zone</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>これは、使用している Linux perf がデマングルサポート付きでコンパイルされていないことを意味します。たとえば、<a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1396654" target="_blank" rel="noreferrer">https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1396654</a> を参照してください。</p><h2 id="例" tabindex="-1">例 <a class="header-anchor" href="#例" aria-label="Permalink to “例”">​</a></h2><p><a href="https://github.com/naugtur/node-example-flamegraph" target="_blank" rel="noreferrer">フレームグラフ演習</a>で、フレームグラフの取得を練習しましょう！</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/ja/nodejs/guide/poor-performance" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>前のページ</span><span class="title" data-v-1bcd8184>パフォーマンスの低下</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/ja/nodejs/guide/discovering-nodejs-test-runner" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>次のページ</span><span class="title" data-v-1bcd8184>Node.js テストランナーを探索する</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-4539713c data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5><a href="https://idoc.dev/ja/privacy">プライバシーポリシー</a></p><p class="copyright" data-v-5b9946f5>著作権 © 2024-present <a href="https://idoc.dev/ja/">iDoc.dev</a></p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>