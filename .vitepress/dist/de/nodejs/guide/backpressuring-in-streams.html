<!DOCTYPE html>
<html lang="de" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verständnis für Rückdruck in Node.js-Streams | API &amp; Leitfäden &amp; Entwicklerdokumentationszentrum</title>
    <meta name="description" content="Erfahren Sie, wie Sie benutzerdefinierte Readable- und Writable-Streams in Node.js implementieren können, während Sie den Rückdruck respektieren, um einen effizienten Datenfluss sicherzustellen und häufige Fallstricke zu vermeiden.">
    <meta name="generator" content="VitePress v2.0.0-alpha.5">
    <link rel="preload stylesheet" href="/assets/style.4-HONZjt.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    <script type="module" src="/assets/chunks/metadata.b396fbd4.js"></script>
    <script type="module" src="/assets/app.NvFkMFIO.js"></script>
    <link rel="modulepreload" href="/assets/chunks/plugin-vue_export-helper.Bts1mPc7.js">
    <link rel="modulepreload" href="/assets/chunks/translation.CRvAmi0k.js">
    <link rel="modulepreload" href="/assets/chunks/VPLocalSearchBox.DEL5Gh-3.js">
    <link rel="modulepreload" href="/assets/de_nodejs_guide_backpressuring-in-streams.md.BnUFypgd.lean.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="theme-color" content="#5f67ee">
    <meta property="og:type" content="website">
    <meta property="og:title" content="iDoc | API &amp; Guide for Developers">
    <meta property="og:site_name" content="iDoc">
    <meta property="og:image" content="https://idoc.dev/logo.svg">
    <meta property="og:url" content="https://idoc.dev/de/nodejs/guide/backpressuring-in-streams">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="idoc.dev">
    <meta name="twitter:image" content="https://idoc.dev/logo.svg">
    <meta name="twitter:title" content="Verständnis für Rückdruck in Node.js-Streams | Node.js - iDoc.dev">
    <meta name="twitter:creator" content="neo@idoc.dev">
    <meta name="twitter:url" content="https://node.idoc.dev/">
    <meta name="twitter:description" content="Erfahren Sie, wie Sie benutzerdefinierte Readable- und Writable-Streams in Node.js implementieren können, während Sie den Rückdruck respektieren, um einen effizienten Datenfluss sicherzustellen und häufige Fallstricke zu vermeiden.">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X0C67TVVXR"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X0C67TVVXR");</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3961359407117622" crossorigin="anonymous"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="og:title" content="Verständnis für Rückdruck in Node.js-Streams | Node.js - iDoc.dev">
    <meta name="og:description" content="Erfahren Sie, wie Sie benutzerdefinierte Readable- und Writable-Streams in Node.js implementieren können, während Sie den Rückdruck respektieren, um einen effizienten Datenfluss sicherzustellen und häufige Fallstricke zu vermeiden.">
    <link rel="canonical" href="https://idoc.dev/de/nodejs/guide/backpressuring-in-streams">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-4539713c><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-4539713c data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-cb5e22fa><div class="wrapper" data-v-cb5e22fa><div class="container" data-v-cb5e22fa><div class="title" data-v-cb5e22fa><div class="VPNavBarTitle has-sidebar" data-v-cb5e22fa data-v-d4488dd0><a class="title" href="/de/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" width="24" height="24" alt="iDoc.dev" data-v-ab19afbb><!--]--><span data-v-d4488dd0>iDoc</span><!--[--><!--]--></a></div></div><div class="content" data-v-cb5e22fa><div class="content-body" data-v-cb5e22fa><!--[--><!--]--><div class="VPNavBarSearch search" data-v-cb5e22fa><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="In Dokumenten suchen"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">In Dokumenten suchen</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-cb5e22fa data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/de/nodejs/api/synopsis" tabindex="0" data-v-020be4db data-v-815115f5><!--[--><span data-v-815115f5>API-Referenz</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/de/nodejs/guide/what-is-nodejs" tabindex="0" data-v-020be4db data-v-815115f5><!--[--><span data-v-815115f5>Leitfaden</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-cb5e22fa data-v-acee064b data-v-9bb987dd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Sprachen" data-v-9bb987dd><span class="text" data-v-9bb987dd><span class="vpi-languages option-icon" data-v-9bb987dd></span><!----><span class="vpi-chevron-down text-icon" data-v-9bb987dd></span></span></button><div class="menu" data-v-9bb987dd><div class="VPMenu" data-v-9bb987dd data-v-2f78439e><!----><!--[--><!--[--><div class="items" data-v-acee064b><p class="title" data-v-acee064b>Deutsch</p><!--[--><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>English</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/zh/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/es/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/fr/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Français</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/pt/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/it/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Italiano</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ja/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>日本語</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ko/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ru/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Русский</span><!--]--></a></div><div class="VPMenuLink" data-v-acee064b data-v-7eeeb2dc><a class="VPLink link" href="/ar/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>العربية</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-cb5e22fa data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-cb5e22fa data-v-f953d92f data-v-9bb987dd><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9bb987dd><span class="vpi-more-horizontal icon" data-v-9bb987dd></span></button><div class="menu" data-v-9bb987dd><div class="VPMenu" data-v-9bb987dd data-v-2f78439e><!----><!--[--><!--[--><div class="group translations" data-v-f953d92f><p class="trans-title" data-v-f953d92f>Deutsch</p><!--[--><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>English</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/zh/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>简体中文</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/es/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/fr/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Français</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/pt/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/it/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Italiano</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ja/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>日本語</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ko/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ru/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>Русский</span><!--]--></a></div><div class="VPMenuLink" data-v-f953d92f data-v-7eeeb2dc><a class="VPLink link" href="/ar/nodejs/guide/backpressuring-in-streams" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>العربية</span><!--]--></a></div><!--]--></div><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Thema</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-cb5e22fa data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-cb5e22fa><div class="divider-line" data-v-cb5e22fa></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-4539713c data-v-6c0451ca><div class="container" data-v-6c0451ca><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-6c0451ca><span class="vpi-align-left menu-icon" data-v-6c0451ca></span><span class="menu-text" data-v-6c0451ca>Menü</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-6c0451ca data-v-92b7576c><button data-v-92b7576c>Zurück nach oben</button><!----></div></div></div><aside class="VPSidebar" data-v-4539713c data-v-606f96d3><div class="curtain" data-v-606f96d3></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-606f96d3><span class="visually-hidden" id="sidebar-aria-label" data-v-606f96d3> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Einführung</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/what-is-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Einleitung</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/how-to-install-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Wie man Node.js installiert</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/javascript-for-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>JavaScript in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/differences-between-node-and-browser" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Unterschiede zwischen Node.js und dem Browser</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/v8-engine" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>JavaScript V8-Engine</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/npm-package-manager" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Npm-Paketmanager</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/ECMAScript-2015(ES6)-and-beyond" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ECMAScript 2015 (ES6) und darüber hinaus</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/the-difference-between-development-and-production" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js: Unterschied zwischen Entwicklung und Produktion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-with-typescript" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js mit TypeScript</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-with-webassembly" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Node.js mit WebAssembly</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/debugging-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Debugging in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/profiling-nodejs-applications" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Profiling von Node.js-Anwendungen</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/security-best-practices" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Beste Sicherheitspraktiken</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Asynchrone Arbeit</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/asynchronous-flow-control" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Asynchrone Flusskontrolle</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/overview-of-blocking-vs-non-blocking" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Übersicht über Blockieren vs. Nicht-Blockieren</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/javascript-asynchronous-programming-and-callbacks" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Asynchrone Programmierung in JavaScript und Callbacks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/discover-javascript-timer" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Übersicht über JavaScript-Timer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-event-loop" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Ereignisschleife in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-event-emitter" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Ereignisauslöser in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/understanding-process-nexttick" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Verstehen von process.nextTick()</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/understanding-setimmediate" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Verstehen von setImmediate()</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/dont-block-the-event-loop" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Blockieren Sie die Ereignisschleife nicht</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Dateioperationen</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-file-stats" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Dateistatistiken in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/nodejs-file-path" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Dateipfade in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/working-with-file-descriptors-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Arbeiten mit Dateideskriptoren in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/reading-files-with-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Lesen von Dateien mit Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/writing-files-with-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Schreiben von Dateien mit Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/working-with-folders-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Arbeiten mit Ordnern in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/how-to-work-with-different-filesystems" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Arbeiten mit verschiedenen Dateisystemen</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Kommandozeile</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/run-nodejs-scripts-from-the-command-line" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Ausführen von Node.js-Skripten über die Kommandozeile</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/how-to-read-environment-variables-from-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Lesen von Umgebungsvariablen in Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/how-to-use-the-nodejs-repl" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Verwendung von Node.js REPL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/output-to-the-command-line-using-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Ausgabe auf der Kommandozeile mit Node.js</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/accept-input-from-the-command-line-in-nodejs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Eingaben über die Kommandozeile in Node.js akzeptieren</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Module</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/how-to-publish-a-nodejs-package" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Veröffentlichen eines Node.js-Pakets</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/anatomy-of-an-http-transaction" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Anatomie einer HTTP-Transaktion</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/abi-stability" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>ABI-Stabilität</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/backpressuring-in-streams" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Umgang mit Backpressure in Streams</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Diagnose</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/user-journey" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Benutzererfahrung</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/memory" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Speicher</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/live-debugging" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Echtzeit-Debugging</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/poor-performance" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Schlechte Leistung</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/flame-graphs" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Flammen-Diagramme</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Test-Runner</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-6b36a2fd><span class="vpi-chevron-right caret-icon" data-v-6b36a2fd></span></div></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/discovering-nodejs-test-runner" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Entdecken des Node.js-Test-Runners</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/de/nodejs/guide/using-nodejs-test-runner" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Verwendung des Node.js-Test-Runners</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4539713c data-v-2652e39a><div class="VPDoc has-sidebar has-aside" data-v-2652e39a data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>Seitennavigation</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-b7d7ef80><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _de_nodejs_guide_backpressuring-in-streams" data-v-d668f7cc><div><h1 id="backpressure-in-streams" tabindex="-1">Backpressure in Streams <a class="header-anchor" href="#backpressure-in-streams" aria-label="Permalink to “Backpressure in Streams”">​</a></h1><p>Es gibt ein allgemeines Problem, das bei der Datenverarbeitung auftritt und als Backpressure bezeichnet wird. Es beschreibt eine Ansammlung von Daten hinter einem Puffer während der Datenübertragung. Wenn das empfangende Ende der Übertragung komplexe Operationen ausführt oder aus irgendeinem Grund langsamer ist, besteht die Tendenz, dass sich Daten von der eingehenden Quelle ansammeln, wie eine Verstopfung.</p><p>Um dieses Problem zu lösen, muss ein Delegationssystem vorhanden sein, um einen reibungslosen Datenfluss von einer Quelle zur anderen zu gewährleisten. Verschiedene Communities haben dieses Problem auf einzigartige Weise für ihre Programme gelöst. Unix-Pipes und TCP-Sockets sind gute Beispiele dafür und werden oft als Flusskontrolle bezeichnet. In Node.js sind Streams die gängige Lösung.</p><p>Ziel dieses Leitfadens ist es, genauer zu erläutern, was Backpressure ist und wie Streams dies im Node.js-Quellcode genau adressieren. Der zweite Teil des Leitfadens stellt empfohlene Best Practices vor, um sicherzustellen, dass der Code Ihrer Anwendung sicher und optimiert ist, wenn Streams implementiert werden.</p><p>Wir setzen eine gewisse Vertrautheit mit der allgemeinen Definition von <code>Backpressure</code>, <code>Buffer</code> und <code>EventEmitters</code> in Node.js sowie einige Erfahrung mit <code>Stream</code> voraus. Wenn Sie diese Dokumente noch nicht gelesen haben, ist es keine schlechte Idee, zuerst einen Blick auf die <a href="/de/nodejs/api/stream">API-Dokumentation</a> zu werfen, da dies Ihr Verständnis beim Lesen dieses Leitfadens erweitern wird.</p><h2 id="das-problem-bei-der-datenverarbeitung" tabindex="-1">Das Problem bei der Datenverarbeitung <a class="header-anchor" href="#das-problem-bei-der-datenverarbeitung" aria-label="Permalink to “Das Problem bei der Datenverarbeitung”">​</a></h2><p>In einem Computersystem werden Daten von einem Prozess zu einem anderen über Pipes, Sockets und Signale übertragen. In Node.js finden wir einen ähnlichen Mechanismus, der als <code>Stream</code> bezeichnet wird. Streams sind großartig! Sie leisten so viel für Node.js und fast jeder Teil der internen Codebasis verwendet dieses Modul. Als Entwickler werden Sie mehr als ermutigt, sie auch zu verwenden!</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:readline&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> readline.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    output: process.stdout,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input: process.stdin,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">question</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Warum sollten Sie Streams verwenden? &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Vielleicht ist es ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}, vielleicht liegt es daran, dass sie großartig sind!`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Ein gutes Beispiel dafür, warum der durch Streams implementierte Backpressure-Mechanismus eine großartige Optimierung darstellt, kann durch den Vergleich der internen Systemtools aus der Stream-Implementierung von Node.js demonstriert werden.</p><p>In einem Szenario nehmen wir eine große Datei (ungefähr -9 GB) und komprimieren sie mit dem bekannten Tool <code>zip(1)</code>.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> The.Matrix.1080p.mkv</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Während dies einige Minuten dauern wird, können wir in einer anderen Shell ein Skript ausführen, das das Node.js-Modul <code>zlib</code> verwendet, das ein anderes Komprimierungstool, <code>gzip(1)</code>, umschließt.</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:zlib&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv.gz&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gzip).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Um die Ergebnisse zu testen, versuchen Sie, jede komprimierte Datei zu öffnen. Die mit dem Tool <code>zip(1)</code> komprimierte Datei meldet, dass die Datei beschädigt ist, während die von Stream abgeschlossene Komprimierung fehlerfrei dekomprimiert wird.</p><div class="tip custom-block"><p class="custom-block-title">Hinweis</p><p>In diesem Beispiel verwenden wir <code>.pipe()</code>, um die Datenquelle von einem Ende zum anderen zu bringen. Beachten Sie jedoch, dass keine geeigneten Fehlerbehandlungsroutinen angehängt sind. Wenn ein Datenblock nicht ordnungsgemäß empfangen werden kann, wird die Readable-Quelle oder der <code>gzip</code>-Stream nicht zerstört. <code>pump</code> ist ein Hilfsprogramm, das alle Streams in einer Pipeline ordnungsgemäß zerstört, wenn einer von ihnen fehlschlägt oder geschlossen wird, und ist in diesem Fall ein Muss!</p></div><p><code>pump</code> ist nur für Node.js 8.x oder früher erforderlich, da für Node.js 10.x oder spätere Versionen <code>pipeline</code> eingeführt wurde, um <code>pump</code> zu ersetzen. Dies ist eine Modulmethode, um zwischen Streams zu pipen, Fehler weiterzuleiten, ordnungsgemäß aufzuräumen und einen Callback bereitzustellen, wenn die Pipeline abgeschlossen ist.</p><p>Hier ist ein Beispiel für die Verwendung von Pipeline:</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:zlib&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Verwenden Sie die Pipeline-API, um auf einfache Weise eine Reihe von Streams</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// miteinander zu verbinden und benachrichtigt zu werden, wenn die Pipeline vollständig abgeschlossen ist.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Eine Pipeline zum effizienten Gzippen einer potenziell riesigen Videodatei:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  zlib.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv.gz&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Pipeline failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Pipeline succeeded&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Sie können auch das Modul <code>stream/promises</code> verwenden, um Pipeline mit <code>async / await</code> zu verwenden:</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:stream/promises&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:zlib&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      zlib.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The.Matrix.1080p.mkv.gz&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Pipeline succeeded&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Pipeline failed&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, err);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="zu-viele-daten-zu-schnell" tabindex="-1">Zu viele Daten, zu schnell <a class="header-anchor" href="#zu-viele-daten-zu-schnell" aria-label="Permalink to “Zu viele Daten, zu schnell”">​</a></h2><p>Es gibt Fälle, in denen ein <code>Readable</code>-Stream Daten viel zu schnell an den <code>Writable</code>-Stream weitergibt - viel mehr, als der Konsument verarbeiten kann!</p><p>In diesem Fall beginnt der Konsument, alle Datenchunks für den späteren Verbrauch zu puffern. Die Schreibwarteschlange wird immer länger, und aus diesem Grund müssen mehr Daten im Speicher gehalten werden, bis der gesamte Prozess abgeschlossen ist.</p><p>Das Schreiben auf eine Festplatte ist viel langsamer als das Lesen von einer Festplatte. Wenn wir also versuchen, eine Datei zu komprimieren und auf unsere Festplatte zu schreiben, entsteht ein Rückstau, da die Schreibfestplatte nicht mit der Geschwindigkeit des Lesens mithalten kann.</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Insgeheim sagt der Stream: &quot;whoa, whoa! Halt, das ist viel zu viel!&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Daten beginnen sich auf der Leseseite des Datenpuffers anzusammeln, während</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// write&#39; versucht, mit dem eingehenden Datenstrom Schritt zu halten.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(gzip).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(outputFile);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Aus diesem Grund ist ein Backpressure-Mechanismus wichtig. Wenn kein Backpressure-System vorhanden wäre, würde der Prozess den Speicher Ihres Systems aufbrauchen, was andere Prozesse effektiv verlangsamen und einen großen Teil Ihres Systems bis zum Abschluss monopolisieren würde.</p><p>Dies führt zu einigen Dingen:</p><ul><li>Verlangsamung aller anderen laufenden Prozesse</li><li>Ein sehr überlasteter Garbage Collector</li><li>Speichererschöpfung</li></ul><p>In den folgenden Beispielen werden wir den Rückgabewert der Funktion <code>.write()</code> entfernen und ihn in <code>true</code> ändern, wodurch die Backpressure-Unterstützung im Node.js-Kern effektiv deaktiviert wird. In jeder Bezugnahme auf die <code>&#39;modifizierte&#39;</code> Binärdatei sprechen wir von der Ausführung der Node-Binärdatei ohne die Zeile <code>return ret;</code>, sondern mit dem ersetzten <code>return true;</code>.</p><h2 id="ubermaßiger-widerstand-bei-der-garbage-collection" tabindex="-1">Übermäßiger Widerstand bei der Garbage Collection <a class="header-anchor" href="#ubermaßiger-widerstand-bei-der-garbage-collection" aria-label="Permalink to “Übermäßiger Widerstand bei der Garbage Collection”">​</a></h2><p>Werfen wir einen Blick auf einen kurzen Benchmark. Am gleichen Beispiel wie oben haben wir einige Zeitmessungen durchgeführt, um eine mittlere Zeit für beide Binärdateien zu erhalten.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   trial</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (#)  | `node` binary (ms) | modified `node` binary (ms)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      56924</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           55011</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      52686</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           55869</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      59479</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           54043</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      54473</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           55229</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      52933</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           59723</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">average</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      55299</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           55975</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Beide benötigen etwa eine Minute für die Ausführung, es gibt also keinen großen Unterschied. Lassen Sie uns jedoch genauer hinsehen, um zu bestätigen, ob unsere Vermutungen richtig sind. Wir verwenden das Linux-Tool <code>dtrace</code>, um zu beurteilen, was mit dem V8-Garbage Collector passiert.</p><p>Die gemessene Zeit des GC (Garbage Collector) gibt die Intervalle eines vollen Zyklus einer einzelnen Bereinigung durch den Garbage Collector an:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">approx.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ms) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ms) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> modified</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ms)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         40</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        170</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        300</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           *</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           *</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           *</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      39000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     26</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      42000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     21</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      47000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     32</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      50000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    8</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     28</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      54000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     35</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Während die beiden Prozesse gleich starten und der GC scheinbar mit der gleichen Rate arbeitet, wird deutlich, dass er nach einigen Sekunden mit einem funktionierenden Backpressure-System die GC-Last über konsistente Intervalle von 4-8 Millisekunden bis zum Ende der Datenübertragung verteilt.</p><p>Wenn jedoch kein Backpressure-System vorhanden ist, beginnt sich die V8-Garbage Collection zu verzögern. Die normale Binärdatei ruft den GC etwa 75 Mal pro Minute auf, während die modifizierte Binärdatei ihn nur 36 Mal aufruft.</p><p>Dies ist die langsame und allmähliche Verschuldung, die sich aus dem wachsenden Speicherverbrauch ergibt. Während Daten übertragen werden, wird ohne ein Backpressure-System mehr Speicher für jede Chunk-Übertragung verwendet.</p><p>Je mehr Speicher zugewiesen wird, desto mehr muss der GC in einem einzigen Durchlauf verarbeiten. Je größer der Durchlauf, desto mehr muss der GC entscheiden, was freigegeben werden kann, und das Scannen nach getrennten Zeigern in einem größeren Speicherbereich verbraucht mehr Rechenleistung.</p><h2 id="speichererschopfung" tabindex="-1">Speichererschöpfung <a class="header-anchor" href="#speichererschopfung" aria-label="Permalink to “Speichererschöpfung”">​</a></h2><p>Um den Speicherverbrauch jeder Binärdatei zu bestimmen, haben wir jeden Prozess einzeln mit <code>/usr/bin/time -lp sudo ./node ./backpressure-example/zlib.js</code> getaktet.</p><p>Dies ist die Ausgabe der normalen Binärdatei:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Die</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rückgabewert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> von</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">wird</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beachtet</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=============================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">real</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        58.88</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        56.79</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          8.79</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  87810048</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  maximale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Resident</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Size</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gemeinsam</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genutzten</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Speichers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ungeteilter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Daten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ungeteilten</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Stacks</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     19427</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Page</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Reclaims</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      3134</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Page</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Faults</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Swaps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Block-Eingabeoperationen</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       194</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Block-Ausgabeoperationen</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  gesendete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Nachrichten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  empfangene</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Nachrichten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  empfangene</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Signale</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        12</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  freiwillige</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kontextwechsel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    666037</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  unfreiwillige</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kontextwechsel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Die maximale Byte-Größe, die vom virtuellen Speicher belegt wird, beträgt ungefähr 87,81 MB.</p><p>Und jetzt ändern wir den Rückgabewert der Funktion <code>.write()</code>:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ohne</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Beachtung</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rückgabewerts</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> von</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">==================================================</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">real</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        54.48</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        53.15</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">          7.43</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1524965376</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  maximale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Resident</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Size</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gemeinsam</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genutzten</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Speichers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ungeteilter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Daten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  durchschnittliche</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Größe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ungeteilten</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Stacks</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    373617</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Page</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Reclaims</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      3139</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Page</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Faults</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Swaps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        18</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Block-Eingabeoperationen</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       199</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Block-Ausgabeoperationen</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  gesendete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Nachrichten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  empfangene</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Nachrichten</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">         1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  empfangene</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Signale</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        25</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  freiwillige</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kontextwechsel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    629566</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  unfreiwillige</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kontextwechsel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Die maximale Byte-Größe, die vom virtuellen Speicher belegt wird, beträgt ungefähr 1,52 GB.</p><p>Ohne vorhandene Streams zur Delegierung des Gegendrucks wird eine Größenordnung mehr Speicherplatz zugewiesen - ein enormer Unterschied zwischen demselben Prozess!</p><p>Dieses Experiment zeigt, wie optimiert und kosteneffizient der Gegendruckmechanismus von Node.js für Ihr Computersystem ist. Lassen Sie uns nun eine Aufschlüsselung der Funktionsweise vornehmen!</p><h2 id="wie-lost-backpressure-diese-probleme" tabindex="-1">Wie löst Backpressure diese Probleme? <a class="header-anchor" href="#wie-lost-backpressure-diese-probleme" aria-label="Permalink to “Wie löst Backpressure diese Probleme?”">​</a></h2><p>Es gibt verschiedene Funktionen, um Daten von einem Prozess zu einem anderen zu übertragen. In Node.js gibt es eine interne, eingebaute Funktion namens <code>.pipe()</code>. Es gibt auch andere Pakete, die Sie verwenden können! Letztendlich haben wir aber auf der grundlegendsten Ebene dieses Prozesses zwei separate Komponenten: die Datenquelle und den Konsumenten.</p><p>Wenn <code>.pipe()</code> von der Quelle aufgerufen wird, signalisiert es dem Konsumenten, dass Daten übertragen werden sollen. Die Pipe-Funktion hilft, die geeigneten Backpressure-Closures für die Ereignisauslöser einzurichten.</p><p>In Node.js ist die Quelle ein <code>Readable</code>-Stream und der Konsument ein <code>Writable</code>-Stream (beide können mit einem Duplex- oder einem Transform-Stream ausgetauscht werden, aber das geht über den Rahmen dieses Leitfadens hinaus).</p><p>Der Moment, in dem Backpressure ausgelöst wird, kann genau auf den Rückgabewert der <code>.write()</code>-Funktion eines <code>Writable</code> eingegrenzt werden. Dieser Rückgabewert wird natürlich durch einige Bedingungen bestimmt.</p><p>In jedem Szenario, in dem der Datenpuffer das <code>highwaterMark</code> überschritten hat oder die Schreibwarteschlange gerade ausgelastet ist, <code>return false</code> <code>.write()</code>.</p><p>Wenn ein <code>false</code>-Wert zurückgegeben wird, springt das Backpressure-System an. Es pausiert den eingehenden <code>Readable</code>-Stream, um keine Daten zu senden, und wartet, bis der Konsument wieder bereit ist. Sobald der Datenpuffer geleert ist, wird ein <code>&#39;drain&#39;</code>-Ereignis ausgelöst und der eingehende Datenfluss wird fortgesetzt.</p><p>Sobald die Warteschlange abgearbeitet ist, ermöglicht Backpressure wieder das Senden von Daten. Der Speicherplatz, der verwendet wurde, wird freigegeben und bereitet sich auf den nächsten Datenstapel vor.</p><p>Dies ermöglicht effektiv, dass zu jedem Zeitpunkt eine feste Menge an Speicher für eine <code>.pipe()</code>-Funktion verwendet wird. Es gibt keine Speicherlecks, keine unendliche Pufferung und der Garbage Collector muss sich nur mit einem Speicherbereich befassen!</p><p>Wenn Backpressure also so wichtig ist, warum haben Sie (wahrscheinlich) noch nichts davon gehört? Die Antwort ist einfach: Node.js erledigt das alles automatisch für Sie.</p><p>Das ist toll! Aber auch nicht so toll, wenn wir versuchen zu verstehen, wie wir unsere eigenen Streams implementieren können.</p><div class="info custom-block"><p class="custom-block-title">NOTE</p><p>Auf den meisten Rechnern gibt es eine Byte-Größe, die bestimmt, wann ein Puffer voll ist (was je nach Rechner variiert). Node.js erlaubt es Ihnen, Ihr eigenes <code>highWaterMark</code> festzulegen, aber üblicherweise ist der Standard auf 16kb (16384 oder 16 für objectMode-Streams) eingestellt. In Fällen, in denen Sie diesen Wert erhöhen möchten, tun Sie dies, aber mit Vorsicht!</p></div><h2 id="lebenszyklus-von-pipe" tabindex="-1">Lebenszyklus von <code>.pipe()</code> <a class="header-anchor" href="#lebenszyklus-von-pipe" aria-label="Permalink to “Lebenszyklus von .pipe()”">​</a></h2><p>Um ein besseres Verständnis von Gegendruck zu erlangen, hier ein Flussdiagramm zum Lebenszyklus eines <code>Readable</code>-Streams, der in einen <code>Writable</code>-Stream <a href="/de/nodejs/api/stream">gepiped</a> wird:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                                     +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">===================+</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         x--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Piping-Funktionen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   src.pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     werden</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> während</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">===================</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                         x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     der</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .pipe-Methode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Event-Callbacks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">===============+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     eingerichtet.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-------------------</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   Ihre</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Daten</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                           |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;close&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=======+=======+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Sie</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> existieren</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> außerhalb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;data&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     des</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Datenflusses,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aber</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;drain&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">              x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     wichtig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ist,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sie</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;unpipe&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+---------v---------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     Events</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> und</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deren</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;error&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Readable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Stream</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +----+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     jeweilige</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Callbacks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;finish&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+-^-------^-------^-+</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     anhängen.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">              |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> .on(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&#39;end&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                           +-------------------+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    +-------------------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         +=================+</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      +---</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Writable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Stream</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +--------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  .write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">           +-------------------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">         +=======+=========+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                 |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                              +------------------v---------+</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       +-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (!chunk)                </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Ist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dieser</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zu</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groß?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     emit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();             </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Ist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> die</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warteschlange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beschäftigt?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       +-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">else</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       +-------+----------------+---+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     emit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();                   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                                   +--v---+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        +---v---+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^-----------------------------------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Nein</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Ja</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                           +------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        +---v---+</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                               |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               emit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .pause</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();          </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================+</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       ^---------------^-----------------------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----+---+</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                               +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=================+</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                                                           |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            wenn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warteschlange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> leer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  +============+</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^------------^-----------------------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pufferung</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">               |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                       |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">============</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">               +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">emit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .drain</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();       </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^Buffer^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">               +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">emit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .resume</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();      </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">+------------+</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ^Buffer^</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                         |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                       +------------+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zur</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Warteschlange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hinzufügen</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                                       |</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---^---------------------</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                                       +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">============+</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p><p>Wenn Sie eine Pipeline einrichten, um ein paar Streams zu verketten, um Ihre Daten zu bearbeiten, werden Sie höchstwahrscheinlich einen Transform-Stream implementieren.</p></div><p>In diesem Fall gelangt Ihre Ausgabe aus Ihrem <code>Readable</code>-Stream in den <code>Transform</code> und wird in den <code>Writable</code> gepiped.</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Readable.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Transformable).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Writable);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Gegendruck wird automatisch angewendet, aber beachten Sie, dass sowohl die eingehende als auch die ausgehende <code>highwaterMark</code> des <code>Transform</code>-Streams manipuliert werden können und das Gegendrucksystem beeinflussen.</p><h2 id="backpressure-richtlinien" tabindex="-1">Backpressure-Richtlinien <a class="header-anchor" href="#backpressure-richtlinien" aria-label="Permalink to “Backpressure-Richtlinien”">​</a></h2><p>Seit Node.js v0.10 bietet die Stream-Klasse die Möglichkeit, das Verhalten von <code>.read()</code> oder <code>.write()</code> mithilfe der Underscore-Version dieser jeweiligen Funktionen (<code>._read()</code> und <code>._write()</code>) zu ändern.</p><p>Es gibt dokumentierte Richtlinien für die Implementierung von Readable Streams und die Implementierung von Writable Streams. Wir gehen davon aus, dass Sie diese gelesen haben, und der nächste Abschnitt wird etwas detaillierter darauf eingehen.</p><h2 id="regeln-die-bei-der-implementierung-von-benutzerdefinierten-streams-zu-beachten-sind" tabindex="-1">Regeln, die bei der Implementierung von benutzerdefinierten Streams zu beachten sind <a class="header-anchor" href="#regeln-die-bei-der-implementierung-von-benutzerdefinierten-streams-zu-beachten-sind" aria-label="Permalink to “Regeln, die bei der Implementierung von benutzerdefinierten Streams zu beachten sind”">​</a></h2><p>Die goldene Regel für Streams ist, immer Backpressure zu respektieren. Was als Best Practice gilt, ist eine nicht widersprüchliche Praxis. Solange Sie darauf achten, Verhaltensweisen zu vermeiden, die mit der internen Backpressure-Unterstützung in Konflikt stehen, können Sie sicher sein, dass Sie eine gute Praxis befolgen.</p><p>Im Allgemeinen gilt:</p><ol><li>Niemals <code>.push()</code> verwenden, wenn Sie nicht dazu aufgefordert werden.</li><li>Niemals <code>.write()</code> aufrufen, nachdem es false zurückgegeben hat, sondern stattdessen auf &#39;drain&#39; warten.</li><li>Streams ändern sich zwischen verschiedenen Node.js-Versionen und der von Ihnen verwendeten Bibliothek. Seien Sie vorsichtig und testen Sie die Dinge.</li></ol><div class="tip custom-block"><p class="custom-block-title">NOTE</p><p>In Bezug auf Punkt 3 ist ein unglaublich nützliches Paket für die Erstellung von Browser-Streams <code>readable-stream</code>. Rodd Vagg hat einen <a href="https://r.va.gg/2014/06/why-i-dont-use-nodes-core-stream-module.html" target="_blank" rel="noreferrer">großartigen Blog-Beitrag</a> geschrieben, der den Nutzen dieser Bibliothek beschreibt. Kurz gesagt, sie bietet eine Art automatisierte, sanfte Verschlechterung für Readable Streams und unterstützt ältere Versionen von Browsern und Node.js.</p></div><h2 id="spezifische-regeln-fur-readable-streams" tabindex="-1">Spezifische Regeln für Readable Streams <a class="header-anchor" href="#spezifische-regeln-fur-readable-streams" aria-label="Permalink to “Spezifische Regeln für Readable Streams”">​</a></h2><p>Bisher haben wir uns angesehen, wie sich <code>.write()</code> auf Backpressure auswirkt, und uns stark auf den Writable Stream konzentriert. Aufgrund der Funktionalität von Node.js fließt Daten technisch gesehen Downstream von Readable zu Writable. Wie wir jedoch bei jeder Übertragung von Daten, Materie oder Energie beobachten können, ist die Quelle genauso wichtig wie das Ziel, und der Readable Stream ist entscheidend für die Handhabung von Backpressure.</p><p>Beide Prozesse sind aufeinander angewiesen, um effektiv zu kommunizieren. Wenn der Readable ignoriert, wenn der Writable Stream ihn auffordert, das Senden von Daten einzustellen, kann dies genauso problematisch sein wie wenn der Rückgabewert von <code>.write()</code> falsch ist.</p><p>Neben der Beachtung des Rückgabewerts von <code>.write()</code> müssen wir auch den Rückgabewert von <code>.push()</code> beachten, der in der <code>._read()</code>-Methode verwendet wird. Wenn <code>.push()</code> einen falschen Wert zurückgibt, stoppt der Stream das Lesen aus der Quelle. Andernfalls wird er ohne Pause fortgesetzt.</p><p>Hier ist ein Beispiel für eine schlechte Praxis bei der Verwendung von <code>.push()</code>:</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dies ist problematisch, da der Rückgabewert von push vollständig ignoriert wird,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// was ein Signal für Backpressure vom Ziel-Stream sein kann!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyReadable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getNextChunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Darüber hinaus gibt es von außerhalb des benutzerdefinierten Streams Fallstricke, wenn Backpressure ignoriert wird. In diesem Gegenbeispiel für eine gute Praxis erzwingt der Code der Anwendung die Datenübertragung, sobald sie verfügbar sind (signalisiert durch das <code>&#39;data&#39;</code>-Ereignis):</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Dies ignoriert die von Node.js eingerichteten Backpressure-Mechanismen</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// und drückt Daten bedingungslos durch, unabhängig davon, ob der</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ziel-Stream bereit dafür ist oder nicht.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">readable.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> writable.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Hier ist ein Beispiel für die Verwendung von <code>.push()</code> mit einem Readable Stream.</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node:stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Erstellen Sie einen benutzerdefinierten Readable Stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> myReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  objectMode: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Schieben Sie einige Daten in den Stream</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello, world!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Markieren Sie das Ende des Streams</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Konsumieren Sie den Stream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myReadableStream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Ausgabe:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// { message: &#39;Hello, world!&#39; }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="regeln-speziell-fur-writable-streams" tabindex="-1">Regeln speziell für Writable Streams <a class="header-anchor" href="#regeln-speziell-fur-writable-streams" aria-label="Permalink to “Regeln speziell für Writable Streams”">​</a></h2><p>Erinnern wir uns, dass ein <code>.write()</code> abhängig von bestimmten Bedingungen true oder false zurückgeben kann. Zum Glück für uns handhabt die Stream-Zustandsmaschine unsere Callbacks, wenn wir unseren eigenen Writable Stream erstellen, und bestimmt, wann Gegendruck behandelt und der Datenfluss für uns optimiert werden soll. Wenn wir jedoch einen Writable direkt verwenden möchten, müssen wir den Rückgabewert von <code>.write()</code> beachten und auf diese Bedingungen achten:</p><ul><li>Wenn die Schreibwarteschlange belegt ist, gibt <code>.write()</code> false zurück.</li><li>Wenn der Datenblock zu groß ist, gibt <code>.write()</code> false zurück (die Grenze wird durch die Variable highWaterMark angegeben).</li></ul><p>In diesem Beispiel erstellen wir einen benutzerdefinierten Readable Stream, der mit <code>.push()</code> ein einzelnes Objekt in den Stream schiebt. Die Methode <code>._read()</code> wird aufgerufen, wenn der Stream bereit ist, Daten zu verarbeiten, und in diesem Fall schieben wir sofort einige Daten in den Stream und markieren das Ende des Streams, indem wir <code>null</code> schieben.</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyReadable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello, world!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyReadable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">readableStream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(process.stdout);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Wir verarbeiten dann den Stream, indem wir auf das Ereignis &#39;data&#39; lauschen und jeden Datenblock protokollieren, der in den Stream geschoben wird. In diesem Fall schieben wir nur einen einzigen Datenblock in den Stream, sodass wir nur eine Protokollnachricht sehen.</p><h2 id="regeln-speziell-fur-writable-streams-1" tabindex="-1">Regeln speziell für Writable Streams <a class="header-anchor" href="#regeln-speziell-fur-writable-streams-1" aria-label="Permalink to “Regeln speziell für Writable Streams”">​</a></h2><p>Erinnern wir uns, dass ein <code>.write()</code> abhängig von bestimmten Bedingungen true oder false zurückgeben kann. Zum Glück für uns handhabt die Stream-Zustandsmaschine unsere Callbacks, wenn wir unseren eigenen Writable Stream erstellen, und bestimmt, wann Gegendruck behandelt und der Datenfluss für uns optimiert werden soll.</p><p>Wenn wir jedoch einen Writable direkt verwenden möchten, müssen wir den Rückgabewert von <code>.write()</code> beachten und auf diese Bedingungen achten:</p><ul><li>Wenn die Schreibwarteschlange belegt ist, gibt <code>.write()</code> false zurück.</li><li>Wenn der Datenblock zu groß ist, gibt <code>.write()</code> false zurück (die Grenze wird durch die Variable highWaterMark angegeben).</li></ul><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Dieser Writable ist aufgrund der asynchronen Natur von JavaScript-Callbacks ungültig.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Ohne eine return-Anweisung für jeden Callback vor dem letzten,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // besteht eine große Chance, dass mehrere Callbacks aufgerufen werden.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (chunk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (chunk.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;b&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Es gibt auch einige Dinge, auf die man bei der Implementierung von <code>._writev()</code> achten sollte. Die Funktion ist mit <code>.cork()</code> gekoppelt, aber es gibt einen häufigen Fehler beim Schreiben:</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Die zweimalige Verwendung von .uncork() führt hier zu zwei Aufrufen auf der C++-Ebene, wodurch die</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Kork-/Entkorktechnik unbrauchbar wird.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;world &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;from &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Matteo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Die korrekte Art, dies zu schreiben, ist die Verwendung von process.nextTick(), das</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// im nächsten Event Loop ausgelöst wird.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;world &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(doUncork, ws);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;from &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Matteo&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(doUncork, ws);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Als globale Funktion.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doUncork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  stream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><code>.cork()</code> kann beliebig oft aufgerufen werden, wir müssen nur darauf achten, <code>.uncork()</code> genauso oft aufzurufen, damit der Fluss wiederhergestellt wird.</p><h2 id="fazit" tabindex="-1">Fazit <a class="header-anchor" href="#fazit" aria-label="Permalink to “Fazit”">​</a></h2><p>Streams sind ein häufig verwendetes Modul in Node.js. Sie sind wichtig für die interne Struktur und für Entwickler, um sich im gesamten Node.js-Modul-Ökosystem zu erweitern und zu vernetzen.</p><p>Hoffentlich können Sie nun Ihre eigenen <code>Writable</code>- und <code>Readable</code>-Streams unter Berücksichtigung des Gegendrucks beheben und sicher programmieren und Ihr Wissen mit Kollegen und Freunden teilen.</p><p>Lesen Sie unbedingt mehr über <code>Stream</code> für andere API-Funktionen, um Ihre Streaming-Fähigkeiten beim Erstellen einer Anwendung mit Node.js zu verbessern und zu entfesseln.</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><!----><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>Letzte Aktualisierung: <time datetime="2025-06-09T10:21:38.000Z" data-v-1bb0c8a8></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/de/nodejs/guide/abi-stability" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Vorherige Seite</span><span class="title" data-v-1bcd8184>ABI-Stabilität</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/de/nodejs/guide/user-journey" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Nächste Seite</span><span class="title" data-v-1bcd8184>Benutzererfahrung</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-4539713c data-v-5b9946f5><div class="container" data-v-5b9946f5><p class="message" data-v-5b9946f5><a href="https://idoc.dev/de/privacy">Datenschutzrichtlinie</a></p><p class="copyright" data-v-5b9946f5>Alle Rechte vorbehalten © 2024-heute <a href="https://idoc.dev/de/">iDoc.dev</a></p></div></footer><!--[--><!--]--></div></div>
    
    
  </body>
</html>