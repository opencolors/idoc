---
title: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js
description: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js, –≤–∫–ª—é—á–∞—è –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–æ–≤, —Ç–µ—Å—Ç—ã –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤, –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
head:
  - - meta
    - name: og:title
      content: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js | Node.js - iDoc.dev
  - - meta
    - name: og:description
      content: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js, –≤–∫–ª—é—á–∞—è –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–æ–≤, —Ç–µ—Å—Ç—ã –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤, –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
  - - meta
    - name: twitter:title
      content: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js | Node.js - iDoc.dev
  - - meta
    - name: twitter:description
      content: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Node.js, –≤–∫–ª—é—á–∞—è –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–æ–≤, —Ç–µ—Å—Ç—ã –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤, –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
---


# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞ Node.js

Node.js –∏–º–µ–µ—Ç –≥–∏–±–∫–∏–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –¥–≤–∏–∂–æ–∫. –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–∫–∞–∂–µ—Ç –≤–∞–º, –∫–∞–∫ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

::: code-group
```bash [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã]
example/
  ‚îú ‚Ä¶
  ‚îú src/
    ‚îú app/‚Ä¶
    ‚îî sw/‚Ä¶
  ‚îî test/
    ‚îú globals/
      ‚îú ‚Ä¶
      ‚îú IndexedDb.js
      ‚îî ServiceWorkerGlobalScope.js
    ‚îú setup.mjs
    ‚îú setup.units.mjs
    ‚îî setup.ui.mjs
```
```bash [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π]
npm init -y
npm install --save-dev concurrently
```
```json [package.json]
{
  "name": "example",
  "scripts": {
    "test": "concurrently --kill-others-on-fail --prefix none npm:test:*",
    "test:sw": "node --import ./test/setup.sw.mjs --test './src/sw/**/*.spec.*'",
    "test:units": "node --import ./test/setup.units.mjs --test './src/app/**/*.spec.*'",
    "test:ui": "node --import ./test/setup.ui.mjs --test './src/app/**/*.test.*'"
  }
}
```
:::

::: info NOTE
–≥–ª–æ–±—ã —Ç—Ä–µ–±—É—é—Ç node v21+, –∏ —Å–∞–º–∏ –≥–ª–æ–±—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–∫–ª—é—á–µ–Ω—ã –≤ –∫–∞–≤—ã—á–∫–∏ (–±–µ–∑ —ç—Ç–æ–≥–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥—Ä—É–≥–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–µ—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —ç—Ç–æ –Ω–µ —Ç–∞–∫).
:::

–ï—Å—Ç—å –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã, –ø–æ—ç—Ç–æ–º—É –ø–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –≤ –±–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂–µ. –≠—Ç–æ—Ç —Ñ–∞–π–ª –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –¥—Ä—É–≥–∏–º–∏, –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

## –û–±—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```js 
import { register } from 'node:module';
register('some-typescript-loader');
// –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º
// –ù–û –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã test/setup.*.mjs –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º JavaScript!
```

–ó–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `setup` (—É–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ –±–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª `setup.mjs` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –∫–∞–∂–¥–æ–º). –ï—Å—Ç—å —Ä—è–¥ –ø—Ä–∏—á–∏–Ω –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –Ω–æ —Å–∞–º–∞—è –æ—á–µ–≤–∏–¥–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ - [YAGNI](https://en.wikipedia.org/wiki/You_aren't_gonna_need_it) + –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å, - —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —Å—Ä–µ–¥—ã –º–æ–∫–∏/–∑–∞–≥–ª—É—à–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –¥–æ—Ä–æ–≥–∏–º–∏ –∏ –∑–∞–º–µ–¥–ª—è—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤. –í—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–∏—Ö –∑–∞—Ç—Ä–∞—Ç (–±—É–∫–≤–∞–ª—å–Ω–æ –¥–µ–Ω–µ–≥, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ CI, –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –∏ —Ç. –¥.), –∫–æ–≥–¥–∞ –æ–Ω–∏ –≤–∞–º –Ω–µ –Ω—É–∂–Ω—ã.

–ö–∞–∂–¥—ã–π –∏–∑ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –±—ã–ª –≤–∑—è—Ç –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤; –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—É–º–µ—Å—Ç–Ω—ã–º–∏/–Ω–µ–ø—Ä–∏–º–µ–Ω–∏–º—ã–º–∏ –∫ –≤–∞—à–∏–º, –Ω–æ –∫–∞–∂–¥—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—â–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —à–∏—Ä–æ–∫–æ –ø—Ä–∏–º–µ–Ω–∏–º—ã.


## ServiceWorker —Ç–µ—Å—Ç—ã

`ServiceWorkerGlobalScope` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—á–µ–Ω—å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ API, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –¥—Ä—É–≥–∏—Ö —Å—Ä–µ–¥–∞—Ö, –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –µ–≥–æ API –∫–∞–∂—É—Ç—Å—è –ø–æ—Ö–æ–∂–∏–º–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `fetch`), –Ω–æ –∏–º–µ—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –í—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ–Ω–∏ –ø—Ä–æ–Ω–∏–∫–∞–ª–∏ –≤ –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.

```js
import { beforeEach } from 'node:test';

import { ServiceWorkerGlobalScope } from './globals/ServiceWorkerGlobalScope.js';

import './setup.mjs'; // üí°

beforeEach(globalSWBeforeEach);
function globalSWBeforeEach() {
  globalThis.self = new ServiceWorkerGlobalScope();
}
```
```js
import assert from 'node:assert/strict';
import { describe, mock, it } from 'node:test';

import { onActivate } from './onActivate.js';

describe('ServiceWorker::onActivate()', () => {
  const globalSelf = globalThis.self;
  const claim = mock.fn(async function mock__claim() {});
  const matchAll = mock.fn(async function mock__matchAll() {});

  class ActivateEvent extends Event {
    constructor(...args) {
      super('activate', ...args);
    }
  }

  before(() => {
    globalThis.self = {
      clients: { claim, matchAll },
    };
  });
  after(() => {
    global.self = globalSelf;
  });

  it('should claim all clients', async () => {
    await onActivate(new ActivateEvent());

    assert.equal(claim.mock.callCount(), 1);
    assert.equal(matchAll.mock.callCount(), 1);
  });
});
```

## Snapshot —Ç–µ—Å—Ç—ã

–û–Ω–∏ –±—ã–ª–∏ –ø–æ–ø—É–ª—è—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω—ã Jest; —Ç–µ–ø–µ—Ä—å –º–Ω–æ–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –≤–∫–ª—é—á–∞—è Node.js –Ω–∞—á–∏–Ω–∞—è —Å v22.3.0. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–≤–æ–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ [Infrastructure as Code](https://en.wikipedia.org/wiki/Infrastructure_as_code) –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

–ù–∏–∫–∞–∫–æ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∫—Ä–æ–º–µ –≤–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é `--experimental-test-snapshots`. –ù–æ —á—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ–±–∞–≤–∏—Ç–µ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤ –æ–¥–∏–Ω –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é node –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–º—è —Ñ–∞–π–ª–∞, –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞: `.js.snapshot`. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º CJS, –ø–æ—ç—Ç–æ–º—É –±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–º –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `.snapshot.cjs` (–∏–ª–∏ –±–æ–ª–µ–µ –∫—Ä–∞—Ç–∫–æ `.snap.cjs`, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂–µ); —ç—Ç–æ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö ESM.

```js
import { basename, dirname, extname, join } from 'node:path';
import { snapshot } from 'node:test';

snapshot.setResolveSnapshotPath(generateSnapshotPath);
/**
 * @param {string} testFilePath '/tmp/foo.test.js'
 * @returns {string} '/tmp/foo.test.snap.cjs'
 */
function generateSnapshotPath(testFilePath) {
  const ext = extname(testFilePath);
  const filename = basename(testFilePath, ext);
  const base = dirname(testFilePath);

  return join(base, `${filename}.snap.cjs`);
}
```

–í –ø—Ä–∏–º–µ—Ä–µ –Ω–∏–∂–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é [testing library](https://testing-library.com/) –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤; –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ `assert.snapshot`):

```js
import { describe, it } from 'node:test';

import { prettyDOM } from '@testing-library/dom';
import { render } from '@testing-library/react'; // Any framework (ex svelte)

import { SomeComponent } from './SomeComponent.jsx';


describe('<SomeComponent>', () => {
  // For people preferring "fat-arrow" syntax, the following is probably better for consistency
  it('should render defaults when no props are provided', (t) => {
    const component = render(<SomeComponent />).container.firstChild;

    t.assert.snapshot(prettyDOM(component));
  });

  it('should consume `foo` when provided', function() {
    const component = render(<SomeComponent foo="bar" />).container.firstChild;

    this.assert.snapshot(prettyDOM(component));
    // `this` works only when `function` is used (not "fat arrow").
  });
});
```

::: warning
`assert.snapshot` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ—Å—Ç–∞ (t –∏–ª–∏ this), –∞ –Ω–µ –∏–∑ `node:assert`. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ—Å—Ç–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è `node:assert` (–≤–∞–º –ø—Ä–∏—à–ª–æ—Å—å –±—ã –≤—Ä—É—á–Ω—É—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –µ–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `assert.snapshot`, –Ω–∞–ø—Ä–∏–º–µ—Ä `snapshot (this, value)`, —á—Ç–æ –±—ã–ª–æ –±—ã –¥–æ–≤–æ–ª—å–Ω–æ —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ).
:::


## Unit tests

Unit tests are the simplest tests and generally require relatively nothing special. The vast majority of your tests will likely be unit tests, so it is important to keep this setup minimal because a small decrease to setup performance will magnify and cascade.

```js
import { register } from 'node:module';

import './setup.mjs'; // üí°

register('some-plaintext-loader');
// plain-text files like graphql can now be imported:
// import GET_ME from 'get-me.gql'; GET_ME = '
```

```js
import assert from 'node:assert/strict';
import { describe, it } from 'node:test';

import { Cat } from './Cat.js';
import { Fish } from './Fish.js';
import { Plastic } from './Plastic.js';

describe('Cat', () => {
  it('should eat fish', () => {
    const cat = new Cat();
    const fish = new Fish();

    assert.doesNotThrow(() => cat.eat(fish));
  });

  it('should NOT eat plastic', () => {
    const cat = new Cat();
    const plastic = new Plastic();

    assert.throws(() => cat.eat(plastic));
  });
});
```

## User Interface tests

UI tests generally require a DOM, and possibly other browser-specific APIs (such as `IndexedDb` used below). These tend to be very complicated and expensive to setup.

If you use an API like `IndexedDb` but it's very isolated, a global mock like below is perhaps not the way to go. Instead, perhaps move this `beforeEach` into the specific test where `IndexedDb` will be accessed. Note that if the module accessing `IndexedDb` (or whatever) is itself widely accessed, either mock that module (probably the better option), or do keep this here.

```js
import { register } from 'node:module';

// ‚ö†Ô∏è Ensure only 1 instance of JSDom is instantiated; multiples will lead to many ü§¨
import jsdom from 'global-jsdom';

import './setup.units.mjs'; // üí°

import { IndexedDb } from './globals/IndexedDb.js';

register('some-css-modules-loader');

jsdom(undefined, {
  url: 'https://test.example.com', // ‚ö†Ô∏è Failing to specify this will likely lead to many ü§¨
});

// Example of how to decorate a global.
// JSDOM's `history` does not handle navigation; the following handles most cases.
const pushState = globalThis.history.pushState.bind(globalThis.history);
globalThis.history.pushState = function mock_pushState(data, unused, url) {
  pushState(data, unused, url);
  globalThis.location.assign(url);
};

beforeEach(globalUIBeforeEach);
function globalUIBeforeEach() {
  globalThis.indexedDb = new IndexedDb();
}
```

You can have 2 different levels of UI tests: a unit-like (wherein externals & dependencies are mocked) and a more end-to-end (where only externals like IndexedDb are mocked but the rest of the chain is real). The former is generally the purer option, and the latter is generally deferred to a fully end-to-end automated usability test via something like [Playwright](https://playwright.dev/) or [Puppeteer](https://pptr.dev/). Below is an example of the former.

```js
import { before, describe, mock, it } from 'node:test';

import { screen } from '@testing-library/dom';
import { render } from '@testing-library/react'; // Any framework (ex svelte)

// ‚ö†Ô∏è Note that SomeOtherComponent is NOT a static import;
// this is necessary in order to facilitate mocking its own imports.


describe('<SomeOtherComponent>', () => {
  let SomeOtherComponent;
  let calcSomeValue;

  before(async () => {
    // ‚ö†Ô∏è Sequence matters: the mock must be set up BEFORE its consumer is imported.

    // Requires the `--experimental-test-module-mocks` be set.
    calcSomeValue = mock.module('./calcSomeValue.js', { calcSomeValue: mock.fn() });

    ({ SomeOtherComponent } = await import('./SomeOtherComponent.jsx'));
  });

  describe('when calcSomeValue fails', () => {
    // This you would not want to handle with a snapshot because that would be brittle:
    // When inconsequential updates are made to the error message,
    // the snapshot test would erroneously fail
    // (and the snapshot would need to be updated for no real value).

    it('should fail gracefully by displaying a pretty error', () => {
      calcSomeValue.mockImplementation(function mock__calcSomeValue() { return null });

      render(<SomeOtherComponent>);

      const errorMessage = screen.queryByText('unable');

      assert.ok(errorMessage);
    });
  });
});
```

## –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã

–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã - —ç—Ç–æ —Å–∞–º—ã–µ –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ. –ü–æ–¥–∞–≤–ª—è—é—â–µ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤, –≤–µ—Ä–æ—è—Ç–Ω–æ, –±—É–¥—É—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —Å–≤–µ—Å—Ç–∏ —ç—Ç—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫ –º–∏–Ω–∏–º—É–º—É, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ–±–æ–ª—å—à–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –∏ –∫–∞—Å–∫–∞–¥–∏—Ä—É–µ—Ç—Å—è.

```js
import { register } from 'node:module';

import './setup.mjs'; // üí°

register('some-plaintext-loader');
// plain-text files like graphql can now be imported:
// import GET_ME from 'get-me.gql'; GET_ME = '
```

```js
import assert from 'node:assert/strict';
import { describe, it } from 'node:test';

import { Cat } from './Cat.js';
import { Fish } from './Fish.js';
import { Plastic } from './Plastic.js';

describe('Cat', () => {
  it('should eat fish', () => {
    const cat = new Cat();
    const fish = new Fish();

    assert.doesNotThrow(() => cat.eat(fish));
  });

  it('should NOT eat plastic', () => {
    const cat = new Cat();
    const plastic = new Plastic();

    assert.throws(() => cat.eat(plastic));
  });
});
```

## –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

UI-—Ç–µ—Å—Ç—ã –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É—é—Ç DOM –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –¥—Ä—É–≥–∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ API (—Ç–∞–∫–∏—Ö –∫–∞–∫ `IndexedDb`, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –Ω–∏–∂–µ). –û–Ω–∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã –∏ –¥–æ—Ä–æ–≥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API, —Ç–∞–∫–æ–π –∫–∞–∫ `IndexedDb`, –Ω–æ –æ–Ω –æ—á–µ–Ω—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω, –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–∫, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∏–∂–µ, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –ø–æ–¥–æ–π–¥–µ—Ç. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç `beforeEach` –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç, –≥–¥–µ –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –¥–æ—Å—Ç—É–ø –∫ `IndexedDb`. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ –º–æ–¥—É–ª—å, –æ–±—Ä–∞—â–∞—é—â–∏–π—Å—è –∫ `IndexedDb` (–∏–ª–∏ —á–µ–º—É-–ª–∏–±–æ –µ—â–µ), —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –ª–∏–±–æ –∑–∞–º–æ–∫–∞–π—Ç–µ —ç—Ç–æ—Ç –º–æ–¥—É–ª—å (–≤–µ—Ä–æ—è—Ç–Ω–æ, –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç), –ª–∏–±–æ –æ—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∑–¥–µ—Å—å.

```js
import { register } from 'node:module';

// ‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω —Ç–æ–ª—å–∫–æ 1 —ç–∫–∑–µ–º–ø–ª—è—Ä JSDom; –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É ü§¨
import jsdom from 'global-jsdom';

import './setup.units.mjs'; // üí°

import { IndexedDb } from './globals/IndexedDb.js';

register('some-css-modules-loader');

jsdom(undefined, {
  url: 'https://test.example.com', // ‚ö†Ô∏è –ù–µ—É–∫–∞–∑–∞–Ω–∏–µ —ç—Ç–æ–≥–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –±–æ–ª—å—à–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É ü§¨
});

// –ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —É–∫—Ä–∞—Å–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç.
// `history` –≤ JSDOM –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é; —Å–ª–µ–¥—É—é—â–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–ª—É—á–∞–µ–≤.
const pushState = globalThis.history.pushState.bind(globalThis.history);
globalThis.history.pushState = function mock_pushState(data, unused, url) {
  pushState(data, unused, url);
  globalThis.location.assign(url);
};

beforeEach(globalUIBeforeEach);
function globalUIBeforeEach() {
  globalThis.indexedDb = new IndexedDb();
}
```

–£ –≤–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è UI-—Ç–µ—Å—Ç–æ–≤: —é–Ω–∏—Ç-–ø–æ–¥–æ–±–Ω—ã–π (–≤ –∫–æ—Ç–æ—Ä–æ–º –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–æ–∫–∞–Ω—ã) –∏ –±–æ–ª–µ–µ —Å–∫–≤–æ–∑–Ω–æ–π (–≥–¥–µ –∑–∞–º–æ–∫–∞–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ IndexedDb, –Ω–æ –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ü–µ–ø–æ—á–∫–∏ —Ä–µ–∞–ª—å–Ω–∞). –ü–µ—Ä–≤—ã–π –æ–±—ã—á–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ —á–∏—Å—Ç—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º, –∞ –≤—Ç–æ—Ä–æ–π –æ–±—ã—á–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–≤–æ–∑–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —é–∑–∞–±–∏–ª–∏—Ç–∏ —Å –ø–æ–º–æ—â—å—é —á–µ–≥–æ-—Ç–æ –≤—Ä–æ–¥–µ [Playwright](https://playwright.dev/) –∏–ª–∏ [Puppeteer](https://pptr.dev/). –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–≤–æ–≥–æ.

```js
import { before, describe, mock, it } from 'node:test';

import { screen } from '@testing-library/dom';
import { render } from '@testing-library/react'; // –õ—é–±–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ (ex svelte)

// ‚ö†Ô∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ SomeOtherComponent –ù–ï —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–º–ø–æ—Ä—Ç–æ–º;
// —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è –∑–∞–º–æ–∫–∏–≤–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤.


describe('<SomeOtherComponent>', () => {
  let SomeOtherComponent;
  let calcSomeValue;

  before(async () => {
    // ‚ö†Ô∏è –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ: –º–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –î–û –∏–º–ø–æ—Ä—Ç–∞ –µ–≥–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è.

    // –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `--experimental-test-module-mocks`.
    calcSomeValue = mock.module('./calcSomeValue.js', { calcSomeValue: mock.fn() });

    ({ SomeOtherComponent } = await import('./SomeOtherComponent.jsx'));
  });

  describe('when calcSomeValue fails', () => {
    // –≠—Ç–æ –≤—ã –Ω–µ –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Å–Ω–∏–º–∫–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ –±—ã –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ:
    // –ö–æ–≥–¥–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–Ω–æ—Å—è—Ç—Å—è –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è,
    // —Ç–µ—Å—Ç —Å–Ω–∏–º–∫–∞ –æ—à–∏–±–æ—á–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –Ω–µ—É–¥–∞—á–µ–π
    // (–∏ —Å–Ω–∏–º–æ–∫ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏).

    it('should fail gracefully by displaying a pretty error', () => {
      calcSomeValue.mockImplementation(function mock__calcSomeValue() { return null });

      render(<SomeOtherComponent>);

      const errorMessage = screen.queryByText('unable');

      assert.ok(errorMessage);
    });
  });
});
```
